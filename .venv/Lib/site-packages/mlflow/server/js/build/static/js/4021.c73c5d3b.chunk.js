"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[4021],{9546:function(e,s,t){t.d(s,{_:function(){return r}});var n=t(49708),o=t(69986),a=t(34599),i=t(76118);const r=({traceIds:e})=>(0,n.I)({queryKey:[a.lA,e],queryFn:async({queryKey:[,e]})=>{const s=(0,i.chunk)(e,20),t=[];for(const n of s){const e=await Promise.all(n.map((e=>(0,o.Uv)(e))));t.push(...e)}return t}})},34599:function(e,s,t){t.d(s,{P4:function(){return o},lA:function(){return a},uz:function(){return n}});const n="GET_DATASET_RECORDS",o="SEARCH_EVALUATION_DATASETS",a="FETCH_TRACES"},69986:function(e,s,t){t.d(s,{RT:function(){return c},Rb:function(){return a},Uv:function(){return o},a_:function(){return u},fz:function(){return m},lc:function(){return g}});var n=t(12803);async function o(e,s){var t;if(!e)return;const[o,a]=await Promise.all([n.x.getExperimentTraceInfoV3(e),n.x.getExperimentTraceData(e)]);return a?{info:(null===o||void 0===o||null===(t=o.trace)||void 0===t?void 0:t.trace_info)||{},data:a}:void 0}async function a(e){if(!e)return;const[s,t]=await Promise.all([n.x.getExperimentTraceInfo(e).then((e=>e.trace_info||{})),n.x.getExperimentTraceData(e)]);return t?{info:s,data:t}:void 0}function i(e){if("trace_id"in e&&"span_id"in e){return!e.parent_span_id}const s=e;return!s.parent_span_id&&!s.parent_id}function r(e){var s;return((null===(s=e.data)||void 0===s?void 0:s.spans)||[]).find(i)||null}function l(e){return"string"===typeof e?e:JSON.stringify(e)}function d(e,s,t){var n;if(s in e){const t=e[s];if(void 0!==t)return l(t)}return void 0!==(null===(n=e.attributes)||void 0===n?void 0:n[t])?l(e.attributes[t]):null}function c(e){const s=r(e);return s?d(s,"inputs","mlflow.spanInputs"):null}function u(e){const s=r(e);return s?d(s,"outputs","mlflow.spanOutputs"):null}function m(e){const s={},t=e.info;return t.assessments&&Array.isArray(t.assessments)?(t.assessments.forEach((e=>{var t;if(!function(e){return"expectation"in e}(e))return;if(!1===e.valid)return;if("HUMAN"!==(null===(t=e.source)||void 0===t?void 0:t.source_type))return;const n=function(e){if("value"in e)return e.value;if("serialized_value"in e&&e.serialized_value)try{return JSON.parse(e.serialized_value.value)}catch{return e.serialized_value.value}return null}(e.expectation);void 0!==n&&null!==n&&(s[e.assessment_name]=n)})),s):s}function p(e){if("trace_id"in e&&"span_id"in e){var s;let t=null===(s=e.attributes)||void 0===s?void 0:s["mlflow.spanType"];if("string"===typeof t&&t.startsWith('"')&&t.endsWith('"'))try{t=JSON.parse(t)}catch{}return"RETRIEVER"===t}let t=e.span_type;if("string"===typeof t&&t.startsWith('"')&&t.endsWith('"'))try{t=JSON.parse(t)}catch{}return"RETRIEVER"===t}function g(e){const s=function(e){var s;const t=(null===(s=e.data)||void 0===s?void 0:s.spans)||[];if(0===t.length)return[];const n=t.filter(p);if(0===n.length)return[];const o=new Set;for(const i of n){const e="span_id"in i?i.span_id:i.context.span_id;e&&o.add(e)}const a=[];for(const i of n){let e,s=!0;if("trace_id"in i&&"span_id"in i)e=i.parent_span_id;else{const s=i;e=s.parent_span_id||s.parent_id}for(;e;){if(o.has(e)){s=!1;break}let n;for(const s of t)if(("span_id"in s?s.span_id:s.context.span_id)===e){n=s;break}if(!n)break;if("trace_id"in n&&"span_id"in n)e=n.parent_span_id;else{const s=n;e=s.parent_span_id||s.parent_id}}s&&a.push(i)}return a}(e);if(0===s.length)return null;const t=[];for(const a of s){let e=[],s="",i="";if("trace_id"in a&&"span_id"in a){var n;const t=a;s=t.span_id||"",i=t.name||s;let o=null===(n=t.attributes)||void 0===n?void 0:n["mlflow.spanOutputs"];if("string"===typeof o)try{o=JSON.parse(o)}catch{continue}o&&"object"===typeof o&&Array.isArray(o)&&(e=o.map((e=>{var s;return{doc_uri:e.doc_uri||e.uri||(null===(s=e.metadata)||void 0===s?void 0:s.doc_uri)||"",content:e.content||e.page_content||""}})))}else{var o;const t=a;s=(null===(o=t.context)||void 0===o?void 0:o.span_id)||"",i=t.name||s,t.outputs&&Array.isArray(t.outputs)&&(e=t.outputs.map((e=>({doc_uri:e.doc_uri||e.uri||"",content:e.content||e.page_content||""}))))}e.length>0&&t.push({span_id:s,span_name:i,documents:e})}return 0===t.length?null:{retrieved_documents:t}}},84021:function(e,s,t){t.d(s,{WB:function(){return Zi},rc:function(){return $e},tj:function(){return De},tl:function(){return Ee},sp:function(){return yr},_p:function(){return Pi},sG:function(){return Se},w_:function(){return Bi},o8:function(){return o},tU:function(){return an},js:function(){return ni},Te:function(){return ke},Rl:function(){return Re},TH:function(){return ui},$W:function(){return Fe},Pn:function(){return Ve},YO:function(){return Be},XQ:function(){return Me},$6:function(){return Te},$U:function(){return er},pR:function(){return we},h:function(){return cs},Mq:function(){return us},d9:function(){return is},BL:function(){return mi},kO:function(){return vi},R7:function(){return Ki},Xz:function(){return ai},Ie:function(){return ci},Wx:function(){return Ir},KW:function(){return pi},Zn:function(){return gi},K0:function(){return Xi},GY:function(){return fe}});var n=t(76118);let o=function(e){return e.Evaluations="_evaluations.json",e.Assessments="_assessments.json",e.Metrics="_metrics.json",e}({}),a=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({}),i=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e.TOTAL_TOKEN_COUNT="agent/total_token_count",e.TOTAL_INPUT_TOKEN_COUNT="agent/total_input_token_count",e.TOTAL_OUTPUT_TOKEN_COUNT="agent/total_output_token_count",e.DOCUMENT_RECALL="retrieval/ground_truth/document_recall",e.DOCUMENT_RATINGS="retrieval/ground_truth/document_ratings",e}({});const r=e=>{var s;return!0===(null===(s=e.metadata)||void 0===s?void 0:s[a.IS_OVERALL_ASSESSMENT])},l=e=>{var s;return(0,n.isNumber)(null===(s=e.metadata)||void 0===s?void 0:s[a.CHUNK_INDEX])},d=e=>Array.isArray(e)&&e.every((e=>(0,n.isPlainObject)(e)&&"doc_uri"in e&&"content"in e)),c=e=>Object.values(e||{}).find(d),u=(e,s,t)=>{const o=c(e)||[],i=c(s);return o.map(((e,s)=>{const o=null===i||void 0===i?void 0:i[s],r=(t||[]).filter((e=>(e.metadata||{})[a.CHUNK_INDEX]===s)),l=(0,n.groupBy)(r,"name");return Object.keys(l).forEach((e=>{l[e]=(0,n.orderBy)(l[e],"timestamp","desc")})),{docUrl:e.doc_uri,content:e.content,retrievalAssessmentsByName:l,target:null===o||void 0===o?void 0:o.content}}))};function m(e){if(!e)return;const{columns:s,data:t,filename:o}=e;if(!s||!Array.isArray(s))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "columns" array`);if(!t||!Array.isArray(t))throw new SyntaxError(`Artifact ${o} is malformed, it does not contain "data" array`);const a=s.map(((e,s)=>null!==e&&void 0!==e?e:`column_${s}`));return t.map((e=>(0,n.zipObject)(a,e)))}var p=t(68248),g=t(27299),v=t(27757),f=t(42747),h=t(44666),y=t(73408);const b="messages";let S=function(e){return e.OVERALL_ASSESSMENT="overall_assessment",e.SAFETY="safety",e.GROUNDEDNESS="groundedness",e.RETRIEVAL_GROUNDEDNESS="retrieval_groundedness",e.CORRECTNESS="correctness",e.RELEVANCE_TO_QUERY="relevance_to_query",e.CHUNK_RELEVANCE="chunk_relevance",e.RETRIEVAL_RELEVANCE="retrieval_relevance",e.CONTEXT_SUFFICIENCY="context_sufficiency",e.RETRIEVAL_SUFFICIENCY="retrieval_sufficiency",e.GUIDELINE_ADHERENCE="guideline_adherence",e.GUIDELINES="guidelines",e.GLOBAL_GUIDELINE_ADHERENCE="global_guideline_adherence",e}({});const I=[S.OVERALL_ASSESSMENT,S.CORRECTNESS,S.GLOBAL_GUIDELINE_ADHERENCE,S.GUIDELINE_ADHERENCE,S.GUIDELINES,S.RELEVANCE_TO_QUERY,S.CONTEXT_SUFFICIENCY,S.RETRIEVAL_SUFFICIENCY,S.CHUNK_RELEVANCE,S.RETRIEVAL_RELEVANCE,S.GROUNDEDNESS,S.RETRIEVAL_GROUNDEDNESS,S.SAFETY];S.OVERALL_ASSESSMENT,S.CORRECTNESS,S.GROUNDEDNESS,S.RETRIEVAL_GROUNDEDNESS,S.RELEVANCE_TO_QUERY,S.SAFETY,S.CHUNK_RELEVANCE,S.RETRIEVAL_RELEVANCE,S.CONTEXT_SUFFICIENCY,S.RETRIEVAL_SUFFICIENCY,S.GUIDELINE_ADHERENCE,S.GUIDELINES;let w=function(e){return e.YES="yes",e.NO="no",e.UNKNOWN="unknown",e}({});function x(e,s,t,n){return"pass-fail"===t.dtype?n===w.YES?{content:e.formatMessage({id:"pm1RNL",defaultMessage:"Pass"}),icon:(0,y.Y)("span",{css:(0,p.AH)({color:`${ne(s,t,{stringValue:w.YES})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,y.Y)(g.CheckCircleIcon,{css:(0,p.AH)({backgroundColor:oe(s,t,{stringValue:w.YES}),borderRadius:"50%"},"")})})}:n===w.NO?{content:e.formatMessage({id:"9cTaBs",defaultMessage:"Fail"}),icon:(0,y.Y)("span",{css:(0,p.AH)({color:`${ne(s,t,{stringValue:w.NO})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,y.Y)(g.XCircleIcon,{css:(0,p.AH)({backgroundColor:oe(s,t,{stringValue:w.NO}),borderRadius:"50%"},"")})})}:{content:e.formatMessage({id:"27XMby",defaultMessage:"Missing"}),icon:(0,y.Y)("span",{css:(0,p.AH)({color:`${ne(s,t,{stringValue:w.UNKNOWN})} !important`,svg:{width:"12px",height:"12px"}},""),children:(0,y.Y)(v.W,{css:(0,p.AH)({backgroundColor:oe(s,t,{stringValue:w.UNKNOWN}),borderRadius:"50%"},"")})})}:"boolean"===t.dtype?!0===n?{content:e.formatMessage({id:"1Ujhc3",defaultMessage:"True"})}:!1===n?{content:e.formatMessage({id:"nvjkTA",defaultMessage:"False"})}:{content:e.formatMessage({id:"keSIQ4",defaultMessage:"null"})}:{content:`${n}`}}let A=function(e){return e.IS_OVERALL_ASSESSMENT="is_overall_assessment",e.CHUNK_INDEX="chunk_index",e.IS_COPIED_FROM_AI="is_copied_from_ai",e}({});const E={response:(0,f.zR)({id:"WiaEQ3",defaultMessage:"Model output"})},T="expected_facts",C={expected_response:(0,f.zR)({id:"CX8ytv",defaultMessage:"Expected output"}),[T]:(0,f.zR)({id:"N1G2a5",defaultMessage:"Expected facts"})},N={[S.OVERALL_ASSESSMENT]:(0,f.zR)({id:"uoJWOm",defaultMessage:"Overall"}),[S.CORRECTNESS]:(0,f.zR)({id:"7+XQ3q",defaultMessage:"Correctness"}),[S.GROUNDEDNESS]:(0,f.zR)({id:"Ws58cc",defaultMessage:"Groundedness"}),[S.RETRIEVAL_GROUNDEDNESS]:(0,f.zR)({id:"wY58OE",defaultMessage:"Retrieval groundedness"}),[S.CONTEXT_SUFFICIENCY]:(0,f.zR)({id:"GRaplV",defaultMessage:"Context sufficiency"}),[S.RETRIEVAL_SUFFICIENCY]:(0,f.zR)({id:"mdzFsD",defaultMessage:"Retrieval sufficiency"}),[S.RELEVANCE_TO_QUERY]:(0,f.zR)({id:"Yhydp3",defaultMessage:"Relevance"}),[S.SAFETY]:(0,f.zR)({id:"jMUqD1",defaultMessage:"Safety"}),[S.CHUNK_RELEVANCE]:(0,f.zR)({id:"qnMgLj",defaultMessage:"Chunk relevance"}),[S.RETRIEVAL_RELEVANCE]:(0,f.zR)({id:"opUoF8",defaultMessage:"Retrieval relevance"}),[S.GUIDELINE_ADHERENCE]:(0,f.zR)({id:"xV6NWF",defaultMessage:"Guideline adherence"}),[S.GUIDELINES]:(0,f.zR)({id:"ls3868",defaultMessage:"Guidelines"}),[S.GLOBAL_GUIDELINE_ADHERENCE]:(0,f.zR)({id:"tUAhDM",defaultMessage:"Global guideline adherence"})},_={[S.CORRECTNESS]:(0,f.zR)({id:"i7UTwK",defaultMessage:"Correctness assessment is missing. This is likely because you have not provided an expected response (ground truth) or grading notes."}),[S.GROUNDEDNESS]:(0,f.zR)({id:"jPW0Lj",defaultMessage:"Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),[S.RETRIEVAL_GROUNDEDNESS]:(0,f.zR)({id:"TXPJuE",defaultMessage:"Retrieval Groundedness assessment is missing. This is likely because your agent is not returning retrieved_context."}),[S.CONTEXT_SUFFICIENCY]:(0,f.zR)({id:"g0tloS",defaultMessage:"Context sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."}),[S.RETRIEVAL_SUFFICIENCY]:(0,f.zR)({id:"ffIouW",defaultMessage:"Retrieval sufficiency assessment is missing. This is likely because your agent is not returning retrieved_context."})},Y={[S.OVERALL_ASSESSMENT]:(0,f.zR)({id:"hW5ehW",defaultMessage:"The overall assessment passes when all of the judges pass."}),[S.CORRECTNESS]:(0,f.zR)({id:"Y6gWro",defaultMessage:"The correctness LLM judge gives a binary evaluation and written rationale on whether the agent's generated response is factually accurate and semantically similar to the provided ground-truth response or grading notes."}),[S.GROUNDEDNESS]:(0,f.zR)({id:"+Wd9fs",defaultMessage:"The groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),[S.RETRIEVAL_GROUNDEDNESS]:(0,f.zR)({id:"6Q/0BO",defaultMessage:"The retrieval groundedness LLM judge returns a binary evaluation and written rationale on whether the generated response is factually consistent with the agent's retrieved context."}),[S.RELEVANCE_TO_QUERY]:(0,f.zR)({id:"oDwj2g",defaultMessage:"The relevance_to_query LLM judge determines whether the response is relevant to the input request."}),[S.SAFETY]:(0,f.zR)({id:"/gqx4n",defaultMessage:"The safety LLM judge returns a binary rating and a written rationale on whether the generated response has harmful or toxic content."}),[S.CHUNK_RELEVANCE]:(0,f.zR)({id:"aUOkOC",defaultMessage:"The chunk-relevance-precision LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),[S.RETRIEVAL_RELEVANCE]:(0,f.zR)({id:"rBydei",defaultMessage:"The retrieval-relevance LLM judge determines whether the chunks returned by the retriever are relevant to the input request. Precision is calculated as the number of relevant chunks returned divided by the total number of chunks returned. For example, if the retriever returns four chunks, and the LLM judge determines that three of the four returned documents are relevant to the request, then llm_judged/chunk_relevance/precision is 0.75."}),[S.CONTEXT_SUFFICIENCY]:(0,f.zR)({id:"bkWot5",defaultMessage:"The context sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),[S.RETRIEVAL_SUFFICIENCY]:(0,f.zR)({id:"fwxkdN",defaultMessage:"The retrieval sufficiency LLM judge determines whether the retrieved context is sufficient to generate the expected response."}),[S.GUIDELINE_ADHERENCE]:(0,f.zR)({id:"4Tg5Vr",defaultMessage:"The guideline adherence LLM judge determines whether the response adheres to the guidelines provided."}),[S.GUIDELINES]:(0,f.zR)({id:"98v9a0",defaultMessage:"The guidelines LLM judge determines whether the response adheres to the guidelines provided. All responses must adhere to guidelines."}),[S.GLOBAL_GUIDELINE_ADHERENCE]:(0,f.zR)({id:"zZ9sIi",defaultMessage:"The global guideline adherence LLM judge determines whether the response adheres to the global guidelines provided. All responses must adhere to global guidelines."})},R={[S.OVERALL_ASSESSMENT]:{[w.YES]:(0,f.zR)({id:"Za9+Cg",defaultMessage:"Pass"}),[w.NO]:(0,f.zR)({id:"j77+aP",defaultMessage:"Fail"})},[S.CHUNK_RELEVANCE]:{[w.YES]:(0,f.zR)({id:"B1Upnc",defaultMessage:"Relevant"}),[w.NO]:(0,f.zR)({id:"M+HfWb",defaultMessage:"Irrelevant"})},[S.RETRIEVAL_RELEVANCE]:{[w.YES]:(0,f.zR)({id:"++039K",defaultMessage:"Relevant"}),[w.NO]:(0,f.zR)({id:"akmaST",defaultMessage:"Irrelevant"})},[S.CONTEXT_SUFFICIENCY]:{[w.YES]:(0,f.zR)({id:"7S/ozs",defaultMessage:"Context sufficient"}),[w.NO]:(0,f.zR)({id:"aAAHaS",defaultMessage:"Context insufficient"})},[S.RETRIEVAL_SUFFICIENCY]:{[w.YES]:(0,f.zR)({id:"rBIGDf",defaultMessage:"Sufficient"}),[w.NO]:(0,f.zR)({id:"lhFnAG",defaultMessage:"Insufficient"})},[S.RELEVANCE_TO_QUERY]:{[w.YES]:(0,f.zR)({id:"rNkAcB",defaultMessage:"Relevant"}),[w.NO]:(0,f.zR)({id:"0M7VVC",defaultMessage:"Irrelevant"})},[S.GROUNDEDNESS]:{[w.YES]:(0,f.zR)({id:"/2InJv",defaultMessage:"Grounded"}),[w.NO]:(0,f.zR)({id:"ZfsnMj",defaultMessage:"Not grounded"})},[S.RETRIEVAL_GROUNDEDNESS]:{[w.YES]:(0,f.zR)({id:"e515YD",defaultMessage:"Grounded"}),[w.NO]:(0,f.zR)({id:"uSVfB9",defaultMessage:"Not grounded"})},[S.CORRECTNESS]:{[w.YES]:(0,f.zR)({id:"eSxQmg",defaultMessage:"Correct"}),[w.NO]:(0,f.zR)({id:"LhxSrc",defaultMessage:"Incorrect"})},[S.SAFETY]:{[w.YES]:(0,f.zR)({id:"DMOaoR",defaultMessage:"Safe"}),[w.NO]:(0,f.zR)({id:"CX/MSu",defaultMessage:"Unsafe"})},[S.GUIDELINE_ADHERENCE]:{[w.YES]:(0,f.zR)({id:"ZNYFUr",defaultMessage:"Adheres to guidelines"}),[w.NO]:(0,f.zR)({id:"hIBLi9",defaultMessage:"Violates guidelines"})},[S.GUIDELINES]:{[w.YES]:(0,f.zR)({id:"luV/3W",defaultMessage:"Adheres to guidelines"}),[w.NO]:(0,f.zR)({id:"WmgIQ+",defaultMessage:"Violates guidelines"})},[S.GLOBAL_GUIDELINE_ADHERENCE]:{[w.YES]:(0,f.zR)({id:"mtYPI8",defaultMessage:"Adheres to global guidelines"}),[w.NO]:(0,f.zR)({id:"rZyNgx",defaultMessage:"Violates global guidelines"})}},M=e=>{var s;return"AI_JUDGE"===(null===e||void 0===e||null===(s=e.source)||void 0===s?void 0:s.sourceType)},k=e=>{let s=D(e,"request");return(0,n.isNil)(s)&&(s=D(e,b)),(0,n.isNil)(s)&&!(0,n.isNil)(e.inputs)&&Object.keys(e.inputs).length>0&&(s=K(e.inputs)),((0,n.isNil)(s)||""===s)&&(s=e.evaluationId),s},D=(e,s)=>{var t,o;if(!(0,n.isNil)(e.inputsTitle))return"string"===typeof e.inputsTitle?e.inputsTitle:JSON.stringify(e.inputsTitle);let a;const i=e.inputs[s];var r;if((0,n.isPlainObject)(i)&&!(0,n.isNil)(i[b])&&Array.isArray(i[b])&&!(0,n.isNil)(null===(t=i[b][0])||void 0===t?void 0:t.content))a=null===(r=i[b][i[b].length-1])||void 0===r?void 0:r.content;else if((0,n.isNil)(i)||!Array.isArray(i)||(0,n.isNil)(null===(o=i[0])||void 0===o?void 0:o.content))a=i?K(i):void 0;else{var l;a=null===(l=i[i.length-1])||void 0===l?void 0:l.content}return a},F=e=>{var s;return!0===(null===(s=e.metadata)||void 0===s?void 0:s[A.IS_OVERALL_ASSESSMENT])},O=e=>{var s;return(0,n.isNumber)(null===(s=e.metadata)||void 0===s?void 0:s[A.CHUNK_INDEX])},V=e=>{var s,t;const o=null!==(s=null!==(t=e.stringValue)&&void 0!==t?t:e.numericValue)&&void 0!==s?s:e.booleanValue;if(!(0,n.isNil)(o))return o};function L(e,s){let t=e;const n=t.startsWith("#");n&&(t=e.slice(1));return`${n?"#":""}${t}${Math.round(255*Math.min(Math.max(s,0),1)).toString(16).toUpperCase()}`}const H=[S.GUIDELINE_ADHERENCE,S.GUIDELINES,S.GLOBAL_GUIDELINE_ADHERENCE,S.RELEVANCE_TO_QUERY,S.CONTEXT_SUFFICIENCY,S.RETRIEVAL_SUFFICIENCY,S.CORRECTNESS,S.GROUNDEDNESS,S.RETRIEVAL_GROUNDEDNESS,S.SAFETY],U=[S.CHUNK_RELEVANCE],z=({name:e,isOverallAssessment:s,value:t,rationale:n,metadata:o={}})=>{var a;const i=null!==(a=(0,h.w)())&&void 0!==a?a:"";return{booleanValue:"boolean"===typeof t?t:null,numericValue:null,stringValue:"boolean"!==typeof t?t:null,name:e,metadata:s?{...o,[A.IS_OVERALL_ASSESSMENT]:!0}:o,rationale:null!==n&&void 0!==n?n:null,source:{sourceId:i,sourceType:"HUMAN",metadata:{}},timestamp:Date.now(),isDraft:!0}},B=e=>"isDraft"in e&&e.isDraft,$=e=>(0,n.orderBy)(Object.entries(e),(([e,s],t)=>{const n=I.indexOf(e);return-1!==n?n:null!==(o=null===(a=s[s.length-1])||void 0===a?void 0:a.timestamp)&&void 0!==o?o:t;var o,a})),j=e=>{var s,t;return null!==(s=null===(t=e.overallAssessments)||void 0===t?void 0:t.filter((e=>!B(e))).some((e=>!M(e))))&&void 0!==s&&s},P=e=>{var s,t;return"HUMAN"===(null===(s=e.source)||void 0===s?void 0:s.sourceType)&&!(null!==(t=e.metadata)&&void 0!==t&&t[A.IS_COPIED_FROM_AI])},q=e=>{var s;return null===(s=e.metadata)||void 0===s?void 0:s[A.CHUNK_INDEX]},K=e=>(0,n.isPlainObject)(e)||Array.isArray(e)?JSON.stringify(e,void 0,2):e,G=e=>{if(e){const s=Boolean(e.rationale),t=!(0,n.isNil)(V(e)),o=Boolean(e.errorMessage);return!(s||t||o)}return!1},W=e=>Array.isArray(e)&&e.every((e=>(0,n.isPlainObject)(e)&&"doc_uri"in e&&"content"in e)),Q="#02B30214",J="#F000400F",X="#077A9D",Z="#FFAB00",ee="#99DDB4",se="#FCA4A1",te="#02B30214",ne=(e,s,t)=>{if("pass-fail"===s.dtype){if((null===t||void 0===t?void 0:t.stringValue)===w.YES)return e.isDarkMode?e.colors.green400:e.colors.green600;if((null===t||void 0===t?void 0:t.stringValue)===w.NO)return e.isDarkMode?e.colors.red400:e.colors.red600}return null!==t&&void 0!==t&&t.errorMessage?e.colors.textValidationWarning:e.colors.grey400},oe=(e,s,t,o=!1)=>{if("pass-fail"===s.dtype){if((null===t||void 0===t?void 0:t.stringValue)===w.YES)return te;if((null===t||void 0===t?void 0:t.stringValue)===w.NO)return e.isDarkMode?L(e.colors.red800,.6):e.colors.red200;if(!o&&null!==t&&void 0!==t&&t.errorMessage)return""}else if("boolean"===s.dtype)return(0,n.isNil)(null===t||void 0===t?void 0:t.booleanValue)?"":t.booleanValue?te:e.isDarkMode?e.colors.red800:e.colors.red200;return""},ae=(e,s,t,o)=>o?"#f09065":"pass-fail"===s.dtype?t===w.YES?ee:t===w.NO?se:e.isDarkMode?e.colors.grey800:e.colors.grey200:"boolean"===s.dtype?(0,n.isNil)(t)?e.isDarkMode?e.colors.grey800:e.colors.grey200:t?ee:se:e.isDarkMode?e.colors.grey800:e.colors.grey200;var ie=t(46709),re=t(58024),le=t(27637);const de=re.zy,ce=le.ok,ue=le.N_,me="assessmentFilter";function pe(e){if("undefined"!==e)return"true"===e||"false"!==e&&e}function ge(e,s){if("pass-fail"===e.dtype){if("undefined"===s)return;return s}return"boolean"===e.dtype?"true"===s||"false"!==s&&void 0:s}function ve(e){return void 0===e||null===e?"undefined":`${e}`}const fe=(e,s)=>{const[t,n]=(0,ie.useState)(s&&e.find((e=>e.id===s.key))?s:void 0);return[(0,ie.useMemo)((()=>{if(t&&e.find((e=>e.id===t.key)))return t}),[t,e]),n]};var he=t(66916),ye=t(79081);const be=(0,ie.createContext)({table:void 0,setTable:()=>{},selectedRowIds:[],setSelectedRowIds:()=>{}}),Se=({children:e})=>{const[s,t]=(0,ie.useState)(),[n,o]=(0,ie.useState)([]),a=(0,ie.useMemo)((()=>({table:s,setTable:t,selectedRowIds:n,setSelectedRowIds:o})),[s,n]);return(0,y.Y)(be.Provider,{value:a,children:e})},Ie=({experimentIds:e,visible:s,selectedTraces:t,handleClose:n,deleteTraces:o})=>{const a=(0,f.tz)(),[i,r]=(0,ie.useState)(""),[l,d]=(0,ie.useState)(!1),c=t.map((e=>e.evaluationId));return(0,y.FD)(ye.d,{componentId:"eval-tab.delete_traces-modal",title:(0,y.Y)(f.sA,{id:"gRz1nB",defaultMessage:"{count, plural, one {Delete Trace} other {Delete Traces}}",values:{count:c.length}}),visible:s,onCancel:n,okText:(0,y.Y)(f.sA,{id:"g56Cuk",defaultMessage:"Delete {count, plural, one { # trace } other { # traces }}",values:{count:c.length}}),onOk:()=>{(async()=>{try{var s;await o(null!==(s=e[0])&&void 0!==s?s:"",c),n()}catch(t){r(a.formatMessage({id:"zhzZUu",defaultMessage:"An error occured while attempting to delete traces. Please refresh the page and try again."}))}d(!1)})(),d(!0)},okButtonProps:{loading:l,danger:!0},children:[i&&(0,y.Y)(v.T.Paragraph,{color:"error",children:i}),(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"kmtWGf",defaultMessage:"{count, plural, one { # trace } other { # traces }} will be deleted.",values:{count:c.length}})})}),(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)(f.sA,{id:"VfGJFc",defaultMessage:"Deleted traces cannot be restored. Are you sure you want to proceed?"})})]})},we=()=>1e3;var xe=t(55215),Ae=t(21636);let Ee=function(e){return e.EQUALS="=",e.NOT_EQUALS="!=",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_THAN_OR_EQUALS=">=",e.LESS_THAN_OR_EQUALS="<=",e.CONTAINS="CONTAINS",e}({}),Te=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TRACE_INFO="TRACE_INFO",e.INPUT="INPUT",e.INTERNAL_MONITOR_REQUEST_TIME="INTERNAL_MONITOR_REQUEST_TIME",e}({}),Ce=function(e){return e.ASSESSMENT="ASSESSMENT",e.EXPECTATION="EXPECTATION",e.TAG="TAG",e.INFO="INFO",e}({});const Ne={[Ce.ASSESSMENT]:"Assessments",[Ce.EXPECTATION]:"Expectations",[Ce.TAG]:"Tags",[Ce.INFO]:"\xa0"},_e="user",Ye="session",Re="response",Me="trace_id",ke="request_time",De="execution_duration",Fe="state",Oe="source",Ve="tags",Le="trace_name",He="request",Ue="run_name",ze="logged_model",Be="tokens",$e="custom_metadata",je="span.name",Pe="span.type",qe="span.content",Ke=[De,ke,Ye],Ge=[De,ke],We=[i.CHUNK_RELEVANCE,i.TOTAL_INPUT_TOKEN_COUNT,i.TOTAL_OUTPUT_TOKEN_COUNT,i.TOTAL_TOKEN_COUNT,i.DOCUMENT_RECALL,i.DOCUMENT_RATINGS];function Qe(e){return e+"_assessment_column"}function Je(e){return e+"_expectation_column"}const Xe=(e,s,t,o,a,i)=>(0,ie.useMemo)((()=>{const r=null!==i&&void 0!==i?i:ls(s);let l=[];if(r)l=[{id:He,label:e.formatMessage({id:"Ey+oLI",defaultMessage:"Request"}),type:Te.INPUT,group:Ce.INFO}];else{let e=new Set,t=new Set;s.forEach((s=>{const{inputs:n}=s;e=new Set([...e,...Object.keys(n||{})]),t=new Set([...t,...Object.keys(s.traceInfo||{})])})),l=[...e].map((e=>({id:e,label:e,type:Te.INPUT})))}const d=t.map((e=>({id:Qe(e.name),label:e.displayName,type:Te.ASSESSMENT,assessmentInfo:e,group:Ce.ASSESSMENT}))).filter((e=>!e.assessmentInfo.isRetrievalAssessment&&!We.includes(e.assessmentInfo.name)));let c;const u={};if(r){c=[{id:Me,label:e.formatMessage({id:"cv/bGM",defaultMessage:"Trace ID"}),type:Te.TRACE_INFO,group:Ce.INFO},{id:Le,label:e.formatMessage({id:"fq8v6G",defaultMessage:"Trace name"}),type:Te.TRACE_INFO,group:Ce.INFO},{id:Re,label:e.formatMessage({id:"BU8Jni",defaultMessage:"Response"}),type:Te.TRACE_INFO,group:Ce.INFO},{id:_e,label:e.formatMessage({id:"JcRo6a",defaultMessage:"User"}),type:Te.TRACE_INFO,group:Ce.INFO},{id:Ye,label:e.formatMessage({id:"womPSY",defaultMessage:"Session"}),type:Te.TRACE_INFO,group:Ce.INFO},{id:De,label:e.formatMessage({id:"FnG9dP",defaultMessage:"Execution time"}),filterLabel:e.formatMessage({id:"rRhMQt",defaultMessage:"Execution time (ms)"}),type:Te.TRACE_INFO,group:Ce.INFO},{id:ke,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:Te.TRACE_INFO,group:Ce.INFO},{id:Fe,label:e.formatMessage({id:"ySuIn+",defaultMessage:"State"}),type:Te.TRACE_INFO,group:Ce.INFO},{id:Oe,label:e.formatMessage({id:"vM/qUz",defaultMessage:"Source"}),type:Te.TRACE_INFO,group:Ce.INFO},{id:ze,label:e.formatMessage({id:"ofr72S",defaultMessage:"Version"}),type:Te.TRACE_INFO,group:Ce.INFO},{id:Be,label:e.formatMessage({id:"q/zoT3",defaultMessage:"Tokens"}),type:Te.TRACE_INFO,group:Ce.INFO},(0,n.isNil)(o)&&{id:Ue,label:e.formatMessage({id:"dVh69l",defaultMessage:"Run name"}),type:Te.TRACE_INFO,group:Ce.INFO},!1];const t=[...s,...a||[]],i={};t.forEach((e=>{var s;const t=null===(s=e.traceInfo)||void 0===s?void 0:s.trace_metadata;t&&Object.keys(t).forEach((e=>{e.startsWith(es)||i[e]||(i[e]={id:as(e),label:e,type:Te.TRACE_INFO,group:Ce.INFO})}));const n=e.targets;n&&Object.keys(n).forEach((e=>{u[e]||(u[e]={id:Je(e),label:e,type:Te.EXPECTATION,group:Ce.EXPECTATION,expectationName:e})}))})),c=[...c,...Object.values(i)];{const e={};t.map((e=>{var s;return null===(s=e.traceInfo)||void 0===s?void 0:s.tags})).forEach((s=>{Object.keys(s||{}).forEach((s=>{s.startsWith(es)||e[s]||(e[s]={id:os(s),label:s,type:Te.TRACE_INFO,group:Ce.TAG})}))}));const s=Object.values(e);c=[...c,...s]}}else c=s.some((e=>!(0,n.isNil)(e.requestTime)))?[{id:ke,label:e.formatMessage({id:"/Aup8Q",defaultMessage:"Request time"}),type:Te.INTERNAL_MONITOR_REQUEST_TIME}]:[];return[...l,...c,...d,...Object.values(u)].filter((e=>Boolean(e)))}),[s,e,t,o,a,i]),Ze="mlflow.sourceRun",es="mlflow.",ss="monitor",ts=e=>(null===e||void 0===e?void 0:e.trace_id)||"",ns=e=>e.split(":").pop(),os=e=>`${Ve}:${e}`,as=e=>`${$e}:${e}`,is=e=>(0,n.uniq)(e.map((e=>Object.keys(e.tags||{}).filter((e=>e&&!e.startsWith(es))))).flat()),rs=(e,s)=>e&&s?e.reduce(((e,t)=>{var n;const o=t.assessments||[],a=o.filter((e=>{var t;const n=null===(t=e.metadata)||void 0===t?void 0:t[Ae.Vg];return!n||n===s}));return(null===(n=t.tags)||void 0===n?void 0:n[Ae.Ex])?e:a.length===o.length?(e.push(t),e):(e.push({...t,assessments:a}),e)}),[]):e,ls=e=>e.length>0&&Boolean(e[0].traceInfo),ds=e=>{try{return JSON.parse(e)}catch{return e}},cs=e=>{var s;return e.request_preview||e.request||(null===(s=e.trace_metadata)||void 0===s?void 0:s["mlflow.traceInputs"])||""},us=e=>{var s;return e.response_preview||e.response||(null===(s=e.trace_metadata)||void 0===s?void 0:s["mlflow.traceOutputs"])||""},ms=["agent/latency_seconds"];const ps=e=>{var s,t,n,o,a;const r=null===(s=e.feedback)||void 0===s?void 0:s.value,l=e.assessment_name===i.OVERALL_ASSESSMENT,d=(e=>{var s,t,n;if(null===(s=e.source)||void 0===s||!s.source_type)return;const o=null===(t=e.source)||void 0===t?void 0:t.source_type;let a;return a="LLM_JUDGE"===o?"AI_JUDGE":o,{sourceType:a,sourceId:(null===(n=e.source)||void 0===n?void 0:n.source_id)||"",metadata:{}}})(e),c=(null===(t=e.feedback)||void 0===t?void 0:t.error)||e.error;return{name:e.assessment_name,stringValue:"string"===typeof r?r:void 0,booleanValue:"boolean"===typeof r?r:void 0,numericValue:"number"===typeof r?r:void 0,errorCode:null===c||void 0===c?void 0:c.error_code,errorMessage:null===c||void 0===c?void 0:c.error_message,rationale:(null===(n=e.metadata)||void 0===n?void 0:n.root_cause_rationale)||e.rationale,source:d,rootCauseAssessment:l?{assessmentName:(null===(o=e.metadata)||void 0===o?void 0:o.root_cause_assessment)||"",suggestedActions:null===(a=e.metadata)||void 0===a?void 0:a.suggested_action}:void 0,metadata:e.metadata}},gs=e=>{var s;const t=ts(e),o=[],a={},r={};null===(s=e.assessments)||void 0===s||s.forEach((e=>{const s=e.assessment_name;ms.includes(s)||!1!==e.valid&&((e=>Boolean("expectation"in e&&e.expectation))(e)?function(e,s){const t=e.assessment_name,n=(0,xe.ed)(e);Array.isArray(n)?s[t]=n.map((e=>"string"===typeof e?ds(e):e)):s[t]="string"===typeof n?ds(n):n}(e,r):function(e,s,t){const n=e.assessment_name,o=ps(e);n===i.OVERALL_ASSESSMENT&&s.push(o),t[n]||(t[n]=[]),t[n].push(o)}(e,o,a))}));const l=cs(e),d=us(e);let c=l,u={},m={};try{var p;u=JSON.parse(l);const e=u.messages;var g;if(Array.isArray(e)&&!(0,n.isNil)(null===(p=e[0])||void 0===p?void 0:p.content))c=null===(g=e[e.length-1])||void 0===g?void 0:g.content;else c=K(u)}catch{u={request:l}}try{m={response:JSON.parse(d)}}catch{m={response:d}}return{evaluationId:t,requestId:e.client_request_id||t,inputsId:t,inputsTitle:c,inputs:u,outputs:m,targets:r,overallAssessments:o,responseAssessmentsByName:a,metrics:{},traceInfo:e}},vs=e=>ls(e)?e.map((e=>{if(!e.traceInfo)return e;const s=gs(e.traceInfo);return{...e,...s}})):e;const fs=(e,s)=>Object.fromEntries(Object.entries(e).map((([e,t])=>[e,t.filter((e=>{var t;return Number(null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.span_output_key)===s}))])).filter((([e,s])=>s.length>0)));var hs=t(9546);var ys={name:"bck6m5",styles:"display:flex;min-height:100%;flex-wrap:nowrap"};const bs=({traceIds:e,onClose:s})=>{const t=(0,f.tz)(),{theme:o}=(0,v.u)(),{data:a,isLoading:i}=(0,hs._)({traceIds:e}),r=(0,ie.useMemo)((()=>(0,n.compact)(a)),[a]);return(0,y.Y)(ye.d,{componentId:"mlflow.genai-traces-table.compare-modal",visible:!0,title:t.formatMessage({id:"c4OuCI",defaultMessage:"Compare traces"}),onCancel:s,size:"wide",verticalSizing:"maxed_out",footer:null,dangerouslySetAntdProps:{width:"95%"},children:(0,y.Y)("div",{css:(0,p.AH)({height:"100%",overflow:"auto",marginLeft:-o.spacing.lg,marginRight:-o.spacing.lg},""),children:(0,y.Y)("div",{css:ys,children:i||!r||0===r.length?(0,y.Y)(v.T.Text,{children:t.formatMessage({id:"AGi/De",defaultMessage:"Loading traces\u2026"})}):r.map(((s,t)=>(0,y.Y)("div",{css:(0,p.AH)({flex:"1 1 0",minHeight:"100%",minWidth:0,borderRight:t<r.length-1?`1px solid ${o.colors.border}`:"none"},""),children:(0,y.Y)(xe.a8,{modelTrace:s,initialActiveView:"summary",isInComparisonView:!0})},e[t])))})})})},Ss=e=>{const{traceActions:s,experimentId:t,selectedTraces:o,traceInfos:a,setRowSelection:i}=e,{table:r,selectedRowIds:l}=(0,ie.useContext)(be),d=(0,ie.useMemo)((()=>vs(l.map((e=>{const s=null===a||void 0===a?void 0:a.find((s=>ts(s)===e));if(s)return{evaluationId:s.trace_id,requestId:s.client_request_id||s.trace_id,inputsId:s.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:s}})).filter((e=>!(0,n.isNil)(e))))),[l,a]),c=o||d;return(0,y.Y)(Is,{experimentId:t,selectedTraces:c,traceActions:s,setRowSelection:null!==i&&void 0!==i?i:null===r||void 0===r?void 0:r.setRowSelection})},Is=e=>{var s,t,o,a,i,r;const{experimentId:l,selectedTraces:d,traceActions:c,setRowSelection:u}=e,m=(0,f.tz)(),[p,h]=(0,ie.useState)(!1),[b,S]=(0,ie.useState)(!1),I=(0,ie.useCallback)((()=>{1===d.length&&d[0].traceInfo&&null!==c&&void 0!==c&&c.editTags&&c.editTags.showEditTagsModalForTrace(d[0].traceInfo)}),[d,c]),w=(0,ie.useCallback)((()=>{h(!0)}),[]),x=(0,ie.useCallback)((()=>{S(!0)}),[]),A=(0,ie.useCallback)((()=>{S(!1)}),[]),E=(0,ie.useCallback)((async(e,s)=>{var t,n;await(null===c||void 0===c||null===(t=c.deleteTracesAction)||void 0===t||null===(n=t.deleteTraces)||void 0===n?void 0:n.call(t,e,s)),null===u||void 0===u||u({})}),[u,c]),T=Boolean(null===c||void 0===c?void 0:c.exportToEvals),C=Boolean(null===c||void 0===c?void 0:c.editTags),N=Boolean(null===c||void 0===c?void 0:c.deleteTracesAction),_=(0,ie.useCallback)((()=>{var e,s;null===c||void 0===c||null===(e=c.exportToEvals)||void 0===e||null===(s=e.setShowExportTracesToDatasetsModal)||void 0===s||s.call(e,!0)}),[null===c||void 0===c?void 0:c.exportToEvals]),Y=null===c||void 0===c||null===(s=c.exportToEvals)||void 0===s?void 0:s.showExportTracesToDatasetsModal,R=d.length>1,M=0===d.length,k=!T&&!C&&!N,D=d.length>=2&&d.length<4;if(k)return null;const F=(0,y.Y)(v.B,{componentId:"mlflow.genai-traces-table.actions-dropdown",disabled:M,type:"primary",endIcon:(0,y.Y)(g.ChevronDownIcon,{}),children:m.formatMessage({id:"PwQiIn",defaultMessage:"Actions{count}"},{count:M?"":` (${d.length})`})});return(0,y.FD)(y.FK,{children:[(0,y.FD)(g.DropdownMenu.Root,{children:[M?(0,y.Y)(ye.T,{componentId:"mlflow.genai-traces-table.actions-disabled-tooltip",content:m.formatMessage({id:"HbgpOU",defaultMessage:"Select one or more traces to add to an evaluation or edit the traces."}),children:(0,y.Y)("div",{children:(0,y.Y)(g.DropdownMenu.Trigger,{asChild:!0,children:F})})}):(0,y.Y)(g.DropdownMenu.Trigger,{asChild:!0,children:F}),(0,y.FD)(g.DropdownMenu.Content,{children:[(0,y.Y)(g.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.compare-traces",onClick:x,disabled:!D,children:m.formatMessage({id:"HrDWRj",defaultMessage:"Compare"})}),(0,y.Y)(g.DropdownMenu.Separator,{}),T&&(0,y.Y)(y.FK,{children:(0,y.FD)(g.DropdownMenu.Group,{children:[(0,y.Y)(g.DropdownMenu.Label,{children:m.formatMessage({id:"xiFkTH",defaultMessage:"Use for evaluation"})}),(0,y.Y)(g.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.export-to-datasets",onClick:_,children:m.formatMessage({id:"QcEYpD",defaultMessage:"Add to evaluation dataset"})})]})}),(C||N)&&(0,y.FD)(y.FK,{children:[T&&(0,y.Y)(g.DropdownMenu.Separator,{}),(0,y.FD)(g.DropdownMenu.Group,{children:[(0,y.Y)(g.DropdownMenu.Label,{children:m.formatMessage({id:"gerwuf",defaultMessage:"Edit"})}),C&&(0,y.Y)(g.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.edit-tags",onClick:I,disabled:R,children:m.formatMessage({id:"A7jptW",defaultMessage:"Edit tags"})}),N&&(0,y.Y)(g.DropdownMenu.Item,{componentId:"mlflow.genai-traces-table.delete-traces",onClick:w,disabled:null===c||void 0===c||null===(t=c.deleteTracesAction)||void 0===t?void 0:t.isDisabled,disabledReason:null===c||void 0===c||null===(o=c.deleteTracesAction)||void 0===o?void 0:o.disabledReason,children:m.formatMessage({id:"G6CJOv",defaultMessage:"Delete traces"})})]})]})]})]}),null===c||void 0===c||null===(a=c.editTags)||void 0===a?void 0:a.EditTagsModal,Y&&(null===c||void 0===c||null===(i=c.exportToEvals)||void 0===i||null===(r=i.renderExportTracesToDatasetsModal)||void 0===r?void 0:r.call(i,{selectedTraceInfos:(0,n.compact)(d.map((e=>e.traceInfo)))})),p&&(null===c||void 0===c?void 0:c.deleteTracesAction)&&(0,y.Y)(Ie,{experimentIds:[l],visible:p,selectedTraces:d,handleClose:()=>h(!1),deleteTraces:E}),b&&(0,y.Y)(bs,{traceIds:(0,n.compact)(d.map((e=>{var s;return null===(s=e.traceInfo)||void 0===s?void 0:s.trace_id}))),onClose:A})]})},ws=[Ce.INFO,Ce.ASSESSMENT,Ce.EXPECTATION,Ce.TAG],xs=[Me,He,Re,Ye,_e,Le,ze,Be],As=[i.OVERALL_ASSESSMENT],Es=Object.fromEntries(ws.map(((e,s)=>[e,s]))),Ts=Object.fromEntries(xs.map(((e,s)=>[e,s]))),Cs=Object.fromEntries(As.map(((e,s)=>[e,s])));function Ns(e,s){return[...e].sort(((e,t)=>{var n,o;if(s){if(e.id===He)return-1;if(t.id===He)return 1}const a=null!==(n=e.group)&&void 0!==n?n:Ce.INFO,i=null!==(o=t.group)&&void 0!==o?o:Ce.INFO,r=Es[a]-Es[i];if(0!==r)return r;if(a===Ce.INFO){var l,d;const s=null!==(l=Ts[e.id])&&void 0!==l?l:1/0,n=null!==(d=Ts[t.id])&&void 0!==d?d:1/0;return s!==n?s-n:e.label.localeCompare(t.label)}if(a===Ce.ASSESSMENT){var c,u;const s=null!==(c=Cs[e.id])&&void 0!==c?c:1/0,n=null!==(u=Cs[t.id])&&void 0!==u?u:1/0;return s!==n?s-n:e.label.localeCompare(t.label)}return Ce.EXPECTATION,e.label.localeCompare(t.label)}))}const _s=(e,s)=>e.sort(((e,t)=>{const n=e=>{var t;const n=null===(t=s.find((s=>s.id===e.id)))||void 0===t?void 0:t.type;return n===Te.INPUT?1:e.id===Le?2:n===Te.TRACE_INFO?3:n===Te.INTERNAL_MONITOR_REQUEST_TIME?4:n===Te.ASSESSMENT?5:999},o=n(e)-n(t);if(0!==o)return o;const a=s.find((s=>s.id===e.id)),r=s.find((e=>e.id===t.id));return(null===a||void 0===a?void 0:a.type)===Te.ASSESSMENT&&(null===r||void 0===r?void 0:r.type)===Te.ASSESSMENT?a.id===i.OVERALL_ASSESSMENT?-1:r.id===i.OVERALL_ASSESSMENT?1:(a.label||"").localeCompare(r.label||""):0})),Ys=(e,s)=>{var t;switch(s){case ke:case De:case Ve:case Fe:return e[s];case Oe:return e.tags;case Me:return e.trace_id;case Ye:return null===(t=e.tags)||void 0===t?void 0:t["mlflow.trace.session"];default:throw new Error(`Unknown column id: ${s}`)}};function Rs(e){const s=new Map,t=new Map;return null===e||void 0===e||e.forEach((e=>{let n=ls([e])?cs(e.traceInfo):e.inputsId;if(s.has(n)){const s=(t.get(e.inputsId)||0)+1;t.set(e.inputsId,s),n=`${e.inputsId}_${s}`}s.set(n,e)})),s}function Ms(e,s){if((0,n.isNil)(s))return e.map((e=>({currentRunValue:e})));const t=Rs(s),o=Rs(e),a=new Set([...o.keys(),...t.keys()]);return Array.from(a).map((e=>({currentRunValue:o.get(e),otherRunValue:t.get(e)})))}var ks=t(90061),Ds=t(49460),Fs=t(76256),Os=t(49708);const Vs=()=>{const{theme:e}=(0,v.u)();return(0,y.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:e.spacing.sm,svg:{width:"12px",height:"12px"},color:e.colors.textValidationWarning},""),children:[(0,y.Y)(v.k,{css:(0,p.AH)({color:e.colors.textValidationWarning},"")}),(0,y.Y)(f.sA,{id:"HdEgbb",defaultMessage:"Error"})," "]})};var Ls={name:"rhxkjj",styles:"height:20px"};const Hs=({isComparing:e})=>{const{theme:s}=(0,v.u)();return(0,y.Y)("span",{css:Ls,children:e&&(0,y.Y)("span",{css:(0,p.AH)({fontStyle:"italic",color:s.colors.textSecondary},""),children:"null"})})},Us=e=>{const{first:s,second:t,gap:n,borderRadius:o,marginY:a}=e,{theme:i}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n||i.spacing.sm,borderRadius:o||i.legacyBorders.borderRadiusMd,marginTop:a||"auto",marginBottom:a||"auto"},""),children:[s,t]})};var zs=t(36476);const Bs=fetch,$s=async(e,s,t,n)=>{const o={method:s,signal:n,headers:{...t?{"Content-Type":"application/json"}:{},...Ps(document.cookie)}};t&&(o.body=JSON.stringify(t));const a=await Bs(e,o);if(!a.ok){const e=(0,zs.a$)(a);try{const s=await(await a.json()).message;s&&(e.message=s)}catch{}throw e}return a.json()};const js=e=>{const s="mlflow-request-header-",t=function(e=document.cookie){return e.split(";").reduce(((e,s)=>{const[t,n]=s.trim().split("=");return e[t]=decodeURIComponent(n||""),e}),{})}(e);return t&&0!==Object.keys(t).length?Object.keys(t).filter((e=>e.startsWith(s))).reduce(((e,s)=>({...e,[s.substring(22)]:t[s]})),{}):{}},Ps=e=>({...js(e)});var qs=t(12608),Ks=t.n(qs);class Gs{static getEntryPointName(e){const s=e[Gs.entryPointTag];return s?s.value:""}static getSourceType(e){const s=e[Gs.sourceTypeTag];return s?s.value:""}static dropExtension(e){return e.replace(/(.*[^/])\.[^/.]+$/,"$1")}static baseName(e){const s=e.split("/");return s[s.length-1]}static formatSource(e){const s=Gs.getSourceName(e),t=Gs.getSourceType(e),n=Gs.getEntryPointName(e);if("PROJECT"===t){let e=Gs.dropExtension(Gs.baseName(s));return n&&"main"!==n&&(e+=":"+n),e}if("JOB"===t){const t="mlflow.databricks.jobID",n="mlflow.databricks.jobRunID",o=e&&e[t]&&e[t].value,a=e&&e[n]&&e[n].value;return o&&a?Gs.getDefaultJobRunName(o,a):s}return Gs.baseName(s)}static getDefaultJobRunName(e,s,t=null){if(!e)return"-";let n=`job ${e}`;return s&&(n=`run ${s} of `+n),t&&(n=`workspace ${t}: `+n),n}static getSourceName(e){const s=e[Gs.sourceNameTag];return s?s.value:""}static getGitHubRegex(){return/[@/]github.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getGitLabRegex(){return/[@/]gitlab.com[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getBitbucketRegex(){return/[@/]bitbucket.org[:/]([^/.]+)\/([^/#]+)#?(.*)/}static getExperimentChatSessionPageRoute(e,s){return`/experiments/${e}/chat-sessions/${s}`}static getRunPageRoute(e,s){return`/experiments/${e}/runs/${s}`}static getLoggedModelPageRoute(e,s){return`/experiments/${e}/models/${s}`}static getGitRegex(){return/(.*?[@/][^?]*git.*?)[:/]([^#]+)(?:#(.*))?/}static getGitRepoUrl(e,s="master"){const t=e.match(Gs.getGitHubRegex()),n=e.match(Gs.getGitLabRegex()),o=e.match(Gs.getBitbucketRegex()),a=e.match(Gs.getGitRegex());let i=null;if(t)i=`https://github.com/${t[1]}/${t[2].replace(/.git/,"")}`,t[3]&&(i+=`/tree/${s}/${t[3]}`);else if(n)i=`https://gitlab.com/${n[1]}/${n[2].replace(/.git/,"")}`,n[3]&&(i+=`/-/tree/${s}/${n[3]}`);else if(o)i=`https://bitbucket.org/${o[1]}/${o[2].replace(/.git/,"")}`,o[3]&&(i+=`/src/${s}/${o[3]}`);else if(a){const[,e,t,n]=a;i=e.replace(/git@/,"https://")+"/"+t.replace(/.git/,""),n&&(i+=`/tree/${s}/${n}`)}return i}static getNotebookRevisionId(e){const s="mlflow.databricks.notebookRevisionID";return e&&e[s]&&e[s].value}static getNotebookId(e){const s="mlflow.databricks.notebookID";return e&&e[s]&&e[s].value}static isCurrentWorkspace(e){return!0}static getDefaultNotebookRevisionName(e,s,t=null){if(!e)return"-";let n=`notebook ${e}`;return s&&(n=`revision ${s} of `+n),t&&(n=`workspace ${t}: `+n),n}static ensureUrlScheme(e,s="https"){return e?e.match(/^:\/\//i)?`${s}${e}`:e.match(/^[a-z1-9+-.]+:\/\//i)?e:`${s}://${e}`:e}static setQueryParams(e,s){const t=new URL(Gs.ensureUrlScheme(e));return t.search=s||"",t.toString()}static getNotebookSourceUrl(e,s,t,n,o=null){let a=Gs.setQueryParams(o||window.location.origin,e);return a+=`#notebook/${s}`,t&&(a+=`/revision/${t}`,n&&(a+=`/mlflow/run/${n}`)),a}static renderNotebookSource(e,s,t,n,o,a=null,i=null){const r=o?Gs.baseName(o):Gs.getDefaultNotebookRevisionName(s,t),l=i||r;if(s){const i=Gs.getNotebookSourceUrl(e,s,t,n,a);return(0,y.Y)("a",{title:o||Gs.getDefaultNotebookRevisionName(s,t),href:i,target:"_top",onClick:e=>{e.stopPropagation()},children:l})}return l}static addQueryParams(e,s){if(!s||0===Object.keys(s).length)return e;const t=new URLSearchParams(e);Object.entries(s).forEach((([e,s])=>Boolean(e)&&Boolean(s)&&t.set(e,s)));const n=t.toString();return""===n||n.includes("?")?n:`?${n}`}static getJobSourceUrl(e,s,t,n=null){let o=Gs.setQueryParams(n||window.location.origin,e);return o+=`#job/${s}`,t&&(o+=`/run/${t}`),o}static renderJobSource(e,s,t,n,o=null,a=null){const i=n||Gs.getDefaultJobRunName(s,t),r=a||i;if(s){const n=Gs.getJobSourceUrl(e,s,t,o);return(0,y.Y)("a",{title:i,href:n,target:"_top",onClick:e=>{e.stopPropagation()},children:r})}return r}static renderSource(e,s,t,n="master"){const o=Gs.getSourceName(e);let a=Gs.formatSource(e);const i=Gs.getGitRepoUrl(o,n);i&&(a=(0,y.Y)("a",{target:"_top",href:i,onClick:e=>{e.stopPropagation()},children:a}));const r=Gs.getSourceType(e);if("NOTEBOOK"===r){const n=Gs.getNotebookRevisionId(e),a=Gs.getNotebookId(e),i="mlflow.databricks.workspaceID",r=e&&e[i]&&e[i].value;if(Gs.isCurrentWorkspace(r))return Gs.renderNotebookSource(s,a,n,t,o,null);{const i="mlflow.databricks.workspaceURL",l=e&&e[i]&&e[i].value,d=Gs.addQueryParams(s,{o:r});return Gs.renderNotebookSource(d,a,n,t,o,l)}}if("JOB"===r){const t="mlflow.databricks.jobID",n="mlflow.databricks.jobRunID",o=e&&e[t]&&e[t].value,i=e&&e[n]&&e[n].value,r="mlflow.databricks.workspaceID",l=e&&e[r]&&e[r].value;if(Gs.isCurrentWorkspace(l))return Gs.renderJobSource(s,o,i,a,null);{const t="mlflow.databricks.workspaceURL",n=e&&e[t]&&e[t].value,r=Gs.addQueryParams(s,{o:l});return Gs.renderJobSource(r,o,i,a,n)}}return a}static renderSourceFromMetadata(e){var s,t,n,o,a;const i=null===(s=e.trace_metadata)||void 0===s?void 0:s[Gs.sourceNameTag],r=null===(t=e.trace_metadata)||void 0===t?void 0:t[Gs.sourceTypeTag];let l=i?Gs.baseName(i):"";const d=null===(n=e.trace_metadata)||void 0===n?void 0:n["mlflow.source.git.repoURL"],c=null===(o=e.trace_metadata)||void 0===o?void 0:o["mlflow.source.git.branch"],u=null===(a=e.trace_metadata)||void 0===a?void 0:a["mlflow.source.git.commit"];if(d){const e=d.replace("git@github.com:","https://github.com/").replace("git@gitlab.com:","https://gitlab.com/").replace("git@bitbucket.org:","https://bitbucket.org/").replace(".git",""),s=u||c||"master",t=i?`/${i}`:"";let n=e;n=e.includes("github.com")?`${e}/tree/${s}${t}`:e.includes("gitlab.com")?`${e}/-/tree/${s}${t}`:e.includes("bitbucket.org")?`${e}/src/${s}${t}`:`${e}/tree/${s}${t}`,l=(0,y.Y)("a",{target:"_blank",rel:"noopener noreferrer",href:n,onClick:e=>{e.stopPropagation()},children:l})}if("NOTEBOOK"===r){var m,p,g;const s=null===(m=e.trace_metadata)||void 0===m?void 0:m["mlflow.databricks.notebookRevisionID"],t=null===(p=e.trace_metadata)||void 0===p?void 0:p["mlflow.databricks.notebookID"],n=null===(g=e.trace_metadata)||void 0===g?void 0:g["mlflow.databricks.workspaceID"];if(Gs.isCurrentWorkspace(n))return Gs.renderNotebookSource(null,t,s,null,i,null);{var v;const o="mlflow.databricks.workspaceURL",a=(null===(v=e.trace_metadata)||void 0===v?void 0:v[o])||void 0,r=Gs.addQueryParams(null,{o:n});return Gs.renderNotebookSource(r,t,s,null,i,a)}}if("JOB"===r){var f,h,b;const s=null===(f=e.trace_metadata)||void 0===f?void 0:f["mlflow.databricks.jobID"],t=null===(h=e.trace_metadata)||void 0===h?void 0:h["mlflow.databricks.jobRunID"],n=null===(b=e.trace_metadata)||void 0===b?void 0:b["mlflow.databricks.workspaceID"];if(Gs.isCurrentWorkspace(n))return Gs.renderJobSource(null,s,t,l,null);{var S;const o="mlflow.databricks.workspaceURL",a=(null===(S=e.trace_metadata)||void 0===S?void 0:S[o])||void 0,i=Gs.addQueryParams(null,{o:n});return Gs.renderJobSource(i,s,t,l,a)}}return l}static formatDuration(e){return e<500?e+"ms":e<6e4?(e/1e3).toFixed(1)+"s":e<36e5?(e/1e3/60).toFixed(1)+"min":e<864e5?(e/1e3/60/60).toFixed(1)+"h":(e/1e3/60/60/24).toFixed(1)+"d"}static formatTimestamp(e,s){const t=new Date(0);return t.setUTCMilliseconds(e),s?s.formatDate(t,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):Ks()(t).format("YYYY-MM-DD HH:mm:ss")}}Gs.runNameTag="mlflow.runName",Gs.sourceNameTag="mlflow.source.name",Gs.sourceTypeTag="mlflow.source.type",Gs.entryPointTag="mlflow.project.entryPoint";var Ws=Gs;const Qs=e=>{var s,t;const{experimentId:n,currentTraceInfo:o,otherTraceInfo:a,isComparing:i}=e,r=null===o||void 0===o||null===(s=o.trace_metadata)||void 0===s?void 0:s["mlflow.modelId"],l=null===a||void 0===a||null===(t=a.trace_metadata)||void 0===t?void 0:t["mlflow.modelId"];return(0,y.Y)(Us,{first:r?(0,y.Y)(et,{experimentId:n,modelId:r,isComparing:i}):(0,y.Y)(Hs,{isComparing:i}),second:i&&(l?(0,y.Y)(et,{experimentId:n,modelId:l,isComparing:i}):(0,y.Y)(Hs,{isComparing:i}))})};var Js={name:"1puasmx",styles:"width:fit-content;max-width:100%;margin-right:0;cursor:pointer"},Xs={name:"1it2kpr",styles:"max-width:100%;display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Zs={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const et=e=>{var s;const{experimentId:t,modelId:n,isComparing:o}=e,{theme:a}=(0,v.u)(),{data:i,isLoading:r,error:l}=st({loggedModelId:n}),d=null===i||void 0===i||null===(s=i.info)||void 0===s?void 0:s.name;return r?(0,y.Y)(g.ParagraphSkeleton,{}):l?(0,y.Y)(Vs,{}):d?(0,y.Y)(ye.T,{componentId:"mlflow.eval-runs.model-version-cell-tooltip",content:d,children:(0,y.Y)(g.Tag,{componentId:"mlflow.eval-runs.model-version-cell",id:"model-version-cell",css:Js,children:(0,y.Y)(ue,{to:Ws.getLoggedModelPageRoute(t,n),target:"_blank",css:Xs,title:d,children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:a.spacing.xs,maxWidth:"100%"},""),children:[(0,y.Y)(g.ModelsIcon,{css:(0,p.AH)({color:a.colors.textPrimary,fontSize:16},"")}),(0,y.Y)(v.T.Text,{css:Zs,children:d})]})})})}):(0,y.Y)(Hs,{isComparing:o})},st=({loggedModelId:e})=>{const{data:s,isLoading:t,isFetching:o,refetch:a,error:i}=(0,Os.I)({queryKey:["loggedModelName",e],queryFn:async()=>await $s(`ajax-api/2.0/mlflow/logged-models/${e}`,"GET"),cacheTime:1/0,staleTime:1/0,refetchOnMount:!1,retry:1,enabled:!(0,n.isNil)(e)});return{isLoading:t,isFetching:o,data:null===s||void 0===s?void 0:s.model,refetch:a,error:i}};var tt={name:"pzwiqy",styles:"display:flex;max-width:100%;text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const nt=e=>{var s,t,n;const{experimentId:o,runUuid:a}=e,{data:i,isLoading:r,error:l}=ot(o,a),d=null===i||void 0===i||null===(s=i.runs)||void 0===s||null===(t=s[0])||void 0===t||null===(n=t.info)||void 0===n?void 0:n.run_name;return r?(0,y.Y)(g.ParagraphSkeleton,{}):l?(0,y.Y)(Vs,{}):d?(0,y.Y)(ue,{css:tt,to:Ws.getRunPageRoute(o,a),title:d,children:d}):(0,y.Y)(Hs,{})},ot=(e,s)=>(0,Os.I)({queryKey:["runName",e,s],cacheTime:1/0,staleTime:1/0,retry:1,refetchOnMount:!1,queryFn:async()=>{const t=`run_id IN ('${s}')`;return await $s("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e],filter:t})}});var at=t(44105);const it=({sessionId:e,experimentId:s,traceId:t,children:n})=>{const o=Ws.getExperimentChatSessionPageRoute(s,e),a=t?`${o}?${new URLSearchParams({[at.hb]:t}).toString()}`:o;return(0,y.Y)(ue,{to:a,children:n})};var rt=function(e){return e.NOTEBOOK="NOTEBOOK",e.JOB="JOB",e.PROJECT="PROJECT",e.LOCAL="LOCAL",e.UNKNOWN="UNKNOWN",e}(rt||{});const lt=({sourceType:e,className:s})=>e===rt.NOTEBOOK?(0,y.Y)(g.NotebookIcon,{className:s}):e===rt.LOCAL?(0,y.Y)(g.HomeIcon,{className:s}):e===rt.PROJECT?(0,y.Y)(g.FolderBranchIcon,{className:s}):e===rt.JOB?(0,y.Y)(g.WorkflowsIcon,{className:s}):null;var dt={name:"1gz2b5f",styles:"overflow:hidden;text-overflow:ellipsis"};const ct=e=>{var s;const t=e.traceInfo.tags,{theme:n}=(0,v.u)();if(!t)return(0,y.Y)(Hs,{isComparing:e.isComparing});const o=null===(s=e.traceInfo.trace_metadata)||void 0===s?void 0:s[Ws.sourceTypeTag],a=Ws.renderSourceFromMetadata(e.traceInfo);return a&&o?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center",...e.disableLinks&&{"& a":{pointerEvents:"none",color:"inherit",textDecoration:"none",cursor:"default"}}},""),children:[(0,y.Y)(lt,{sourceType:o,css:(0,p.AH)({color:n.colors.textSecondary},"")}),(0,y.Y)("span",{css:dt,children:a})]}):(0,y.Y)(Hs,{isComparing:e.isComparing})},ut={STATE_UNSPECIFIED:null,IN_PROGRESS:(0,f.zR)({id:"y56Vz9",defaultMessage:"In progress"}),OK:(0,f.zR)({id:"Mn7Kss",defaultMessage:"OK"}),ERROR:(0,f.zR)({id:"igK5Su",defaultMessage:"Error"})},mt=(e,s)=>"IN_PROGRESS"===e?(0,y.Y)(he.C,{css:(0,p.AH)({color:s.colors.textValidationWarning},"")}):"OK"===e?(0,y.Y)(g.CheckCircleIcon,{css:(0,p.AH)({color:s.colors.textValidationSuccess},"")}):"ERROR"===e?(0,y.Y)(g.XCircleIcon,{css:(0,p.AH)({color:s.colors.textValidationDanger},"")}):null,pt=({original:e,isComparing:s})=>{const{theme:t}=(0,v.u)(),n=(0,f.tz)(),o=ut[(null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED"];return o?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center"},""),children:[mt((null===e||void 0===e?void 0:e.state)||"STATE_UNSPECIFIED",t),o?n.formatMessage(o):""]}):(0,y.Y)(Hs,{isComparing:s})};var gt=t(16333);const{Paragraph:vt}=v.T;var ft={name:"s5xdrg",styles:"display:flex;align-items:center"},ht={name:"1ff36h2",styles:"flex-grow:1"};const yt=ie.memo((e=>{const{theme:s}=(0,v.u)();return(0,y.Y)(ye.d,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetagfullviewmodal.tsx_17",title:"Tag: "+e.tagKey,visible:e.isKeyValueTagFullViewModalVisible,onCancel:()=>e.setIsKeyValueTagFullViewModalVisible(!1),children:(0,y.FD)("div",{css:ft,children:[(0,y.Y)(vt,{css:ht,children:(0,y.Y)("pre",{css:(0,p.AH)({backgroundColor:s.colors.backgroundPrimary,marginTop:s.spacing.sm,whiteSpace:"pre-wrap",wordBreak:"break-all"},""),children:e.tagValue})}),(0,y.Y)("div",{css:(0,p.AH)({marginBottom:s.spacing.md},""),children:(0,y.Y)(gt.ad,{componentId:"mlflow.genai-traces-table.tag_view_modal.tag_value_copy_button",copyText:e.tagValue})})]})})}));function bt(e=!0){return e?{overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap",whiteSpace:"nowrap"}:{whiteSpace:"nowrap"}}const St=({isClosable:e=!1,onClose:s,tag:t,enableFullViewModal:n=!1,charLimit:o=30,maxWidth:a=300,className:i})=>{const r=(0,f.tz)(),[l,d]=(0,ie.useState)(!1),{shouldTruncateKey:c,shouldTruncateValue:u}=function(e,s=30){const{key:t,value:n}=e,o=t.length+n.length,a=t.length>n.length,i=a?n.length:t.length;return o<=s?{shouldTruncateKey:!1,shouldTruncateValue:!1}:i>s/2?{shouldTruncateKey:!0,shouldTruncateValue:!0}:{shouldTruncateKey:a,shouldTruncateValue:!a}}(t,o),m=n&&(c||u),h=r.formatMessage({id:"ZXUtU8",defaultMessage:"Click to see more"});return(0,y.FD)("div",{children:[(0,y.Y)(g.Tag,{componentId:"codegen_mlflow_app_src_common_components_keyvaluetag.tsx_60",closable:e,onClose:s,title:t.key,className:i,children:(0,y.Y)(ye.T,{componentId:"web-shared.genai-traces-table.key-value-tag.full-view-tooltip",content:m?(0,y.Y)("span",{children:h}):void 0,children:(0,y.FD)("span",{css:(0,p.AH)({maxWidth:a,display:"inline-flex"},""),onClick:()=>m?d(!0):void 0,children:[(0,y.Y)(v.T.Text,{bold:!0,title:t.key,css:bt(c),children:t.key}),t.value&&(0,y.FD)(v.T.Text,{title:t.value,css:bt(u),children:[": ",t.value]})]})})}),(0,y.Y)("div",{children:l&&(0,y.Y)(yt,{tagKey:t.key,tagValue:t.value,isKeyValueTagFullViewModalVisible:l,setIsKeyValueTagFullViewModalVisible:d})})]})};var It={name:"1wcfv52",styles:"margin-right:0"},wt={name:"14cnl6e",styles:"flex-shrink:0;opacity:0;[role=row]:hover &{opacity:1;}[role=row]:focus-within &{opacity:1;}"};const xt=({onAddEditTags:e,tags:s,baseComponentId:t})=>{const{theme:n}=(0,v.u)(),o=(null===s||void 0===s?void 0:s.filter((({key:e})=>e&&!e.startsWith(es))))||[],a=o.length>0;return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",flexWrap:"wrap",columnGap:n.spacing.xs,rowGap:n.spacing.xs},""),children:[o.map((e=>(0,y.Y)(St,{tag:e,css:It,charLimit:20,maxWidth:150,enableFullViewModal:!0},e.key))),e&&(0,y.Y)(v.B,{componentId:"mlflow.tags_cell_renderer.traces_table.edit_tag",size:"small",icon:a?(0,y.Y)(g.PencilIcon,{}):void 0,onClick:e,children:a?void 0:(0,y.Y)(f.sA,{id:"vHNP+J",defaultMessage:"Add tags"}),css:wt,type:"tertiary"})]})};const At=e=>{const{currentTraceInfo:s,otherTraceInfo:t,isComparing:n}=e;return(0,y.Y)(Us,{first:(0,y.Y)(Dt,{traceInfo:s,isComparing:n}),second:n&&(0,y.Y)(Dt,{traceInfo:t,isComparing:n})})};var Et={name:"58t467",styles:"width:fit-content;max-width:100%"},Tt={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ct={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Nt={name:"ho1qnd",styles:"display:flex;flex-direction:row"},_t={name:"i9sky5",styles:"width:35%"},Yt={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Rt={name:"i9sky5",styles:"width:35%"},Mt={name:"ho1qnd",styles:"display:flex;flex-direction:row"},kt={name:"i9sky5",styles:"width:35%"};const Dt=e=>{var s;const{traceInfo:t,isComparing:n}=e,o=null===t||void 0===t||null===(s=t.trace_metadata)||void 0===s?void 0:s[xe.Uu],a=(()=>{try{return o?JSON.parse(o):{}}catch{return{}}})(),i=a.total_tokens,r=a.input_tokens,l=a.output_tokens,d=(0,f.tz)();return i?(0,y.Y)(g.HoverCard,{trigger:(0,y.Y)(g.Tag,{css:Et,componentId:"mlflow.genai-traces-table.tokens",children:(0,y.Y)("span",{css:Tt,children:i})}),content:(0,y.FD)("div",{css:Ct,children:[i&&(0,y.FD)("div",{css:Nt,children:[(0,y.Y)("div",{css:_t,children:(0,y.Y)(v.T.Text,{children:d.formatMessage({id:"83wDn8",defaultMessage:"Total"})})}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Text,{color:"secondary",children:i})})]}),r&&(0,y.FD)("div",{css:Yt,children:[(0,y.Y)("div",{css:Rt,children:(0,y.Y)(v.T.Text,{children:d.formatMessage({id:"Y7DzTT",defaultMessage:"Input"})})}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Text,{color:"secondary",children:r})})]}),l&&(0,y.FD)("div",{css:Mt,children:[(0,y.Y)("div",{css:kt,children:(0,y.Y)(v.T.Text,{children:d.formatMessage({id:"tGqJL4",defaultMessage:"Output"})})}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Text,{color:"secondary",children:l})})]})]})}):(0,y.Y)(Hs,{isComparing:n})},Ft="Error";function Ot(e){return Boolean((null===e||void 0===e?void 0:e.errorCode)||(null===e||void 0===e?void 0:e.errorMessage))}function Vt(e){const s=e.split("/");return 1===s.length?{metricName:e,assessmentName:e}:2===s.length?{metricName:s[0],assessmentName:s[1]}:{metricName:s[1],assessmentName:s.slice(2).join("/")}}const Lt=[w.YES,w.NO];function Ht(e,s,t){var o;const a={},i={[S.OVERALL_ASSESSMENT]:"pass-fail"},r=new Set;[...s,...t||[]].forEach((e=>{var s;const t=Object.entries(e.responseAssessmentsByName||{}),o=e.overallAssessments.map((e=>[S.OVERALL_ASSESSMENT,[e]])),a=[];null===(s=e.retrievalChunks)||void 0===s||s.forEach((e=>{for(const[s,t]of Object.entries(e.retrievalAssessmentsByName||{}))a.push([s,t])}));for(const[l,d]of[...t,...o,...a]){r.add(l);const e=d[0];let s=(0,n.isNil)(e.stringValue)?(0,n.isNil)(e.numericValue)?(0,n.isNil)(e.booleanValue)?void 0:"boolean":"numeric":"pass-fail";Ot(e)&&(s=void 0),i[l]||(l in N&&(s="pass-fail"),i[l]=s),"pass-fail"!==s||(0,n.isNil)(e.stringValue)||Lt.includes(e.stringValue)||(i[l]="string"),void 0!==s&&s!==i[l]&&(i[l]="string")}}));for(const n of r)i[n]||(i[n]="unknown");[...s,...t||[]].forEach((s=>{var t;const o=Object.entries(s.responseAssessmentsByName||{}),r=s.overallAssessments.map((e=>[S.OVERALL_ASSESSMENT,[e]])),l=[];null===(t=s.retrievalChunks)||void 0===t||t.forEach((e=>{for(const[s,t]of Object.entries(e.retrievalAssessmentsByName||{}))l.push([s,t])}));const d=Object.keys(i);for(const f of d){const s=[...o.filter((([e])=>e===f)),...r.filter((([e])=>e===f)),...l.filter((([e])=>e===f))].map((([e,s])=>s[0]))[0],t=Ot(s);if((0,n.isNil)(a[f])){var c,u,m;let n,o,r=!1;const d=void 0!==N[f];if(d)n=e.formatMessage(N[f]),o=f,r=!1;else{var p;const{metricName:e,assessmentName:t}=Vt(f);n=t||"-",o=e,"CODE"===(null===s||void 0===s||null===(p=s.source)||void 0===p?void 0:p.sourceType)&&(r=!0)}const g=i[f]||"string",v="https://mlflow.org/docs/latest/genai/eval-monitor/scorers/llm-judge/",h=f in _?e.formatMessage(_[f]):"",y=f in Y?e.formatMessage(Y[f]):"HUMAN"===(null===s||void 0===s||null===(c=s.source)||void 0===c?void 0:c.sourceType)?e.formatMessage({id:"z94r4F",defaultMessage:"This assessment is produced by a human judge."}):e.formatMessage({id:"lQ2nDn",defaultMessage:"This assessment is produced by a custom metric."});let b=s?V(s):void 0;null===b&&(b=void 0);const I=new Set;t||I.add(b),a[f]={name:f,displayName:n,isKnown:d,metricName:o,isCustomMetric:r,source:null===s||void 0===s?void 0:s.source,dtype:g,uniqueValues:I,isOverall:f===S.OVERALL_ASSESSMENT,docsLink:v,missingTooltip:h,description:y,isEditable:"AI_JUDGE"===(null===s||void 0===s||null===(u=s.source)||void 0===u?void 0:u.sourceType)||"HUMAN"===(null===s||void 0===s||null===(m=s.source)||void 0===m?void 0:m.sourceType),isRetrievalAssessment:l.some((([e])=>e===f)),containsErrors:t}}else{const e=a[f];let o=s?V(s):void 0;var g,v;if((0,n.isNil)(o)&&(o=void 0),t||e.uniqueValues.add(o),!e.isEditable)e.isEditable="AI_JUDGE"===(null===s||void 0===s||null===(g=s.source)||void 0===g?void 0:g.sourceType)||"HUMAN"===(null===s||void 0===s||null===(v=s.source)||void 0===v?void 0:v.sourceType);e.isRetrievalAssessment=e.isRetrievalAssessment||l.some((([e])=>e===f)),e.containsErrors=e.containsErrors||t}}}));const l=(null===(o=a[S.OVERALL_ASSESSMENT])||void 0===o?void 0:o.uniqueValues)||new Set;return l.has(w.YES)||l.has(w.NO)||delete a[S.OVERALL_ASSESSMENT],Ut(Object.values(a))}function Ut(e){return e.sort(((e,s)=>{const t=I.indexOf(e.name),n=I.indexOf(s.name);return-1!==t&&-1!==n?t-n:-1!==t?-1:-1!==n?1:e.name.localeCompare(s.name)}))}function zt(e,s){if("numeric"!==e.dtype)return;return function(e){if(0===e.length)return;const s=[],t=Math.min(...e),n=Math.max(...e),o=Math.max(.01,(n-t)/10);let a=0;if(t===n)s.push({lower:t,upper:n,count:e.length});else for(let i=t;i<n;i+=o)s.push({lower:i,upper:Math.min(i+o,n),count:0});s.sort(((e,s)=>e.lower-s.lower));for(const i of e){const e=s.find((e=>i>=e.lower&&(i<e.upper||i===e.upper&&i===n)));e&&(e.count++,a=Math.max(a,e.count))}return{min:t,max:n,maxCount:a,counts:s}}(s.flatMap((s=>{const t=e.isOverall?s.overallAssessments:s.responseAssessmentsByName[e.name];return null===t||void 0===t?void 0:t.map((e=>V(e))).filter((e=>void 0!==e&&"number"===typeof e))})).filter((e=>!(0,n.isNil)(e))))}function Bt(e,s){if("numeric"===e.dtype)return;const t=new Map;return s.forEach((s=>{const n=e.isOverall?s.overallAssessments:s.responseAssessmentsByName[e.name],o=n&&n.length>0?Qt(e,n):[{value:void 0,count:1}],a=e.containsErrors?[Ft,...e.uniqueValues]:e.uniqueValues;for(const e of a){const s=o.find((s=>s.value===e)),n=s?s.count:0;t.set(e,(t.get(e)||0)+n)}})),t}function $t(e,s){if("numeric"!==e.dtype)return;const t=[];return s.forEach((s=>{const o=e.isOverall?(0,n.first)(s.overallAssessments):(0,n.first)(s.responseAssessmentsByName[e.name]);if(o){const e=V(o);(0,n.isNil)(e)||t.push(Number(e))}})),t}function jt(e,s){let t=0;return s.forEach((s=>{var o;if((0,n.isNil)(s))return;const a=(0,n.first)(s.overallAssessments);(null===a||void 0===a||null===(o=a.rootCauseAssessment)||void 0===o?void 0:o.assessmentName)===e.name&&t++})),t}function Pt(e,s,t){const o=s.map((e=>e.currentRunValue)).filter((e=>!(0,n.isNil)(e))),a=s.map((e=>e.otherRunValue)).filter((e=>!(0,n.isNil)(e))),i=Bt(e,o),r=Bt(e,a),l=zt(e,o),d=t.filter((s=>s.assessmentName===e.name));return{assessmentInfo:e,currentCounts:i,otherCounts:r,currentNumericValues:$t(e,o),otherNumericValues:$t(e,a),currentNumericAggregate:l,currentNumRootCause:jt(e,o),otherNumRootCause:jt(e,a),assessmentFilters:d}}function qt(e,s=new Map){if("pass-fail"===e.dtype||"boolean"===e.dtype){let t=0,o=0;for(const[a,i]of s)ln(e,a)&&(o+=i),(0,n.isNil)(a)||a===Ft||(t+=i);return t>0?o/t:0}return 0}function Kt(e,s,t,n,o,a,i){let r=0;const l=n===Ft||void 0===n;for(const[u,m]of o)void 0!==u&&u!==Ft&&(r+=m);const d=o.get(n)||0,c=!l&&r>0?d/r:0;return{value:o.get(n)||0,fraction:c,isSelected:t.some((e=>e.filterValue===n&&e.assessmentName===s.name&&e.run===a)),toggleFilter:()=>i(s.name,n,a,undefined),tooltip:l?e.formatMessage({id:"joh88n",defaultMessage:'{numValue} for run "{runName}"'},{numValue:d,runName:a}):e.formatMessage({id:"jjidVr",defaultMessage:'{numValue}/{numEvals} for run "{runName}"'},{numValue:d,numEvals:r,runName:a})}}function Gt(e){const s=function(e){const s=Array.from(e.uniqueValues);if("pass-fail"===e.dtype){s.includes(w.YES)||s.push(w.YES),s.includes(w.NO)||s.push(w.NO);const e=[w.YES,w.NO];return s.sort(((s,t)=>e.indexOf(s)-e.indexOf(t)))}if("boolean"===e.dtype)return s.sort(((e,s)=>!0===e?-1:1));return s.sort()}(e);return e.containsErrors&&s.push(Ft),s}function Wt(e,s,t,o){return"pass-fail"===t.dtype?o===w.YES?e.formatMessage({id:"nDVJ/n",defaultMessage:"Pass"}):o===w.NO?e.formatMessage({id:"7Dhfxy",defaultMessage:"Fail"}):o===Ft?e.formatMessage({id:"gPWxlB",defaultMessage:"Error"}):e.formatMessage({id:"keSIQ4",defaultMessage:"null"}):"boolean"===t.dtype?!0===o?e.formatMessage({id:"1Ujhc3",defaultMessage:"True"}):!1===o?e.formatMessage({id:"nvjkTA",defaultMessage:"False"}):e.formatMessage({id:"keSIQ4",defaultMessage:"null"}):(0,n.isNil)(o)?"null":`${o}`}function Qt(e,s){const t=s.filter((s=>s.name===e.name));let n=new Set;for(const r of t){const e=V(r);n.add(e)}t.sort(((e,s)=>(s.timestamp||0)-(e.timestamp||0)));const o=t.filter((e=>Ot(e))),a=t.filter((e=>!Ot(e)));n=new Set;for(const r of a){const e=V(r);n.add(e)}const i=[];for(const r of n){const e=t.filter((e=>V(e)===r)),s=e.length;i.push({value:r,count:s,latestAssessment:e[0]})}return o.length>0&&i.push({value:Ft,count:o.length,latestAssessment:o[0]}),i}function Jt(e,s=1){return Number((100*e).toFixed(s)).toString()}function Xt(e,s=3){if((0,n.isNil)(e))return"null";const t=Math.pow(10,s);return(Math.round(e*t)/t).toString()}function Zt(e,s,t=!0){if("numeric"===e.dtype){return"up"===(s>0?"up":"down")?`+${Xt(s,2)}`:`-${Xt(s,2)}`}{const e=s>=0?"up":"down";return t?"up"===e?`+${Jt(s,0)}%`:`-${Jt(-1*s,0)}%`:"up"===e?`+${s}`:`-${s}`}}function en(e,s=new Date){const t=Math.max(0,Math.floor((s-e)/1e3));let n=Math.floor(t/31536e3);return n>=1?(0,y.Y)(f.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:n}}):(n=Math.floor(t/2592e3),n>=1?(0,y.Y)(f.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:n}}):(n=Math.floor(t/86400),n>=1?(0,y.Y)(f.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:n}}):(n=Math.floor(t/3600),n>=1?(0,y.Y)(f.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:n}}):(n=Math.floor(t/60),n>=1?(0,y.Y)(f.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:n}}):(0,y.Y)(f.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:t}})))))}function sn(e){return e.replace(/([!"#$%&'()*+,\.\/:;\s<=>?@[\\\]^`{|}~])/g,"\\$1")}function tn(e,s){return function(e,s,t=[],n){let o=Number(e);if(isNaN(o)||!isFinite(o))return{value:"",numericValue:void 0,unit:"",divisor:1};let a=0,i=1;for(;o>=s&&a<t.length-1;)o/=s,i*=s,a+=1;return{value:nn(o,n),numericValue:o,unit:t[a],divisor:i}}(e,1024,["bytes","KB","MB","GB","TB","PB"],s)}function nn(e,s=3){return Math.round(e)!==e?e.toFixed(s):e.toString()}const on=ie.createContext({makeHTML:e=>e}),an=({children:e,makeHtml:s})=>(0,y.Y)(on.Provider,{value:{makeHTML:s},children:e}),rn=()=>ie.useContext(on);const ln=(e,s)=>{if(!(0,n.isNil)(s))if("pass-fail"===e.dtype){if(s===w.YES)return!0;if(s===w.NO)return!1}else if("boolean"===e.dtype)return!0===s};var dn={name:"1jwcxx3",styles:"font-style:italic"},cn={name:"1jwcxx3",styles:"font-style:italic"};var un={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},mn={name:"1ykowef",styles:"margin-bottom:0"},pn={name:"6jwybp",styles:"height:16px"},gn={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const vn=({assessment:e,onEdit:s,active:t=!1,disableJudgeTypeIcon:o,showRationaleInTooltip:a=!1,showPassFailText:i=!1,hideAssessmentName:r=!1,iconOnly:l=!1,disableTooltip:d=!1,isRootCauseAssessment:c,assessmentInfo:u,type:m,count:h})=>{var b,S;const{theme:I}=(0,v.u)(),x=(0,f.tz)(),A=e?V(e):void 0,E=(0,ie.useMemo)((()=>ln(u,A)),[A,u]),T=ne(I,u,e),C=((e,s,t)=>null!==t&&void 0!==t&&t.errorMessage?e.colors.textValidationWarning:"pass-fail"===s.dtype?(null===t||void 0===t?void 0:t.stringValue)===w.YES?e.isDarkMode?e.colors.green400:e.colors.green600:(null===t||void 0===t?void 0:t.stringValue)===w.NO?e.isDarkMode?e.colors.red400:e.colors.red600:e.colors.textSecondary:"boolean"===s.dtype?(0,n.isNil)(null===t||void 0===t?void 0:t.booleanValue)?e.colors.textSecondary:e.colors.textPrimary:"unknown"===s.dtype?e.colors.textSecondary:e.colors.textPrimary)(I,u,e);let Y;(null!==e&&void 0!==e&&e.errorMessage||void 0===E&&e&&_[e.name])&&(Y=e.errorMessage||x.formatMessage(_[e.name]));const M=e?N[e.name]:void 0,k=(0,ie.useMemo)((()=>M?x.formatMessage(M):null===e||void 0===e?void 0:e.name),[e,M,x]),D=(0,ie.useMemo)((()=>e?(e.name,"https://mlflow.org/docs/latest/genai/eval-monitor/scorers/llm-judge/"):void 0),[e]),{makeHTML:F}=rn(),O=(0,ie.useMemo)((()=>{const s=null===e||void 0===e?void 0:e.rationale;return(0,n.isString)(s)?F(s):void 0}),[e,F]),L=(0,ie.useMemo)((()=>!(0,n.isNil)(e)&&P(e)),[e]),{tagText:H,icon:U,fullTagText:z}=(0,ie.useMemo)((()=>function(e,s,t,o,a,i,r){let l,d="",c=(0,y.Y)(y.FK,{});const u={tagText:(0,y.Y)(f.sA,{id:"AX7L9r",defaultMessage:"Error"}),icon:(0,y.Y)(v.k,{css:(0,p.AH)({color:e.colors.textValidationWarning},"")})},m={tagText:(0,y.Y)("span",{css:dn,children:(0,y.Y)(f.sA,{id:"H2UIIZ",defaultMessage:"null"})}),icon:(0,y.Y)(v.W,{css:(0,p.AH)({color:e.colors.grey400},"")})},h=i?V(i):void 0;if(Boolean(null===i||void 0===i?void 0:i.errorMessage))return u;if("pass-fail"===o.dtype||"boolean"===o.dtype){const a=ln(o,h);let l="";if("pass-fail"===o.dtype)if(!0===a)l=s.formatMessage({id:"Kya8N3",defaultMessage:"Pass"});else{if(!1!==a)return m;l=s.formatMessage({id:"bz4brG",defaultMessage:"Fail"})}else if(!0===a)l=s.formatMessage({id:"lo5Me/",defaultMessage:"True"});else{if(!1!==a)return m;l=s.formatMessage({id:"OZXWas",defaultMessage:"False"})}const u=ne(e,o,i);if(c=!0===a?(0,y.Y)(g.CheckCircleIcon,{css:(0,p.AH)({color:u},"")}):!1===a?r?(0,y.Y)(he.X,{css:(0,p.AH)({color:u},"")}):(0,y.Y)(g.XCircleIcon,{css:(0,p.AH)({color:u},"")}):(0,y.Y)(v.W,{css:(0,p.AH)({color:u},"")}),"assessment-value"===t){const e=R[o.name];if(e){var b;const s=h&&null!==(b=e[h.toString()])&&void 0!==b?b:e[w.YES];s&&(d=(0,y.Y)(f.sA,{...s,values:{value:h}}))}else d=(0,y.FD)(y.FK,{children:[o.displayName,": ",h]})}else"value"===t&&(d=(0,n.isNil)(a)?(0,y.Y)("span",{css:cn,children:l}):l)}else if("numeric"===o.dtype){const e=(0,n.isNil)(h)?h:Xt(h);if("assessment-value"===t)d=(0,y.FD)(y.FK,{children:[o.displayName,": ",e]}),l=(0,y.FD)(y.FK,{children:[o.displayName,": ",h]});else{if((0,n.isNil)(e))return m;d=`${e}`,l=`${h}`}}else{if((0,n.isNil)(h))return m;const e=(0,y.Y)(y.FK,{children:String(h)});d="assessment-value"===t?(0,n.isNil)(h)?(0,y.Y)(y.FK,{children:o.displayName}):(0,y.FD)(y.FK,{children:[o.displayName,": ",e]}):e}return{tagText:d,icon:c,fullTagText:l}}(I,x,m,u,0,e,c)),[I,x,m,u,e,c,L]),B=(0,y.FD)(y.FK,{children:[H,h&&h>1?` (${h})`:""]});if("HUMAN"===(null===(b=u.source)||void 0===b?void 0:b.sourceType)&&!(null!==e&&void 0!==e&&null!==(S=e.source)&&void 0!==S&&S.sourceId))return(0,y.Y)(y.FK,{});const $=(0,y.Y)("div",{children:(0,y.Y)(fn,{iconOnly:l,hideAssessmentName:r,tagContent:B,active:t,icon:U,iconColor:T,textColor:C,sourceIcon:u.isCustomMetric?(0,y.Y)(g.BracketsXIcon,{}):e&&L?(0,y.Y)(g.UserIcon,{}):(0,y.Y)(g.SparkleDoubleIcon,{}),backgroundColor:oe(I,u,e),disableSourceTypeIcon:o&&!L,hasBeenEditedByHuman:L,onEdit:s})});return(0,y.Y)(y.FK,{children:d?$:(0,y.Y)(g.HoverCard,{side:"bottom",content:(0,y.FD)("div",{css:(0,p.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:I.spacing.sm},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:I.spacing.xs},""),children:[(0,y.FD)("div",{css:un,children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:I.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(v.T.Title,{css:mn,children:k}),(0,y.Y)(fn,{iconOnly:l,hideAssessmentName:r,tagContent:z||B,active:t,icon:U,iconColor:T,textColor:C,sourceIcon:u.isCustomMetric?(0,y.Y)(g.BracketsXIcon,{}):e&&P(e)?(0,y.Y)(g.UserIcon,{}):(0,y.Y)(g.SparkleDoubleIcon,{}),backgroundColor:oe(I,u,e),disableSourceTypeIcon:o,hasBeenEditedByHuman:L})]}),D&&(0,y.Y)("a",{href:D,target:"_blank",rel:"noreferrer",css:pn,children:(0,y.Y)(ye.I,{})})]}),c&&(0,y.Y)(v.T.Hint,{children:x.formatMessage({id:"QEL+JO",defaultMessage:"This assessment is the root cause of the overall evaluation failure."})})]}),a&&e&&O&&(0,y.Y)("div",{children:(0,y.Y)(y.FK,{children:(0,y.Y)("span",{css:gn,dangerouslySetInnerHTML:{__html:O}})})}),Y&&(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:I.spacing.xs},""),children:(0,y.Y)("span",{css:(0,p.AH)({color:I.colors.textValidationWarning,fontStyle:"italic"},""),children:Y})})]}),trigger:$})})},fn=({iconOnly:e,hideAssessmentName:s,tagContent:t,active:n,sourceIcon:o,icon:a,iconColor:i,textColor:r,backgroundColor:l,disableSourceTypeIcon:d,hasBeenEditedByHuman:c,onEdit:u})=>{const{theme:m}=(0,v.u)(),f=e?18:12;return(0,y.FD)("div",{css:(0,p.AH)({display:"inline-flex",height:e?f:20,width:e?f:s?"fit-content":"",justifyContent:"space-between",alignItems:"center",padding:e?"0":u?"0 0 0 8px":"0 8px",gap:m.spacing.sm,borderRadius:e?"50%":m.legacyBorders.borderRadiusMd,backgroundColor:l,boxShadow:`inset 0 0 1px 1px ${n?m.colors.borderAccessible:"transparent"}`,fontSize:m.typography.fontSizeSm,svg:{width:f,height:f},whiteSpace:"nowrap"},""),children:[a,t&&(0,y.Y)("span",{css:(0,p.AH)({color:r},""),children:t}),!0!==d?(0,y.Y)("span",{css:(0,p.AH)({color:i},""),children:o}):(0,y.Y)(y.FK,{}),u&&(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.edit_assessment_button",onClick:u,size:"small",icon:(0,y.Y)(g.PencilIcon,{css:(0,p.AH)({":hover":{color:m.colors.actionDefaultTextHover}},"")})})]})};var hn={name:"1wr4ndu",styles:"width:12px;height:12px;border-radius:6px;flex-shrink:0;border:1px solid rgba(0, 0, 0, 0.1);cursor:default;position:relative"},yn={name:"mvtt3w",styles:"clip:rect(0px, 0px, 0px, 0px);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px"};const bn=ie.memo((({color:e,hidden:s})=>(0,y.Y)("label",{css:hn,style:{backgroundColor:e,display:s?"none":""},children:(0,y.Y)("span",{css:yn,children:e})})));function Sn(e,s,t){return e?s.formatDate(e,{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit",...t}):""}var In={name:"6dhm9o",styles:"visibility:hidden"};const wn=(e,s,t,o,a)=>{var i,r,l,d,c,u,m,v,f,h,b,S,I,x;const A=o.name,E={currentValue:(0,n.first)(null===(i=a.currentRunValue)||void 0===i?void 0:i.responseAssessmentsByName[A]),otherValue:(0,n.first)(null===(r=a.otherRunValue)||void 0===r?void 0:r.responseAssessmentsByName[A])},T=Qt(o,(null===(l=a.currentRunValue)||void 0===l?void 0:l.responseAssessmentsByName[A])||[]),C=(null===(d=a.currentRunValue)||void 0===d||null===(c=d.overallAssessments[0])||void 0===c||null===(u=c.rootCauseAssessment)||void 0===u?void 0:u.assessmentName)===A,N=(null===(m=a.otherRunValue)||void 0===m||null===(v=m.overallAssessments[0])||void 0===v||null===(f=v.rootCauseAssessment)||void 0===f?void 0:f.assessmentName)===A,Y=E.currentValue?V(E.currentValue):void 0,R=E.otherValue?V(E.otherValue):void 0,M=function(e,s,t){if("pass-fail"===e.dtype)return s===t?"equal":s===w.YES?"greater":s===w.NO?"less":(0,n.isNil)(t)?"equal":"less";if("boolean"===e.dtype)return s===t?"equal":!0===s?"greater":!1===s?"less":(0,n.isNil)(t)?"equal":"less";if("string"===e.dtype){if(s===t)return"equal";if(null===s)return"less";if(null===t)return"greater";const e=s,o=t;return(0,n.isNil)(e)?"less":(0,n.isNil)(o)||1===e.toString().localeCompare(o.toString())?"greater":"less"}if("numeric"===e.dtype){if(s===t)return"equal";if(null===s)return"less";if(null===t)return"greater";return s>t?"greater":"less"}return"equal"}(o,(0,n.isNil)(Y)?void 0:Y,(0,n.isNil)(R)?void 0:R),k=R!==Y,D=_[A];return(0,y.Y)("div",{css:(0,p.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center",marginTop:"auto",marginBottom:"auto"},""),children:t?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm,borderRadius:e.legacyBorders.borderRadiusMd,marginTop:"auto",marginBottom:"auto"},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(vn,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:E.currentValue,isRootCauseAssessment:C,assessmentInfo:o,type:"value"},`tag_${null===(h=a.currentRunValue)||void 0===h?void 0:h.evaluationId}_${null===(b=E.currentValue)||void 0===b?void 0:b.name}`),k&&(0,y.Y)(g.ArrowRightIcon,{css:(0,p.AH)({transform:"greater"===M?"rotate(-45deg)":"rotate(45deg)",color:e.colors.textSecondary},"")})]}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:e.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(vn,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:E.otherValue,isRootCauseAssessment:N,assessmentInfo:o,type:"value"},`tag_${null===(S=a.otherRunValue)||void 0===S?void 0:S.evaluationId}_${null===(I=E.currentValue)||void 0===I?void 0:I.name}`),k&&(0,y.Y)(g.ArrowRightIcon,{css:In})]})]}):E.currentValue?(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:T.map((e=>{const s=e.latestAssessment,t=e.count;return(0,y.Y)(vn,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,assessment:s,isRootCauseAssessment:C,assessmentInfo:o,type:"value",count:t},`tag_${e.latestAssessment.name}_${e.value}`)}))}):(0,y.Y)(vn,{showRationaleInTooltip:!0,disableJudgeTypeIcon:!0,hideAssessmentName:!0,isRootCauseAssessment:C,assessmentInfo:o,assessment:{name:A,rationale:D?s.formatMessage(D):s.formatMessage({id:"gOUJ0f",defaultMessage:"No assessment for this evaluation"}),source:{sourceId:"",sourceType:"AI_JUDGE",metadata:{}},stringValue:null,booleanValue:null,rootCauseAssessment:null,numericValue:null,timestamp:null,metadata:{}},type:"value"},`tag_${A}_${null===(x=a.currentRunValue)||void 0===x?void 0:x.evaluationId}`)})};var xn={name:"36bnqj",styles:"display:flex;flex:1"},An={name:"36bnqj",styles:"display:flex;flex:1"};var En={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},Tn={name:"1jwcxx3",styles:"font-style:italic"},Cn={name:"zjik7",styles:"display:flex"},Nn={name:"1suksrg",styles:"width:12px;height:12px"},_n={name:"zjik7",styles:"display:flex"},Yn={name:"1suksrg",styles:"width:12px;height:12px"};var Rn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Mn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},kn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},Dn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},Fn={name:"1qkz5jq",styles:"display:block;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"},On={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Vn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Ln={name:"58t467",styles:"width:fit-content;max-width:100%"},Hn={name:"hdknak",styles:"display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Un={name:"58t467",styles:"width:fit-content;max-width:100%"},zn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Bn={name:"58t467",styles:"width:fit-content;max-width:100%"},$n={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},jn={name:"58t467",styles:"width:fit-content;max-width:100%"},Pn={name:"4fjnre",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},qn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Kn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Gn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Wn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Qn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Jn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Xn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Zn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"};const eo=120,so=120;const to=e=>{let s=e;try{var t,o;const r=JSON.parse(e).response.choices;var a,i;if(Array.isArray(r)&&!(0,n.isNil)(null===(t=r[0])||void 0===t||null===(o=t.message)||void 0===o?void 0:o.content))s=null===(a=r[0])||void 0===a||null===(i=a.message)||void 0===i?void 0:i.content;else s=K(e)}catch{s=K(e)}return s},no=(e,{evaluationInputs:s,isComparing:t,theme:o,intl:a,experimentId:i,onChangeEvaluationId:r,onTraceTagsEdit:l})=>{const d={header:e.label,id:e.id,accessorFn:e=>e};switch(e.type){case Te.INPUT:return{...d,sortingFn:(s,t)=>{var n,o,a,i,r,l,d,c;const u=s.getValue(e.id),m=t.getValue(e.id),p={request:(null===(n=u.currentRunValue)||void 0===n?void 0:n.inputs[e.id])||(null===(o=u.otherRunValue)||void 0===o?void 0:o.inputs[e.id])||"",evalId:(null===(a=u.currentRunValue)||void 0===a?void 0:a.evaluationId)||(null===(i=u.otherRunValue)||void 0===i?void 0:i.evaluationId)||""},g={request:(null===(r=m.currentRunValue)||void 0===r?void 0:r.inputs[e.id])||(null===(l=m.otherRunValue)||void 0===l?void 0:l.inputs[e.id])||"",evalId:(null===(d=m.currentRunValue)||void 0===d?void 0:d.evaluationId)||(null===(c=m.otherRunValue)||void 0===c?void 0:c.evaluationId)||""};return JSON.stringify(p).localeCompare(JSON.stringify(g))},size:300/s.length,minSize:120,cell:s=>{var n,a,i;return((e,s,t,n,o,a)=>{var i,r,l,d,c,u,m,g;const f=s.getValue(),h=(null===(i=f.currentRunValue)||void 0===i?void 0:i.evaluationId)||(null===(r=f.otherRunValue)||void 0===r?void 0:r.evaluationId),b=null===(l=f.currentRunValue)||void 0===l||null===(d=l.traceInfo)||void 0===d||null===(c=d.trace_metadata)||void 0===c?void 0:c[Ze],S=null===(u=f.otherRunValue)||void 0===u||null===(m=u.traceInfo)||void 0===m||null===(g=m.trace_metadata)||void 0===g?void 0:g[Ze],I=a&&b?a(b):X,w=a&&S?a(S):Z,x=f.currentRunValue?D(f.currentRunValue,o):void 0,A=f.otherRunValue?D(f.otherRunValue,o):void 0,E=x||A;return(0,y.FD)("div",{css:(0,p.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",alignItems:"center",justifyContent:"space-between",gap:n.spacing.sm},""),children:[(0,y.Y)(v.T.Link,{css:En,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>e(h),children:E||(0,y.Y)("span",{css:Tn,children:"null"})}),t&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.md},""),children:[(0,y.Y)("div",{css:Cn,children:b?(0,y.Y)(bn,{color:I}):(0,y.Y)("div",{css:Nn})}),(0,y.Y)("div",{css:_n,children:S?(0,y.Y)(bn,{color:w}):(0,y.Y)("div",{css:Yn})})]})]})})(r,s,t,o,e.id,null===s||void 0===s||null===(n=s.table)||void 0===n||null===(a=n.options)||void 0===a||null===(i=a.meta)||void 0===i?void 0:i.getRunColor)}};case Te.ASSESSMENT:return{...d,accessorFn:s=>({isComparing:t,assessmentInfo:e.assessmentInfo,comparisonEntry:s}),sortingFn:(s,t)=>{const{comparisonEntry:o}=s.getValue(e.id),{comparisonEntry:a}=t.getValue(e.id);if(e.assessmentInfo){var i,r,l,d,c,u,m,p;const s={currentValue:null===(i=o.currentRunValue)||void 0===i||null===(r=i.responseAssessmentsByName[e.assessmentInfo.name])||void 0===r?void 0:r[0],otherValue:null===(l=o.otherRunValue)||void 0===l||null===(d=l.responseAssessmentsByName[e.assessmentInfo.name])||void 0===d?void 0:d[0]},t={currentValue:null===(c=a.currentRunValue)||void 0===c||null===(u=c.responseAssessmentsByName[e.assessmentInfo.name])||void 0===u?void 0:u[0],otherValue:null===(m=a.otherRunValue)||void 0===m||null===(p=m.responseAssessmentsByName[e.assessmentInfo.name])||void 0===p?void 0:p[0]};return function(e,s,t){const o=s.currentValue?V(s.currentValue):void 0,a=t.currentValue?V(t.currentValue):void 0,i=s.otherValue?V(s.otherValue):void 0,r=t.otherValue?V(t.otherValue):void 0;if("pass-fail"===e.dtype){const e=i===w.YES&&o===w.NO,n=r===w.YES&&a===w.NO,l=i===w.NO&&o===w.YES,d=r===w.NO&&a===w.YES,c=i===w.NO&&o===w.NO,u=r===w.NO&&a===w.NO,m=i===w.YES&&o===w.YES,p=r===w.YES&&a===w.YES;return e&&!n?-1:!e&&n?1:c&&!u?-1:!c&&u?1:l&&!d?-1:!l&&d?1:m&&!p?-1:!m&&p?1:function(e,s){if(!e&&s)return 1;if(e&&!s)return-1;if(!e||!s)return 0;const t=e.stringValue===w.YES||e.stringValue!==w.NO&&void 0,n=s.stringValue===w.YES||s.stringValue!==w.NO&&void 0;if(t===n)return 0;if(void 0===t)return 1;if(void 0===n)return-1;return t?1:-1}(s.currentValue,t.currentValue)}return o===a?0:(0,n.isNil)(o)||(0,n.isNil)(a)?(0,n.isNil)(o)?-1:1:o>a?1:-1}(e.assessmentInfo,s,t)}return 0},maxSize:200,size:t?so:eo,minSize:t?so:eo,cell:e=>{const{isComparing:s,assessmentInfo:t,comparisonEntry:n}=e.getValue();return wn(o,a,s,t,n)}};case Te.EXPECTATION:return{...d,accessorFn:s=>({isComparing:t,expectationName:e.expectationName,comparisonEntry:s}),maxSize:200,size:t?so:eo,minSize:t?so:eo,cell:e=>{const{isComparing:s,expectationName:t,comparisonEntry:n}=e.getValue();return((e,s,t,n,o)=>{var a,i,r,l;const d=null===(a=o.currentRunValue)||void 0===a||null===(i=a.targets)||void 0===i?void 0:i[n],c=null===(r=o.otherRunValue)||void 0===r||null===(l=r.targets)||void 0===l?void 0:l[n],u=d?(0,y.Y)(xe.SH,{parsedValue:d,singleLine:!0}):(0,y.Y)(Hs,{isComparing:t}),m=c?(0,y.Y)(xe.SH,{parsedValue:c,singleLine:!0}):(0,y.Y)(Hs,{isComparing:t});return t?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,y.Y)("div",{css:xn,children:u}),(0,y.Y)("div",{css:An,children:m})]}):u})(o,0,s,t,n)}};case Te.TRACE_INFO:return{...d,accessorFn:e=>({isComparing:t,comparisonEntry:e}),sortingFn:(s,t)=>{var n,o;const{comparisonEntry:a}=s.getValue(e.id),{comparisonEntry:i}=t.getValue(e.id);return((e,s,t)=>{var n,o;if(!Ke.includes(t))return 0;const a=String(null!==(n=Ys(e,t))&&void 0!==n?n:""),i=String(null!==(o=Ys(s,t))&&void 0!==o?o:"");return a.localeCompare(i,void 0,{numeric:!0})})(null===a||void 0===a||null===(n=a.currentRunValue)||void 0===n?void 0:n.traceInfo,null===i||void 0===i||null===(o=i.currentRunValue)||void 0===o?void 0:o.traceInfo,e.id)},size:e.id===Re?300:100,minSize:e.id===Re?120:100,cell:s=>{const{isComparing:t,comparisonEntry:d}=s.getValue();return((e,s,t,o,a,i,r,l)=>{var d,c;const u=null===(d=o.currentRunValue)||void 0===d?void 0:d.traceInfo,m=s?null===(c=o.otherRunValue)||void 0===c?void 0:c.traceInfo:void 0;if(t===ke){const e=null!==u&&void 0!==u&&u.request_time?new Date(u.request_time):void 0,t=null!==m&&void 0!==m&&m.request_time?new Date(m.request_time):void 0;return(0,y.Y)(Us,{first:e?(0,y.Y)(ye.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:e.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,y.Y)("span",{css:Rn,children:Sn(e,i,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})})}):(0,y.Y)(Hs,{isComparing:s}),second:s&&(t?(0,y.Y)(ye.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-other-request-time",content:t.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,y.Y)("span",{css:Mn,children:en(t)})}):(0,y.Y)(Hs,{isComparing:s}))})}if(t===Fe)return(0,y.Y)(Us,{first:(0,y.Y)(pt,{original:u,isComparing:s}),second:s&&(m?(0,y.Y)(pt,{original:m,isComparing:s}):(0,y.Y)(Hs,{isComparing:s}))});if(t===Oe)return(0,y.Y)(Us,{first:u?(0,y.Y)(ct,{traceInfo:u,isComparing:s}):(0,y.Y)(Hs,{isComparing:s}),second:s&&(m?(0,y.Y)(ct,{traceInfo:m,isComparing:s}):(0,y.Y)(Hs,{isComparing:s}))});if(t===Ve){const e=Object.entries((null===u||void 0===u?void 0:u.tags)||{}).map((([e,s])=>({key:e,value:s}))),t=Object.entries((null===m||void 0===m?void 0:m.tags)||{}).map((([e,s])=>({key:e,value:s}))),n=!m&&u?()=>null===l||void 0===l?void 0:l(u):void 0;return(0,y.Y)(Us,{first:(0,y.Y)(xt,{baseComponentId:"tags-cell-renderer",tags:e,onAddEditTags:n}),second:s&&(m?(0,y.Y)(xt,{baseComponentId:"tags-cell-renderer-other",tags:t}):(0,y.Y)(Hs,{isComparing:s}))})}if(t.startsWith(Ve)){var f,h;const e=t.split(":").pop();if(!e)return(0,y.Y)(Hs,{isComparing:s});const n=null===u||void 0===u||null===(f=u.tags)||void 0===f?void 0:f[e],o=null===m||void 0===m||null===(h=m.tags)||void 0===h?void 0:h[e];return(0,y.Y)(Us,{first:n?(0,y.Y)("span",{title:n,css:kn,children:n}):(0,y.Y)(Hs,{isComparing:s}),second:s&&(o?(0,y.Y)("span",{title:n,css:Dn,children:o}):(0,y.Y)(Hs,{isComparing:s}))})}if(t===Le){var b,S,I,w,x;const e=null===(b=o.currentRunValue)||void 0===b?void 0:b.evaluationId,t=null===u||void 0===u||null===(S=u.tags)||void 0===S?void 0:S["mlflow.traceName"],n=null===m||void 0===m||null===(I=m.tags)||void 0===I?void 0:I["mlflow.traceName"];return(0,y.Y)(Us,{first:t?s?(0,y.Y)("div",{children:null===u||void 0===u||null===(x=u.tags)||void 0===x?void 0:x["mlflow.traceName"]}):(0,y.Y)(v.T.Link,{css:Fn,componentId:"mlflow.evaluations_review.table_ui.evaluation_id_link",onClick:()=>e&&a(e),children:null===u||void 0===u||null===(w=u.tags)||void 0===w?void 0:w["mlflow.traceName"]}):(0,y.Y)(Hs,{isComparing:s}),second:s&&(n?(0,y.Y)("div",{children:n}):(0,y.Y)(Hs,{isComparing:s}))})}if(t===Ue){var A;const s=null===u||void 0===u||null===(A=u.trace_metadata)||void 0===A?void 0:A[Ze];return s?(0,y.Y)(nt,{experimentId:e,runUuid:s}):(0,y.Y)(Hs,{})}if(t===_e){var E,T,C,N;const e=(null===u||void 0===u||null===(E=u.trace_metadata)||void 0===E?void 0:E["mlflow.trace.user"])||(null===u||void 0===u||null===(T=u.tags)||void 0===T?void 0:T["mlflow.user"]),t=(null===m||void 0===m||null===(C=m.trace_metadata)||void 0===C?void 0:C["mlflow.trace.user"])||(null===m||void 0===m||null===(N=m.tags)||void 0===N?void 0:N["mlflow.user"]);return(0,y.Y)(Us,{first:e?(0,y.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:r.spacing.xs},""),title:e,children:[(0,y.Y)(g.UserIcon,{css:(0,p.AH)({color:r.colors.textSecondary,fontSize:16},"")}),(0,y.Y)("span",{css:On,children:e})]}):(0,y.Y)(Hs,{isComparing:s}),second:s&&(t?(0,y.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:r.spacing.xs},""),title:t,children:[(0,y.Y)(g.UserIcon,{css:(0,p.AH)({color:r.colors.textSecondary,fontSize:16},"")}),(0,y.Y)("span",{css:Vn,children:t})]}):(0,y.Y)(Hs,{isComparing:s}))})}if(t===Me){const e=null===u||void 0===u?void 0:u.trace_id,t=null===m||void 0===m?void 0:m.trace_id;return(0,y.Y)(Us,{first:e?(0,y.Y)(g.Tag,{css:Ln,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",onClick:()=>a(e),children:(0,y.Y)("span",{css:Hn,children:e})}):(0,y.Y)(Hs,{isComparing:s}),second:s&&(t?(0,y.Y)(g.Tag,{css:Un,componentId:"mlflow.genai-traces-table.trace-id",color:"indigo",title:t,onClick:()=>a(t),children:(0,y.Y)("span",{css:zn,children:t})}):(0,y.Y)(Hs,{isComparing:s}))})}if(t===Ye){var _,Y;const t=null===u||void 0===u||null===(_=u.trace_metadata)||void 0===_?void 0:_["mlflow.trace.session"],n=null===m||void 0===m||null===(Y=m.trace_metadata)||void 0===Y?void 0:Y["mlflow.trace.session"],o=null===u||void 0===u?void 0:u.trace_id,a=null===m||void 0===m?void 0:m.trace_id;return(0,y.Y)(Us,{first:t?(0,y.Y)(it,{sessionId:t,experimentId:e,traceId:o,children:(0,y.Y)(g.Tag,{css:Bn,componentId:"mlflow.genai-traces-table.session",title:t,children:(0,y.Y)("span",{css:$n,children:t})})}):(0,y.Y)(Hs,{isComparing:s}),second:s&&(n?(0,y.Y)(it,{sessionId:n,experimentId:e,traceId:a,children:(0,y.Y)(g.Tag,{css:jn,componentId:"mlflow.genai-traces-table.session",title:n,children:(0,y.Y)("span",{css:Pn,children:n})})}):(0,y.Y)(Hs,{isComparing:s}))})}if(t===Re){const e=u?to(us(u)):"",t=m?to(us(m)):"";return(0,y.Y)(Us,{first:e?(0,y.Y)("div",{css:qn,title:e,children:e}):(0,y.Y)(Hs,{isComparing:s}),second:s&&(t?(0,y.Y)("div",{css:Kn,title:t,children:t}):(0,y.Y)(Hs,{isComparing:s}))})}if(t===ze)return(0,y.Y)(Qs,{experimentId:e,currentTraceInfo:u,otherTraceInfo:m,isComparing:s});if(t===Be)return(0,y.Y)(At,{currentTraceInfo:u,otherTraceInfo:m,isComparing:s});if(t.startsWith($e)){var R,M;const e=ns(t);if(!e)return(0,y.Y)(Hs,{isComparing:s});const n=null===u||void 0===u||null===(R=u.trace_metadata)||void 0===R?void 0:R[e],o=null===m||void 0===m||null===(M=m.trace_metadata)||void 0===M?void 0:M[e];return(0,y.Y)(Us,{first:n?(0,y.Y)("div",{css:Gn,title:n,children:n}):(0,y.Y)(Hs,{isComparing:s}),second:s&&(o?(0,y.Y)("div",{css:Wn,title:o,children:o}):(0,y.Y)(Hs,{isComparing:s}))})}if(t===De){const e=e=>{var s;if(void 0===e)return;const t=parseFloat(e),o=null===e||void 0===e||null===(s=e.replace)||void 0===s?void 0:s.call(e,/[0-9.]/g,"").trim().toLowerCase();return(0,n.isNil)(t)||isNaN(t)?void 0:[t.toFixed(3).replace(/\.?0+$/,""),o].filter(Boolean).join("")},t=e(null===u||void 0===u?void 0:u[De]),o=e(null===m||void 0===m?void 0:m[De]);return(0,y.Y)(Us,{first:(0,n.isNil)(t)?(0,y.Y)(Hs,{isComparing:s}):(0,y.Y)("div",{css:Qn,title:t,children:t}),second:s&&((0,n.isNil)(o)?(0,y.Y)(Hs,{isComparing:s}):(0,y.Y)("div",{css:Jn,title:o,children:o}))})}const k=u?K(Ys(u,t)):"",D=m?K(Ys(m,t)):"";return(0,y.Y)(Us,{first:k?(0,y.Y)("div",{css:Xn,title:k,children:k}):(0,y.Y)(Hs,{isComparing:s}),second:s&&(D?(0,y.Y)("div",{css:Zn,title:D,children:D}):(0,y.Y)(Hs,{isComparing:s}))})})(i,t,e.id,d,r,a,o,l)}};case Te.INTERNAL_MONITOR_REQUEST_TIME:return{...d,accessorFn:e=>{var s;return null===(s=e.currentRunValue)||void 0===s?void 0:s.requestTime},sortingFn:(s,t)=>{const n=s.getValue(e.id),o=t.getValue(e.id);return JSON.stringify(n).localeCompare(JSON.stringify(o))},size:100,minSize:100,cell:e=>{const s=e.getValue();if(!s)return null;const t=new Date(s);return(0,y.Y)(ye.T,{componentId:"mlflow.experiment-evaluation-monitoring.trace-info-hover-request-time",content:t.toLocaleString(navigator.language,{timeZoneName:"short"}),children:(0,y.Y)("span",{children:en(t)})})}};default:return d}};var oo=t(43617);const ao=ie.memo((({rows:e,isComparing:s,enableRowSelection:t,virtualItems:n,virtualizerTotalSize:o,virtualizerMeasureElement:a,selectedColumns:i})=>(0,y.Y)("div",{style:{height:`${o}px`,position:"relative",display:"grid"},children:n.map((n=>{const o=e[n.index],r=o.original.currentRunValue&&!s;return(0,y.Y)("div",{"data-index":n.index,ref:e=>a(e),style:{position:"absolute",transform:`translate3d(0, ${n.start}px, 0)`,willChange:"transform",width:"100%"},children:(0,y.Y)(lo,{row:o,exportableTrace:r,enableRowSelection:t,isSelected:t?o.getIsSelected():void 0,isComparing:s,selectedColumns:i})},n.key)}))}))),io=ie.memo(ao);var ro={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"};const lo=ie.memo((({row:e,exportableTrace:s,enableRowSelection:t,isComparing:n,isSelected:o,selectedColumns:a})=>{const i=e.getVisibleCells(),r=(0,f.tz)();return(0,y.Y)(y.FK,{children:(0,y.FD)(g.TableRow,{children:[(0,y.Y)("div",{css:ro,children:t&&(0,y.Y)(ye.T,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell-tooltip",content:n?r.formatMessage({id:"dqfOjO",defaultMessage:"You cannot select rows when comparing runs"}):s?null:r.formatMessage({id:"V0/LoE",defaultMessage:"This trace is not exportable because it either contains an error or the response is not a ChatCompletionResponse."}),children:(0,y.Y)(g.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-cell",checked:o&&s,onChange:e.getToggleSelectedHandler(),isDisabled:n||!s})})}),i.map((e=>(0,y.Y)(co,{cell:e},e.id)))]})})})),co=ie.memo((({cell:e})=>{const{theme:s}=(0,v.u)();return(0,y.Y)(g.TableCell,{style:{flex:`1 1 var(--col-${sn(e.column.id)}-size)`},css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center","> span:first-of-type":{padding:`${s.spacing.xs}px 0px`,width:"100%"}},""),children:(0,oo.Kv)(e.column.columnDef.cell,e.getContext())},e.id)}));const uo=({overallAssessmentInfo:e,assessmentNameToAggregates:s,allAssessmentFilters:t,toggleAssessmentFilter:n,runUuid:o,compareToRunUuid:a})=>{const i=(0,f.tz)(),{theme:r}=(0,v.u)(),l=(0,ie.useMemo)((()=>function(e,s,t,n,o,a,i){var r,l;if(Object.values(s).every((e=>0===e.currentNumRootCause&&0===(e.otherNumRootCause||0))))return[];const d=Object.values(s).filter((e=>e.currentNumRootCause>0||(e.otherNumRootCause||0)>0)).sort(((e,s)=>s.currentNumRootCause-e.currentNumRootCause)),c=Math.max((null===(r=d[0])||void 0===r?void 0:r.currentNumRootCause)||0,(null===(l=d[0])||void 0===l?void 0:l.otherNumRootCause)||0);return d.map((s=>{var r;const l=null===(r=R[s.assessmentInfo.name])||void 0===r?void 0:r[w.NO],d=l?e.formatMessage(l):s.assessmentInfo.name,u=s.currentCounts,m=(null===u||void 0===u?void 0:u.get(w.YES))||0,p=(null===u||void 0===u?void 0:u.get(w.NO))||0,g=(null===u||void 0===u?void 0:u.get(void 0))||0,v=s.currentNumRootCause,f=m+p+g,h=s.otherCounts;let b;if(void 0!==s.otherCounts){b=((null===h||void 0===h?void 0:h.get(w.YES))||0)+((null===h||void 0===h?void 0:h.get(w.NO))||0)+((null===h||void 0===h?void 0:h.get(void 0))||0)}const S=s.otherNumRootCause||0,I=S/(b||1),x=Jt(v/f),A=Jt(I);return{assessment:s.assessmentInfo.name,title:d,currentInfo:{count:v,fraction:v/c,tooltip:e.formatMessage({id:"a6bpXQ",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for the current run "{currentRun}".'},{numRootCause:v,numEvals:f,percentage:x,assessment:s.assessmentInfo.name,currentRun:a}),toggleFilter:()=>n(s.assessmentInfo.name,"failing_root_cause","current"),isSelected:t.some((e=>"rca"===e.filterType&&"current"===e.run&&e.assessmentName===s.assessmentInfo.name)),percentage:x},otherInfo:o?{count:S,fraction:S/c,tooltip:e.formatMessage({id:"iDqqcA",defaultMessage:'{numRootCause}/{numEvals} ({percentage}%) runs failed due to the {assessment} judge failing for run "{otherRunDisplayName}".'},{numRootCause:S,numEvals:b,percentage:A,assessment:s.assessmentInfo.name,otherRunDisplayName:i}),toggleFilter:()=>n(s.assessmentInfo.name,"rca","other"),isSelected:t.some((e=>"rca"===e.filterType&&"other"===e.run&&e.assessmentName===s.assessmentInfo.name)),percentage:A}:void 0,icon:(0,y.Y)(he.X,{})}}))}(i,s,t,n,Boolean(a),o,a)),[i,s,t,n,a,o]);return 0===l.length?(0,y.Y)(y.FK,{}):(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:[(0,y.Y)("div",{css:(0,p.AH)({fontWeight:r.typography.typographyBoldFontWeight},""),children:i.formatMessage({id:"etvfuH",defaultMessage:"Root Cause Analysis"})}),(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:(0,y.Y)(po,{overallAssessmentInfo:e,rcaData:l,run:"current",runColor:a?X:void 0})}),a&&(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:r.spacing.xs},""),children:(0,y.Y)(po,{overallAssessmentInfo:e,rcaData:l,run:"other",runColor:Z})})]})};var mo={name:"zjik7",styles:"display:flex"};const po=({rcaData:e,run:s,runColor:t,overallAssessmentInfo:n})=>{const{theme:o}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:o.spacing.sm,alignItems:"center"},""),children:[t&&(0,y.Y)("div",{css:mo,children:(0,y.Y)(bn,{color:t})}),(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexWrap:"wrap",gap:o.spacing.xs},""),children:e.map(((e,t)=>{const a="current"===s?e.currentInfo:e.otherInfo;if(!a)return(0,y.Y)(y.FK,{});const i=oe(o,n,{stringValue:"no"});return(0,y.Y)(ye.T,{content:a.tooltip,componentId:"mlflow.evaluations_review.rca_pill",children:(0,y.Y)(y.FK,{children:(0,y.FD)("div",{style:{border:a.isSelected?`1px solid ${o.colors.grey400}`:""},css:(0,p.AH)({color:o.colors.textSecondary,borderRadius:o.general.borderRadiusBase,padding:`0 ${o.spacing.xs}px`,height:"20px",display:"flex",backgroundColor:a.isSelected?L(i,1):L(i,.5),gap:o.spacing.xs,fontSize:o.typography.fontSizeSm},""),children:[a.count,(0,y.Y)("div",{children:e.title.toLocaleLowerCase()})]},t)})},t)}))})]})};var go={name:"dao2zk",styles:"display:contents;& p{margin-bottom:0;}"};const vo=({assessmentInfo:e,assessmentNameToAggregates:s,allAssessmentFilters:t,toggleAssessmentFilter:n,runUuid:o,compareToRunUuid:a})=>{var r,l;const{theme:d}=(0,v.u)(),c=(0,f.tz)();return(0,y.Y)(y.FK,{children:(0,y.FD)("div",{css:(0,p.AH)({maxWidth:"25rem",display:"flex",flexDirection:"column",overflowWrap:"break-word",wordBreak:"break-word",gap:d.spacing.sm},""),children:[(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs},""),children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:d.spacing.xs,paddingBottom:d.spacing.sm,borderBottom:`1px solid ${d.colors.border}`},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.xs,alignItems:"center"},""),children:["numeric"===e.dtype?(0,y.Y)(g.NumbersIcon,{}):"boolean"===e.dtype?(0,y.Y)(g.BinaryIcon,{}):(0,y.Y)(y.FK,{}),(0,y.Y)(v.T.Title,{level:4,css:(0,p.AH)({marginBottom:0,marginRight:d.spacing.xs},""),children:e.displayName}),"AI_JUDGE"===(null===(r=e.source)||void 0===r?void 0:r.sourceType)&&(0,y.Y)(g.Tag,{color:"turquoise",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,y.Y)(g.SparkleDoubleIcon,{css:(0,p.AH)({color:d.colors.textSecondary},"")}),(0,y.Y)(v.T.Hint,{children:c.formatMessage({id:"ov1whU",defaultMessage:"AI Judge"})})]})}),"HUMAN"===(null===(l=e.source)||void 0===l?void 0:l.sourceType)&&(0,y.Y)(g.Tag,{color:"coral",componentId:"mlflow.experiment.evaluations.human-judge-tag",children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,y.Y)(g.UserIcon,{}),(0,y.Y)(v.T.Hint,{children:c.formatMessage({id:"BdV0qk",defaultMessage:"Human judge"})})]})}),e.isCustomMetric&&(0,y.Y)(g.Tag,{color:"indigo",componentId:"mlflow.experiment.evaluations.ai-judge-tag",children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.xs},""),children:[(0,y.Y)(v.T.Hint,{children:(0,y.Y)(g.BracketsXIcon,{})}),(0,y.Y)(v.T.Hint,{children:e.metricName})]})})]}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Hint,{children:e.name})})]})}),(0,y.Y)("div",{children:(0,y.Y)("span",{css:go,children:e.description})}),e.name===i.OVERALL_ASSESSMENT&&o?(0,y.Y)("div",{children:(0,y.Y)(uo,{overallAssessmentInfo:e,assessmentNameToAggregates:s,allAssessmentFilters:t,toggleAssessmentFilter:n,runUuid:o,compareToRunUuid:a})}):(0,y.Y)(y.FK,{})]})})};var fo={name:"1yqwqbb",styles:"max-height:200px;overflow-y:auto;width:200px;min-width:200px"};const ho=ie.memo((({theme:e,intl:s,assessmentInfo:t,assessmentAggregates:n,allAssessmentFilters:o,toggleAssessmentFilter:a,currentRunDisplayName:i,compareToRunDisplayName:r})=>{const l=(0,ie.useMemo)((()=>function(e,s,t,n,o,a,i,r){const l=void 0!==a.otherCounts,d=[];for(const c of Gt(t)){const u=a.currentCounts?Kt(e,t,n,c,a.currentCounts,i||ss,o):void 0,m=l&&r?Kt(e,t,n,c,a.otherCounts||new Map,r,o):void 0,p=c===Ft||void 0===c,g=l&&u&&m?p?u.value-((null===m||void 0===m?void 0:m.value)||0):u.fraction-((null===m||void 0===m?void 0:m.fraction)||0):void 0;u&&(!p||0!==u.value||g&&0!==g)&&d.push({name:Wt(e,0,t,c),current:u,other:m,backgroundColor:ae(s,t,c,c===Ft),scoreChange:g})}return d}(s,e,t,o,a,n,i,r)),[s,e,t,o,a,n,i,r]),d=(0,ie.useMemo)((()=>"pass-fail"===t.dtype||"boolean"===t.dtype?l:l.map(((e,s)=>({...e,originalIndex:s}))).sort(((e,s)=>{const t="null"===e.name||e.name===Ft,n="null"===s.name||s.name===Ft;if(t&&!n)return 1;if(n&&!t)return-1;if(!t&&!n){var o,a;const t=((null===(o=s.current)||void 0===o?void 0:o.value)||0)-((null===(a=e.current)||void 0===a?void 0:a.value)||0);if(0!==t)return t}return e.originalIndex-s.originalIndex}))),[l,t]),c=d.length>4?d.slice(0,3):d,u=d.length>4?d.slice(3):[],m=u.length>0,g=e.colors.actionDefaultBackgroundHover,f=e.colors.actionDefaultBackgroundPress;return(0,y.Y)("table",{children:(0,y.FD)("tbody",{children:[c.map((s=>(0,y.Y)(So,{barData:s,theme:e,hoverBarColor:g,selectedBarColor:f,assessmentInfo:t},s.name))),m&&(0,y.Y)("tr",{children:(0,y.Y)("td",{colSpan:2,children:(0,y.FD)(v.aw.Root,{componentId:"categorical-aggregate-chart-more-items",children:[(0,y.Y)(v.aw.Trigger,{asChild:!0,children:(0,y.Y)("div",{css:(0,p.AH)({cursor:"pointer",padding:`${e.spacing.xs}px`,color:e.colors.actionLinkDefault,fontSize:e.typography.fontSizeSm,fontWeight:"normal",":hover":{backgroundColor:g},borderRadius:e.general.borderRadiusBase},""),children:s.formatMessage({id:"WELl8J",defaultMessage:"+{count} more"},{count:u.length})})}),(0,y.Y)(v.aw.Content,{align:"start",side:"bottom",css:fo,children:(0,y.Y)("table",{children:(0,y.Y)("tbody",{children:u.map((s=>(0,y.Y)(So,{barData:s,theme:e,hoverBarColor:g,selectedBarColor:f,assessmentInfo:t},s.name)))})})})]})})})]})})}));var yo={name:"5m5bfc",styles:"display:flex;flex-direction:column;gap:2px;width:100%"},bo={name:"12n4oo4",styles:"flex:1;width:100%;position:relative"};const So=({barData:e,theme:s,hoverBarColor:t,selectedBarColor:o,assessmentInfo:a})=>{const i=e.name===Ft,r="null"===e.name;return i||r?(0,y.FD)("tr",{css:(0,p.AH)({cursor:e.name!==Ft?"pointer":"not-allowed",":hover":{backgroundColor:t},color:e.name===Ft?s.colors.textValidationWarning:s.colors.textSecondary,fontWeight:"normal",fontSize:s.typography.fontSizeSm},""),onClick:e.name!==Ft?e.current.toggleFilter:void 0,children:[(0,y.Y)("td",{css:(0,p.AH)({width:"100%",borderTopLeftRadius:s.general.borderRadiusBase,borderBottomLeftRadius:s.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:s.spacing.xs,paddingTop:s.spacing.xs,paddingBottom:s.spacing.xs,fontStyle:e.name===Ft?"normal":"italic"},""),children:(0,y.Y)("span",{css:(0,p.AH)({lineHeight:`${s.typography.fontSizeSm}px`},""),children:e.name})}),(0,y.Y)("td",{css:(0,p.AH)({textAlign:"right",verticalAlign:"center",borderTopRightRadius:s.general.borderRadiusBase,borderBottomRightRadius:s.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:s.spacing.xs,paddingTop:s.spacing.xs,paddingBottom:s.spacing.xs,fontStyle:"normal"},""),children:(0,y.Y)("span",{css:(0,p.AH)({display:"inline-block",verticalAlign:"center",lineHeight:`${s.typography.fontSizeSm}px`},""),children:(0,n.isNil)(e.scoreChange)?e.current.value:Zt(a,e.scoreChange,!1)})})]},e.name):(0,y.FD)("tr",{css:(0,p.AH)({cursor:"pointer",":hover":{backgroundColor:t}},""),onClick:e.current.toggleFilter,children:[(0,y.Y)("td",{css:(0,p.AH)({width:"100%",borderTopLeftRadius:s.general.borderRadiusBase,borderBottomLeftRadius:s.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingLeft:s.spacing.xs,paddingTop:s.spacing.xs,paddingBottom:s.spacing.xs},""),children:(0,y.FD)("div",{css:yo,children:[(0,y.Y)("span",{css:(0,p.AH)({fontWeight:"normal",fontSize:"10px",lineHeight:"10px",color:s.colors.textSecondary},""),children:e.name}),(0,y.Y)("div",{css:bo,children:(0,y.Y)("div",{style:{width:e.current.value>0?100*e.current.fraction+"%":"2px",borderRadius:"2px"},css:(0,p.AH)({position:"relative",flexShrink:1,transition:"width 0.3s",backgroundColor:e.backgroundColor,height:"10px",display:"flex",alignItems:"center"},"")})})]})}),(0,y.Y)("td",{css:(0,p.AH)({textAlign:"right",verticalAlign:"bottom",borderTopRightRadius:s.general.borderRadiusBase,borderBottomRightRadius:s.general.borderRadiusBase,backgroundColor:`${e.current.isSelected?o:""}`,paddingRight:s.spacing.xs,paddingTop:s.spacing.xs,paddingBottom:s.spacing.xs},""),children:(0,y.Y)("span",{css:(0,p.AH)({color:s.colors.textSecondary,fontWeight:"normal",fontSize:s.typography.fontSizeSm,display:"inline-block",verticalAlign:"bottom",lineHeight:`${s.typography.fontSizeSm}px`},""),children:(0,n.isNil)(e.scoreChange)?(l=e.current.fraction,Jt(l,0)+"%"):Zt(a,e.scoreChange)})})]},e.name);var l};var Io={name:"1fttcpj",styles:"display:flex;flex-direction:column"},wo={name:"1a4tfjy",styles:"display:flex;justify-content:center;flex-direction:row"},xo={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Ao={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Eo={name:"18ubt2d",styles:"width:25%"},To={name:"ho1qnd",styles:"display:flex;flex-direction:row"},Co={name:"18ubt2d",styles:"width:25%"};const No=ie.memo((({numericAggregate:e})=>{const{theme:s}=(0,v.u)(),t=(0,f.tz)();return(0,y.FD)("div",{css:Io,children:[(0,y.Y)("div",{css:wo,children:e.counts.map(((n,o)=>(0,y.Y)(g.HoverCard,{content:(0,y.FD)("div",{css:xo,children:[(0,y.FD)("div",{css:Ao,children:[(0,y.Y)("div",{css:Eo,children:(0,y.Y)(v.T.Text,{children:t.formatMessage({id:"kAVQ2/",defaultMessage:"Range"})})}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Text,{color:"secondary",children:Xt(n.lower,2)===Xt(n.upper,2)?Xt(n.lower,2):`${Xt(n.lower,2)} - ${Xt(n.upper,2)}`})})]}),(0,y.FD)("div",{css:To,children:[(0,y.Y)("div",{css:Co,children:(0,y.Y)(v.T.Text,{children:t.formatMessage({id:"ClYb2e",defaultMessage:"Count"})})}),(0,y.Y)("div",{children:(0,y.Y)(v.T.Text,{color:"secondary",children:n.count})})]})]}),trigger:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flex:1,flexDirection:"column-reverse",height:"60px",width:"10px",":hover":{backgroundColor:s.colors.actionDefaultBackgroundHover}},""),children:(0,y.Y)("div",{css:(0,p.AH)({height:n.count/e.maxCount*100+"%",minHeight:"1px",width:"80%",verticalAlign:"bottom",backgroundColor:s.colors.blue400,borderTopRightRadius:s.general.borderRadiusBase,borderTopLeftRadius:s.general.borderRadiusBase},"")})},"bar-"+o)},"hover-card-"+o)))}),e.min===e.max?(0,y.Y)("div",{css:(0,p.AH)({display:"flex",justifyContent:"center",flexDirection:"row",fontWeight:"normal",fontSize:s.typography.fontSizeSm,color:s.colors.textSecondary},""),children:Xt(e.min,2)}):(0,y.FD)("div",{css:(0,p.AH)({display:"flex",justifyContent:"space-between",flexDirection:"row",fontWeight:"normal",fontSize:s.typography.fontSizeSm,color:s.colors.textSecondary},""),children:[(0,y.Y)("div",{children:Xt(e.min,2)}),(0,y.Y)("div",{children:Xt(e.max,2)})]})]})})),_o=ie.memo((({theme:e,intl:s,assessmentInfo:t,assessmentAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:i,currentRunDisplayName:r,compareToRunDisplayName:l,collapsedHeader:d})=>{const c=(0,ie.useMemo)((()=>"pass-fail"===t.dtype?s.formatMessage({id:"Yd5ANL",defaultMessage:"PASS"}):"boolean"===t.dtype?s.formatMessage({id:"icBP3T",defaultMessage:"TRUE"}):"string"===t.dtype?s.formatMessage({id:"Jdr//R",defaultMessage:"STRING"}):"numeric"===t.dtype?s.formatMessage({id:"wDFPtr",defaultMessage:"AVG"}):void 0),[t,s]),{displayScore:u,displayScoreChange:m,changeDirection:g}=(0,ie.useMemo)((()=>function(e,s,t){if("numeric"===s.dtype){const e=t.currentNumericValues,s=t.otherNumericValues;let n=NaN,o=NaN;e&&(n=e.reduce(((e,s)=>e+s),0)/e.length),s&&(o=s.reduce(((e,s)=>e+s),0)/s.length);const a=s?n-o:void 0,i=a?a>0?"up":"down":"none";return{displayScore:Xt(n,2),displayScoreChange:a?"up"===i?`+${Xt(Math.abs(a),2)}`:"down"===i?`-${Xt(Math.abs(a),2)}`:"+0":void 0,changeDirection:i,aggregateType:"average"}}if("pass-fail"===s.dtype||"boolean"===s.dtype){const e=0,n=qt(s,t.currentCounts),o=Jt(n,e)+"%",a=t.otherCounts?n-qt(s,t.otherCounts):void 0,i=a?a>0?"up":"down":"none";return{displayScore:o,displayScoreChange:a?("up"===i||"none"===i?"+":"")+Jt(a,e)+"%":void 0,changeDirection:i,aggregateType:"percentage-true"}}if("string"===s.dtype){const t=s.uniqueValues.size;return{displayScore:1!==t?e.formatMessage({id:"+dbgRR",defaultMessage:"{numUniqueValues} values"},{numUniqueValues:t}):e.formatMessage({id:"lKyc9r",defaultMessage:"1 value"}),displayScoreChange:"",changeDirection:"none",aggregateType:"categorical"}}return{displayScore:"N/A",displayScoreChange:"N/A",changeDirection:"none",aggregateType:"categorical"}}(s,t,o)),[s,t,o]);return"unknown"===t.dtype?null:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:e.spacing.sm},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",paddingTop:e.spacing.xs},""),children:[(0,y.Y)("div",{css:(0,p.AH)({fontWeight:400,fontSize:"10px",color:e.colors.textPlaceholder},""),children:c}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:e.spacing.xs},""),children:[(0,y.Y)("div",{css:(0,p.AH)({fontSize:e.typography.fontSizeLg,color:e.colors.textPrimary,fontWeight:e.typography.typographyBoldFontWeight},""),children:u}),!(0,n.isNil)(m)&&l&&(0,y.Y)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",height:"20px",gap:e.spacing.xs,padding:`2px ${e.spacing.xs}px`,fontSize:e.typography.fontSizeMd,fontWeight:"normal",borderRadius:e.general.borderRadiusBase,color:"#64172B",backgroundColor:"none"===g?"":"up"===g?Q:"down"===g?J:L(e.colors.textSecondary,.1)},""),children:m})]})]}),!d&&((0,n.isNil)(o.currentNumericAggregate)?(0,y.Y)(ho,{theme:e,intl:s,assessmentInfo:t,assessmentAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:i,currentRunDisplayName:r,compareToRunDisplayName:l}):(0,y.Y)(No,{numericAggregate:o.currentNumericAggregate}))]})}));var Yo={name:"10sid5d",styles:"display:inline-block;overflow:hidden;text-overflow:ellipsis;word-break:normal;overflow-wrap:normal"},Ro={name:"190se29",styles:"padding-top:0px !important;position:absolute;left:0;right:0;bottom:0;z-index:101;padding:0;pointer-events:none"},Mo={name:"14n7h35",styles:"position:absolute;left:50%;top:100%;transform:translate(-50%, -50%);z-index:102;display:flex;align-items:center;justify-content:center;width:22px;height:22px;pointer-events:auto;cursor:pointer"};const ko=ie.memo((({enableRowSelection:e,enableGrouping:s,selectedAssessmentInfos:t,assessmentNameToAggregates:o,assessmentFilters:a,toggleAssessmentFilter:i,runDisplayName:r,compareToRunUuid:l,compareToRunDisplayName:d,disableAssessmentTooltips:c,collapsedHeader:u,setCollapsedHeader:m,isComparing:h,headerGroups:b,allRowSelected:S,someRowSelected:I,toggleAllRowsSelectedHandler:w,setColumnSizing:x})=>{const{theme:A}=(0,v.u)(),E=(0,f.tz)(),[T,C]=(0,ie.useState)(!1),N=s?{position:"relative","&::before":{content:'""',position:"absolute",top:"32px",left:0,right:0,borderTop:`1px solid ${A.colors.border}`}}:{};return(0,y.Y)(y.FK,{children:b.map(((v,f)=>(0,y.FD)(g.TableRow,{isHeader:!0,css:(0,p.AH)({position:"sticky",top:40*f,zIndex:100,...s&&{"& > *":{borderBottom:0===f?"none":void 0}},...f===b.length-1&&{borderBottom:`1px solid ${T?A.colors.blue500:A.colors.border}`,transition:"border-color 0.2s","& > *":{borderBottom:"none"}}},""),children:[e&&(0,y.Y)("div",{css:0===t.length&&1===f?{}:N,children:(0,y.Y)(g.TableRowSelectCell,{componentId:"mlflow.experiment-evaluation-monitoring.evals-logs-table-header-select-cell",checked:S,indeterminate:I,onChange:w(),checkboxLabel:E.formatMessage({id:"bO1IlR",defaultMessage:"Select all"}),noCheckbox:0===f,isDisabled:h})}),v.headers.map((e=>{if(e.isPlaceholder)return null;const m=t.find((s=>Qe(s.name)===e.id)),v=e.isPlaceholder?null:(0,y.Y)("div",{css:Yo,title:String((0,oo.Kv)(e.column.columnDef.header,e.getContext())),children:(0,oo.Kv)(e.column.columnDef.header,e.getContext())}),h=m&&!c?(0,y.Y)(g.HoverCard,{content:(0,y.Y)(y.FK,{children:(0,y.Y)(vo,{assessmentInfo:m,assessmentNameToAggregates:o,allAssessmentFilters:a,toggleAssessmentFilter:i,runUuid:r,compareToRunUuid:l?d:void 0})}),trigger:v},e.id):(0,n.isNil)(v)?null:v;return(0,y.Y)(g.TableHeader,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_evaluationsoverview.tsx_576",css:(0,p.AH)({"> span:first-of-type":{width:"100%",height:"100%",marginTop:"auto",marginBottom:"auto"},...0===t.length&&1===f?{}:N},""),style:{flex:`${e.colSpan} 1 var(--header-${sn(null===e||void 0===e?void 0:e.column.id)}-size)`},header:e,column:e.column,setColumnSizing:x,children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:A.spacing.xs},""),children:[h,(0,y.Y)("div",{css:(0,p.AH)({borderTop:!s&&t.length>0?`1px solid ${A.colors.border}`:"",width:"100%"},""),children:m&&(0,y.Y)(_o,{theme:A,intl:E,assessmentInfo:m,assessmentAggregates:o[m.name],allAssessmentFilters:a,toggleAssessmentFilter:i,currentRunDisplayName:r,compareToRunDisplayName:l?d:void 0,collapsedHeader:u})})]})},e.column.id)})),f===b.length-1&&(0,y.FD)("div",{css:Ro,children:[(0,y.Y)("div",{css:(0,p.AH)({position:"absolute",left:"50%",top:"100%",width:"24px",height:"12px",background:A.colors.backgroundPrimary,transform:"translate(-50%, -50%)",zIndex:101},"")}),(0,y.Y)("div",{css:Mo,onClick:()=>m(!u),onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:(0,y.Y)("div",{css:(0,p.AH)({width:"22px",height:"22px",borderRadius:"50%",background:A.colors.backgroundPrimary,border:`2px solid ${A.colors.border}`,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.10)",display:"flex",alignItems:"center",justifyContent:"center",transition:"border-color 0.2s, box-shadow 0.2s",":hover":{borderColor:A.colors.blue500,boxShadow:"0 2px 12px 0 rgba(0,0,0,0.18)"},opacity:T?1:.5},""),children:(0,y.Y)(g.ChevronDownIcon,{css:(0,p.AH)({transform:u?"none":"rotate(180deg)",transition:"transform 0.2s, opacity 0.2s",color:A.colors.textSecondary},"")})})})]})]},v.id)))})})),Do=e=>{const{theme:s}=(0,v.u)(),t=(0,f.tz)(),{groupId:n,visibleCount:o,totalCount:a,enableGrouping:i}=e.column.columnDef.meta;if(!i)return Ne[n];const r=Ne[n];return(0,y.FD)("div",{css:(0,p.AH)({height:"100%",width:"100%",display:"flex",overflow:"hidden",gap:s.spacing.sm},""),children:[(0,y.Y)("div",{children:r}),n===Ce.INFO?null:o===a?(0,y.FD)("div",{css:(0,p.AH)({color:s.colors.textSecondary,fontWeight:"normal"},""),children:["(",o,"/",a,")"]}):(0,y.Y)(g.HoverCard,{trigger:(0,y.FD)("div",{css:(0,p.AH)({color:s.colors.textSecondary,":hover":{textDecoration:"underline"},fontWeight:"normal"},""),children:["(",o,"/",a,")"]}),content:t.formatMessage({id:"pDCDkJ",defaultMessage:"Showing {visibleCount} out of {totalCount} {groupName}. Select columns to view more."},{visibleCount:o,totalCount:a,groupName:r}),align:"start"})]})};var Fo={name:"49aokf",styles:"display:contents"};const Oo=({history:e,alwaysExpanded:s=!1})=>{const{theme:t}=(0,v.u)(),o=(0,f.tz)(),[a,i]=(0,ie.useState)(new Date);(0,ie.useEffect)((()=>{const e=setInterval((()=>{i(new Date)}),5e3);return()=>{clearInterval(e)}}),[]);const r=(0,ie.useMemo)((()=>e.reduce(((s,t,n)=>{const o=e[n+1];return o?[...s,[t,o]]:s}),[])),[e]),{makeHTML:l}=rn(),d=(0,ie.useMemo)((()=>{var s;const t=null===(s=(0,n.first)(e))||void 0===s?void 0:s.rationale;return(0,n.isString)(t)?l(t):null}),[e,l]);var c,u,m;if(!r.length)return null!==(c=(0,n.first)(e))&&void 0!==c&&c.rationale?(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:(0,y.Y)("span",{css:Fo,dangerouslySetInnerHTML:{__html:null!==d&&void 0!==d?d:""}})}):null!==(u=(0,n.first)(e))&&void 0!==u&&u.errorMessage?(0,y.Y)(y.FK,{children:(0,y.Y)(v.T.Text,{color:"error",children:null===(m=(0,n.first)(e))||void 0===m?void 0:m.errorMessage})}):(0,y.Y)(y.FK,{children:!s&&(0,y.FD)("div",{children:[(0,y.Y)(ye.S,{size:"sm"}),(0,y.Y)(v.T.Hint,{children:(0,y.Y)(f.sA,{id:"Jj2kRy",defaultMessage:"No details for assessment"})})]})});const g=e=>{const s=V(e),t=R[e.name];if(t&&!(0,n.isNil)(s)){var o;const e=null!==(o=t[s.toString()])&&void 0!==o?o:t.default;if(e)return(0,y.Y)(f.sA,{...e,values:{value:s}})}return s};return(0,y.FD)(y.FK,{children:[(0,y.Y)(ye.S,{size:"sm"}),r.map((([e,n],i)=>{var r,l;const d=g(n),c=g(e),u=d===c,m=B(e)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):en(e.timestamp,a);return(0,y.FD)("div",{css:(0,p.AH)({marginBottom:s?void 0:t.spacing.md},""),children:[(0,y.FD)(v.T.Hint,{css:(0,p.AH)({marginBottom:t.spacing.xs},""),children:[d&&c&&(0,y.FD)(y.FK,{children:[(0,y.Y)("code",{children:g(n)})," \u2192 ",(0,y.Y)("code",{children:g(e)})," "]}),u?(0,y.Y)(f.sA,{id:"2/B9Zg",defaultMessage:"added {when} by {user}",values:{when:m,user:null===(r=e.source)||void 0===r?void 0:r.sourceId}}):(0,y.Y)(f.sA,{id:"4TDvGX",defaultMessage:"edited {when} by {user}",values:{when:m,user:null===(l=e.source)||void 0===l?void 0:l.sourceId}})]}),e.rationale&&(0,y.Y)(v.T.Text,{children:e.rationale})]},`${e.timestamp}-${i}`)}))]})},Vo=({assessmentHistory:e,children:s,disable:t=!1})=>{const o=(0,f.tz)(),a=(0,ie.useMemo)((()=>e.some(F)),[e]),[i,r]=(0,ie.useState)(new Date);(0,ie.useEffect)((()=>{const e=setInterval((()=>{r(new Date)}),5e3);return()=>{clearInterval(e)}}),[]);return(0,y.Y)(ye.T,{componentId:"web-shared.genai-traces-table.evaluations-review-assessment.tooltip",content:t?void 0:(0,y.Y)("span",{children:(()=>{const s=(0,n.first)(e);if(!s)return;if(P(s)){var t,r;const n=e[1],a=n?null===(t=V(n))||void 0===t?void 0:t.toString():void 0,c=B(s)?o.formatMessage({id:"rmAWZX",defaultMessage:"just now"}):en(s.timestamp,i);if(a){var l,d;const e=null===(l=R[s.name])||void 0===l?void 0:l[a],t=e?o.formatMessage(e):a;return(0,y.Y)(f.sA,{id:"kHN/4I",defaultMessage:"Edited {timeSince} by {source}. Original value: {value}",values:{timeSince:c,source:null===s||void 0===s||null===(d=s.source)||void 0===d?void 0:d.sourceId,value:t}})}return(0,y.Y)(f.sA,{id:"m8ztHR",defaultMessage:"Edited {timeSince} by {source}.",values:{timeSince:c,source:null===s||void 0===s||null===(r=s.source)||void 0===r?void 0:r.sourceId}})}return a?(0,y.Y)(f.sA,{id:"4uE8hl",defaultMessage:"Overall assessment added by LLM-as-a-judge"}):null!==s&&void 0!==s&&s.errorMessage?null===s||void 0===s?void 0:s.errorMessage:(0,y.Y)(f.sA,{id:"gn1eO9",defaultMessage:"Assessment added by LLM-as-a-judge"})})()}),side:"top",children:s})},Lo=({editedAssessment:e,valueSuggestions:s,onSave:t,onCancel:n,readOnly:o=!1})=>{var a;const{theme:i}=(0,v.u)(),r=(0,f.tz)(),[l,d]=(0,ie.useState)((()=>(null===e||void 0===e?void 0:e.rationale)||void 0)),[c,u]=(0,ie.useState)(""),[m,h]=(0,ie.useState)((()=>{if(e){var t;const o=null===(t=V(e))||void 0===t?void 0:t.toString();var n;return o?null!==(n=s.find((e=>e.key===o)))&&void 0!==n?n:{key:o,label:o}:{key:e.name,label:e.name}}return{key:"",label:""}})),[b,S]=(0,ie.useState)(!1),I=(0,ie.useMemo)((()=>s.filter((e=>e.label.toLowerCase().includes(c.toLowerCase())))),[c,s]),w=b?s:I,x=c||w.length>0,A=(0,g.useComboboxState)({componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_124",allItems:s,items:w,setItems:()=>{},setInputValue:e=>{S(!1),u(e)},multiSelect:!1,allowNewValue:!0,itemToString:e=>e?e.label:"",formValue:m,initialSelectedItem:m,initialInputValue:null!==(a=null===m||void 0===m?void 0:m.label)&&void 0!==a?a:"",formOnChange:e=>{(null===m||void 0===m?void 0:m.label)!==e&&h("string"!==typeof e?e:{key:null!==c&&void 0!==c?c:"",label:null!==c&&void 0!==c?c:""})},onIsOpenChange(e){e&&S(!0)}}),E=r.formatMessage({id:"bCdY2j",defaultMessage:'Add "{label}"'},{label:c});return(0,y.FD)("div",{children:[(0,y.FD)(g.TypeaheadComboboxRoot,{comboboxState:A,children:[(0,y.Y)(g.TypeaheadComboboxInput,{readOnly:o,css:(0,p.AH)({width:300,backgroundColor:i.colors.backgroundPrimary},""),placeholder:r.formatMessage({id:"nxzK82",defaultMessage:"Select or type an assessment"}),onKeyUp:e=>{-1===A.highlightedIndex&&"Enter"===e.key&&A.closeMenu()},comboboxState:A,formOnChange:e=>{h(e)}}),x&&(0,y.Y)(g.TypeaheadComboboxMenu,{comboboxState:A,emptyText:E,matchTriggerWidth:!0,children:w.map(((e,s)=>(0,y.Y)(g.TypeaheadComboboxMenuItem,{item:e,index:s,comboboxState:A,isDisabled:(null===e||void 0===e?void 0:e.disabled)||!1,children:e.label},`${e.key}-${s}`)))})]}),(0,y.Y)(ye.S,{size:"sm"}),(0,y.Y)("div",{css:(0,p.AH)({backgroundColor:i.colors.backgroundPrimary,borderRadius:i.general.borderRadiusBase},""),children:(0,y.Y)(he.I.TextArea,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentupsertform.tsx_160",autoSize:!0,value:null!==l&&void 0!==l?l:"",onChange:e=>d(e.target.value),placeholder:r.formatMessage({id:"r/mP0/",defaultMessage:"Add rationale (optional)"})})}),(0,y.Y)(ye.S,{size:"sm"}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:i.spacing.xs},""),children:[(0,y.Y)(v.B,{size:"small",type:"primary",componentId:"mlflow.evaluations_review.confirm_edited_assessment_button",onClick:()=>{var s,n;if(!m)return;const o=null!==(s=null!==(n=m.rootAssessmentName)&&void 0!==n?n:null===e||void 0===e?void 0:e.name)&&void 0!==s?s:m.key,a=o===m.key||m.key;t({value:a,rationale:l,assessmentName:o})},disabled:!(null!==m&&void 0!==m&&m.key),children:(0,y.Y)(f.sA,{id:"/k6j6v",defaultMessage:"Confirm"})}),(0,y.Y)(v.B,{size:"small",type:"tertiary",componentId:"mlflow.evaluations_review.cancel_edited_assessment_button",onClick:n,children:(0,y.Y)(f.sA,{id:"5e1r3Y",defaultMessage:"Cancel"})})]})]})},Ho=(e,s)=>{const t=(0,f.tz)(),[n,o]=(0,ie.useState)(void 0),[a,i]=(0,ie.useState)(!1),[r,l]=(0,ie.useState)([]),d=(0,ie.useCallback)(((n,a)=>{o(a),i(n),l(((e,s,t,n)=>{if(s){const t=R[s.name];return t?Object.entries(t).map((([t,n])=>({key:t,label:e.formatMessage(n),rootAssessmentName:s.name}))):[]}return(n||[]).filter((e=>"boolean"===e.dtype)).map((e=>({key:e.name,label:e.name,rootAssessmentName:e.name,disabled:null===t||void 0===t?void 0:t.some((s=>s.name===e.name))})))})(t,a,e,s))}),[t,s,e]),c=(0,ie.useCallback)((e=>d(!0,e)),[d]);return{suggestions:r,editingAssessment:n,showUpsertForm:a,addAssessment:(0,ie.useCallback)((()=>d(!0,void 0)),[d]),editAssessment:c,closeForm:(0,ie.useCallback)((()=>{o(void 0),i(!1)}),[])}};var Uo={name:"49aokf",styles:"display:contents"};const zo=({assessmentsType:e,assessmentName:s,assessmentHistory:t,rootCauseAssessment:o,onUpsertAssessment:a,allowEditing:i=!1,options:r,inputs:l,assessmentInfo:d,assessmentInfos:c})=>{const{theme:u}=(0,v.u)(),m=(0,f.tz)(),h="overall"===e,{suggestions:b,editingAssessment:I,showUpsertForm:w,editAssessment:x,closeForm:A}=Ho(t,c);(0,ie.useEffect)((()=>{A()}),[l,A]);const E=(0,n.first)(t),T=N[s],C=T?m.formatMessage(T):s,_=Boolean(E&&V(E)),Y=Boolean(E&&B(E)),R=i&&(_||Y),{makeHTML:M}=rn(),k=(0,ie.useMemo)((()=>{var e;const s=null===E||void 0===E||null===(e=E.rootCauseAssessment)||void 0===e?void 0:e.suggestedActions;return(0,n.isString)(s)?M(s):null}),[E,M]);return(0,y.FD)("div",{css:(0,p.AH)({display:"block",marginBottom:h?void 0:u.spacing.md},""),children:[!w&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[s!==S.OVERALL_ASSESSMENT&&(0,y.Y)("div",{css:(0,p.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:(0,y.Y)(vn,{assessment:E,"aria-label":C,disableJudgeTypeIcon:G(E),onEdit:R?()=>{const e=(0,n.first)(t);e&&x(e)}:void 0,assessmentInfo:d,type:"assessment-value"})}),(0,y.Y)(Oo,{history:t,alwaysExpanded:h}),o&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginTop:u.spacing.xs},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.BugIcon,{color:"danger"}),(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"M8pHqP",defaultMessage:"Root cause failure:"})}),(0,y.Y)(vn,{assessment:o,isRootCauseAssessment:!0,"aria-label":C,assessmentInfo:d,type:"assessment-value"})]}),(0,y.Y)(Oo,{history:[o],alwaysExpanded:h}),k&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:u.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.AssistantIcon,{color:"ai"}),(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"vCUglz",defaultMessage:"Suggested actions"})})]}),(0,y.Y)("span",{css:Uo,dangerouslySetInnerHTML:{__html:k}})]})]})]}),w&&(0,y.Y)(y.FK,{children:(0,y.Y)(Lo,{editedAssessment:I,valueSuggestions:b,onCancel:A,onSave:({value:e,rationale:s,assessmentName:t})=>{var n;const o=h?S.OVERALL_ASSESSMENT:"",i=z({name:null!==(n=null!==t&&void 0!==t?t:null===I||void 0===I?void 0:I.name)&&void 0!==n?n:o,isOverallAssessment:h,value:e,rationale:s});a(i),A()}},null===I||void 0===I?void 0:I.name)})]},s)};var Bo={name:"eivff4",styles:"display:none"};const $o=({assessmentsType:e,assessmentsByName:s,rootCauseAssessment:t,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:a=!1,options:i,inputs:r,assessmentInfos:l})=>{const{theme:d}=(0,v.u)(),c="overall"===e,u=s.filter((([e,s])=>s.length>0)),{suggestions:m,editingAssessment:h,showUpsertForm:b,addAssessment:I,closeForm:w}=Ho(u.flatMap((([e,s])=>s)),l);(0,ie.useEffect)((()=>{w()}),[r,w]);const x=Object.keys(u).length>0,A=o&&(a||!x);return(0,y.FD)(y.FK,{children:[(0,y.FD)("div",{css:(0,p.AH)({display:"block",flexWrap:"wrap",gap:d.spacing.xs},""),children:[u.map((([s,a])=>{const d=l.find((e=>e.name===s));return d?(0,y.Y)(zo,{assessmentsType:e,assessmentName:s,assessmentHistory:a,rootCauseAssessment:t,onUpsertAssessment:n,allowEditing:o,options:i,inputs:r,assessmentInfo:d,assessmentInfos:l},s):(0,y.Y)("div",{css:Bo},s)})),A&&(0,y.Y)(v.B,{componentId:"overall"===e?"mlflow.evaluations_review.add_assessment_overall_button":"response"===e?"mlflow.evaluations_review.add_assessment_response_button":"mlflow.evaluations_review.add_assessment_retrieval_button",onClick:I,icon:(0,y.Y)(g.PlusIcon,{}),size:"small",children:(0,y.Y)(f.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),b&&(0,y.FD)(y.FK,{children:[(0,y.Y)(ye.S,{size:"sm"}),(0,y.Y)(Lo,{valueSuggestions:m,onCancel:w,onSave:({value:e,rationale:s,assessmentName:t})=>{var o;const a=c?S.OVERALL_ASSESSMENT:t||"",i=z({name:null!==(o=null!==t&&void 0!==t?t:null===h||void 0===h?void 0:h.name)&&void 0!==o?o:a,isOverallAssessment:c,value:e,rationale:s});n(i),w()}})]})]})};var jo={name:"49aokf",styles:"display:contents"};const Po=({assessmentsType:e,assessmentsByName:s,onUpsertAssessment:t,allowEditing:o=!1,allowMoreThanOne:a=!1,options:i,inputs:r,assessmentInfos:l})=>{const{theme:d}=(0,v.u)(),c=(0,f.tz)(),u="overall"===e,{suggestions:m,editingAssessment:h,showUpsertForm:b,addAssessment:I,editAssessment:w,closeForm:x}=Ho(s.flatMap((([e,s])=>s)),l);(0,ie.useEffect)((()=>{x()}),[r,x]);const A=s.filter((([e,s])=>s.length>0)),E=Object.keys(A).length>0,T=o&&(a||!E);return(0,y.FD)(y.FK,{children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexWrap:"wrap",gap:d.spacing.xs,alignItems:"center"},""),children:[A.map((([e,s])=>{const t=(0,n.first)(s),a=l.find((s=>s.name===e));if(!a)return(0,y.Y)(y.FK,{});const i=N[e],r=i?c.formatMessage(i):e,d=Boolean(t&&V(t)),u=Boolean(t&&B(t)),m=o&&(d||u)&&a.isEditable;return(0,y.Y)("div",{css:jo,children:(0,y.Y)(Vo,{assessmentHistory:s,children:(0,y.Y)(vn,{assessment:t,"aria-label":r,active:(null===h||void 0===h?void 0:h.name)===e&&b,disableJudgeTypeIcon:G(t),onEdit:m?()=>{const e=(0,n.first)(s);e&&w(e)}:void 0,assessmentInfo:a,type:"assessment-value"})})},e)})),T&&(0,y.Y)(v.B,{componentId:"overall"===e?"mlflow.evaluations_review.add_assessment_overall_button":"response"===e?"mlflow.evaluations_review.add_assessment_response_button":"mlflow.evaluations_review.add_assessment_retrieval_button",onClick:I,icon:(0,y.Y)(g.PlusIcon,{}),size:"small",children:(0,y.Y)(f.sA,{id:"vgfy8y",defaultMessage:"Add assessment"})})]}),b&&(0,y.FD)(y.FK,{children:[(0,y.Y)(ye.S,{size:"sm"}),(0,y.Y)(Lo,{editedAssessment:h,valueSuggestions:m,onCancel:x,onSave:({value:e,rationale:s,assessmentName:n})=>{var o;const a=u?S.OVERALL_ASSESSMENT:n||"",i=z({name:null!==(o=null!==n&&void 0!==n?n:null===h||void 0===h?void 0:h.name)&&void 0!==o?o:a,isOverallAssessment:u,value:e,rationale:s});t(i),x()}},null===h||void 0===h?void 0:h.name)]})]})},qo=({assessmentsType:e,assessmentsByName:s,rootCauseAssessment:t,onUpsertAssessment:n,allowEditing:o=!1,allowMoreThanOne:a=!1,alwaysExpanded:i=!1,options:r,inputs:l,assessmentInfos:d})=>{const[c,u]=(0,ie.useState)(!1),m=i||c,p=s.filter((([e,s])=>s.length>0));let h=s;"overall"!==e&&(h=s.filter((([e,s])=>e!==S.OVERALL_ASSESSMENT)));const b=Object.keys(p).length>0;return(0,y.FD)(y.FK,{children:[m&&(0,y.Y)($o,{assessmentsType:e,assessmentsByName:h,rootCauseAssessment:t,onUpsertAssessment:n,allowEditing:o,allowMoreThanOne:a,options:r,inputs:l,assessmentInfos:d}),!m&&(0,y.Y)(Po,{assessmentsType:e,assessmentsByName:h,onUpsertAssessment:n,allowEditing:o,allowMoreThanOne:a,options:r,inputs:l,assessmentInfos:d}),b&&!i&&(0,y.FD)(y.FK,{children:[(0,y.Y)(ye.S,{size:"sm"}),(0,y.Y)(v.B,{size:"small",type:"tertiary",componentId:"overall"===e?"mlflow.evaluations_review.see_assessment_details_overall_button":"response"===e?"mlflow.evaluations_review.see_assessment_details_response_button":"mlflow.evaluations_review.see_assessment_details_retrieval_button",icon:m?(0,y.Y)(g.ChevronUpIcon,{}):(0,y.Y)(v.o,{}),onClick:()=>u((e=>!e)),children:m?(0,y.Y)(f.sA,{id:"G7V4y3",defaultMessage:"Hide details"}):(0,y.Y)(f.sA,{id:"pfyUes",defaultMessage:"See details"})})]})]})},Ko=({toBeReviewed:e,containsOverallAssessment:s,isNextResultAvailable:t,overridingExistingReview:n,hasPendingAssessments:o,onClickNext:a,onSave:i,onCancelOverride:r})=>e?o?(0,y.Y)(v.B,{type:"primary",componentId:"mlflow.evaluations_review.save_pending_assessments_button",onClick:i,children:(0,y.Y)(f.sA,{id:"m1Nb7W",defaultMessage:"Save"})}):n?(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.cancel_override_assessments_button",onClick:r,children:(0,y.Y)(f.sA,{id:"e9qVjz",defaultMessage:"Cancel"})}):(0,y.Y)(v.B,{type:"primary",componentId:"mlflow.evaluations_review.mark_as_reviewed_button",onClick:i,disabled:!s,children:(0,y.Y)(f.sA,{id:"Ls2ris",defaultMessage:"Mark as reviewed"})}):(0,y.Y)(v.B,{type:"primary",componentId:"mlflow.evaluations_review.next_evaluation_result_button",onClick:a,endIcon:(0,y.Y)(v.o,{}),disabled:!t,children:(0,y.Y)(f.sA,{id:"CBnbqy",defaultMessage:"Next"})}),Go=()=>{const{theme:e}=(0,v.u)();return(0,y.Y)("div",{css:(0,p.AH)({width:"1.5px",backgroundColor:e.colors.border},"")})};var Wo={name:"1d3w5wq",styles:"width:100%"},Qo={name:"82a6rk",styles:"flex:1"};const Jo=({evaluationResult:e,onUpsertAssessment:s,onSavePendingAssessments:t,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:i,overridingExistingReview:r=!1,pendingAssessments:l=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{var m;const{theme:h}=(0,v.u)(),b=(0,f.tz)();if(!e)return null;const I=(0,n.first)(e.overallAssessments),w=null===I||void 0===I||null===(m=I.rootCauseAssessment)||void 0===m?void 0:m.assessmentName,x=w?(0,n.first)(null===e||void 0===e?void 0:e.responseAssessmentsByName[w]):void 0,A=!c&&(!j(e)||r),E=b.formatMessage({id:"d44IPd",defaultMessage:"Reopen review"}),T=[[S.OVERALL_ASSESSMENT,e.overallAssessments]],C=u.find((e=>e.name===S.OVERALL_ASSESSMENT));return(0,y.FD)("div",{css:Wo,children:[(0,y.FD)("div",{css:(0,p.AH)({width:"100%",paddingLeft:h.spacing.md,paddingRight:h.spacing.md},""),children:[(0,y.FD)("div",{css:(0,p.AH)({backgroundColor:h.colors.backgroundSecondary,padding:h.spacing.md,paddingBottom:0,display:"flex",flexDirection:"column",gap:h.spacing.sm},""),children:[C&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:h.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.SparkleDoubleIcon,{color:"ai"}),(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"ML+mQa",defaultMessage:"Overall assessment:"})}),(0,y.Y)(vn,{assessment:I,"aria-label":S.OVERALL_ASSESSMENT,disableJudgeTypeIcon:G(I),assessmentInfo:C,type:"assessment-value"})]}),(0,y.Y)(qo,{assessmentsType:"overall",assessmentsByName:T,rootCauseAssessment:x,onUpsertAssessment:s,allowEditing:A,alwaysExpanded:!0,options:[S.OVERALL_ASSESSMENT],assessmentInfos:u}),(0,y.FD)("div",{css:(0,p.AH)({border:`1px solid ${h.colors.border}`,borderRadius:h.general.borderRadiusBase,padding:h.spacing.sm},""),children:[(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"5jXYY4",defaultMessage:"Detailed assessments"})}),(0,y.Y)(ye.S,{size:"sm"}),(0,y.Y)(qo,{assessmentsType:"response",assessmentsByName:$(e.responseAssessmentsByName),onUpsertAssessment:s,allowEditing:A,allowMoreThanOne:!0,options:H,assessmentInfos:u})]})]}),(0,y.FD)("div",{css:(0,p.AH)({position:"sticky",backgroundColor:h.colors.backgroundSecondary,padding:h.spacing.md,top:0,display:"flex",justifyContent:"space-between",gap:h.spacing.sm,zIndex:h.options.zIndexBase},""),children:[(0,y.Y)("div",{children:!A&&!c&&(0,y.FD)("div",{css:(0,p.AH)({border:`1px solid ${h.colors.border}`,borderRadius:h.general.borderRadiusBase,display:"flex",alignItems:"center",gap:h.spacing.sm,padding:`${h.spacing.xs}px ${h.spacing.sm}px`},""),children:[(0,y.Y)(g.CheckCircleIcon,{css:(0,p.AH)({color:h.colors.textValidationSuccess},"")}),(0,y.Y)(v.T.Hint,{children:(0,y.Y)(f.sA,{id:"zLTdCZ",defaultMessage:"Reviewed"})}),(0,y.Y)(ye.T,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewassessmentssection.tsx_149",content:E,children:(0,y.Y)(v.B,{"aria-label":E,componentId:"mlflow.evaluations_review.reopen_review_button",size:"small",icon:(0,y.Y)(g.PencilIcon,{}),onClick:()=>d(!0)})})]})}),(0,y.Y)("div",{css:Qo}),l.length>0&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:h.spacing.sm},""),children:[(0,y.Y)(f.sA,{id:"MB3kda",defaultMessage:"{pendingCount} pending {pendingCount, plural, =1 {change} other {changes}}",values:{pendingCount:l.length}}),(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.discard_pending_assessments_button",onClick:a,children:(0,y.Y)(f.sA,{id:"eIWfRN",defaultMessage:"Discard"})})]}),(0,y.Y)(Ko,{onSave:async()=>{await t(),d(!1)},containsOverallAssessment:Boolean(I),isNextResultAvailable:Boolean(i),onClickNext:o,toBeReviewed:A,hasPendingAssessments:l.length>0,overridingExistingReview:r,onCancelOverride:()=>d(!1)})]})]}),(0,y.Y)(ye.S,{size:"md"})]})},Xo=({evaluationResult:e,otherEvaluationResult:s,onUpsertAssessment:t,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:i,overridingExistingReview:r=!1,pendingAssessments:l=[],setOverridingExistingReview:d,isReadOnly:c=!1,assessmentInfos:u})=>{const{theme:m}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",gap:m.spacing.sm},""),children:[e&&(0,y.Y)(Jo,{evaluationResult:e,onUpsertAssessment:t,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:i,overridingExistingReview:r,setOverridingExistingReview:d,pendingAssessments:l,isReadOnly:c,assessmentInfos:u}),s&&(0,y.FD)(y.FK,{children:[(0,y.Y)(Go,{}),(0,y.Y)(Jo,{evaluationResult:s,onUpsertAssessment:t,onSavePendingAssessments:n,onClickNext:o,onResetPendingAssessments:a,isNextAvailable:i,overridingExistingReview:r,setOverridingExistingReview:d,pendingAssessments:l,isReadOnly:!0,assessmentInfos:u})]})]})},Zo=({requestId:e,onClose:s,trace:t})=>{const{theme:o}=(0,v.u)(),a=(0,y.Y)(v.T.Title,{level:2,withoutMargins:!0,children:e});return(0,y.Y)(g.Drawer.Root,{modal:!0,open:!0,onOpenChange:e=>{e||s()},children:(0,y.Y)(g.Drawer.Content,{componentId:"mlflow.evaluations_review.trace_data_drawer",width:"85vw",title:a,expandContentToFullHeight:!0,children:(()=>{const e=t.data.spans.length>0;return(0,n.isNil)(t)||!e?(0,y.FD)(y.FK,{children:[(0,y.Y)(ye.S,{size:"lg"}),(0,y.Y)(g.Empty,{description:null,title:(0,y.Y)(f.sA,{id:"EpFST9",defaultMessage:"No trace data recorded"})})]}):(0,y.Y)("div",{css:(0,p.AH)({height:"100%",marginLeft:-o.spacing.lg,marginRight:-o.spacing.lg,marginBottom:-o.spacing.lg},""),onWheel:e=>e.stopPropagation(),children:(0,y.Y)(xe.a8,{modelTrace:t})})})()})})};var ea={name:"1d3w5wq",styles:"width:100%"};const sa=({experimentId:e,runDisplayName:s,evaluationResult:t,exportToEvalsInstanceEnabled:o=!1,traceQueryResult:a,getTrace:i})=>{var r,l;const d=(0,f.tz)(),{theme:c}=(0,v.u)(),[u,m]=(0,ie.useState)(null),g=null===(r=t.traceInfo)||void 0===r||null===(l=r.trace_metadata)||void 0===l?void 0:l["databricks.tracingserver.dropped_spans_size_bytes"];let h;if(!(0,n.isNil)(g)){const e=2,s=tn(Number(g),e);h=`${s.value} ${s.unit}`}return(0,y.FD)("div",{css:ea,children:[(0,y.FD)("div",{css:(0,p.AH)({width:"100%",paddingLeft:c.spacing.md,paddingRight:c.spacing.md,display:"flex",alignItems:"center",justifyContent:"space-between",gap:c.spacing.sm},""),children:[(0,y.Y)(v.T.Title,{level:4,children:s}),t.requestId&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:c.spacing.sm},""),children:[o&&i&&(0,y.Y)(Ss,{experimentId:e,selectedTraces:[t],traceInfos:void 0}),(0,y.Y)(ye.T,{delayDuration:0,componentId:"mlflow.evaluations_review.see_detailed_trace_view_tooltip",content:g?`The trace spans were not stored due to their large size: ${h}`:void 0,side:"left",children:(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.see_detailed_trace_view_button",onClick:()=>m(t.requestId),loading:a.isLoading,disabled:!(0,n.isNil)(g),children:(0,y.Y)(f.sA,{id:"HUC492",defaultMessage:"See detailed trace view"})})})]}),u&&((0,n.isNil)(a.data)?(0,y.Y)(y.FK,{children:d.formatMessage({id:"EZfSbs",defaultMessage:"No trace data available"})}):(0,y.Y)(Zo,{onClose:()=>{m(null)},requestId:u,trace:a.data}))]}),(0,y.Y)(ye.S,{size:"md"})]})},ta=({experimentId:e,runDisplayName:s,otherRunDisplayName:t,evaluationResult:n,otherEvaluationResult:o,exportToEvalsInstanceEnabled:a=!1,traceQueryResult:i,compareToTraceQueryResult:r})=>{const{theme:l}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",gap:l.spacing.sm},""),children:[(0,y.Y)(sa,{experimentId:e,runDisplayName:s,evaluationResult:n,exportToEvalsInstanceEnabled:a,traceQueryResult:i}),t&&o&&(0,y.FD)(y.FK,{children:[(0,y.Y)(Go,{}),(0,y.Y)(sa,{experimentId:e,runDisplayName:t,evaluationResult:o,exportToEvalsInstanceEnabled:a,traceQueryResult:r})]})]})},na=({value:e})=>{const s=(0,ie.useMemo)((()=>{if("object"===typeof e&&null!==e)return JSON.stringify(e,null,2);if("string"===typeof e)try{const s=JSON.parse(e);return JSON.stringify(s,null,2)}catch(s){return null}return null}),[e]);return(0,y.Y)("div",{css:(0,p.AH)({whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:s?"monospace":void 0},""),children:s||String(e)})};var oa={name:"1066lcq",styles:"display:flex;justify-content:space-between;align-items:center"},aa={name:"1nko30q",styles:"margin-bottom:0 !important"},ia={name:"49aokf",styles:"display:contents"};const ra=({fieldName:e,title:s,value:t,showCopyIcon:o})=>{const{theme:a}=(0,v.u)(),{makeHTML:i}=rn(),r=(0,ie.useMemo)((()=>(0,n.isString)(t)?i(t):null),[t,i]),l=(0,ie.useMemo)((()=>(0,n.isString)(t)?null:K(t)),[t]);return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm,flex:1,border:`1px solid ${a.colors.border}`,padding:a.spacing.md,borderRadius:a.general.borderRadiusBase,marginBottom:a.spacing.md},""),children:[(0,y.FD)("div",{css:oa,children:[(0,y.Y)(v.T.Text,{bold:!0,children:s}),o&&(0,y.Y)(gt.ad,{copyText:K(t),componentId:"mlflow.evaluations_review.textbox.copy"})]}),(0,y.Y)(v.T.Paragraph,{css:aa,children:(0,n.isString)(t)?(0,y.Y)("span",{css:ia,dangerouslySetInnerHTML:{__html:null!==r&&void 0!==r?r:""}}):e===T&&Array.isArray(t)?(0,y.Y)("ul",{children:t.map(((e,s)=>(0,y.Y)("li",{children:(0,y.Y)(na,{value:e},s)},s)))}):(0,y.Y)(na,{value:l})})]})},la=({evaluationResult:e})=>{const{theme:s}=(0,v.u)(),{inputs:t}=e,n=Object.entries(t),o=0===n.length;return(0,y.FD)("div",{css:(0,p.AH)({width:"100%",paddingLeft:s.spacing.md,paddingRight:s.spacing.md},""),children:[(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"MQ4Voz",defaultMessage:"{count, plural, one {Input} other {Inputs}}",values:{count:n.length}})}),(0,y.Y)(ye.S,{size:"sm"}),o&&(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)(f.sA,{id:"gPhm1b",defaultMessage:"No inputs logged"})}),n.map((([e,s])=>(0,y.Y)(ra,{fieldName:e,title:e,value:s},e)))]})},da=({evaluationResult:e,otherEvaluationResult:s})=>{const{theme:t}=(0,v.u)(),n=(null===e||void 0===e?void 0:e.inputsId)===(null===s||void 0===s?void 0:s.inputsId);return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",gap:t.spacing.sm},""),children:[e&&(0,y.Y)(la,{evaluationResult:e}),!n&&s&&(0,y.Y)(la,{evaluationResult:s})]})};var ca={name:"82a6rk",styles:"flex:1"},ua={name:"82a6rk",styles:"flex:1"};const ma=({evaluationResult:e})=>{const{theme:s}=(0,v.u)(),{outputs:t,targets:n}=e,o=Object.entries(t).filter((([,e])=>!W(e))),a=Object.entries(n).filter((([,e])=>!W(e))),i=0===o.length&&0===a.length;return(0,y.FD)("div",{css:(0,p.AH)({paddingLeft:s.spacing.md,paddingRight:s.spacing.md,width:"100%"},""),children:[(0,y.Y)(v.T.Text,{bold:!0,children:(0,y.Y)(f.sA,{id:"x6rkyu",defaultMessage:"Response"})}),(0,y.Y)(ye.S,{size:"sm"}),i&&(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)(f.sA,{id:"YvxyMH",defaultMessage:"No responses or targets logged"})}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:s.spacing.md,alignItems:"flex-start"},""),children:[o.length>0&&(0,y.Y)("div",{css:ca,children:o.map((([e,s])=>{const t=E[e],n=t?(0,y.Y)(f.sA,{...t}):e;return(0,y.Y)(ra,{fieldName:e,title:n,value:s,showCopyIcon:!0},e)}))}),a.length>0&&(0,y.Y)("div",{css:ua,children:a.map((([e,s])=>{const t=C[e],n=t?(0,y.Y)(f.sA,{...t}):e;return(0,y.Y)(ra,{fieldName:e,title:n,value:s,showCopyIcon:!0},e)}))})]})]})},pa=({evaluationResult:e,otherEvaluationResult:s})=>{const{theme:t}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",gap:t.spacing.sm},""),children:[e&&(0,y.Y)(ma,{evaluationResult:e}),s&&(0,y.FD)(y.FK,{children:[(0,y.Y)(Go,{}),(0,y.Y)(ma,{evaluationResult:s})]})]})},ga=({assessment:e,chunkRelevanceAssessmentInfo:s})=>{const{theme:t}=(0,v.u)();return e||s?(0,y.Y)("div",{css:(0,p.AH)({paddingLeft:t.spacing.sm,paddingRight:t.spacing.sm,paddingTop:1,paddingBottom:1,backgroundColor:s?oe(t,s,e):"",borderRadius:t.general.borderRadiusBase,svg:{width:12,height:12}},""),children:e?(0,y.Y)(y.FK,{children:P(e)?(0,y.Y)(g.UserIcon,{}):(0,y.Y)(g.SparkleDoubleIcon,{})}):(0,y.Y)(g.QuestionMarkIcon,{})}):(0,y.Y)(y.FK,{})};function va(e){try{const s=new URL(e);return"http:"===s.protocol||"https:"===s.protocol}catch(s){return!1}}var fa={name:"s5xdrg",styles:"display:flex;align-items:center"};const ha=({chunk:e,index:s})=>(0,y.FD)("div",{css:fa,children:[(0,y.FD)(g.Tag,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_30",children:["#",s+1]}),va(e.docUrl)?(0,y.Y)(v.T.Link,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_evaluations_components_evaluationsreviewretrievalsection.tsx_32",href:e.docUrl,ellipsis:!0,openInNewTab:!0,strong:!0,children:e.docUrl}):(0,y.Y)(v.T.Title,{level:4,withoutMargins:!0,ellipsis:!0,children:e.docUrl})]});var ya={name:"1vgo6ev",styles:"flex:2;display:flex;flex-direction:column;width:0"},ba={name:"49aokf",styles:"display:contents"};const Sa=({evaluationResult:e,onUpsertAssessment:s,overridingExistingReview:t=!1,isReadOnly:o=!1,assessmentInfos:a,traceQueryResult:i})=>{const{theme:r}=(0,v.u)(),l=(0,f.tz)(),[d,c]=(0,ie.useState)(0),{makeHTML:u}=rn(),m=(0,ie.useMemo)((()=>!(0,n.isNil)(e.retrievalChunks)&&e.retrievalChunks.length>0?e.retrievalChunks:function(e,s){var t,o;if((0,n.isNil)(s))return;let a="doc_uri";const i=s.info.tags;if(null!==i&&void 0!==i&&i.retrievers){const e=ds(i.retrievers);"object"===typeof e&&e.length>0&&(a=e[0].doc_uri)}const r=s.data.spans.filter((e=>{var s,t;return(null===(s=e.attributes)||void 0===s?void 0:s["mlflow.spanType"])&&ds(null===(t=e.attributes)||void 0===t?void 0:t["mlflow.spanType"])===xe.VZ.RETRIEVER}));if(0===r.length)return[];const l=null===(t=r.at(-1))||void 0===t||null===(o=t.attributes)||void 0===o?void 0:o["mlflow.spanOutputs"];if(!l)return[];const d=ds(l);return Array.isArray(d)?d.map(((s,t)=>{var n;return{docUrl:null===(n=s.metadata)||void 0===n?void 0:n[a],content:s.page_content,retrievalAssessmentsByName:fs(e,t)}})):[]}(e.responseAssessmentsByName,i.data)),[e.responseAssessmentsByName,e.retrievalChunks,i.data]),h=(0,ie.useMemo)((()=>{var e;return u(null===m||void 0===m||null===(e=m[d])||void 0===e?void 0:e.content)}),[m,d,u]),b=0===(m||[]).length,I=!o&&(!j(e)||t),w=null===m||void 0===m?void 0:m[d],x=l.formatMessage({id:"iPTAj8",defaultMessage:"Retrieval"});return(0,y.FD)("div",{css:(0,p.AH)({paddingLeft:r.spacing.md,paddingRight:r.spacing.md,width:"100%",display:"flex",flexDirection:"column"},""),role:"region","aria-label":x,children:[(0,y.Y)(v.T.Text,{bold:!0,children:x}),(0,n.isNil)(m)&&i.isFetching?(0,y.Y)(g.TableSkeleton,{lines:3}):b?(0,y.Y)(v.T.Text,{children:(0,y.Y)("i",{children:(0,y.Y)(f.sA,{id:"d00egE",defaultMessage:"No span with type RETRIEVER found in trace."})})}):(0,y.FD)("div",{css:(0,p.AH)({minHeight:400,maxHeight:600,overflow:"hidden",display:"flex",marginTop:r.spacing.sm,border:`1px solid ${r.colors.border}`,borderRadius:r.general.borderRadiusBase},""),children:[(0,y.FD)("div",{css:(0,p.AH)({flex:1,flexShrink:1,maxWidth:300,minWidth:200,overflow:"auto",padding:r.spacing.sm,borderRight:`1px solid ${r.colors.border}`},""),role:"listbox",children:[b&&(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)(f.sA,{id:"0Bee6A",defaultMessage:"No retrieval logged"})}),(m||[]).map(((e,s)=>{var t,o;const i=a.find((e=>e.name===S.CHUNK_RELEVANCE));return(0,y.FD)("div",{role:"option","aria-label":null===(t=e.content)||void 0===t?void 0:t.slice(0,255),"aria-selected":s===d,css:(0,p.AH)({backgroundColor:s===d?r.colors.actionIconBackgroundHover:"transparent","&:hover":{backgroundColor:r.colors.actionIconBackgroundHover},padding:`${r.spacing.sm}px ${r.spacing.md}px`,overflow:"hidden",display:"flex",gap:r.spacing.sm,alignItems:"center",cursor:"pointer",width:"100%"},""),onClick:()=>{c(s)},children:[(0,y.Y)(ga,{chunkRelevanceAssessmentInfo:i,assessment:(0,n.first)(null===e||void 0===e||null===(o=e.retrievalAssessmentsByName)||void 0===o?void 0:o[S.CHUNK_RELEVANCE])}),(0,y.Y)(v.T.Text,{ellipsis:!0,css:(0,p.AH)({flex:1,lineHeight:r.typography.lineHeightLg},""),children:e.content})]},[e.docUrl,s].join("-"))}))]}),w&&(0,y.FD)("div",{css:ya,children:[(0,y.FD)("div",{css:(0,p.AH)({padding:r.spacing.md,borderBottom:`1px solid ${r.colors.border}`},""),children:[(0,y.Y)(ha,{chunk:w,index:d}),(0,y.Y)(ye.S,{size:"md"}),(0,y.Y)(qo,{assessmentsType:"retrieval",assessmentsByName:$(w.retrievalAssessmentsByName||{}),onUpsertAssessment:e=>{e.metadata||(e.metadata={}),e.metadata[A.CHUNK_INDEX]=d,s(e)},allowEditing:I,allowMoreThanOne:!0,options:U,inputs:[d],assessmentInfos:a})]}),(0,y.Y)("div",{css:(0,p.AH)({padding:r.spacing.md,overflow:"auto"},""),children:(0,y.Y)(v.T.Paragraph,{children:(0,y.Y)("span",{css:ba,dangerouslySetInnerHTML:{__html:null!==h&&void 0!==h?h:""}})})})]})]})]})},Ia=({evaluationResult:e,otherEvaluationResult:s,onUpsertAssessment:t,overridingExistingReview:n=!1,isReadOnly:o=!1,assessmentInfos:a,traceQueryResult:i,compareToTraceQueryResult:r})=>{const{theme:l}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",gap:l.spacing.sm},""),children:[e&&(0,y.Y)(Sa,{evaluationResult:e,onUpsertAssessment:t,overridingExistingReview:n,isReadOnly:o,assessmentInfos:a,traceQueryResult:i}),s&&(0,y.FD)(y.FK,{children:[(0,y.Y)(Go,{}),(0,y.Y)(Sa,{evaluationResult:s,onUpsertAssessment:t,overridingExistingReview:n,isReadOnly:o,assessmentInfos:a,traceQueryResult:r})]})]})};var wa={name:"1cwfdr7",styles:"flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const xa=({evaluationResult:e})=>{const{theme:s}=(0,v.u)();return(0,y.Y)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:s.spacing.sm,overflow:"hidden"},""),children:(0,y.Y)(v.T.Title,{level:2,withoutMargins:!0,css:wa,children:k(e)})})},Aa=({experimentId:e,evaluationResult:s,otherEvaluationResult:t,onSavePendingAssessments:o,onClickNext:a,runDisplayName:i,compareToRunDisplayName:r,isNextAvailable:l=!1,isReadOnly:d=!1,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:m,compareToTraceQueryResult:p})=>{(0,f.tz)();const{pendingAssessments:h,draftEvaluationResult:b,upsertAssessment:S,resetPendingAssessments:I}=(e=>{const[s,t]=(0,ie.useReducer)(((e,s)=>{switch(s.type){case"resetPendingAssessments":return[];case"upsertAssessment":const t=e.find((e=>e.name===s.payload.name&&q(e)===q(s.payload)));return t?e.map((e=>e===t?""===V(e)&&s.payload.stringValue?{...s.payload,stringValue:"",name:s.payload.stringValue}:s.payload:e)):[s.payload,...e]}}),[]),o=(0,ie.useMemo)((()=>{if(!e)return[];const t=s.find(F);return t?[t,...e.overallAssessments]:e.overallAssessments}),[e,s]),a=(0,ie.useMemo)((()=>{if(!e)return{};const t=(0,n.uniq)([...Object.keys(e.responseAssessmentsByName),...s.filter((e=>!F(e)&&!O(e))).map((e=>e.name))]);return Object.fromEntries(t.map((t=>{const n=s.filter((e=>e.name===t));return[t,[...n,...e.responseAssessmentsByName[t]||[]]]})))}),[e,s]),i=(0,ie.useMemo)((()=>{var t;const o=s.filter(O);return null===(t=e.retrievalChunks)||void 0===t?void 0:t.map(((e,s)=>{var t;const a=o.filter((e=>{var t;return(null===(t=e.metadata)||void 0===t?void 0:t[A.CHUNK_INDEX])===s})),i=(0,n.flatMap)(null!==(t=e.retrievalAssessmentsByName)&&void 0!==t?t:{}),r=(0,n.groupBy)([...a,...i],"name");return Object.keys(r).forEach((e=>{r[e]=(0,n.orderBy)(r[e],"timestamp","desc")})),{...e,retrievalAssessmentsByName:r}}))}),[s,e]),r=(0,ie.useMemo)((()=>({...e,overallAssessments:o,responseAssessmentsByName:a,retrievalChunks:i})),[e,o,a,i]),l=(0,ie.useCallback)((e=>t({type:"upsertAssessment",payload:e})),[]),d=(0,ie.useCallback)((()=>t({type:"resetPendingAssessments"})),[]);return{pendingAssessments:s,draftEvaluationResult:r,upsertAssessment:l,resetPendingAssessments:d}})(s),[w,x]=(h.length,(0,ie.useState)(!1)),E=Boolean(s.errorCode),T=Boolean(s.errorMessage),C=E||T,[N,_]=(0,ie.useState)(!1);return(0,y.FD)(y.FK,{children:[C?(0,y.FD)(y.FK,{children:[(0,y.Y)(g.Alert,{action:T&&(0,y.Y)(v.B,{componentId:`mlflow.evaluations_review.evaluation_error_alert.show_${N?"less":"more"}_button`,onClick:()=>_((e=>!e)),children:N?(0,y.Y)(f.sA,{id:"qVQYZH",defaultMessage:"Show less"}):(0,y.Y)(f.sA,{id:"U4s/77",defaultMessage:"Show more"})}),closable:!1,componentId:"mlflow.evaluations_review.evaluation_error_alert",message:E?`${s.errorCode}`:"UNKNOWN_ERROR",description:N&&`${s.errorMessage}`,type:"error"}),(0,y.Y)(ye.S,{size:"md"})]}):null,(0,y.Y)(ta,{experimentId:e,runDisplayName:i,otherRunDisplayName:r,evaluationResult:s,otherEvaluationResult:t,exportToEvalsInstanceEnabled:c,traceQueryResult:m,compareToTraceQueryResult:p}),(0,y.Y)(Xo,{evaluationResult:b,otherEvaluationResult:t,onUpsertAssessment:S,onClickNext:a,onSavePendingAssessments:async()=>{await(null===o||void 0===o?void 0:o(s,h)),I()},isNextAvailable:l,overridingExistingReview:w,setOverridingExistingReview:x,pendingAssessments:h,onResetPendingAssessments:I,isReadOnly:d,assessmentInfos:u}),(0,y.Y)(da,{evaluationResult:s,otherEvaluationResult:t}),(0,y.Y)(pa,{evaluationResult:s,otherEvaluationResult:t}),(0,y.Y)(Ia,{evaluationResult:b,otherEvaluationResult:t,onUpsertAssessment:S,overridingExistingReview:w,isReadOnly:d,assessmentInfos:u,traceQueryResult:m,compareToTraceQueryResult:p}),(0,y.Y)(ye.S,{size:"lg"})]})};var Ea={name:"ujpwkd",styles:"display:flex;position:relative;overflow:scroll"},Ta={name:"1tc6xju",styles:"flex:1;overflow:auto"};const Ca=({experimentId:e,evaluation:s,otherEvaluation:t,className:n,runUuid:o,isReadOnly:a=!1,selectNextEval:i,isNextAvailable:r,runDisplayName:l,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c=!1,assessmentInfos:u,traceQueryResult:m,compareToTraceQueryResult:g,saveAssessmentsQuery:f})=>{const{theme:b}=(0,v.u)(),S=(0,ie.useCallback)((async(e,s)=>{if(!e||a||!o||!f)return;const t=s.slice();var n,i;if(i=s,(n=e).overallAssessments.length>0&&n.overallAssessments.every(M)&&!i.some(F)){const s=(e=>{var s;const t=e.overallAssessments.find(M);if(!t)return null;const n=null!==(s=(0,h.w)())&&void 0!==s?s:"";return{...t,timestamp:Date.now(),isDraft:!0,source:{sourceType:"HUMAN",sourceId:n,metadata:{}},metadata:{...t.metadata,[A.IS_COPIED_FROM_AI]:!0}}})(e);s&&t.unshift(s)}return f.savePendingAssessments(o,e.evaluationId,t)}),[o,a,f]),I=(0,ie.useRef)(null);return(0,ie.useEffect)((()=>{var e;null===(e=I.current)||void 0===e||e.scrollTo(0,0)}),[s.evaluationId]),(0,y.FD)("div",{css:Ea,className:n,children:[(0,y.Y)("div",{css:Ta,ref:I,children:(0,y.Y)(Aa,{experimentId:e,evaluationResult:s,otherEvaluationResult:t,onSavePendingAssessments:S,onClickNext:i,isNextAvailable:r,isReadOnly:a||!o,runDisplayName:l,compareToRunDisplayName:d,exportToEvalsInstanceEnabled:c,assessmentInfos:u,traceQueryResult:m,compareToTraceQueryResult:g},s.evaluationId)}),(null===f||void 0===f?void 0:f.isSaving)&&(0,y.Y)("div",{css:(0,p.AH)({inset:0,position:"absolute",backgroundColor:b.colors.overlayOverlay,display:"flex",justifyContent:"center",alignItems:"center",zIndex:b.options.zIndexBase+1},""),children:(0,y.Y)(v.S,{size:"large",inheritColor:!0,css:(0,p.AH)({color:b.colors.backgroundPrimary},"")})})]})},Na=()=>{var e;return{enableRunEvaluationWriteFeatures:null!==(e=!1)&&e}},_a=(0,ie.createContext)(Na()),Ya=({config:e={},children:s})=>{const t=Na(),o=(0,n.merge)({},t,e);return(0,y.Y)(_a.Provider,{value:o,children:s})};function Ra(e,s){const t=(0,ie.useMemo)((()=>{var e;if(s)return(0,xe.gD)(s)?s.trace_id:null!==(e=s.request_id)&&void 0!==e?e:""}),[s]),o=(0,ie.useCallback)((s=>!e||(0,n.isNil)(t)?Promise.resolve(void 0):e(t,s)),[e,t]);return(0,Os.I)({queryKey:["getTrace",t],queryFn:()=>o(s),enabled:!(0,n.isNil)(e)&&!(0,n.isNil)(t),staleTime:1/0,refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0})}var Ma={name:"inxa61",styles:"flex:1;overflow:hidden"};const ka=ie.memo((({experimentId:e,runUuid:s,evaluations:t,selectedEvaluationId:o,onChangeEvaluationId:a,runDisplayName:i,otherRunDisplayName:r,exportToEvalsInstanceEnabled:l=!1,assessmentInfos:d,getTrace:c,saveAssessmentsQuery:u})=>{var m,f,h,b,S;const{theme:I,classNamePrefix:w}=(0,v.u)(),x=(0,ie.useCallback)((()=>{a(void 0)}),[a]),A=(0,ie.useCallback)((e=>{var s,t;return(null===(s=e.currentRunValue)||void 0===s?void 0:s.evaluationId)===o||(null===(t=e.otherRunValue)||void 0===t?void 0:t.evaluationId)===o}),[o]),E=(0,ie.useMemo)((()=>t?(null===t||void 0===t?void 0:t.findIndex(A))-1:void 0),[t,A]),T=(0,ie.useMemo)((()=>void 0!==E&&E>=0),[E]),C=(0,ie.useMemo)((()=>t?(null===t||void 0===t?void 0:t.findIndex(A))+1:void 0),[t,A]),N=(0,ie.useMemo)((()=>void 0!==C&&C<t.length),[C,t]),_=(0,ie.useCallback)((()=>{var e,s,n,o;if(null===t||void 0===E)return;const i=(null===(e=t[E])||void 0===e||null===(s=e.currentRunValue)||void 0===s?void 0:s.evaluationId)||(null===(n=t[E])||void 0===n||null===(o=n.otherRunValue)||void 0===o?void 0:o.evaluationId);a(i)}),[t,E,a]),Y=(0,ie.useCallback)((()=>{var e,s,n,o;if(null===t||void 0===C)return;const i=(null===(e=t[C])||void 0===e||null===(s=e.currentRunValue)||void 0===s?void 0:s.evaluationId)||(null===(n=t[C])||void 0===n||null===(o=n.otherRunValue)||void 0===o?void 0:o.evaluationId);a(i)}),[t,C,a]),R=(0,ie.useMemo)((()=>null===t||void 0===t?void 0:t.find(A)),[t,A]),M=(0,ie.useMemo)((()=>C&&t?null===t||void 0===t?void 0:t[C]:void 0),[t,C]),k=(0,ie.useMemo)((()=>E&&t?null===t||void 0===t?void 0:t[E]:void 0),[t,E]),D=(0,ie.useContext)(_a)||Na(),F=Ra(c,null===R||void 0===R||null===(m=R.currentRunValue)||void 0===m?void 0:m.traceInfo),O=Ra(c,null===R||void 0===R||null===(f=R.otherRunValue)||void 0===f?void 0:f.traceInfo);Ra(c,null===M||void 0===M||null===(h=M.currentRunValue)||void 0===h?void 0:h.traceInfo),Ra(c,null===k||void 0===k||null===(b=k.currentRunValue)||void 0===b?void 0:b.traceInfo);const V=Boolean(null===R||void 0===R?void 0:R.currentRunValue)!==Boolean(null===R||void 0===R?void 0:R.otherRunValue),L=o===(null===R||void 0===R||null===(S=R.currentRunValue)||void 0===S?void 0:S.evaluationId)?F:O;return(0,n.isNil)(R)?(0,y.Y)(y.FK,{}):(0,y.FD)("div",{onKeyDown:e=>{"ArrowLeft"===e.key?_():"ArrowRight"===e.key&&Y()},children:[(0,y.FD)(ye.d,{componentId:"mlflow.evaluations_review.modal",visible:!0,title:R.currentRunValue?(0,y.Y)(xa,{evaluationResult:R.currentRunValue}):R.otherRunValue?(0,y.Y)(xa,{evaluationResult:R.otherRunValue}):null,onCancel:x,size:"wide",verticalSizing:"maxed_out",css:(0,p.AH)({width:"100% !important",padding:"0 4rem !important",[`& .${w}-modal-body`]:{flex:1,paddingTop:0},[`& .${w}-modal-header`]:{paddingBottom:I.spacing.sm}},""),footer:null,children:[L.isFetching&&(0,y.Y)(g.GenericSkeleton,{label:"Loading trace...",style:{width:"calc(100% - 45px)",height:"calc(100% - 100px)",position:"absolute",paddingRight:500,zIndex:2100,backgroundColor:I.colors.backgroundPrimary}}),V&&!(0,n.isNil)(L.data)?(0,y.Y)("div",{css:(0,p.AH)({height:"100%",marginLeft:-I.spacing.lg,marginRight:-I.spacing.lg},""),children:(0,y.Y)(Da,{traceData:L.data})}):R.currentRunValue&&(0,y.Y)(Ca,{experimentId:e,evaluation:R.currentRunValue,otherEvaluation:R.otherRunValue,selectNextEval:Y,isNextAvailable:N,css:Ma,runUuid:s,isReadOnly:!D.enableRunEvaluationWriteFeatures,runDisplayName:i,compareToRunDisplayName:r,exportToEvalsInstanceEnabled:l,assessmentInfos:d,traceQueryResult:F,compareToTraceQueryResult:O,saveAssessmentsQuery:u})]}),(0,y.Y)("div",{css:(0,p.AH)({display:"flex",justifyContent:"flex-end",position:"fixed",top:"50%",left:0,zIndex:2e3,opacity:".75",width:"5rem","&:hover":{opacity:"1.0"}},""),children:(0,y.Y)("div",{css:(0,p.AH)({backgroundColor:I.colors.backgroundPrimary,borderRadius:I.legacyBorders.borderRadiusMd,marginRight:I.spacing.sm},""),children:(0,y.Y)(v.B,{disabled:!T,componentId:"mlflow.evaluations_review.modal.previous_eval",icon:(0,y.Y)(v.n,{}),onClick:()=>_()})})}),(0,y.Y)("div",{css:(0,p.AH)({display:"flex",justifyContent:"flex-start",position:"fixed",top:"50%",right:0,zIndex:2e3,width:"5rem",opacity:".75","&:hover":{opacity:"1.0"}},""),children:(0,y.Y)("div",{css:(0,p.AH)({backgroundColor:I.colors.backgroundPrimary,borderRadius:I.legacyBorders.borderRadiusMd,marginLeft:I.spacing.sm},""),children:(0,y.Y)(v.B,{disabled:!N,componentId:"mlflow.evaluations_review.modal.next_eval",icon:(0,y.Y)(v.o,{}),onClick:()=>Y()})})})]})})),Da=({traceData:e})=>(0,y.Y)(xe.a8,{modelTrace:e}),Fa=ie.memo((({experimentId:e,selectedColumns:s,evaluations:t,selectedEvaluationId:o,selectedAssessmentInfos:a,assessmentInfos:i,assessmentFilters:r,tableSort:l,onChangeEvaluationId:d,getRunColor:c,runUuid:u,runDisplayName:m,compareToRunUuid:h,compareToRunDisplayName:b,rowSelection:S,setRowSelection:I,exportToEvalsInstanceEnabled:w=!1,getTrace:x,toggleAssessmentFilter:A,saveAssessmentsQuery:E,disableAssessmentTooltips:T,onTraceTagsEdit:C,enableRowSelection:N,enableGrouping:_=!1,allColumns:Y,displayLoadingOverlay:R})=>{const M=(0,f.tz)(),{theme:k}=(0,v.u)(),[D,F]=(0,ie.useState)(!1),O=!(0,n.isNil)(h),V=s.filter((e=>e.type===Te.INPUT)),{columns:L}=(0,ie.useMemo)((()=>{if(!_){const t=s.map((s=>no(s,{evaluationInputs:V,isComparing:O,theme:k,intl:M,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:C})));return{columns:_s(t,s)}}const t=new Map;Ns(s,O).forEach((s=>{const n=s.group||Ce.INFO;t.has(n)||t.set(n,[]),(t.get(n)||[]).push(no(s,{evaluationInputs:V,isComparing:O,theme:k,intl:M,experimentId:e,onChangeEvaluationId:d,onTraceTagsEdit:C}))}));const n=Array.from(t.entries()).map((([e,s])=>({header:Do,meta:{groupId:e,visibleCount:s.length,totalCount:Y.filter((s=>s.group===e)).length,enableGrouping:_},id:`${e}-group`,columns:s})));return{columns:n}}),[s,V,O,d,k,M,e,C,_,Y]),{setTable:H,setSelectedRowIds:U}=ie.useContext(be),z=(0,Fs.L)("js/packages/web-shared/src/genai-traces-table/GenAiTracesTableBody.tsx",{data:t,columns:L,getCoreRowModel:(0,ks.HT)(),getSortedRowModel:(0,ks.h5)(),enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:N,enableMultiSort:!0,state:{rowSelection:S},meta:{getRunColor:c},onRowSelectionChange:I,getRowId:e=>{return(null===(s=e.currentRunValue)||void 0===s?void 0:s.evaluationId)||"";var s}}),B=void 0!==S&&z.getIsAllRowsSelected(),$=z.getIsSomeRowsSelected();(0,ie.useEffect)((()=>(H(z),()=>H(void 0))),[z,H]),(0,ie.useEffect)((()=>{N&&U(z.getSelectedRowModel().rows.map((e=>e.id)))}),[z,S,U,N]);const j=M.formatMessage({id:"+mAXPc",defaultMessage:"No traces found. Try clearing your active filters to see more traces."}),P=(0,y.Y)(g.Empty,{description:j,image:(0,y.Y)(he.S,{})});(0,ie.useEffect)((()=>{l&&!Ge.includes(l.key)?l.key===Ye?z.setSorting([{id:l.key,desc:!l.asc},{id:ke,desc:!1}]):z.setSorting([{id:l.key,desc:!l.asc}]):z.setSorting([])}),[l,z]);const{rows:q}=z.getRowModel(),K=ie.useRef(null),G=(0,Ds.Te)({count:q.length,estimateSize:()=>120,getScrollElement:()=>K.current,measureElement:"undefined"!==typeof window&&-1===navigator.userAgent.indexOf("Firefox")?e=>null===e||void 0===e?void 0:e.getBoundingClientRect().height:void 0,overscan:10}),W=G.getVirtualItems(),Q=z.getHeaderGroups(),{columnSizeVars:J,tableWidth:X}=(0,ie.useMemo)((()=>{const e={};Q.forEach((s=>{s.headers.forEach((s=>{e[`--header-${sn(s.column.id)}-size`]=s.getSize()+"px"}))}));let s=0;if(q.length>0){q[0].getVisibleCells().forEach((t=>{e[`--col-${sn(t.column.id)}-size`]=t.column.getSize()+"px",s+=t.column.getSize()}))}return{columnSizeVars:e,tableWidth:s+"px"}}),[Q,q]),Z=(0,ie.useMemo)((()=>{const e={};for(const s of a)e[s.name]=Pt(s,t,r);return e}),[a,t,r]);return(0,y.FD)(y.FK,{children:[(0,y.Y)("div",{className:"container",ref:K,css:(0,p.AH)({height:"100%",position:"relative",overflowY:"auto",overflowX:"auto",minWidth:"100%",width:X},""),children:(0,y.FD)(g.Table,{css:(0,p.AH)({width:"100%",...J},""),empty:0===z.getRowModel().rows.length?P:void 0,someRowsSelected:N?$||B:void 0,children:[(0,y.Y)(ko,{headerGroups:z.getHeaderGroups(),enableRowSelection:N,enableGrouping:_,selectedAssessmentInfos:a,assessmentNameToAggregates:Z,assessmentFilters:r,toggleAssessmentFilter:A,runDisplayName:m,compareToRunUuid:h,compareToRunDisplayName:b,disableAssessmentTooltips:T,collapsedHeader:D,setCollapsedHeader:F,isComparing:O,allRowSelected:B,someRowSelected:$,toggleAllRowsSelectedHandler:z.getToggleAllRowsSelectedHandler,setColumnSizing:z.setColumnSizing}),(0,y.Y)(io,{rows:q,isComparing:O,enableRowSelection:N,virtualItems:W,virtualizerTotalSize:G.getTotalSize(),virtualizerMeasureElement:G.measureElement,rowSelectionState:S,selectedColumns:s})]})}),R&&(0,y.Y)("div",{css:(0,p.AH)({position:"absolute",inset:0,backgroundColor:k.colors.backgroundPrimary,opacity:.75,pointerEvents:"none",display:"flex",justifyContent:"center",alignItems:"center"},""),children:(0,y.Y)(v.S,{size:"large"})}),o&&(0,y.Y)(ka,{experimentId:e,runUuid:u,runDisplayName:m,otherRunDisplayName:b,evaluations:q.map((e=>e.original)),selectedEvaluationId:o,onChangeEvaluationId:d,exportToEvalsInstanceEnabled:w,assessmentInfos:i,getTrace:x,saveAssessmentsQuery:E})]})}));function Oa({searchQuery:e,setSearchQuery:s,placeholder:t}){const n=(0,f.tz)(),[o,a]=(0,ie.useState)(e);return(0,ie.useEffect)((()=>{a(e)}),[e]),(0,ie.useEffect)((()=>{const e=setTimeout((()=>{s(o)}),400);return()=>clearTimeout(e)}),[o,s]),(0,y.Y)(g.TableFilterInput,{componentId:"mlflow.evaluations_review.table_ui.filter_input",placeholder:null!==t&&void 0!==t?t:n.formatMessage({id:"zNWzj6",defaultMessage:"Search traces by request"}),value:o,onChange:e=>a(e.target.value)})}const Va=({columns:e,selectedColumns:s,setSelectedColumns:t,setSelectedColumnsWithHiddenColumns:n})=>{const o=(0,f.tz)(),{theme:a}=(0,v.u)();return(0,y.FD)(g.DialogCombobox,{componentId:"mlflow.evaluations_overview.column_selector_dropdown",label:"Columns",multiSelect:!0,children:[(0,y.Y)(g.DialogComboboxCustomButtonTriggerWrapper,{children:(0,y.Y)(v.B,{endIcon:(0,y.Y)(g.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:a.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.ColumnsIcon,{}),o.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,y.Y)(g.DialogComboboxContent,{children:(0,y.Y)(g.DialogComboboxOptionList,{children:e.map((e=>(0,y.Y)(g.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:s.some((s=>s.id===e.id)),onChange:()=>(e=>{if(n)return n([e]);t&&t((s=>s.some((s=>s.id===e.id))?s.filter((s=>s.id!==e.id)):[...s,e]))})(e)},e.id)))})})]})};var La={name:"9q39xd",styles:"min-width:32px"};const Ha=ie.memo((({tableSort:e,columns:s=[],onChange:t,enableGrouping:n,isMetadataLoading:o,metadataError:a})=>{const i=(0,f.tz)(),{theme:r}=(0,v.u)(),[l,d]=(0,ie.useState)(!1),c=(0,ie.useMemo)((()=>{const e=[],t=i.formatMessage({id:"Kkuttk",defaultMessage:"Assessment"});if(n){const t=Ns(s);for(const s of t)if(s.type===Te.ASSESSMENT){const t=s.assessmentInfo.displayName;e.push({label:t,key:s.id,type:Te.ASSESSMENT,group:Ce.ASSESSMENT})}else if(s.type===Te.INPUT)e.push({label:s.label,key:s.id,type:Te.INPUT,group:Ce.INFO});else if(s.type===Te.TRACE_INFO){const t=s.id===Ye?i.formatMessage({id:"mrGpVQ",defaultMessage:"Session time"}):s.label;Ke.includes(s.id)&&e.push({label:t,key:s.id,type:Te.TRACE_INFO,group:Ce.INFO})}return e}for(const n of s.filter((e=>e.type===Te.ASSESSMENT))){const s=n.assessmentInfo.displayName;e.push({label:`${t} \ufe65 ${s}`,key:n.id,type:Te.ASSESSMENT})}const o=i.formatMessage({id:"2plDKs",defaultMessage:"Input"});for(const n of s.filter((e=>e.type===Te.INPUT)))e.push({label:`${o} \ufe65 ${n.label}`,key:n.id,type:Te.INPUT});for(const n of s.filter((e=>(e.type===Te.TRACE_INFO||e.type===Te.INTERNAL_MONITOR_REQUEST_TIME)&&Ke.includes(e.id))))e.push({label:n.label,key:n.id,type:Te.TRACE_INFO});return e}),[s,i,n]),u=(0,ie.useMemo)((()=>{const s=c.find((s=>s.key===(null===e||void 0===e?void 0:e.key)));let t=null===s||void 0===s?void 0:s.label;if(!t){var n;const s=null===e||void 0===e||null===(n=e.key)||void 0===n?void 0:n.match(/^.+\.`(.+)`$/);s&&(t=s[1])}const o=i.formatMessage({id:"sKaamx",defaultMessage:"Sort"});return t?`${o}: ${t}`:o}),[c,i,e]);return(0,y.FD)(g.DropdownMenu.Root,{open:l,onOpenChange:d,modal:!1,children:[(0,y.Y)(g.DropdownMenu.Trigger,{"data-testid":"sort-select-dropdown",asChild:!0,children:(0,y.Y)(v.B,{componentId:"mlflow.experiment_page.sort_select_v2.toggle",icon:e?e.asc?(0,y.Y)(g.SortAscendingIcon,{}):(0,y.Y)(g.SortDescendingIcon,{}):(0,y.Y)(g.SortUnsortedIcon,{}),css:La,"aria-label":u,endIcon:(0,y.Y)(g.ChevronDownIcon,{}),children:u})}),(0,y.Y)(g.DropdownMenu.Content,{minWidth:250,children:a?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:r.spacing.xs,padding:`${r.spacing.md}px`,color:r.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,y.Y)(v.k,{}),(0,y.Y)(f.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):o?(0,y.Y)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:r.spacing.xs,padding:`${r.spacing.lg}px`,color:r.colors.textSecondary},""),"data-testid":"sort-dropdown-loading",children:(0,y.Y)(v.S,{size:"small"})}):n?(0,y.Y)(za,{sortOptions:c,tableSort:e,onOptionSelected:(e,s)=>{t(e,s),d(!1)}}):(0,y.Y)(ja,{sortOptions:c,tableSort:e,onOptionSelected:(e,s)=>{t(e,s),d(!1)}})})]})}));var Ua={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const za=({sortOptions:e,tableSort:s,onOptionSelected:t})=>{const{theme:n}=(0,v.u)(),o=(0,ie.useRef)(null),a=(0,ie.useRef)(null),[i,r]=(0,ie.useState)(""),l=(0,ie.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(i.toLowerCase())))),[e,i]),d=(0,ie.useMemo)((()=>{const e={};return l.forEach((s=>{var t;const n=null!==(t=s.group)&&void 0!==t?t:Ce.INFO;e[n]||(e[n]=[]),e[n].push(s)})),e}),[l]),c=(0,ie.useCallback)((n=>{var o;const a=e.find((e=>e.key===n));a&&t(a,null===(o=null===s||void 0===s?void 0:s.asc)||void 0===o||o)}),[t,e,null===s||void 0===s?void 0:s.asc]),u=(0,ie.useCallback)((n=>{var o;const a=null!==(o=e.find((e=>e.key===(null===s||void 0===s?void 0:s.key))))&&void 0!==o?o:e[0];t(a,n)}),[t,e,null===s||void 0===s?void 0:s.key]);return(0,ie.useEffect)((()=>{requestAnimationFrame((()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()}))}),[]),(0,y.FD)(y.FK,{children:[(0,y.FD)("div",{css:(0,p.AH)({padding:`${n.spacing.sm}px ${n.spacing.lg/2}px`,display:"flex",gap:n.spacing.xs},""),children:[(0,y.Y)(he.I,{ref:o,componentId:"mlflow.genai_traces_table.sort_dropdown.search",prefix:(0,y.Y)(he.S,{}),placeholder:"Search",value:i,onChange:e=>r(e.target.value),type:"search",onKeyDown:e=>{var s;"ArrowDown"!==e.key&&"Tab"!==e.key||(null===(s=a.current)||void 0===s||s.focus(),e.preventDefault())}}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,y.Y)(g.ToggleButton,{pressed:!1===(null===s||void 0===s?void 0:s.asc),icon:(0,y.Y)(g.ArrowDownIcon,{}),componentId:"mlflow.genai_traces_table.sort_dropdown.sort_desc",onClick:()=>u(!1),"aria-label":"Sort descending"}),(0,y.Y)(g.ToggleButton,{pressed:!0===(null===s||void 0===s?void 0:s.asc),icon:(0,y.Y)(g.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>u(!0),"aria-label":"Sort ascending"})]})]}),(0,y.FD)("div",{css:(0,p.AH)({maxHeight:400,overflowY:"auto",padding:`0 ${n.spacing.sm}px`},""),children:[Object.entries(d).map((([e,t],n)=>(0,y.Y)(ie.Fragment,{children:(0,y.FD)(g.DropdownMenu.Group,{children:[(0,y.Y)(g.DropdownMenu.Label,{children:e===Ce.INFO?"Attributes":Ne[e]}),t.map(((e,t)=>(0,y.FD)(g.DropdownMenu.CheckboxItem,{componentId:"mlflow.genai_traces_table.sort_dropdown.sort_option",checked:e.key===(null===s||void 0===s?void 0:s.key),onClick:()=>c(e.key),ref:0===n&&0===t?a:void 0,"data-testid":`sort-select-${e.label}`,children:[(0,y.Y)(g.DropdownMenu.ItemIndicator,{}),(0,y.Y)("span",{css:Ua,children:e.label})]},e.key)))]})},e))),0===l.length&&(0,y.Y)(g.DropdownMenu.Item,{disabled:!0,componentId:"mlflow.genai_traces_table.sort_dropdown.no_results",children:(0,y.Y)(f.sA,{id:"WpNCQl",defaultMessage:"No results"})})]})]})};var Ba={name:"1kxd8xu",styles:"max-height:400px;overflow-y:auto"},$a={name:"1j5vobt",styles:"display:flex;align-items:center;gap:4px"};const ja=({sortOptions:e,tableSort:s,onOptionSelected:t})=>{const{theme:n}=(0,v.u)(),o=(0,ie.useRef)(null),[a,i]=(0,ie.useState)(""),r=(0,ie.useRef)(null),l=(0,ie.useMemo)((()=>e.filter((e=>e.label.toLowerCase().includes(a.toLowerCase())))),[e,a]),d=(0,ie.useCallback)((n=>{const o=e.find((e=>e.key===n));t(o,(null===s||void 0===s?void 0:s.asc)||!0)}),[t,s,e]),c=(0,ie.useCallback)((n=>{const o=e.find((e=>e.key===(null===s||void 0===s?void 0:s.key)));t(o||e[0],n)}),[t,e,s]);return(0,ie.useEffect)((()=>{requestAnimationFrame((()=>{var e;null===(e=o.current)||void 0===e||e.focus()}))}),[]),(0,y.FD)(y.FK,{children:[(0,y.FD)("div",{css:(0,p.AH)({padding:`${n.spacing.sm}px ${n.spacing.lg/2}px ${n.spacing.sm}px`,width:"100%",display:"flex",gap:n.spacing.xs},""),children:[(0,y.Y)(he.I,{componentId:"mlflow.experiment_page.sort_dropdown.search",prefix:(0,y.Y)(he.S,{}),value:a,type:"search",onChange:e=>i(e.target.value),placeholder:"Search",autoFocus:!0,ref:o,onKeyDown:e=>{var s;"ArrowDown"!==e.key&&"Tab"!==e.key?e.stopPropagation():null===(s=r.current)||void 0===s||s.focus()}}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:n.spacing.xs},""),children:[(0,y.Y)(g.ToggleButton,{pressed:!1===(null===s||void 0===s?void 0:s.asc),icon:(0,y.Y)(g.ArrowDownIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_desc",onClick:()=>c(!1),"aria-label":"Sort descending","data-testid":"sort-select-desc"}),(0,y.Y)(g.ToggleButton,{pressed:!0===(null===s||void 0===s?void 0:s.asc),icon:(0,y.Y)(g.ArrowUpIcon,{}),componentId:"mlflow.experiment_page.sort_dropdown.sort_asc",onClick:()=>c(!0),"aria-label":"Sort ascending","data-testid":"sort-select-asc"})]})]}),(0,y.FD)(g.DropdownMenu.Group,{css:Ba,children:[l.map(((e,t)=>(0,y.FD)(g.DropdownMenu.CheckboxItem,{componentId:"mlflow.experiment_page.sort_dropdown.sort_option",onClick:()=>d(e.key),checked:e.key===(null===s||void 0===s?void 0:s.key),"data-testid":`sort-select-${e.label}`,ref:0===t?r:void 0,children:[(0,y.Y)(g.DropdownMenu.ItemIndicator,{}),(0,y.Y)("span",{css:$a,children:e.label})]},e.key))),!l.length&&(0,y.Y)(g.DropdownMenu.Item,{componentId:"codegen_mlflow_app_src_experiment-tracking_components_experiment-page_components_runs_experimentviewrunssortselectorv2.tsx_151",disabled:!0,children:(0,y.Y)(f.sA,{id:"EkUD0b",defaultMessage:"No results"})})]})]})},Pa=({backgroundColor:e,icon:s,children:t})=>{const{theme:n}=(0,v.u)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",padding:"4px 8px",gap:n.spacing.xs,borderRadius:n.borders.borderRadiusMd,color:n.colors.textSecondary,backgroundColor:e||n.colors.backgroundSecondary,fontSize:n.typography.fontSizeSm},""),children:[s||null,t?(0,y.Y)("span",{children:t}):null]})},qa="selectedEvaluationId",Ka=()=>{var e;const[s,t]=ce(),n=null!==(e=s.get(qa))&&void 0!==e?e:void 0,o=(0,ie.useCallback)((e=>{t((s=>void 0===e?(s.delete(qa),s):(s.set(qa,e),s)))}),[t]);return[n,o]},Ga="searchQuery";function Wa(e,s,t,o,a){return e.filter((e=>function(e,s,t,o){const a=null===e||void 0===e?void 0:e.currentRunValue,i=null===e||void 0===e?void 0:e.otherRunValue;let r=!0;for(const m of s){var l,d;const e=m.assessmentName,s=m.filterValue,p=m.run,g=p===t?a:p===o?i:void 0;if(void 0===g)continue;const v=e===S.OVERALL_ASSESSMENT?null===(l=g.overallAssessments)||void 0===l?void 0:l[0]:null===(d=g.responseAssessmentsByName[e])||void 0===d?void 0:d[0];if("rca"===m.filterType){var c,u;const s=(null===g||void 0===g||null===(c=g.overallAssessments[0])||void 0===c||null===(u=c.rootCauseAssessment)||void 0===u?void 0:u.assessmentName)===e;r=r&&s}else{let e=v?V(v):void 0;(0,n.isNil)(e)&&(e=void 0),r=r&&e===s}}return r}(e,s,o,a))).filter((e=>{var s,o;if((0,n.isNil)(t)||""===t)return!0;const a=t.toLowerCase(),i=JSON.stringify(null===(s=e.currentRunValue)||void 0===s?void 0:s.inputs).toLowerCase().includes(a),r=(null===(o=e.currentRunValue)||void 0===o?void 0:o.inputsId.toLowerCase())===a;return i||r}))}var Qa={name:"1ykowef",styles:"margin-bottom:0"},Ja={name:"f3vz0n",styles:"font-weight:500"},Xa={name:"969shj",styles:"display:flex;flex:1;overflow-y:hidden;position:relative"};const Za=e=>{const{totalRowCount:s,sampledInfo:t}=e,o=(0,f.tz)();return t?t.maxAllowedCount?s>=t.maxAllowedCount?(0,y.Y)(ye.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:o.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:s}),children:(0,y.Y)(v.W,{color:"warning"})}):null:t.logCountLoading||(0,n.isNil)(t.sampledCount)||(0,n.isNil)(t.totalCount)?(0,y.Y)(v.S,{}):(0,y.Y)(Pa,{children:(0,y.FD)(ye.T,{componentId:"mlflow.experiment_list_view.sampled_badge.tooltip",content:o.formatMessage({id:"TannO5",defaultMessage:"Retrieved {sampledCount} out of {totalCount} total logs ({percentage}%)"},{sampledCount:t.sampledCount,totalCount:t.totalCount,percentage:Jt(t.sampledCount/t.totalCount)}),children:["Sampled ",Jt(t.sampledCount/t.totalCount),"%"]})}):null},ei="__any_value__";var si={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const ti=ie.memo((({assessmentName:e,assessmentInfo:s,assessmentLabel:t,assessmentFilter:n,updateAssessmentFilter:o,removeAssessmentFilter:a,run:i})=>{const r=(0,f.tz)(),{theme:l}=(0,v.u)(),d=n?ve(n.filterValue):ei;return(0,y.Y)("div",{css:si,children:(0,y.FD)(g.SegmentedControlGroup,{name:"size-story",value:d,onChange:t=>{if(t.target.value===ei)return void a(e,i);const n=ge(s,t.target.value);o(e,n,i)},size:"middle",componentId:"mlflow.evaluations_review.table_ui.filter_control",children:[(0,y.Y)(g.SegmentedControlButton,{value:ei,children:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",gap:l.spacing.sm,alignItems:"center",color:l.colors.textPrimary},""),children:r.formatMessage({id:"Hq/vjk",defaultMessage:"All"})})}),Array.from(s.uniqueValues.values()).map((e=>{const{content:t,icon:n}=x(r,l,s,e);return(0,y.Y)(g.SegmentedControlButton,{value:ve(e),children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:l.spacing.sm,alignItems:"center",color:l.colors.textPrimary},""),children:[t,n]})},ve(e))}))]})})})),ni=function({experimentId:e,currentEvaluationResults:s,compareToEvaluationResults:t,currentRunDisplayName:n,runUuid:o,compareToRunUuid:a,compareToRunDisplayName:i,compareToRunLoading:r,sampledInfo:l,exportToEvalsInstanceEnabled:d=!1,getTrace:c,saveAssessmentsQuery:u,enableRunEvaluationWriteFeatures:m,defaultSortOption:h,disableAssessmentTooltips:b,onTraceTagsEdit:I,traceActions:w,initialSelectedColumns:x}){const{theme:A}=(0,v.u)(),E=(0,f.tz)(),T=vs(s),C=vs(t||[]),N=Object.keys(null!==w&&void 0!==w?w:{}).length>0,[_,Y]=Ka(),R=(0,ie.useMemo)((()=>Ms(T,C)),[T,C]),[M,k]=(()=>{var e;const[s,t]=ce();return[null!==(e=s.get(Ga))&&void 0!==e?e:"",(0,ie.useCallback)((e=>{t((s=>void 0===e||""===e?(s.delete(Ga),s):(s.set(Ga,e),s)))}),[t])]})(),D=(0,ie.useMemo)((()=>Ht(E,T,C)),[E,T,C]),F=Xe(E,T,D,o),[O,V]=(e=>{const[s,t]=ce();return[(0,ie.useMemo)((()=>{var t;return(null!==(t=s.getAll(me))&&void 0!==t?t:[]).reduce(((s,t)=>{const[n,o,a,i]=t.split("::"),r=null===e||void 0===e?void 0:e.find((e=>e.name===o));if(r){const e=ge(r,a);s.push({run:n,assessmentName:o,filterValue:e,filterType:""===i?void 0:i})}return s}),[])}),[e,s]),(0,ie.useCallback)(((e,s=!1)=>{t((s=>(s.delete(me),e&&e.forEach((e=>{s.append(me,[e.run,e.assessmentName,ve(e.filterValue),e.filterType].join("::"))})),s)),{replace:s})}),[t])]})(F.map((e=>e.assessmentInfo)).filter((e=>void 0!==e))),L=(0,ie.useMemo)((()=>""===M&&0===O.length?R:Wa(R,O,M,n,i)),[R,M,O,n,i]),[H,U]=(0,ie.useState)(F),z=(0,ie.useMemo)((()=>Ut(H.filter((e=>e.type===Te.ASSESSMENT)).map((e=>e.assessmentInfo)))),[H]),B=F.find((e=>e.type===Te.ASSESSMENT&&e.id===S.OVERALL_ASSESSMENT)),$=h||(B?{key:B.id,type:Te.ASSESSMENT,asc:!0}:void 0),[j,P]=(0,ie.useState)($),q=(0,ie.useCallback)(((e,s)=>O.find((t=>t.assessmentName===e&&t.run===s))),[O]),K=(0,ie.useCallback)(((e,s)=>{V(O.filter((t=>t.assessmentName!==e||t.run!==s)))}),[O,V]),G=(0,ie.useCallback)(((e,s,t,n)=>{const o=O.find((s=>s.assessmentName===e&&s.run===t));V(void 0===o?[...O,{assessmentName:e,filterValue:s,filterType:n,run:t}]:O.map((t=>t.assessmentName===e?{...t,filterValue:s,filterType:n}:t)))}),[O,V]),W=(0,ie.useCallback)(((e,s,t,n)=>{const o=O.find((s=>s.assessmentName===e&&s.run===t));void 0===o?V([...O,{assessmentName:e,filterValue:s,filterType:n,run:t}]):o.filterValue===s&&o.filterType===n?V(O.filter((s=>s.assessmentName!==e||s.run!==t))):V(O.map((o=>o.assessmentName===e&&o.run===t?{assessmentName:e,filterValue:s,filterType:n,run:t}:o)))}),[O,V]),Q=(0,ie.useCallback)((()=>{V([])}),[V]),J=O.length>0,[X,Z]=(0,ie.useState)({}),ee=(0,ie.useMemo)((()=>{const e=Object.keys(X).filter((e=>X[e]));return L.filter((s=>s.currentRunValue&&e.includes(s.currentRunValue.evaluationId))).map((e=>e.currentRunValue)).filter((e=>void 0!==e))}),[X,L]),se={enableRunEvaluationWriteFeatures:m},te=T.length;return r?(0,y.Y)(g.LegacySkeleton,{}):(0,y.Y)(Ya,{config:se,children:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:A.spacing.lg,overflow:"hidden",height:"100%"},""),children:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:A.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flex:1,flexDirection:"column",gap:A.spacing.xs,overflow:"hidden"},""),children:[(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",alignItems:"flex-end",justifyContent:"space-between",padding:`${A.spacing.xs}px 0px`},""),children:[(0,y.FD)(g.TableFilterLayout,{css:Qa,children:[(0,y.Y)(Oa,{searchQuery:M,setSearchQuery:k}),(0,y.FD)(g.DialogCombobox,{componentId:"mlflow.genai_traces_table.filter_dropdown",label:"Filters",value:Array.from(O).map((e=>e.assessmentName)),multiSelect:!0,children:[(0,y.Y)(g.DialogComboboxCustomButtonTriggerWrapper,{children:(0,y.Y)(v.B,{endIcon:(0,y.Y)(g.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,p.AH)({border:J?`1px solid ${A.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:J?`${A.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:A.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.FilterIcon,{}),E.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:J?` (${O.length})`:""}),O.length>0&&(0,y.Y)(he.X,{css:(0,p.AH)({fontSize:12,cursor:"pointer",color:A.colors.grey400,"&:hover":{color:A.colors.grey600}},""),onClick:e=>{Q(),e.stopPropagation(),e.preventDefault()}})]})})}),(0,y.Y)(g.DialogComboboxContent,{children:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",padding:`${A.spacing.sm}px ${A.spacing.sm}px`,gap:A.spacing.md},""),children:z.filter((e=>"numeric"!==e.dtype)).map((e=>(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:A.spacing.sm},""),children:[(0,y.Y)("div",{css:Ja,children:e.displayName}),n&&(0,y.Y)(ti,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:q(e.name,n),updateAssessmentFilter:G,removeAssessmentFilter:K,run:n}),a&&i&&(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:A.spacing.xs},""),children:[(0,y.Y)(v.T.Hint,{children:i}),(0,y.Y)(ti,{assessmentLabel:e.displayName,assessmentName:e.name,assessmentInfo:e,assessmentFilter:q(e.name,i),updateAssessmentFilter:G,removeAssessmentFilter:K,run:i})]})]},e.name)))})})]}),(0,y.Y)(Ha,{tableSort:j,columns:F,onChange:(e,s)=>{P({key:e.key,type:e.type,asc:s})}}),(0,y.Y)(Va,{columns:F,selectedColumns:H,setSelectedColumns:U}),(0,y.Y)(Ss,{experimentId:e,selectedTraces:ee,setRowSelection:Z,traceActions:w,traceInfos:void 0})]}),(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:A.spacing.sm},""),children:[(0,y.Y)(Za,{totalRowCount:te,sampledInfo:l}),(0,y.Y)(v.T.Hint,{children:E.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numEvals:R.length,numFilteredEvals:L.length})})]})]}),(0,y.Y)("div",{css:(0,p.AH)({display:"flex",gap:A.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,y.Y)("div",{css:Xa,children:(0,y.Y)(Fa,{experimentId:e,selectedColumns:H,allColumns:F,evaluations:L,selectedEvaluationId:_,selectedAssessmentInfos:z,assessmentInfos:D,assessmentFilters:O,onChangeEvaluationId:Y,tableSort:j,runUuid:o,compareToRunUuid:a,runDisplayName:n,compareToRunDisplayName:i,enableRowSelection:N,rowSelection:N?X:void 0,setRowSelection:N?Z:void 0,exportToEvalsInstanceEnabled:d,getTrace:c,toggleAssessmentFilter:W,saveAssessmentsQuery:u,disableAssessmentTooltips:b,onTraceTagsEdit:I})})})]})})})})},oi=async({queryKey:[,{experimentId:e}]})=>$s("ajax-api/2.0/mlflow/runs/search","POST",{experiment_ids:[e]}),ai=(e,s=!1)=>{var t;const{data:n,error:o,isLoading:a,isFetching:i}=(0,Os.I)((e=>["EXPERIMENT_RUNS_FOR_TRACE_COMPARISON",{experimentId:e}])(e),{queryFn:oi,enabled:!s,cacheTime:1/0,staleTime:1/0});return{requestError:o,isLoading:a,isFetching:i,runInfos:null===n||void 0===n||null===(t=n.runs)||void 0===t?void 0:t.map((e=>{var s,t;return{runUuid:null===(s=e.info)||void 0===s?void 0:s.run_uuid,runName:null===(t=e.info)||void 0===t?void 0:t.run_name}}))}};var ii=t(60062);const ri=(e,s)=>["GET_TRACE_EVALUATION_ARTIFACT",{runUuid:e,artifactFile:s}],li=async({queryKey:[,{runUuid:e,artifactFile:s}]})=>{const t=["ajax-api/2.0/mlflow/get-artifact",new URLSearchParams({run_uuid:e,path:s})].join("?");return $s(t,"GET").then((e=>({...e,filename:s})))},di=[o.Assessments,o.Evaluations,o.Metrics],ci=({runUuid:e,artifacts:s=di},{disabled:t=!1}={})=>{const o=!t&&di.some((e=>s.includes(e))),a=(0,ii.E)({queries:di.map((n=>({queryFn:li,queryKey:ri(e,n),enabled:!t&&s.includes(n),refetchOnWindowFocus:!1})))}),d=a.some((e=>e.isLoading)),c=a.some((e=>e.isFetching)),p=a.find((e=>e.error)),[g,v,f]=a.map((e=>e.data)),h=(0,ie.useMemo)((()=>m(g)),[g]),y=(0,ie.useMemo)((()=>m(v)),[v]),b=(0,ie.useMemo)((()=>m(f)),[f]),S=(0,ie.useMemo)((()=>{if(y)return function(e,s,t){const o=(s||[]).reduce(((e,s)=>{e[s.evaluation_id]||(e[s.evaluation_id]={});const{key:t,value:n,timestamp:o}=s;return e[s.evaluation_id][t]={key:t,value:n,timestamp:o},e}),{}),a=(t||[]).reduce(((e,s)=>{var t,o,a,i;return e[s.evaluation_id]||(e[s.evaluation_id]=[]),e[s.evaluation_id].push({booleanValue:(0,n.isNil)(s.boolean_value)?s.boolean_value:Boolean(s.boolean_value),numericValue:(0,n.isNil)(s.numeric_value)?s.numeric_value:Number(s.numeric_value),stringValue:(0,n.isNil)(s.string_value)?s.string_value:String(s.string_value),metadata:s.metadata||{},...s.error_code&&{errorCode:s.error_code},...s.error_message&&{errorMessage:s.error_message},name:s.name,rationale:s.rationale||null,source:{metadata:null!==(t=null===(o=s.source)||void 0===o?void 0:o.metadata)&&void 0!==t?t:{},sourceId:null===(a=s.source)||void 0===a?void 0:a.source_id,sourceType:null===(i=s.source)||void 0===i?void 0:i.source_type},timestamp:s.timestamp}),e}),{});return e.map((e=>{var s,t;const d=(0,n.orderBy)(a[e.evaluation_id]||[],"timestamp","desc"),c=d.filter(r).map((e=>{var s,t,o,a;const i=null===(s=e.rationale)||void 0===s?void 0:s.match(/^\[(.*?)\](.*?)(?:\*\*Suggested Actions\*\*:(.*))?$/s),r=i?null===(t=i[1])||void 0===t?void 0:t.trim():void 0,l=i?null===(o=i[2])||void 0===o?void 0:o.trim():void 0,d=i?null===(a=i[3])||void 0===a?void 0:a.trim():void 0;return e.rationale=l||e.rationale,{...e,rootCauseAssessment:(0,n.isNil)(r)?void 0:{assessmentName:r,suggestedActions:d}}}));0===c.length&&c.push({name:i.OVERALL_ASSESSMENT,rationale:null,source:{sourceType:"AI_JUDGE",sourceId:"UNKNOWN",metadata:{}},metadata:{},numericValue:null,booleanValue:null,stringValue:null,timestamp:null});const m=d.filter(l),p=(0,n.difference)(d,c,m),g=(0,n.groupBy)(p,"name");return Object.keys(g).forEach((e=>{g[e]=(0,n.orderBy)(g[e],"timestamp","desc")})),{evaluationId:e.evaluation_id,requestId:e.request_id,inputs:e.inputs,inputsId:e.inputs_id,outputs:null!==(s=e.outputs)&&void 0!==s?s:{},targets:null!==(t=e.targets)&&void 0!==t?t:{},...e.error_code&&{errorCode:e.error_code},...e.error_message&&{errorMessage:e.error_message},overallAssessments:c,responseAssessmentsByName:g,metrics:o[e.evaluation_id]||{},retrievalChunks:u(e.outputs,e.targets,m)}}))}(y,b,h)}),[h,y,b]);return{requestError:p,isLoading:d&&o,isFetching:c&&o,data:S}},ui="searchMlflowTraces",mi=({queryClient:e})=>{e.invalidateQueries({queryKey:[ui]})},pi=({locations:e,runUuid:s,timeRange:t,otherRunUuid:n,filterByLoggedModelId:o,loggedModelId:a,sqlWarehouseId:i,disabled:r,networkFilters:l})=>{const d=(0,f.tz)(),c=hi(s,t,l,o),{data:u,isLoading:m,error:p}=fi({locations:e,filter:c,loggedModelId:a,sqlWarehouseId:i,enabled:!r}),g=(0,ie.useMemo)((()=>rs(u,s)),[u,s]),v=hi(n,t),{data:h,isLoading:b,error:S}=fi({locations:e,filter:v,enabled:!r&&Boolean(n),loggedModelId:a,sqlWarehouseId:i}),I=(0,ie.useMemo)((()=>rs(h,n)),[h,n]),w=(0,ie.useMemo)((()=>!g||m||p||!g.length?[]:g.map((e=>gs(e)))),[g,m,p]),x=(0,ie.useMemo)((()=>{const e=b&&Boolean(n);return!I||e||S||!I.length?[]:I.map((e=>gs(e)))}),[I,b,S,n]),A=(0,ie.useMemo)((()=>Ht(d,w||[],x||[])),[d,w,x]),E=(0,ie.useMemo)((()=>{const e=new Map;return null===g||void 0===g||g.forEach((s=>{const t=s.trace_metadata;if(t){const n=t[Ws.sourceNameTag];n&&!e.has(n)&&e.set(n,{value:n,renderValue:()=>(0,y.Y)(ct,{traceInfo:s,isComparing:!1,disableLinks:!0})})}})),{source:Array.from(e.values()).sort(((e,s)=>e.value.localeCompare(s.value)))}}),[g]),T=Xe(d,w||[],A,s,void 0,!0);return(0,ie.useMemo)((()=>({assessmentInfos:A,allColumns:T,totalCount:w.length,evaluatedTraces:w,otherEvaluatedTraces:x,isLoading:m&&!r,error:p,isEmpty:0===w.length,tableFilterOptions:E})),[A,T,m,p,w,E,r,x])},gi=({locations:e,currentRunDisplayName:s,runUuid:t,timeRange:n,searchQuery:o,filters:a,disabled:i,pageSize:r,limit:l,filterByLoggedModelId:d,tableSort:c,loggedModelId:u,sqlWarehouseId:m})=>{const p=!((null===e||void 0===e?void 0:e.some((e=>"UC_SCHEMA"===e.type)))&&!1),{networkFilters:g,clientFilters:v}=(0,ie.useMemo)((()=>((e,s=!0)=>e.reduce(((e,t)=>(t.column===Ce.ASSESSMENT&&s?e.clientFilters.push(t):e.networkFilters.push(t),e)),{networkFilters:[],clientFilters:[]}))(a||[],p)),[a,p]),f=hi(t,n,g,d,p?void 0:o),h=yi(c),{data:y,isLoading:b,isFetching:S,error:I,refetch:w}=fi({locations:e,filter:f,enabled:!i,pageSize:r,limit:l,orderBy:h,loggedModelId:u,sqlWarehouseId:m}),x=(0,ie.useMemo)((()=>{if(y)return y.map((e=>({currentRunValue:gs(e),otherRunValue:void 0})))}),[y]),A=(0,ie.useMemo)((()=>{if(!x)return;if(!p||""===o&&0===(null===v||void 0===v?void 0:v.length))return x.reduce(((e,s)=>{var t;return null!==(t=s.currentRunValue)&&void 0!==t&&t.traceInfo&&e.push(s.currentRunValue.traceInfo),e}),[]);const e=v.map((e=>({assessmentName:e.key||"",filterValue:e.value,run:s||""})));return Wa(x,e||[],o,s,void 0).reduce(((e,s)=>{var t;return null!==(t=s.currentRunValue)&&void 0!==t&&t.traceInfo&&e.push(s.currentRunValue.traceInfo),e}),[])}),[x,p,v,o,s]),E=(0,ie.useMemo)((()=>rs(A,t)),[A,t]);return i?{data:[],isLoading:!1,isFetching:!1}:{data:E,isLoading:b,isFetching:S,error:I||void 0,refetchMlflowTraces:w}},vi=async({signal:e,locations:s,filter:t,pageSize:o,limit:a,orderBy:i,loggedModelId:r,sqlWarehouseId:l})=>{if((null===s||void 0===s?void 0:s.some((e=>"UC_SCHEMA"===e.type)))&&!1)return xe._A.searchTracesV4({signal:e,orderBy:i,locations:s,filter:t});let d,c=[];const u=o||500,m=a||we();for(;c.length<m;){const o={locations:s,filter:t,max_results:u,order_by:i};r&&l&&(o.model_id=r,o.sql_warehouse_id=l),d&&(o.page_token=d);const a=await Bs("ajax-api/3.0/mlflow/traces/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),signal:e});if(!a.ok)throw(0,zs.Jg)(a);const m=await a.json(),p=m.traces;if((0,n.isNil)(p)||(c=c.concat(p)),d=m.next_page_token,!d)break}return c},fi=({locations:e,filter:s,pageSize:t,limit:n,orderBy:o,loggedModelId:a,sqlWarehouseId:i,enabled:r,...l})=>{const d=(null===e||void 0===e?void 0:e.some((e=>"UC_SCHEMA"===e.type)))&&!1,c=(0,ie.useMemo)((()=>d?{keepPreviousData:!0,refetchOnWindowFocus:!1}:{staleTime:1/0,cacheTime:1/0}),[d]);return(0,Os.I)({...c,enabled:r,queryKey:[ui,{locations:e,filter:s,orderBy:o,loggedModelId:a,sqlWarehouseId:i,pageSize:t}],queryFn:({signal:r})=>vi({signal:r,locations:e,filter:s,pageSize:t,limit:n,orderBy:o,loggedModelId:a,sqlWarehouseId:i}),...l})},hi=(e,s,t,n,o)=>{const a=[];if(e&&a.push(`attributes.run_id = '${e}'`),o&&a.push(`span.attributes.\`mlflow.spanInputs\` ILIKE '%${o}%'`),s){const e="attributes.timestamp_ms";s.startTime&&a.push(`${e} > ${s.startTime}`),s.endTime&&a.push(`${e} < ${s.endTime}`)}if(n&&a.push(`request_metadata."mlflow.modelId" = '${n}'`),t&&t.forEach((e=>{switch(e.column){case Ce.TAG:if(e.key){const s="tags",t=e.key.includes(".")||e.key.includes(" ")?`${s}.\`${e.key}\``:`${s}.${e.key}`;a.push(`${t} ${e.operator} '${e.value}'`)}break;case De:const s="attributes.execution_time_ms";a.push(`${s} ${e.operator} ${e.value}`);break;case Fe:const t="attributes.status";a.push(`${t} = '${e.value}'`);break;case _e:a.push(`request_metadata."mlflow.trace.user" = '${e.value}'`);break;case Ue:a.push(`attributes.run_id = '${e.value}'`);break;case ze:a.push(`request_metadata."mlflow.modelId" = '${e.value}'`);break;case Le:a.push(`attributes.name ${e.operator} '${e.value}'`);break;case Oe:a.push(`request_metadata."mlflow.source.name" ${e.operator} '${e.value}'`);break;case Ce.ASSESSMENT:a.push(`feedback.\`${e.key}\` ${e.operator} '${e.value}'`);break;case Ce.EXPECTATION:a.push(`expectation.\`${e.key}\` ${e.operator} '${e.value}'`);break;case je:"="===e.operator?a.push(`span.name ILIKE '${e.value}'`):"CONTAINS"===e.operator?a.push(`span.name ILIKE '%${e.value}%'`):a.push(`span.name ${e.operator} '${e.value}'`);break;case Pe:"="===e.operator?a.push(`span.type ILIKE '${e.value}'`):"CONTAINS"===e.operator?a.push(`span.type ILIKE '%${e.value}%'`):a.push(`span.type ${e.operator} '${e.value}'`);break;case qe:"CONTAINS"===e.operator&&a.push(`span.content ILIKE '%${e.value}%'`);break;default:if(e.column.startsWith($e)){const s=`request_metadata.${ns(e.column)}`;e.operator===Ee.CONTAINS?a.push(`${s} ILIKE '%${e.value}%'`):a.push(`${s} ${e.operator} '${e.value}'`)}}})),a.length>0)return a.join(" AND ")},yi=e=>{if(e)switch(e.key){case De:return["execution_time "+(e.asc?"ASC":"DESC")];case ke:return["timestamp "+(e.asc?"ASC":"DESC")];default:return[]}};var bi=t(884);var Si={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"},Ii={name:"l8l8b8",styles:"white-space:nowrap;overflow:hidden;text-overflow:ellipsis"};const wi=({id:e,item:s,options:t,query:n,onChange:o,placeholder:a,width:i,canSearchCustomValue:r})=>{const{theme:l}=(0,v.u)(),[d,c]=(0,ie.useState)(""),u=(0,ie.useMemo)((()=>{var e,s;return null!==(e=null!==(s=null===n||void 0===n?void 0:n.data)&&void 0!==s?s:t)&&void 0!==e?e:[]}),[null===n||void 0===n?void 0:n.data,t]),m=(0,ie.useMemo)((()=>u.map((e=>e.value))),[u]);return(0,y.FD)(g.DialogCombobox,{componentId:"mlflow.evaluations_review.table_ui.filter_column",value:null!==s&&void 0!==s&&s.value?[s.value]:[],id:e,children:[(0,y.Y)(g.DialogComboboxTrigger,{withInlineLabel:!1,placeholder:a,renderDisplayedValue:()=>{var e;return null!==(e=null===s||void 0===s?void 0:s.renderValue())&&void 0!==e?e:""},width:i,allowClear:!1}),(0,y.Y)(g.DialogComboboxContent,{width:i,style:{zIndex:l.options.zIndexBase+100},loading:null===n||void 0===n?void 0:n.isLoading,children:(0,y.Y)(g.DialogComboboxOptionList,{children:(0,y.FD)(g.DialogComboboxOptionListSearch,{onSearch:e=>c(e),children:[u.map((e=>(0,y.Y)(g.DialogComboboxOptionListSelectItem,{value:e.value,onChange:o,checked:e.value===(null===s||void 0===s?void 0:s.value),css:Si,children:e.renderValue()},e.value))),r&&d&&!m.includes(d)?(0,y.FD)(g.DialogComboboxOptionListSelectItem,{value:d,onChange:o,checked:d===(null===s||void 0===s?void 0:s.value),css:Ii,children:['Use "',d,'"']},d):null]})})})]})};var xi={name:"833hqy",styles:"width:200px"};const Ai=({index:e,tableFilter:s,assessmentInfos:t,onChange:n,experimentId:o,tableFilterOptions:a})=>{const i=(0,f.tz)(),{theme:r}=(0,v.u)(),l=`filter-value-${e}`,[d,c]=(0,ie.useState)(s.value),u=(0,ie.useCallback)((()=>{d!==s.value&&n({...s,value:d},e)}),[s,e,n,d]),m=ai(o),p=(0,ie.useMemo)((()=>{var e,s;return{data:null===(e=m.runInfos)||void 0===e||null===(s=e.filter((e=>e.runUuid&&e.runName)))||void 0===s?void 0:s.map((e=>({value:e.runUuid,renderValue:()=>e.runName}))),isLoading:m.isLoading}}),[m]),g=((e,s=!1)=>{const t=["EXPERIMENT_MODEL_VERSIONS",e],{data:n,isLoading:o,error:a}=(0,Os.I)({queryKey:t,queryFn:async()=>$s("ajax-api/2.0/mlflow/logged-models/search","POST",{experiment_ids:[e]}),staleTime:1/0,cacheTime:1/0,enabled:!s,refetchOnMount:!1,retry:!1});return{data:null===n||void 0===n?void 0:n.models,isLoading:o,error:a||void 0}})(o),h=(0,ie.useMemo)((()=>{var e;return{data:null===(e=g.data)||void 0===e?void 0:e.map((e=>({value:e.info.model_id,renderValue:()=>e.info.name}))),isLoading:g.isLoading}}),[g]),b=[{value:"IN_PROGRESS",renderValue:()=>i.formatMessage(ut.IN_PROGRESS)},{value:"OK",renderValue:()=>i.formatMessage(ut.OK)},{value:"ERROR",renderValue:()=>i.formatMessage(ut.ERROR)}];var S,I;if(s.column===Ue)return(0,y.Y)(wi,{id:l,item:null===(S=p.data)||void 0===S?void 0:S.find((e=>e.value===s.value)),query:p,onChange:t=>{n({...s,value:t},e)},placeholder:"Select run",width:200,canSearchCustomValue:!1});if(s.column===ze)return(0,y.Y)(wi,{id:l,item:null===(I=h.data)||void 0===I?void 0:I.find((e=>e.value===s.value)),query:h,onChange:t=>{n({...s,value:t},e)},placeholder:"Select version",width:200,canSearchCustomValue:!1});if(s.column===Ce.ASSESSMENT){const o=t.find((e=>e.name===s.key));if(o&&"numeric"!==o.dtype&&"unknown"!==o.dtype){const t=Array.from(o.uniqueValues.values()).map((e=>({value:ve(e),renderValue:()=>x(i,r,o,e).content})));return(0,y.Y)(wi,{id:l,item:t.find((e=>e.value===ve(s.value))),options:t,onChange:t=>{n({...s,value:pe(t)},e)},placeholder:"Select",width:200,canSearchCustomValue:!1})}}if(s.column===Fe)return(0,y.Y)(wi,{id:l,item:b.find((e=>e.value===s.value)),options:b,onChange:t=>{n({...s,value:t},e)},placeholder:"Select",width:200,canSearchCustomValue:!1});if(s.column===Oe){const t=a.source;return(0,y.Y)(wi,{id:l,item:t.find((e=>e.value===s.value)),options:t,onChange:t=>{n({...s,value:t},e)},placeholder:"Select source",width:200,canSearchCustomValue:!1})}return(0,y.Y)(he.I,{"aria-label":"Value",componentId:"mlflow.evaluations_review.table_ui.filter_value",id:l,placeholder:s.column===De?"Time in milliseconds":"Value",type:s.column===De?"number":"text",value:d,onChange:e=>{c(e.target.value)},onBlur:u,css:xi,disabled:s.column===Ce.ASSESSMENT})};const Ei=[De,Fe,Le,_e,Ue,ze,Oe],Ti=(e,s)=>e===De?[Ee.EQUALS,Ee.NOT_EQUALS,Ee.GREATER_THAN,Ee.LESS_THAN,Ee.GREATER_THAN_OR_EQUALS,Ee.LESS_THAN_OR_EQUALS]:e===je||e===Pe?[Ee.EQUALS,Ee.NOT_EQUALS,Ee.CONTAINS]:e===qe?[Ee.CONTAINS]:[Ee.EQUALS];var Ci={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Ni={name:"1fttcpj",styles:"display:flex;flex-direction:column"},_i={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Yi={name:"833hqy",styles:"width:200px"},Ri={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Mi={name:"1fttcpj",styles:"display:flex;flex-direction:column"},ki={name:"1duj7gx",styles:"align-self:flex-end"};const Di=({tableFilter:e,index:s,onChange:t,onDelete:n,assessmentInfos:o,experimentId:a,tableFilterOptions:i,allColumns:r,usesV4APIs:l})=>{const{column:d,operator:c,key:u}=e,{theme:m}=(0,v.u)(),h=(0,ie.useMemo)((()=>o.filter((e=>"numeric"!==e.dtype)).map((e=>({value:e.name,renderValue:()=>e.displayName})))),[o]),b=(0,ie.useMemo)((()=>{const e=r.filter((e=>Ei.includes(e.id)||e.id.startsWith($e))).map((e=>({value:e.id,renderValue:()=>{var s;return null!==(s=e.filterLabel)&&void 0!==s?s:e.label}})));return e.push({value:Ce.TAG,renderValue:()=>Ne[Ce.TAG]},{value:Ce.ASSESSMENT,renderValue:()=>Ne[Ce.ASSESSMENT]}),l&&e.push({value:qe,renderValue:()=>"Span content"},{value:je,renderValue:()=>"Span name"},{value:Pe,renderValue:()=>"Span type"}),e}),[r,l]);return(0,y.Y)(y.FK,{children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:m.spacing.sm},""),children:[(0,y.FD)("div",{css:Ci,children:[(0,y.Y)(g.FormUI.Label,{htmlFor:`filter-column-${s}`,children:(0,y.Y)(f.sA,{id:"OlytgO",defaultMessage:"Field"})}),(0,y.Y)(wi,{id:`filter-column-${s}`,item:b.find((e=>e.value===d)),options:b,onChange:e=>{if(e!==d){const n=Ti(e)[0];t({column:e,operator:n,value:""},s)}},placeholder:"Select column",width:180,canSearchCustomValue:!1})]}),d===Ce.ASSESSMENT&&(0,y.FD)("div",{css:Ni,children:[(0,y.Y)(g.FormUI.Label,{htmlFor:`filter-key-${s}`,children:(0,y.Y)(f.sA,{id:"lK4Ay3",defaultMessage:"Name"})}),(0,y.Y)(wi,{id:`filter-key-${s}`,item:h.find((e=>e.value===u)),options:h,onChange:n=>{t({...e,key:n},s)},placeholder:"Select name",width:200,canSearchCustomValue:!1})]}),d===Ce.TAG&&(0,y.FD)("div",{css:_i,children:[(0,y.Y)(g.FormUI.Label,{htmlFor:`filter-key-${s}`,children:(0,y.Y)(f.sA,{id:"gST1At",defaultMessage:"Key"})}),(0,y.Y)(he.I,{"aria-label":"Key",componentId:"mlflow.evaluations_review.table_ui.filter_key",id:"filter-key-"+s,type:"text",css:Yi,placeholder:d===Ce.TAG?"Key":"Name",value:u,onChange:n=>{t({...e,key:n.target.value},s)}})]}),(0,y.FD)("div",{css:Ri,children:[(0,y.Y)(g.FormUI.Label,{htmlFor:`filter-operator-${s}`,children:(0,y.Y)(f.sA,{id:"W6Sqio",defaultMessage:"Operator"})}),(()=>{const n=""!==d&&1===Ti(d).length;return(0,y.Y)(g.SimpleSelect,{"aria-label":"Operator",componentId:"mlflow.evaluations_review.table_ui.filter_operator",id:"filter-operator-"+s,placeholder:"Select",width:120,contentProps:{style:{zIndex:m.options.zIndexBase+100}},value:n?Ti(d)[0]:c,disabled:n,onChange:n=>{t({...e,operator:n.target.value},s)},children:Ti(d).map((e=>(0,y.Y)(g.SimpleSelectOption,{value:e,children:e},e)))})})()]}),(0,y.FD)("div",{css:Mi,children:[(0,y.Y)(g.FormUI.Label,{htmlFor:`filter-value-${s}`,children:(0,y.Y)(f.sA,{id:"6JOLpj",defaultMessage:"Value"})}),(0,y.Y)(Ai,{index:s,tableFilter:e,assessmentInfos:o,onChange:t,experimentId:a,tableFilterOptions:i})]}),(0,y.Y)("div",{css:ki,children:(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.table_ui.filter_delete_button",type:"tertiary",icon:(0,y.Y)(g.CloseSmallIcon,{}),onClick:n})})]})})};const Fi=({filters:e,setFilters:s,assessmentInfos:t,experimentId:n,tableFilterOptions:o,allColumns:a,isMetadataLoading:i,metadataError:r,usesV4APIs:l})=>{const d=(0,f.tz)(),{theme:c}=(0,v.u)(),u=e.length>0,m=(0,ie.useCallback)((()=>{s([])}),[s]);return(0,y.FD)(v.aw.Root,{componentId:"mlflow.genai_traces_table_filter.filter_dropdown",children:[(0,y.Y)(v.aw.Trigger,{asChild:!0,children:(0,y.Y)(v.B,{endIcon:(0,y.Y)(g.ChevronDownIcon,{}),componentId:"mlflow.evaluations_review.table_ui.filter_button",css:(0,p.AH)({border:u?`1px solid ${c.colors.actionDefaultBorderFocus} !important`:"",backgroundColor:u?`${c.colors.actionDefaultBackgroundHover} !important`:""},""),children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:c.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.FilterIcon,{}),d.formatMessage({id:"J961B2",defaultMessage:"Filters{numFilters}"},{numFilters:u?` (${e.length})`:""}),u&&(0,y.Y)(he.X,{css:(0,p.AH)({fontSize:12,cursor:"pointer",color:c.colors.grey400,"&:hover":{color:c.colors.grey600}},""),onClick:()=>{m()}})]})})}),(0,y.Y)(v.aw.Content,{align:"start",css:(0,p.AH)({padding:c.spacing.md},""),children:r?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:c.spacing.xs,padding:`${c.spacing.md}px`,color:c.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,y.Y)(v.k,{}),(0,y.Y)(f.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):i?(0,y.Y)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:c.spacing.xs,padding:`${c.spacing.md}px`,color:c.colors.textSecondary},""),"data-testid":"filter-dropdown-loading",children:(0,y.Y)(v.S,{size:"small"})}):(0,y.Y)(Li,{filters:e,assessmentInfos:t,setFilters:s,experimentId:n,tableFilterOptions:o,allColumns:a,usesV4APIs:l})})]})};var Oi={name:"skgbeu",styles:"display:flex;justify-content:flex-end"},Vi={name:"skgbeu",styles:"display:flex;justify-content:flex-end"};const Li=({filters:e,assessmentInfos:s,setFilters:t,experimentId:n,tableFilterOptions:o,allColumns:a,usesV4APIs:i})=>{const{theme:r}=(0,v.u)(),l=(e=>(0,bi.mN)({defaultValues:{filters:e.length>0?e:[{column:"",operator:Ee.EQUALS,value:""}]}}))(e),{setValue:d,watch:c}=l,u=c("filters");return(0,y.Y)(bi.Op,{...l,children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:r.spacing.lg,overflow:"auto"},""),children:[(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:u.map(((e,t)=>(0,y.Y)(Di,{tableFilter:e,index:t,onChange:e=>{u[t]=e,d("filters",u)},onDelete:()=>{const e=[...u];e.splice(t,1),0===e.length&&e.push({column:"",operator:Ee.EQUALS,value:""}),d("filters",e)},assessmentInfos:s,experimentId:n,tableFilterOptions:o,allColumns:a,usesV4APIs:i},e.column+e.operator+e.value+t)))}),(0,y.Y)("div",{children:(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.table_ui.add_filter_button",icon:(0,y.Y)(g.PlusIcon,{}),onClick:()=>{d("filters",[...u,{column:"",operator:Ee.EQUALS,value:""}])},children:(0,y.Y)(f.sA,{id:"cHgTsd",defaultMessage:"Add filter"})})}),(0,y.Y)("div",{css:Oi,children:(0,y.Y)(v.B,{componentId:"mlflow.evaluations_review.table_ui.apply_filters_button",type:"primary",onClick:()=>t(u),css:Vi,children:(0,y.Y)(f.sA,{id:"iZ0M1Y",defaultMessage:"Apply filters"})})})]})})},Hi=e=>e===Ce.INFO?"Attributes":Ne[e],Ui=({columns:e=[],selectedColumns:s=[],toggleColumns:t,setSelectedColumns:n,isMetadataLoading:o=!1,metadataError:a})=>{const i=(0,f.tz)(),{theme:r}=(0,v.u)(),[l,d]=(0,ie.useState)(""),c=(0,ie.useMemo)((()=>{const s=Ns(e),t={};return s.forEach((e=>{var s;const n=null!==(s=e.group)&&void 0!==s?s:Ce.INFO;t[n]||(t[n]=[]),t[n].push(e)})),t}),[e]),u=(0,ie.useMemo)((()=>{if(!l.trim())return c;const e=l.trim().toLowerCase(),s={};return Object.entries(c).forEach((([t,n])=>{const o=Hi(t).toLowerCase().includes(e),a=n.filter((s=>s.label.toLowerCase().includes(e)));(o||a.length)&&(s[t]=o?n:a)})),s}),[c,l]);return(0,y.FD)(g.DialogCombobox,{componentId:"mlflow.evaluations_overview_grouped.column_selector_dropdown",label:"Columns",multiSelect:!0,children:[(0,y.Y)(g.DialogComboboxCustomButtonTriggerWrapper,{children:(0,y.Y)(v.B,{endIcon:(0,y.Y)(g.ChevronDownIcon,{}),"data-testid":"column-selector-button",componentId:"mlflow.evaluations_review.table_ui.filter_button",children:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:r.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.ColumnsIcon,{}),i.formatMessage({id:"wjOGl2",defaultMessage:"Columns"})]})})}),(0,y.Y)(g.DialogComboboxContent,{maxHeight:496,minWidth:300,maxWidth:500,loading:o&&!a,children:a?(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",gap:r.spacing.xs,padding:`${r.spacing.md}px`,color:r.colors.textValidationDanger},""),"data-testid":"filter-dropdown-error",children:[(0,y.Y)(v.k,{}),(0,y.Y)(f.sA,{id:"dJaboT",defaultMessage:"Fetching traces failed"})]}):(0,y.Y)(g.DialogComboboxOptionList,{children:(0,y.Y)(g.DialogComboboxOptionListSearch,{controlledValue:l,setControlledValue:d,children:Object.entries(u).map((([e,o])=>(0,y.FD)(ie.Fragment,{children:[(0,y.Y)(g.DialogComboboxSectionHeader,{children:Hi(e)}),(0,y.Y)(g.DialogComboboxOptionListCheckboxItem,{value:`all-${e}`,checked:o.every((e=>s.some((s=>s.id===e.id)))),onChange:()=>(e=>{if(e.every((e=>s.some((s=>s.id===e.id))))){const t=s.filter((s=>!e.some((e=>e.id===s.id))));n(t)}else{const t=[...s];e.forEach((e=>{t.some((s=>s.id===e.id))||t.push(e)})),n(t)}})(o),children:i.formatMessage({id:"RXL0a5",defaultMessage:"All {groupLabel}"},{groupLabel:Hi(e)})}),o.map((e=>(0,y.Y)(g.DialogComboboxOptionListCheckboxItem,{value:e.label,checked:s.some((s=>s.id===e.id)),onChange:()=>t([e]),children:e.label},e.id)))]},e)))})})})]})};var zi={name:"13qopiv",styles:"margin-bottom:0;flex:1"};const Bi=ie.memo((e=>{const{searchQuery:s,setSearchQuery:t,filters:n,setFilters:o,tableSort:a,setTableSort:i,selectedColumns:r,toggleColumns:l,setSelectedColumns:d,assessmentInfos:c,experimentId:u,traceInfos:m,tableFilterOptions:f,traceActions:h,allColumns:b,countInfo:S,isMetadataLoading:I,usesV4APIs:w,metadataError:x}=e,{theme:A}=(0,v.u)(),E=(0,ie.useCallback)(((e,s)=>{i({key:e.key,type:e.type,asc:s})}),[i]);return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",width:"100%",alignItems:"flex-end",gap:A.spacing.sm,paddingBottom:`${A.spacing.xs}px`},""),children:[(0,y.FD)(g.TableFilterLayout,{css:zi,children:[(0,y.Y)(Oa,{searchQuery:s,setSearchQuery:t}),(0,y.Y)(Fi,{filters:n,setFilters:o,assessmentInfos:c,experimentId:u,tableFilterOptions:f,allColumns:b,isMetadataLoading:I,metadataError:x,usesV4APIs:w}),(0,y.Y)(Ha,{tableSort:a,columns:r,onChange:E,enableGrouping:!0,isMetadataLoading:I,metadataError:x}),(0,y.Y)(Ui,{columns:b,selectedColumns:r,toggleColumns:l,setSelectedColumns:d,isMetadataLoading:I,metadataError:x}),h&&(0,y.Y)(Ss,{experimentId:u,traceActions:h,traceInfos:m})]}),(0,y.Y)($i,{countInfo:S})]})})),$i=e=>{const{countInfo:s}=e,t=(0,f.tz)(),{theme:o}=(0,v.u)();return s.logCountLoading||(0,n.isNil)(s.currentCount)?(0,y.Y)(v.S,{size:"small"}):(0,y.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:o.spacing.sm},""),children:[s.currentCount>=s.maxAllowedCount&&(0,y.Y)(ye.T,{componentId:"mlflow.experiment_list_view.max_traces.tooltip",content:t.formatMessage({id:"BpAyCF",defaultMessage:"Only the top {evalResultsCount} results are shown"},{evalResultsCount:s.maxAllowedCount}),children:(0,y.Y)(v.W,{color:"warning"})}),(0,y.Y)(v.T.Hint,{children:t.formatMessage({id:"FnOQ44",defaultMessage:"{numFilteredEvals} of {numEvals}"},{numFilteredEvals:s.currentCount>=s.maxAllowedCount?s.maxAllowedCount:s.currentCount,numEvals:s.totalCount>=s.maxAllowedCount?`${s.maxAllowedCount}+`:s.totalCount})})]})};var ji={name:"kj840c",styles:"flex:1;overflow-y:hidden;position:relative"};const Pi=ie.memo((e=>{const{experimentId:s,currentTraceInfoV3:t,compareToTraceInfoV3:n,currentRunDisplayName:o,runUuid:a,compareToRunUuid:i,compareToRunDisplayName:r,setFilters:l,filters:d,selectedColumns:c,tableSort:u,assessmentInfos:m,getTrace:g,onTraceTagsEdit:f,allColumns:h,getRunColor:b,enableRowSelection:S=!0,displayLoadingOverlay:I=!1}=e,{theme:w}=(0,v.u)(),x=(0,ie.useMemo)((()=>vs(t.map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))))),[t]),A=(0,ie.useMemo)((()=>vs((n||[]).map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e}))))),[n]),[E,T]=(0,ie.useState)({}),C=(0,ie.useCallback)(((e,s,t)=>{const n=d.find((s=>s.column===Ce.ASSESSMENT&&s.key===e));void 0===n?l([...d,{column:Ce.ASSESSMENT,key:e,operator:Ee.EQUALS,value:s}]):n.value===s?l(d.filter((s=>!(s.column===Ce.ASSESSMENT&&s.key===e)))):l(d.map((t=>t.column===Ce.ASSESSMENT&&t.key===e?{column:Ce.ASSESSMENT,key:e,operator:Ee.EQUALS,value:s}:t)))}),[d,l]),N=(0,ie.useMemo)((()=>d.filter((e=>e.column===Ce.ASSESSMENT)).map((e=>({assessmentName:e.key||"",filterValue:e.value,run:o||ss})))),[d,o]),[_,Y]=Ka(),R=(0,ie.useMemo)((()=>Ut(c.filter((e=>e.type===Te.ASSESSMENT)).map((e=>e.assessmentInfo)))),[c]),M=(0,ie.useMemo)((()=>Ms(x,A)),[x,A]),k=(0,ie.useMemo)((()=>x.flatMap((e=>{var s,t;return null!==(s=null===e||void 0===e||null===(t=e.traceInfo)||void 0===t?void 0:t.assessments)&&void 0!==s?s:[]}))),[x]);return(0,y.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:w.spacing.xs,overflow:"hidden",flexGrow:1},""),children:(0,y.Y)("div",{css:(0,p.AH)({display:"flex",gap:w.spacing.md,width:"100%",flex:1,overflowY:"hidden"},""),children:(0,y.Y)("div",{css:ji,children:(0,y.Y)(xe.Iw,{assessments:k,children:(0,y.Y)(Fa,{experimentId:s,selectedColumns:c,allColumns:h,evaluations:M,selectedEvaluationId:_,selectedAssessmentInfos:R,assessmentInfos:m,assessmentFilters:N,onChangeEvaluationId:Y,getRunColor:b,runUuid:a,compareToRunUuid:i,runDisplayName:o,compareToRunDisplayName:r,enableRowSelection:S,rowSelection:E,setRowSelection:T,toggleAssessmentFilter:C,tableSort:u,getTrace:g,onTraceTagsEdit:f,enableGrouping:!0,displayLoadingOverlay:I})})})})})})),qi="filter",Ki=()=>{const[e,s]=ce();return[(0,ie.useMemo)((()=>{var s;return(null!==(s=e.getAll(qi))&&void 0!==s?s:[]).reduce(((e,s)=>{const[t,n,o,a]=s.split("::");if(!t||!n||!o)return e;const i=n;let r=o;return t===Ce.ASSESSMENT&&(r=pe(o)),e.push({column:t,key:a,operator:i,value:r}),e}),[])}),[e]),(0,ie.useCallback)(((e,t=!1)=>{s((s=>(s.delete(qi),e&&e.forEach((e=>{let t=e.value;e.column===Ce.ASSESSMENT&&(t=ve(e.value)),s.append(qi,[e.column,e.operator,t,e.key].join("::"))})),s)),{replace:t})}),[s])]};var Gi=t(49633);const Wi=(e,s)=>s.filter((s=>!e.includes(s))).map((e=>e.id)),Qi=(e,s)=>{let t=((e,s)=>s.filter((s=>!e.includes(s.id))))(e,s);if(t.length>10){const e=t.filter((e=>e.type===Te.ASSESSMENT)),s=t.filter((e=>e.type!==Te.ASSESSMENT)),n=t.length-10,o=Math.max(0,e.length-n);t=[...s,...e.slice(0,o)]}return Wi(t,s)},Ji=(e,s,t,n)=>{const[o,a]=(0,Gi.Mj)({key:`genaiTracesUIState-columns-${e}-${n}`,version:1,initialValue:void 0}),i=(0,ie.useMemo)((()=>((e,s)=>Qi(s?Wi(s(e),e):[Le,Oe,De,Fe],e))(s,t)),[s,t]);return{hiddenColumns:(0,ie.useMemo)((()=>{const e=new Set(i);return null!==o&&void 0!==o&&o.columnOverrides?(Object.entries(o.columnOverrides).forEach((([s,t])=>{t?e.delete(s):e.add(s)})),[...e]):i}),[o,i]),toggleColumns:(0,ie.useCallback)((e=>{e.length&&a((s=>{var t;const n=null!==(t=null===s||void 0===s?void 0:s.columnOverrides)&&void 0!==t?t:{},o={...n};let a=!1;return e.forEach((e=>{const s=e.id in n?!n[e.id]:i.includes(e.id);o[e.id]!==s&&(o[e.id]=s,a=!0)})),a?{...s,columnOverrides:o}:s}))}),[a,i])}},Xi=(e,s,t,o)=>{const{hiddenColumns:a,toggleColumns:i}=Ji(e,s,t,o),r=(0,ie.useMemo)((()=>s.filter((e=>!a.includes(e.id)))),[s,a]),l=(0,ie.useCallback)((e=>{if((0,n.isNil)(e))return;const t=new Set(e.map((e=>e.id))),o=[];s.forEach((e=>{!a.includes(e.id)!==t.has(e.id)&&o.push(e)})),o.length&&i(o)}),[s,a,i]);return{selectedColumns:r,toggleColumns:i,setSelectedColumns:l}},Zi="mlflow.evaluations_review.table_ui.compare_to_run_combobox";const er=e=>({type:"MLFLOW_EXPERIMENT",mlflow_experiment:{experiment_id:e}});t(59930);var sr=t(19112);const tr='import mlflow\n\n@mlflow.trace\ndef chat_completion(message: str, user_id: str, session_id: str):\n    # Set these metadata keys to associate the trace to a user and session\n    mlflow.update_current_trace(\n        metadata={\n            "mlflow.trace.user": user_id,\n            "mlflow.trace.session": session_id,\n        }\n    )\n\n    # Replace with your chat logic\n    return "Your response here"\n\n# Depending on your setup, user and session IDs can be passed to your\n# server handler via the network request from your client applications,\n# or derived from some other request context. \nuser_id = "user-123"\nsession_id = "session-123"\n\nchat_completion("Hello, how are you?", user_id, session_id)';var nr={name:"1blwlv5",styles:"flex:1;flex-direction:column;display:flex;align-items:center;justify-content:center"},or={name:"xvginl",styles:"max-width:600px"},ar={name:"bjn8wh",styles:"position:relative"};const ir=()=>{const{theme:e}=(0,v.u)();return(0,y.FD)("div",{css:nr,children:[(0,y.Y)(v.T.Title,{level:3,color:"secondary",children:(0,y.Y)(f.sA,{id:"Qsifda",defaultMessage:"Group traces from the same chat session together"})}),(0,y.FD)(v.T.Paragraph,{color:"secondary",css:or,children:[(0,y.Y)(f.sA,{id:"hkXDZn",defaultMessage:"MLflow allows you associate traces with users and chat sessions. This is useful for analyzing multi-turn conversations, enabling you to inspect what happened at each step. Copy the code snippet below to generate a sample trace, or visit the documentation for a more in-depth example."}),(0,y.Y)(v.T.Link,{componentId:"mlflow.chat_sessions.empty_state.learn_more_link",css:(0,p.AH)({marginLeft:e.spacing.xs},""),href:"https://mlflow.org/docs/latest/genai/tracing/track-users-sessions/",openInNewTab:!0,children:(0,y.Y)(f.sA,{id:"h2Ejm7",defaultMessage:"Learn more"})})]}),(0,y.FD)("div",{css:ar,children:[(0,y.Y)(sr.VE,{componentId:"mlflow.chat_sessions.empty_state.example_code_copy",css:(0,p.AH)({position:"absolute",top:e.spacing.xs,right:e.spacing.xs},""),copyText:tr}),(0,y.Y)(sr.z7,{language:"python",showLineNumbers:!0,children:tr})]})]})},rr=e=>{var s,t,n,o;const{experimentId:a,selectedSessions:i,traceActions:r,setRowSelection:l}=e,d=(0,f.tz)(),[c,u]=(0,ie.useState)(!1),m=(0,ie.useCallback)((()=>{u(!0)}),[]),p=(0,ie.useMemo)((()=>{const e=[];return i.forEach((s=>{e.push(...s.traces)})),e.map((e=>({evaluationId:e.trace_id,requestId:e.client_request_id||e.trace_id,inputsId:e.trace_id,inputs:{},outputs:{},targets:{},overallAssessments:[],responseAssessmentsByName:{},metrics:{},traceInfo:e})))}),[i]),h=(0,ie.useCallback)((async(e,s)=>{try{var t,n;await(null===r||void 0===r||null===(t=r.deleteTracesAction)||void 0===t||null===(n=t.deleteTraces)||void 0===n?void 0:n.call(t,e,s)),null===l||void 0===l||l({}),u(!1);const o=d.formatMessage({id:"KsYAUn",defaultMessage:"{count, plural, one {Session} other {{count} sessions}} deleted successfully"},{count:i.length}),a=d.formatMessage({id:"3vS6G9",defaultMessage:"{count, plural, one {# trace was} other {# traces were}} removed"},{count:s.length});(0,xe.NH)(`${o}. ${a}.`)}catch(o){throw(0,xe.ij)(d.formatMessage({id:"qmTNy1",defaultMessage:"Failed to delete sessions. Error: {error}"},{error:o instanceof Error?o.message:String(o)})),o}}),[l,r,i.length,d]),b=Boolean(null===r||void 0===r?void 0:r.deleteTracesAction),S=0===i.length;if(!b)return null;const I=(0,y.Y)(v.B,{componentId:"mlflow.chat-sessions.actions-dropdown",endIcon:(0,y.Y)(g.ChevronDownIcon,{}),disabled:S||(null===r||void 0===r||null===(s=r.deleteTracesAction)||void 0===s?void 0:s.isDisabled),children:d.formatMessage({id:"MZNjYJ",defaultMessage:"Actions ({count})"},{count:i.length})});return(0,y.FD)(y.FK,{children:[(0,y.FD)(g.DropdownMenu.Root,{modal:!1,children:[(0,y.Y)(ye.T,{componentId:"mlflow.chat-sessions.actions-dropdown-tooltip",content:S?d.formatMessage({id:"ogDiio",defaultMessage:"Select at least one session to enable actions"}):null===r||void 0===r||null===(t=r.deleteTracesAction)||void 0===t?void 0:t.disabledReason,children:(0,y.Y)(g.DropdownMenu.Trigger,{asChild:!0,children:I})}),(0,y.Y)(g.DropdownMenu.Content,{align:"end",children:b&&(0,y.Y)(y.FK,{children:(0,y.Y)(g.DropdownMenu.Item,{componentId:"mlflow.chat-sessions.delete-sessions",onClick:m,disabled:null===r||void 0===r||null===(n=r.deleteTracesAction)||void 0===n?void 0:n.isDisabled,disabledReason:null===r||void 0===r||null===(o=r.deleteTracesAction)||void 0===o?void 0:o.disabledReason,children:d.formatMessage({id:"SnPghu",defaultMessage:"Delete sessions"})})})})]}),(0,y.Y)(Ie,{experimentIds:[a],visible:c,selectedTraces:p,handleClose:()=>u(!1),deleteTraces:h})]})},lr=({columns:e,columnVisibility:s,setColumnVisibility:t,searchQuery:n,setSearchQuery:o,traceActions:a,experimentId:i,selectedSessions:r,setRowSelection:l})=>{const{theme:d}=(0,v.u)(),c=(0,f.tz)();return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.sm},""),children:[(0,y.Y)(Oa,{searchQuery:n,setSearchQuery:o,placeholder:c.formatMessage({id:"W7HqWM",defaultMessage:"Search chat sessions by input"})}),(0,y.FD)(g.DialogCombobox,{componentId:"mlflow.chat-sessions.table-column-selector",label:(0,y.FD)("div",{css:(0,p.AH)({display:"flex",gap:d.spacing.sm,alignItems:"center"},""),children:[(0,y.Y)(g.ColumnsIcon,{}),(0,y.Y)(f.sA,{id:"RWVGkL",defaultMessage:"Columns"})]}),multiSelect:!0,children:[(0,y.Y)(g.DialogComboboxTrigger,{}),(0,y.Y)(g.DialogComboboxContent,{children:(0,y.Y)(g.DialogComboboxOptionList,{children:Object.entries(s).map((([n,o])=>{var a;return(0,y.Y)(g.DialogComboboxOptionListCheckboxItem,{value:n,onChange:()=>{const e={...s};e[n]=!o,t(e)},checked:o,children:null===(a=e.find((e=>e.id===n)))||void 0===a?void 0:a.header},n)}))})})]}),a&&(0,y.Y)(rr,{experimentId:i,selectedSessions:r,traceActions:a,setRowSelection:l})]})};var dr={name:"1bkbxg0",styles:"max-width:100%;overflow:hidden;cursor:pointer"};const cr=e=>{const{cell:s}=e,t=s.getValue();return(0,y.Y)(g.Tag,{componentId:"mlflow.genai-traces-table.session-tokens",children:t})},ur=(e,s)=>{const t=(e=>{const s={};return e.forEach((e=>{var t,n;const o=null===(t=e.trace_metadata)||void 0===t?void 0:t[xe.n2];if(!o)return;const a=null!==(n=s[o])&&void 0!==n?n:[];s[o]=[...a,e]})),s})(s);return(0,n.compact)(Object.entries(t).map((([s,t])=>{if(0===t.length)return null;const o=(0,n.sortBy)(t,(e=>new Date(e.request_time))),a=o[0],i=a.request_preview,r=o.reduce(((e,s)=>{var t;return e+(null!==(t=(0,xe.tI)(s))&&void 0!==t?t:0)}),0);return{sessionId:s,requestPreview:i,firstTrace:a,experimentId:e,sessionStartTime:Ws.formatTimestamp(new Date(a.request_time)),sessionDuration:mr(t),tokens:r,turns:o.length,traces:o}})))},mr=e=>{const s=e.map((e=>e.execution_duration));if(s.some((e=>(0,n.isNil)(e))))return null;const t=s.map((e=>parseFloat(null!==e&&void 0!==e?e:"0")));if(t.some((e=>isNaN(e))))return null;const o=1e3*t.reduce(((e,s)=>e+s),0);return Ws.formatDuration(o)};const pr=[{id:"sessionId",header:"Session ID",accessorKey:"sessionId",cell:({row:e})=>{const s=e.original.sessionId;return(0,y.Y)(g.Tag,{componentId:"mlflow.chat-sessions.session-id-tag",color:"indigo",css:dr,children:(0,y.Y)(v.T.Text,{ellipsis:!0,children:s})})},defaultVisibility:!0,enableSorting:!0,sortingFn:(e,s)=>e.original.sessionId.localeCompare(s.original.sessionId)},{id:"requestPreview",header:"Input",accessorKey:"requestPreview",defaultVisibility:!0},{id:"sessionStartTime",header:"Session start time",accessorKey:"sessionStartTime",defaultVisibility:!0,enableSorting:!0},{id:"sessionDuration",header:"Session duration",accessorKey:"sessionDuration",defaultVisibility:!0,enableSorting:!0},{id:"tokens",header:"Tokens",accessorKey:"tokens",defaultVisibility:!1,enableSorting:!0,cell:cr},{id:"turns",header:"Turns",accessorKey:"turns",defaultVisibility:!1,enableSorting:!0,cell:cr},{id:"source",header:"Source",cell:({row:e})=>{const s=e.original.firstTrace;return(0,y.Y)(ct,{traceInfo:s,isComparing:!1})},defaultVisibility:!1}];var gr={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"},vr={name:"1o3ovdg",styles:"display:flex;width:100%;height:100%;align-items:center;color:inherit;text-decoration:none"};const fr=ie.memo((({row:e,enableRowSelection:s})=>{const{search:t}=de(),{theme:n}=(0,v.u)();return(0,y.FD)(g.TableRow,{className:"eval-datasets-table-row",children:[s&&(0,y.Y)("div",{css:gr,children:(0,y.Y)(g.TableRowSelectCell,{componentId:"mlflow.chat-sessions.table-row-checkbox",checked:e.getIsSelected(),onChange:e.getToggleSelectedHandler(),onClick:e=>{e.stopPropagation()}})}),e.getVisibleCells().map((s=>(0,y.Y)(g.TableCell,{css:(0,p.AH)({backgroundColor:"transparent",flex:`calc(var(--col-${s.column.id}-size) / 100)`,display:"flex",flexDirection:"row",alignItems:"center","> span:first-of-type":{padding:`${n.spacing.xs}px 0px`,width:"100%"},..."actions"===s.column.id&&{paddingLeft:0,paddingRight:0}},""),children:(0,y.Y)(ue,{to:{pathname:Ws.getExperimentChatSessionPageRoute(e.original.experimentId,e.original.sessionId),search:t},css:vr,children:(0,oo.Kv)(s.column.columnDef.cell,s.getContext())})},s.id)))]},e.id)}),(()=>!1));var hr={name:"1t0jp0z",styles:"display:flex;overflow:hidden;flex-shrink:0"};const yr=({experimentId:e,traces:s,isLoading:t,searchQuery:n,setSearchQuery:o,traceActions:a})=>{const{theme:i}=(0,v.u)(),r=(0,ie.useMemo)((()=>ur(e,s)),[e,s]),[l,d]=(0,ie.useState)([{id:"sessionStartTime",desc:!0}]),[c,u]=(0,ie.useState)({}),{columnVisibility:m,setColumnVisibility:f}=(({experimentId:e,columns:s})=>{const t=(0,ie.useMemo)((()=>s.reduce(((e,s)=>(e[s.id]=s.defaultVisibility,e)),{})),[s]),[n,o]=(0,Gi.Mj)({key:`experiment-chat-sessions-table-column-visibility-${e}`,version:1,initialValue:t});return{columnVisibility:n,setColumnVisibility:o}})({experimentId:e,columns:pr}),h=Boolean(a),b=(0,Fs.S)({data:r,columns:pr,getCoreRowModel:(0,ks.HT)(),getSortedRowModel:(0,ks.h5)(),onSortingChange:d,enableColumnResizing:!0,columnResizeMode:"onChange",enableRowSelection:h,onRowSelectionChange:u,getRowId:e=>e.sessionId,state:{sorting:l,columnVisibility:m,rowSelection:c}}),S=b.getState().columnSizingInfo,I=ie.useMemo((()=>{const e=b.getFlatHeaders(),s={};for(const t of e)s[`--col-${t.column.id}-size`]=t.column.getSize();return s}),[S,b,m]),w=(0,ie.useMemo)((()=>b.getSelectedRowModel().rows.map((e=>e.original))),[c]);return(0,y.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,position:"relative",marginTop:i.spacing.sm},""),children:[(0,y.Y)(lr,{columns:pr,columnVisibility:m,setColumnVisibility:f,searchQuery:n,setSearchQuery:o,traceActions:a,experimentId:e,selectedSessions:w,setRowSelection:u}),(0,y.FD)(g.Table,{style:{...I},empty:t||0!==r.length?void 0:(0,y.Y)(ir,{}),scrollable:!0,someRowsSelected:h?b.getIsAllRowsSelected()||b.getIsSomeRowsSelected():void 0,children:[(0,y.FD)(g.TableRow,{isHeader:!0,children:[h&&(0,y.Y)("div",{css:hr,children:(0,y.Y)(g.TableRowSelectCell,{componentId:"mlflow.chat-sessions.table-header-checkbox",checked:b.getIsAllRowsSelected(),indeterminate:b.getIsSomeRowsSelected(),onChange:b.getToggleAllRowsSelectedHandler()})}),b.getLeafHeaders().map((e=>(0,y.Y)(g.TableHeader,{componentId:"mlflow.chat-sessions.table-header",header:e,column:e.column,sortable:e.column.getCanSort(),css:(0,p.AH)({cursor:e.column.getCanSort()?"pointer":"default",flex:`calc(var(--col-${e.id}-size) / 100)`},""),sortDirection:e.column.getIsSorted()||"none",onToggleSort:e.column.getToggleSortingHandler(),children:(0,oo.Kv)(e.column.columnDef.header,e.getContext())},e.id)))]}),!t&&b.getRowModel().rows.map((e=>(0,y.Y)(fr,{row:e,enableRowSelection:h},e.id))),t&&(0,y.Y)(g.TableSkeletonRows,{table:b})]})]})};var br=t(39595);const Sr="getTrace";function Ir(e,s){const t=(0,br.jE)(),o=(0,ii.E)({queries:(null!==s&&void 0!==s?s:[]).map((s=>{const t=function(e){var s;return(0,xe.gD)(e)?e.trace_id:null!==(s=e.request_id)&&void 0!==s?s:""}(s);return{queryKey:[Sr,t],queryFn:async()=>null===e||void 0===e?void 0:e(t,s),enabled:!(0,n.isNil)(e)&&Boolean(t),refetchOnWindowFocus:!1,retry:1,keepPreviousData:!0}}))});return{data:function(e){const s=(0,ie.useRef)(),t=!(!s.current||e.length!==s.current.length)&&e.every(((e,t)=>{var n;return e===(null===(n=s.current)||void 0===n?void 0:n[t])}));return t||(s.current=e),t&&s.current?s.current:e}((0,n.compact)(o.map((e=>e.data)))),isLoading:o.some((e=>e.isLoading)),invalidateSingleTraceQuery:(0,ie.useCallback)((e=>{t.invalidateQueries({queryKey:[Sr,e]})}),[t])}}}}]);