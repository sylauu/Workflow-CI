"use strict";(self.webpackChunk_mlflow_mlflow=self.webpackChunk_mlflow_mlflow||[]).push([[8867],{16333:function(e,t,n){n.d(t,{Ld:function(){return r.L},ad:function(){return s.a}});n(37750);var s=n(44072),r=n(38815)},21636:function(e,t,n){n.d(t,{Bt:function(){return r},E3:function(){return u},Ex:function(){return a},Uu:function(){return c},Vg:function(){return i},gK:function(){return o},kj:function(){return s},n2:function(){return d},zZ:function(){return l}});const s="yellow500",r="yellow200",a="mlflow.trace.sourceScorer",i="mlflow.assessment.sourceRunId",o="mlflow.assessment.scorerTraceId",l="mlflow.assessment.judgeCost",d="mlflow.trace.session",c="mlflow.trace.tokenUsage",u="mlflow.trace.user"},27882:function(e,t,n){n.d(t,{F9:function(){return a},T9:function(){return r},aZ:function(){return i},ny:function(){return s}});const s=()=>!1,r=()=>1e9,a=()=>!1,i=()=>!0},31988:function(e,t,n){n.d(t,{u:function(){return i}});var s=n(27757),r=n(27299),a=n(73408);function i(e){return(0,a.Y)(s.B,{icon:(0,a.Y)(r.TrashIcon,{}),...e})}},42747:function(e,t,n){n.d(t,{sA:function(){return s.sA},tz:function(){return s.tz},zR:function(){return s.zR}});var s=n(77680);n(13584)},44072:function(e,t,n){n.d(t,{a:function(){return o}});n(46709);var s=n(27757),r=n(79081),a=n(38815),i=n(73408);function o({buttonProps:e,componentId:t,copyText:n,copyTooltip:o,isInsideInputGroup:l=!1,onCopy:d,tooltipProps:c}){const{actionIcon:u,copy:p,handleTooltipOpenChange:m,tooltipOpen:h,tooltipMessage:g}=(0,a.L)(n,o,d),f=(0,i.Y)(s.B,{"aria-label":g,componentId:null!==t&&void 0!==t?t:"codegen_web-shared_src_copy_copyactionbutton.tsx_17",icon:u,onClick:p,size:"small",...e}),v=(0,i.Y)(s.B,{"aria-label":g,componentId:null!==t&&void 0!==t?t:"codegen_web-shared_src_copy_copyactionbutton.tsx_17",onClick:p,...e,children:u});return(0,i.Y)(r.T,{componentId:t?`${t}-tooltip`:"codegen_web-shared_src_copy_copyactionbutton.tsx_17-tooltip",content:g,onOpenChange:m,open:h,...c,children:l?v:f})}},45175:function(e,t,n){n.d(t,{V:function(){return i}});var s=n(68248),r=n(27757),a=n(73408);function i({children:e}){const{theme:t}=(0,r.u)();return(0,a.Y)("div",{css:(0,s.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e})}},49633:function(e,t,n){n.d(t,{Mj:function(){return o.Mj},Ub:function(){return a},wY:function(){return i.w}});var s=n(46709),r=n(69103);function a(e){return function(e){return(0,r.useSyncExternalStore)(s.useCallback((t=>(e.addEventListener("change",t),()=>{e.removeEventListener("change",t)})),[e]),(()=>e.matches))}(s.useMemo((()=>window.matchMedia(e)),[e]))}var i=n(27925),o=n(53637)},55215:function(e,t,n){n.d(t,{Iw:function(){return Ft},SH:function(){return en.S},a8:function(){return Es},Xb:function(){return dt},l5:function(){return kt},Fn:function(){return Gs},VZ:function(){return m.VZ},n2:function(){return g.n2},U2:function(){return Ks},r_:function(){return rr},y8:function(){return Zs},Uu:function(){return g.Uu},_A:function(){return Te},ij:function(){return i.ij},NH:function(){return i.NH},ed:function(){return Ct.e},MF:function(){return i.MF},cp:function(){return i.cp},tI:function(){return i.tI},gD:function(){return i.gD},UZ:function(){return i.UZ},aZ:function(){return a.aZ},F9:function(){return a.F9},xD:function(){return i.xD},BR:function(){return Qs}});var s=n(46709),r=n(89949),a=n(27882),i=n(86125),o=n(27299),l=n(27757),d=n(42747),c=n(73408);const u=()=>(0,c.Y)(o.Empty,{title:(0,c.Y)(d.sA,{id:"rjhiii",defaultMessage:"Trace failed to render"}),description:(0,c.Y)(d.sA,{id:"1a1+j5",defaultMessage:"Unfortunately, the trace could not be rendered due to an unknown error. You can reload the page to try again. If the problem persists, please contact support."}),image:(0,c.Y)(l.k,{})});var p=n(68248),m=n(94664),h=n(76118),g=n(21636);const f=({searchFilter:e,data:t,activeMatch:n,containsActiveMatch:r})=>{const{theme:a}=(0,l.u)(),o=(0,s.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),d=(0,s.useMemo)((()=>e?(0,i.OS)({data:t,searchFilter:e,activeMatchBackgroundColor:a.colors[g.kj],inactiveMatchBackgroundColor:a.colors[g.Bt],containsActiveMatch:r,activeMatch:n,scrollToActiveMatch:o}):[]),[e,t,a,r,n,o]);return(0,c.Y)("pre",{css:(0,p.AH)({whiteSpace:"pre-wrap",backgroundColor:a.colors.backgroundSecondary,padding:a.spacing.sm,fontSize:a.typography.fontSizeSm},""),children:d})};var v=n(87562),x=n(22534),y=n(19112),b=n(20027);var Y={name:"1qmr6ab",styles:"overflow:auto"},A={name:"uufhp1",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%;z-index:0"};const T=({children:e})=>(0,c.Y)("div",{"data-testid":"basic-table",css:Y,children:(0,c.Y)(o.Table,{scrollable:!0,css:A,children:e})}),w=({children:e,node:t})=>{const{header:n,rows:r,isValid:a}=function({children:e}){var t;if(!e)return{header:void 0,rows:[],isValid:!1};const n=s.Children.toArray(e);return{header:null!==(t=n[0])&&void 0!==t?t:void 0,rows:n.slice(1).flatMap((e=>s.isValidElement(e)?s.Children.toArray(e.props.children).filter((e=>s.isValidElement(e))):[])),isValid:!0}}({children:e,node:t});return a?(0,c.Y)(M,{header:n,rows:r}):(0,c.Y)(T,{children:e,node:t})};var S={name:"qneu98",styles:"height:auto;min-height:initial;display:inline-flex;min-width:100%"};const M=({header:e,rows:t})=>{const{theme:n}=(0,l.u)(),r=s.useRef(null),a=(0,b.z)({size:t.length,parentRef:r,overscan:20}),{virtualItems:i,totalSize:d}=a;return(0,c.Y)("div",{"data-testid":"virtualized-table",ref:r,css:(0,p.AH)({overflow:"auto",maxHeight:420,border:"1px solid",borderColor:n.colors.border,borderRadius:n.borders.borderRadiusMd,marginBottom:n.spacing.md,zIndex:0},""),children:(0,c.FD)(o.Table,{css:S,children:[e,(0,c.Y)("div",{css:(0,p.AH)({position:"relative",height:`${d}px`,width:"100%",'& > div:last-child [role="cell"]':{borderBottom:"none"}},""),children:i.map((e=>{const n=e.index,s=t[n];return(0,c.Y)("div",{ref:e.measureRef,css:(0,p.AH)({position:"absolute",top:`${e.start}px`,width:"100%"},""),children:s},n)}))})]})})},I=({children:e,node:t})=>{const n=null===t||void 0===t?void 0:t.children.some((e=>"th"===e.tagName)),{theme:s}=(0,l.u)();return(0,c.Y)(o.TableRow,{style:n?{position:"sticky",top:0,zIndex:1,backgroundColor:s.colors.backgroundPrimary}:void 0,children:e,isHeader:n})},k=({children:e,node:t})=>{const n="th"===(null===t||void 0===t?void 0:t.tagName),{theme:s}=(0,l.u)();return n?(0,c.Y)(o.TableHeader,{"data-testid":"virtualized-table-header",componentId:"virtualized-table-header",css:(0,p.AH)({paddingLeft:s.spacing.sm,borderColor:s.colors.border,color:s.colors.textPrimary},""),children:e}):(0,c.Y)(o.TableCell,{children:e})};const D=e=>e.startsWith("data:image/png")||e.startsWith("data:image/jpeg")?e:(0,v.Lv)(e),C=e=>{const t=(0,s.useMemo)((()=>L({extensions:e.components})),[e.components]);return(0,c.Y)(v.oz,{components:t,remarkPlugins:R,urlTransform:D,children:e.children})},N=({codeBlock:e,codeInline:t,node:n,...r})=>{var a,i;const o=s.useMemo((()=>{var e;const t=/language-(\w+)/.exec(null!==(e=r.className)&&void 0!==e?e:"");return t&&t[1]?t[1]:void 0}),[r.className]);return(null===n||void 0===n||null===(a=n.position)||void 0===a?void 0:a.start.line)===(null===n||void 0===n||null===(i=n.position)||void 0===i?void 0:i.end.line)?s.createElement(t,r):s.createElement(e,{...r,language:o})},F=({children:e})=>(0,c.Y)(l.T.Text,{code:!0,children:e});var E={name:"bjn8wh",styles:"position:relative"};const H=s.memo((({children:e,language:t})=>{const{theme:n}=(0,l.u)(),s=String(e).replace(/\n$/,"");return(0,c.Y)("div",{css:E,children:(0,c.Y)(y.z7,{actions:(0,c.Y)(y.VE,{componentId:"genai.util.markdown-copy-code-block",copyText:s}),theme:n.isDarkMode?"duotoneDark":"light",children:s,language:t&&O(t)?t:"text",style:{padding:"8px 0",borderRadius:8,width:"100%",boxSizing:"border-box",maxHeight:640,display:"flex",flexDirection:"column-reverse"},showLineNumbers:!0})})})),R=[x.A];var _={name:"qhxz92",styles:"max-width:100%"};const L=e=>({a:({href:e,children:t})=>(0,c.Y)(l.T.Link,{componentId:"codegen_webapp_js_genai_util_markdown.tsx_71",href:e,id:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?e.replace("#user-content-fn-","user-content-fnref-"):void 0,disabled:null===e||void 0===e?void 0:e.startsWith("."),children:null!==e&&void 0!==e&&e.startsWith("#user-content-fn-")?(0,c.FD)(c.FK,{children:["[",t,"]"]}):t,openInNewTab:!(e&&e.startsWith("#"))}),code:t=>{var n,s,r,a;return(0,c.Y)(N,{...t,codeBlock:null!==(n=null===(s=e.extensions)||void 0===s?void 0:s.codeBlock)&&void 0!==n?n:H,codeInline:null!==(r=null===(a=e.extensions)||void 0===a?void 0:a.codeInline)&&void 0!==r?r:F})},p:({children:e})=>(0,c.Y)(l.T.Paragraph,{children:e}),h1:({children:e})=>(0,c.Y)(l.T.Title,{level:1,children:e}),h2:({children:e})=>(0,c.Y)(l.T.Title,{level:2,children:e}),h3:({children:e})=>(0,c.Y)(l.T.Title,{level:3,children:e}),h4:({children:e})=>(0,c.Y)(l.T.Title,{level:4,children:e}),h5:({children:e})=>(0,c.Y)(l.T.Title,{level:5,children:e}),table:({children:e,node:t})=>(0,c.Y)(w,{children:e,node:t}),tr:({children:e,node:t})=>(0,c.Y)(I,{children:e,node:t}),th:({children:e,node:t})=>(0,c.Y)(k,{children:e,node:t}),td:({children:e})=>(0,c.Y)(o.TableCell,{children:e,multiline:!0}),thead:({children:e})=>(0,c.Y)(c.FK,{children:e}),tbody:({children:e})=>(0,c.Y)(c.FK,{children:e}),img:({src:e,alt:t})=>(0,c.Y)("img",{src:e,alt:t,css:_})}),O=e=>{switch(e){case"go":case"java":case"javascript":case"json":case"python":case"sql":case"text":case"yaml":return!0;default:return!1}};const B=4,$=300;var j={name:"bjn8wh",styles:"position:relative"},V={name:"n31mhe",styles:"width:100%;padding:0"};function z({data:e,searchFilter:t="",activeMatch:n=null,containsActiveMatch:r=!1,renderMode:a=m.cC.JSON,initialExpanded:i=!1}){const u=Boolean(t)&&!(0,h.isNil)(n)&&e.toLowerCase().includes(t),{theme:g}=(0,l.u)(),[v,x]=(0,s.useState)("json"===a),[b,Y]=(0,s.useState)(i||u),A=(0,s.useRef)(null),T=(0,s.useMemo)((()=>{if("json"===a)return e;const t=JSON.parse(e);return(0,h.isString)(t)?t:e}),[e,a]),w=v||T.split("\n").length>B||T.length>$,S=(0,s.useMemo)((()=>{if(w&&!b){const e=T.split("\n").slice(0,B).join("\n");return e.length>$?e.slice(0,$):e}return T}),[T,w,b]);(0,s.useEffect)((()=>{A.current&&x(A.current.scrollWidth>A.current.clientWidth)}),[a,e]);const M=(0,s.useCallback)((e=>(0,c.Y)("pre",{...e,ref:A})),[]);return u?(0,c.Y)(f,{data:e,searchFilter:t,activeMatch:n,containsActiveMatch:!n.isKeyMatch&&r}):(0,c.FD)("div",{css:j,children:["markdown"===a?(0,c.Y)("div",{css:(0,p.AH)({padding:g.spacing.md,backgroundColor:g.colors.backgroundSecondary,marginBottom:-g.spacing.md},""),children:(0,c.Y)(C,{children:S})}):(0,c.FD)(c.FK,{children:[(0,c.Y)(y.VE,{componentId:"shared.model-trace-explorer.copy-snippet",copyText:e,size:"small",css:(0,p.AH)({position:"absolute",top:g.spacing.xs,right:g.spacing.xs,zIndex:1},"")},"copy-snippet"),(0,c.Y)(y.z7,{PreTag:M,showLineNumbers:!0,language:a,lineProps:{style:{wordBreak:"break-word",whiteSpace:"pre-wrap"}},wrapLines:b,theme:g.isDarkMode?"duotoneDark":"light",style:{backgroundColor:g.colors.backgroundSecondary,padding:g.spacing.sm,paddingBottom:w?0:g.spacing.sm,paddingRight:2*g.spacing.md,overflow:b?"auto":"hidden",textOverflow:"ellipsis",fontSize:g.typography.fontSizeSm,lineHeight:g.typography.lineHeightBase},children:S})]}),w&&(0,c.Y)("div",{css:(0,p.AH)({backgroundColor:g.colors.backgroundSecondary},""),children:(0,c.Y)(l.B,{css:V,componentId:b?"shared.model-trace-explorer.snippet-see-less":"shared.model-trace-explorer.snippet-see-more",icon:b?(0,c.Y)(o.ChevronUpIcon,{}):(0,c.Y)(o.ChevronDownIcon,{}),type:"tertiary",onClick:()=>Y(!b),children:b?(0,c.Y)(d.sA,{id:"AgjhWE",defaultMessage:"See less"}):(0,c.Y)(d.sA,{id:"HYQHVk",defaultMessage:"See more"})})})]})}const P=e=>JSON.stringify(`import mlflow\n\n# returns an MLflow Trace object\ntrace = mlflow.get_trace('${e}')\n\n# trace.info contains tags and metadata\ntrace_info = trace.info\n\n# the trace's spans are stored in trace.data\nspans = trace.data.spans`);var K={name:"b9l38d",styles:"width:min-content"};const W=({traceId:e,setForceDisplay:t})=>{const{theme:n}=(0,l.u)();return(0,c.Y)(o.Empty,{image:(0,c.Y)(l.W,{}),title:(0,c.Y)(d.sA,{id:"4Itm9y",defaultMessage:"Large trace"}),description:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.md,alignItems:"center"},""),children:[(0,c.Y)(d.sA,{id:"TvjS47",defaultMessage:"This trace is very large, and may cause UI slowness when attempting to render. You can click the button below to attempt to display it anyway."}),(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.trace-too-large.force-display-button",css:K,onClick:()=>t(!0),children:(0,c.Y)(d.sA,{id:"rFJSWc",defaultMessage:"Attempt to display"})}),(0,c.Y)("span",{children:(0,c.Y)(d.sA,{id:"1Buj/Q",defaultMessage:"Alternatively, you can interact with this trace via the MLflow Python SDK, using the {code} function. For more information, please check the {documentation_link}.",values:{code:(0,c.Y)(l.T.Text,{code:!0,children:"mlflow.get_trace()"}),documentation_link:(0,c.Y)(l.T.Link,{href:"https://mlflow.org/docs/latest/api_reference/python_api/mlflow.entities.html#mlflow.entities.Trace",target:"_blank",openInNewTab:!0,componentId:"shared.model-trace-explorer.trace-too-large.documentation-link",children:(0,c.Y)(d.sA,{id:"7RNlsx",defaultMessage:"MLflow API documentation"})})}})}),(0,c.Y)(z,{data:P(e),renderMode:m.cC.PYTHON,initialExpanded:!0})]})})};var U=n(81390);const G=(0,s.createContext)({rootNode:null,nodeMap:{},activeView:"summary",setActiveView:()=>{},selectedNode:void 0,setSelectedNode:()=>{},activeTab:"content",setActiveTab:()=>{},showTimelineTreeGantt:!1,setShowTimelineTreeGantt:()=>{},assessmentsPaneExpanded:!1,setAssessmentsPaneExpanded:()=>{},isTraceInitialLoading:!1,assessmentsPaneEnabled:!0,isInComparisonView:!1}),J=()=>(0,s.useContext)(G),q=({modelTrace:e,initialActiveView:t,selectedSpanIdOnRender:n,assessmentsPaneEnabled:r,initialAssessmentsPaneCollapsed:a,isTraceInitialLoading:o=!1,isInComparisonView:l=!1,children:d})=>{var u,p,m;const g=(0,s.useMemo)((()=>(0,i.jW)(e)),[e]),f=(0,s.useMemo)((()=>g?(0,U.dM)([g]):{}),[g]),v=(0,i.f7)(g,n),x=null!==(u=null!==v&&void 0!==v?v:g)&&void 0!==u?u:void 0,y=(null!==(p=null===x||void 0===x||null===(m=x.assessments)||void 0===m?void 0:m.length)&&void 0!==p?p:0)>0,b=!(0,h.isNil)(null===g||void 0===g?void 0:g.inputs)||!(0,h.isNil)(null===g||void 0===g?void 0:g.outputs),[Y,A]=(0,s.useState)(null!==t&&void 0!==t?t:b?"summary":"detail"),[T,w]=(0,s.useState)(x),S=(0,i.pQ)(T),[M,I]=(0,s.useState)(S),[k,D]=(0,s.useState)(!1),[C,N]=(0,s.useState)(!a&&y||"force-open"===a);(0,s.useEffect)((()=>{const e=(0,i.pQ)(T);I(e)}),[T]);const F=(0,s.useMemo)((()=>({rootNode:g,nodeMap:f,activeView:Y,setActiveView:A,activeTab:M,setActiveTab:I,selectedNode:T,setSelectedNode:w,showTimelineTreeGantt:k,setShowTimelineTreeGantt:D,assessmentsPaneExpanded:C,setAssessmentsPaneExpanded:N,assessmentsPaneEnabled:r,isTraceInitialLoading:o,isInComparisonView:l})),[Y,f,M,g,T,k,D,C,N,r,o,l]);return(0,c.Y)(G.Provider,{value:F,children:d})};var X=n(66916),Q=n(79081);var Z={name:"e0dnmk",styles:"cursor:pointer"};const ee=({label:e,value:t,displayValue:n=t,icon:s,color:r,getTruncatedLabel:a,onCopy:i})=>{const{theme:d}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:d.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:e}),(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.header-details.tooltip",content:t,maxWidth:400,children:(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",color:r,onClick:()=>{navigator.clipboard.writeText(t),i()},css:Z,children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:d.spacing.xs},""),children:[s&&(0,c.Y)("span",{children:s}),(0,c.Y)("span",{children:a(n)})]})})})]})},te="mlflow.",ne=e=>{try{return JSON.parse(e)}catch(t){return}},se=(e,t)=>{const n=(0,h.truncate)(e,{length:t});return(0,h.takeWhile)(n,(e=>"\n"!==e)).join("")};var re={name:"dgkyot",styles:"cursor:default;width:fit-content;max-width:100%"},ae={name:"j601fv",styles:"flex-basis:45%;flex-shrink:0"},ie={name:"1sdjnkx",styles:"word-break:break-word"};const oe=({traceMetadata:e,getTruncatedLabel:t=e=>se(e,40)})=>{const{theme:n}=(0,l.u)(),r=e=>{if(e&&"object"===typeof e)try{return JSON.stringify(e)}catch{return String(e)}if("string"===typeof e){const t=ne(e);if(t&&"object"===typeof t)try{return JSON.stringify(t)}catch{return e}return e}return String(null!==e&&void 0!==e?e:"")},a=(0,s.useMemo)((()=>Object.entries(e||{}).filter((([e,t])=>null!==t&&""!==t&&!e.startsWith(te))).sort((([e],[t])=>e.localeCompare(t))).map((([e,t])=>({key:e,value:t,displayValue:r(t)})))),[e]);return 0===a.length?null:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:n.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"zRKlAL",defaultMessage:"Metadata"})}),(0,c.Y)(o.Overflow,{noMargin:!0,children:(0,c.Y)(o.HoverCard,{trigger:(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.header-metadata-pill",color:"default",css:re,children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:n.spacing.xs},""),children:[(0,c.Y)(Q.L,{css:(0,p.AH)({fontSize:12,color:n.colors.textSecondary},"")}),(0,c.Y)("span",{children:a.length})]})}),content:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.xs,maxWidth:480,maxHeight:320,overflowY:"auto"},""),children:[a.slice(0,100).map((({key:e,displayValue:s,value:r})=>(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"flex-start",gap:n.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{css:ae,children:t(e)}),(0,c.Y)(l.T.Text,{color:"secondary",css:ie,children:s})]},`${e}:${r}`))),a.length>100&&(0,c.FD)(l.T.Text,{color:"secondary",children:["+",a.length-100," more"]})]})})})]})};var le=n(44105),de=n(52489),ce=n(110);var ue={name:"mqlsmr",styles:"font-size:12px;display:flex"},pe={name:"rnnx2x",styles:"font-size:12px"};const me=({experimentId:e,sessionId:t,traceId:n,handleCopy:r})=>{const{theme:a}=(0,l.u)(),i=(0,ce.zy)(),u=t.length>10?`${t.slice(0,10)}...`:t,m=(0,s.useCallback)((e=>e.length>10?`${e.slice(0,10)}...`:e),[]),h=(0,de.e)(e,t),g=n?`${h}?${new URLSearchParams({[le.hb]:n}).toString()}`:h;return i.pathname.includes(`/chat-sessions/${t}`)?(0,c.Y)(ee,{label:(0,c.Y)(d.sA,{id:"XIWwOm",defaultMessage:"Session ID"}),icon:(0,c.Y)(o.SpeechBubbleIcon,{css:ue}),value:t,color:"default",getTruncatedLabel:m,onCopy:r}):(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:a.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"XIWwOm",defaultMessage:"Session ID"})}),(0,c.Y)(Q.T,{componentId:"mlflow.model-trace-explorer.session-id-tag",content:(0,c.Y)(d.sA,{id:"OUPWd8",defaultMessage:"View chat session"}),children:(0,c.Y)(ce.N_,{to:g,children:(0,c.Y)(o.Tag,{componentId:"mlflow.model_trace_explorer.header_details.tag-session-id",children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",gap:a.spacing.xs},""),children:[(0,c.Y)(o.SpeechBubbleIcon,{css:pe}),(0,c.Y)("span",{children:u})]})})})})]})};var he={name:"7z0gr8",styles:"font-size:12px;display:flex;align-items:center;justify-content:center"},ge={name:"mqlsmr",styles:"font-size:12px;display:flex"},fe={name:"e0dnmk",styles:"cursor:pointer"};const ve=({modelTraceInfo:e})=>{var t;const{theme:n}=(0,l.u)(),[r,a]=(0,s.useState)(!1),{rootNode:u}=J(),{experimentId:m}=(0,ce.g)(),h=Object.entries(null!==(t=e.tags)&&void 0!==t?t:{}).filter((([e])=>{return!(t=e).startsWith(te)&&!t.startsWith("_mlflow_");var t})),[f,v]=(0,s.useMemo)((()=>{var t;return(0,i.ko)(e)&&(0,i.gD)(e)?[(0,i.vX)(e),e.trace_id]:[(0,i.gD)(e)?e.trace_id:null!==(t=e.request_id)&&void 0!==t?t:""]}),[e]),x=(0,s.useMemo)((()=>{var t,n;return ne(null!==(t=null===e||void 0===e||null===(n=e.trace_metadata)||void 0===n?void 0:n[g.Uu])&&void 0!==t?t:"{}")}),[e]),y=(0,s.useMemo)((()=>null===x||void 0===x?void 0:x.total_tokens),[x]),b=(0,s.useMemo)((()=>{var t;return null===e||void 0===e||null===(t=e.trace_metadata)||void 0===t?void 0:t[g.n2]}),[e]),Y=(0,s.useMemo)((()=>{var t;return null===e||void 0===e||null===(t=e.trace_metadata)||void 0===t?void 0:t[g.E3]}),[e]),A=(0,s.useMemo)((()=>{if(u)return(0,U.X6)(u.end-u.start)}),[u]),T=e=>se(e,40),w=(0,s.useCallback)((()=>{a(!0),setTimeout((()=>a(!1)),2e3)}),[]);return(0,c.FD)("div",{css:(0,p.AH)({paddingLeft:n.spacing.md,paddingBottom:n.spacing.sm},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:n.spacing.md,rowGap:n.spacing.sm,flexWrap:"wrap"},""),children:[f&&(0,c.Y)(ee,{label:(0,c.Y)(d.sA,{id:"imKpxw",defaultMessage:"ID"}),value:f,displayValue:v,color:"purple",getTruncatedLabel:T,onCopy:w}),y&&(0,c.Y)(ee,{label:(0,c.Y)(d.sA,{id:"zp4MBw",defaultMessage:"Token count"}),value:y.toString(),getTruncatedLabel:T,onCopy:w}),A&&(0,c.Y)(ee,{label:(0,c.Y)(d.sA,{id:"K1JLVU",defaultMessage:"Latency"}),icon:(0,c.Y)(X.C,{css:he}),value:A,getTruncatedLabel:T,onCopy:w}),b&&m&&(0,c.Y)(me,{handleCopy:w,experimentId:m,sessionId:b,traceId:f}),Y&&(0,c.Y)(ee,{label:(0,c.Y)(d.sA,{id:"128VYg",defaultMessage:"User"}),icon:(0,c.Y)(o.UserIcon,{css:ge}),value:Y,color:"default",getTruncatedLabel:T,onCopy:w}),(0,c.Y)(oe,{traceMetadata:null===e||void 0===e?void 0:e.trace_metadata,getTruncatedLabel:T}),h.length>0&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"row",gap:n.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{size:"md",color:"secondary",children:(0,c.Y)(d.sA,{id:"7KPJii",defaultMessage:"Tags"})}),(0,c.Y)(o.Overflow,{noMargin:!0,children:h.map((([e,t])=>{const n=`${e}: ${t}`;return(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.header-details.tooltip",content:n,children:(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.header-details.tag",onClick:()=>{var e;e=n,navigator.clipboard.writeText(e),w()},css:fe,children:T(`${e}: ${t}`)})},e)}))})]})]}),r&&(0,c.FD)(o.Notification.Provider,{children:[(0,c.Y)(o.Notification.Root,{severity:"success",componentId:"mlflow.model_trace_explorer.header_details.notification",children:(0,c.Y)(o.Notification.Title,{children:(0,c.Y)(d.sA,{id:"xgypqc",defaultMessage:"Copied to clipboard"})})}),(0,c.Y)(o.Notification.Viewport,{})]})]})};var xe=n(49708),ye=n(59930),be=n.n(ye),Ye=n(33120);const Ae=({payload:e})=>(0,Ye.ff)((0,Ye.we)(`ajax-api/3.0/mlflow/traces/${e.assessment.trace_id}/assessments`),"POST",e),Te={searchTracesV4:async({signal:e,orderBy:t,locations:n,filter:s})=>{var r;const a={locations:n,filter:s,max_results:1e3,order_by:t},i=await(0,Ye.ff)((0,Ye.we)("ajax-api/4.0/mlflow/traces/search"),"POST",a,e);return null!==(r=null===i||void 0===i?void 0:i.trace_infos)&&void 0!==r?r:[]},getBatchTracesV4:async({traceIds:e,traceLocation:t})=>{const n=(0,h.isString)(t)?t:(0,i.nr)(t),s=(0,Ye.we)(`ajax-api/4.0/mlflow/traces/${n}/batchGet`),r=new URLSearchParams;for(const i of e)r.append("trace_ids",i);const a=`${s}?${r.toString()}`;return await(0,Ye.ff)(a,"GET")},getTraceInfoV4:({traceId:e,traceLocation:t})=>{const n=(0,h.isString)(t)?t:(0,i.nr)(t),s=`${(0,Ye.we)(`ajax-api/4.0/mlflow/traces/${n}/${e}/info`)}?${(new URLSearchParams).toString()}`;return(0,Ye.ff)(s)},createAssessmentV4:({payload:{assessment:e},traceLocation:t})=>{be()(t,"Trace location is required for creating assessment via V4 API");const n=(0,h.isString)(t)?t:(0,i.nr)(t);be()(n,"Trace location could not be resolved");const s=e,r=new URLSearchParams,a=`${(0,Ye.we)(`ajax-api/4.0/mlflow/traces/${n}/${e.trace_id}/assessments`)}?${r.toString()}`;return(0,Ye.ff)(a,"POST",s)},updateAssessmentV4:({traceId:e,assessmentId:t,payload:n,traceLocation:s})=>{const{assessment:r,update_mask:a}=n;be()(s,"Trace location is required for creating assessment via V4 API");const o=(0,h.isString)(s)?s:(0,i.nr)(s);be()(o,"Trace location could not be resolved");const l=new URLSearchParams;l.append("update_mask",a);const d=`${(0,Ye.we)(`ajax-api/4.0/mlflow/traces/${o}/${e}/assessments/${t}`)}?${l.toString()}`;return(0,Ye.ff)(d,"PATCH",r)},deleteAssessmentV4:({traceId:e,sqlWarehouseId:t,assessmentId:n,traceLocation:s})=>{const r=new URLSearchParams,a=(0,i.nr)(s),o=`${(0,Ye.we)(`ajax-api/4.0/mlflow/traces/${a}/${e}/assessments/${n}`)}?${r.toString()}`;return(0,Ye.ff)(o,"DELETE")},setTraceTagV4:async({traceLocation:e,tag:t,traceId:n})=>{const s=(0,i.nr)(e),r=`${(0,Ye.we)(`ajax-api/4.0/mlflow/traces/${s}/${n}/tags`)}?${(new URLSearchParams).toString()}`;return(0,Ye.ff)(r,"PATCH",t)},deleteTraceTagV4:async({tagKey:e,traceId:t,traceLocation:n})=>{const s=(0,i.nr)(n),r=`${(0,Ye.we)(`ajax-api/4.0/mlflow/traces/${s}/${t}/tags/${encodeURIComponent(e)}`)}?${(new URLSearchParams).toString()}`;return(0,Ye.ff)(r,"DELETE")}},we=async({tag:e,traceId:t})=>{const n=(0,Ye.we)(`ajax-api/3.0/mlflow/traces/${t}/tags`);return(0,Ye.ff)(n,"PATCH",e)},Se=async({tagKey:e,traceId:t})=>{const n=(0,Ye.we)(`ajax-api/3.0/mlflow/traces/${t}/tags`),s=new URLSearchParams;s.append("key",e);const r=`${n}?${s.toString()}`;return(0,Ye.ff)(r,"DELETE")};var Me=n(41151);const Ie=({traceId:e,setModelTrace:t,setAssessmentsPaneEnabled:n,enabled:r=!0})=>{const o=[i.BS,e],l=(0,Me.M)(),d=(0,s.useMemo)((()=>(0,a.F9)()&&!e.startsWith("tr-")?r&&l.modelTraceInfo&&(0,i.gD)(l.modelTraceInfo):r&&e.startsWith("tr-")),[r,e,l.modelTraceInfo]);return(0,xe.I)({queryKey:o,queryFn:()=>{var t;return(0,a.F9)()&&l.modelTraceInfo&&(0,i.gD)(l.modelTraceInfo)&&!e.startsWith("tr-")?Te.getTraceInfoV4({traceId:e,traceLocation:null===(t=l.modelTraceInfo)||void 0===t?void 0:t.trace_location}):(({traceId:e})=>(0,Ye.ff)((0,Ye.we)(`ajax-api/3.0/mlflow/traces/${e}`)))({traceId:e})},onSuccess:e=>{var s;const r=(0,i.gD)(e)?e:null===e||void 0===e||null===(s=e.trace)||void 0===s?void 0:s.trace_info;t((e=>({data:e.data,info:null!==r&&void 0!==r?r:{}}))),n(!0)},onError:()=>{n(!1)},enabled:d,refetchOnWindowFocus:!1,refetchOnMount:"always"})};const ke=(0,n(24447).vt)((e=>({assessmentActions:{},resetCache:()=>e((()=>({assessmentActions:{}}))),logAddedAssessment:(t,n)=>e((e=>n?{assessmentActions:{...e.assessmentActions,[t]:[...e.assessmentActions[t]||[],{action:"ADD",assessment:n}]}}:e)),logRemovedAssessment:(t,n)=>e((e=>n?{assessmentActions:{...e.assessmentActions,[t]:[...e.assessmentActions[t]||[],{action:"DELETE",assessment:n}]}}:e)),reconstructAssessments:(e,t)=>{if(!t)return e;let n=[...e];return t.forEach((({action:e,assessment:t})=>{"ADD"===e&&t?n.unshift(t):"DELETE"===e&&t&&(n=n.filter((e=>e.assessment_id!==t.assessment_id)))})),n}})));var De={name:"1d3w5wq",styles:"width:100%"};const Ce=({sectionKey:e,title:t,children:n,withBorder:r=!1,className:a})=>{const[i,d]=(0,s.useState)(!0),{theme:u}=(0,l.u)();return(0,c.FD)("div",{className:a,css:(0,p.AH)({display:"flex",flexDirection:"column",borderRadius:u.borders.borderRadiusMd},""),children:[(0,c.FD)("div",{css:(0,p.AH)({alignItems:"center",display:"flex",flexDirection:"row",gap:u.spacing.xs,padding:r?u.spacing.sm:0,background:r?u.colors.backgroundSecondary:void 0,borderTopLeftRadius:u.borders.borderRadiusMd,borderTopRightRadius:u.borders.borderRadiusMd,borderBottomLeftRadius:i?0:u.borders.borderRadiusMd,borderBottomRightRadius:i?0:u.borders.borderRadiusMd,border:r?`1px solid ${u.colors.border}`:void 0,marginBottom:r?0:u.spacing.sm},""),children:[(0,c.Y)(l.B,{size:"small",componentId:"shared.model-trace-explorer.expand",type:"tertiary",icon:i?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>d(!i)}),(0,c.Y)(l.T.Title,{withoutMargins:!0,level:4,css:De,children:t})]}),i&&(0,c.Y)("div",{css:(0,p.AH)({border:r?`1px solid ${u.colors.border}`:void 0,borderTop:"none",borderBottomLeftRadius:r?u.borders.borderRadiusMd:void 0,borderBottomRightRadius:r?u.borders.borderRadiusMd:void 0,padding:r?u.spacing.sm:0},""),children:n})]})};function Ne({paramName:e,paramProperties:t,isRequired:n}){const{theme:s}=(0,l.u)(),{type:r,description:a,enum:i}=t,o=r||a||i,u=o?{borderTopLeftRadius:s.borders.borderRadiusMd,borderTopRightRadius:s.borders.borderRadiusMd,borderBottom:`1px solid ${s.colors.border}`}:{borderRadius:s.borders.borderRadiusMd};return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:s.borders.borderRadiusMd,border:`1px solid ${s.colors.border}`},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:s.colors.backgroundSecondary,padding:`${s.spacing.sm}px ${s.spacing.md}px`,gap:s.spacing.sm,...u},""),children:[(0,c.Y)(l.T.Title,{withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e}),n&&(0,c.Y)(l.T.Text,{withoutMargins:!0,color:"error",children:(0,c.Y)(d.sA,{id:"JmNdE4",defaultMessage:"required"})})]}),o&&(0,c.FD)("div",{css:(0,p.AH)({display:"grid",gridTemplateColumns:"auto 1fr",gridTemplateRows:"auto",gap:s.spacing.md,padding:`${s.spacing.sm}px ${s.spacing.md}px`},""),children:[r&&(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{withoutMargins:!0,bold:!0,children:(0,c.Y)(d.sA,{id:"CbRDlp",defaultMessage:"Type"})}),(0,c.Y)(l.T.Text,{withoutMargins:!0,code:!0,children:r})]}),a&&(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{withoutMargins:!0,bold:!0,children:(0,c.Y)(d.sA,{id:"SLjN1/",defaultMessage:"Description"})}),(0,c.Y)(l.T.Text,{withoutMargins:!0,children:a})]}),i&&(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{withoutMargins:!0,bold:!0,children:(0,c.Y)(d.sA,{id:"/WK1x1",defaultMessage:"Enum Values"})}),(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:s.spacing.sm,flexWrap:"wrap"},""),children:i.map((e=>(0,c.Y)(l.T.Text,{withoutMargins:!0,code:!0,children:e},e)))})]})]})]})}function Fe({tool:e}){var t,n,r;const{theme:a}=(0,l.u)(),[i,d]=(0,s.useState)(!1),u=e.function.description,m=null===(t=e.function.parameters)||void 0===t?void 0:t.properties,h=null!==(n=null===(r=e.function.parameters)||void 0===r?void 0:r.required)&&void 0!==n?n:[],g=u||m,f=g?{":hover":{backgroundColor:a.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:a.borders.borderRadiusMd,border:`1px solid ${a.colors.border}`,backgroundColor:a.colors.backgroundPrimary},""),"data-testid":"model-trace-explorer-chat-tool",children:[(0,c.FD)("div",{role:"button",css:(0,p.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm,alignItems:"center",borderBottom:g&&i?`1px solid ${a.colors.border}`:"none",padding:a.spacing.sm,...f},""),onClick:()=>d(!i),"data-testid":"model-trace-explorer-chat-tool-toggle",children:[g&&(i?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{})),(0,c.Y)(l.T.Text,{bold:!0,withoutMargins:!0,style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:e.function.name})]}),g&&i&&(0,c.FD)("div",{css:(0,p.AH)({padding:a.spacing.sm},""),children:[u&&(0,c.Y)(l.T.Paragraph,{style:{whiteSpace:"pre-wrap",marginBottom:a.spacing.sm,padding:`0px ${a.spacing.xs}px`},children:e.function.description}),m&&(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:Object.keys(m).map((e=>(0,c.Y)(Ne,{paramName:e,paramProperties:m[e],isRequired:h.includes(e)},e)))})]})]})}const Ee=({title:e,tools:t})=>{const{theme:n}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,padding:n.spacing.sm,border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginLeft:n.spacing.xs},""),bold:!0,children:e}),t.map((e=>(0,c.Y)(Fe,{tool:e},e.function.name)))]})};var He=n(73880);var Re={name:"1fttcpj",styles:"display:flex;flex-direction:column"};function _e({text:e,metadataTags:t,setExpanded:n,logDocumentClick:s}){const{theme:r}=(0,l.u)();return(0,c.FD)("div",{css:Re,children:[(0,c.Y)("div",{role:"button",onClick:()=>{n(!1),null===s||void 0===s||s("collapse")},css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",cursor:"pointer",padding:`${r.spacing.sm}px ${r.spacing.md}px`,height:r.typography.lineHeightBase,boxSizing:"content-box","&:hover":{backgroundColor:r.colors.backgroundSecondary}},""),children:(0,c.Y)(o.FileDocumentIcon,{})}),(0,c.Y)("div",{css:(0,p.AH)({padding:r.spacing.md,paddingBottom:0},""),children:(0,c.Y)(C,{children:e})}),(0,c.Y)("div",{css:(0,p.AH)({padding:r.spacing.md,paddingTop:0},""),children:t.map((({key:e,value:t})=>(0,c.Y)(He.t,{itemKey:e,itemValue:t},e)))}),(0,c.Y)(l.B,{css:(0,p.AH)({width:"100%",padding:r.spacing.sm},""),componentId:"shared.model-trace-explorer.retriever-document-collapse",icon:(0,c.Y)(o.ChevronUpIcon,{}),type:"tertiary",onClick:()=>n(!1),children:(0,c.Y)(d.sA,{id:"AgjhWE",defaultMessage:"See less"})})]})}var Le={name:"ti75j2",styles:"margin:0"},Oe={name:"1r5gb7q",styles:"display:inline-block"},Be={name:"1tma7dt",styles:"white-space:nowrap;margin:0"};function $e({text:e,metadataTags:t,setExpanded:n,logDocumentClick:s}){const{theme:r}=(0,l.u)();return(0,c.FD)("div",{role:"button",onClick:()=>{n(!0),null===s||void 0===s||s("expand")},css:(0,p.AH)({display:"flex",flexDirection:"row",padding:`${r.spacing.sm}px ${r.spacing.md}px`,gap:r.spacing.sm,alignItems:"center",justifyContent:"space-between",cursor:"pointer","&:hover":{backgroundColor:r.colors.backgroundSecondary}},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm,alignItems:"center",minWidth:0,flexShrink:1},""),children:[(0,c.Y)(o.FileDocumentIcon,{}),(0,c.Y)(l.T.Text,{ellipsis:!0,size:"md",children:e})]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm},""),children:[t.length>0?(0,c.Y)(He.t,{css:Le,itemKey:t[0].key,itemValue:t[0].value}):null,t.length>1?(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.tag-count.hover-tooltip",content:t.slice(1).map((({key:e,value:t})=>(0,c.Y)("span",{css:Oe,children:`${e}: ${t}`},e))),children:(0,c.FD)(o.Tag,{componentId:"shared.model-trace-explorer.tag-count",css:Be,children:["+",t.length-1]})}):null]})]})}function je({text:e,metadata:t}){const[n,r]=(0,s.useState)(!1),a=(0,i.g_)(t);return n?(0,c.Y)(_e,{text:e,metadataTags:a,setExpanded:r}):(0,c.Y)($e,{text:e,metadataTags:a,setExpanded:r})}const Ve=({title:e,documents:t})=>{const{theme:n}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({backgroundColor:n.colors.backgroundPrimary,borderRadius:n.borders.borderRadiusSm,border:`1px solid ${n.colors.border}`},""),children:[e&&(0,c.Y)("div",{css:(0,p.AH)({padding:`${n.spacing.xs}px ${n.spacing.sm}px`,borderBottom:`1px solid ${n.colors.border}`},""),children:(0,c.Y)(l.T.Text,{bold:!0,children:e})}),t.map(((e,s)=>(0,c.Y)("div",{css:(0,p.AH)({borderBottom:s!==t.length-1?`1px solid ${n.colors.border}`:""},""),children:(0,c.Y)(je,{text:e.page_content,metadata:e.metadata},s)},s)))]})},ze=({title:e,value:t})=>{const{theme:n}=(0,l.u)(),[r,a]=(0,s.useState)(!1),i=t.length>400,u=!r&&t.length>400?t.slice(0,400)+"...":t,m=i?{":hover":{backgroundColor:n.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,c.FD)("div",{css:(0,p.AH)({border:`1px solid ${n.colors.border}`,borderRadius:n.borders.borderRadiusSm},""),children:[e&&(0,c.FD)("div",{role:"button",css:(0,p.AH)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:`${n.spacing.sm}px ${n.spacing.sm+n.spacing.xs}px`,...m},""),onClick:()=>a(!r),children:[(0,c.Y)(l.T.Title,{level:4,color:"secondary",withoutMargins:!0,children:e}),i&&(r?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}))]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.sm+n.spacing.xs,paddingRight:n.spacing.sm+n.spacing.xs,paddingTop:e?0:n.spacing.sm,paddingBottom:n.spacing.sm,"& > div:last-of-type":{marginBottom:0}},""),children:[(0,c.Y)(C,{children:u}),i&&(0,c.Y)(l.T.Link,{onClick:()=>a(!r),componentId:"shared.model-trace-explorer.text-field-see-more-link",children:r?(0,c.Y)(d.sA,{id:"Y5Rr5k",defaultMessage:"See less"}):(0,c.Y)(d.sA,{id:"Hyv8Go",defaultMessage:"See more"})})]})]})},Pe=({title:e,searchFilter:t,isActiveMatch:n})=>{const{theme:r}=(0,l.u)(),a=(0,s.useCallback)((e=>{null===e||void 0===e||e.scrollIntoView({block:"nearest",inline:"nearest"})}),[]),i=e.toLowerCase();if(!i.includes(t))return(0,c.Y)("div",{children:e});const o=i.indexOf(t),d=o+t.length,u=n?r.colors[g.kj]:r.colors[g.Bt];return(0,c.FD)("div",{children:[e.slice(0,o),(0,c.Y)("span",{ref:n?a:null,css:(0,p.AH)({backgroundColor:u,scrollMarginTop:50},""),children:e.slice(o,d)}),e.slice(d)]})};function Ke(e,t){return t||(e?m.cC.MARKDOWN:m.cC.JSON)}function We(e){switch(e){case m.cC.JSON:return"JSON";case m.cC.TEXT:return"Text";case m.cC.MARKDOWN:return"Markdown";case m.cC.PYTHON:return"Python"}}var Ue={name:"bjn8wh",styles:"position:relative"},Ge={name:"1boj65s",styles:"max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},Je={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"},qe={name:"2fp7nl",styles:"height:min-content;margin:0"};function Xe({title:e,tokens:t,data:n,searchFilter:r="",activeMatch:a=null,containsActiveMatch:i=!1,initialRenderMode:d}){var u;const g=(0,s.useMemo)((()=>JSON.parse(n)),[n]),f=(0,h.isString)(g),{theme:v}=(0,l.u)(),[x,y]=(0,s.useState)(Ke(f,d)),b=i&&null!==(u=null===a||void 0===a?void 0:a.isKeyMatch)&&void 0!==u&&u,Y=f&&!r;return(0,s.useEffect)((()=>{y(Ke(f,d))}),[f,d]),(0,c.Y)("div",{css:Ue,children:(0,c.FD)("div",{css:(0,p.AH)({borderRadius:v.borders.borderRadiusSm,border:`1px solid ${v.colors.border}`,overflow:"hidden"},""),children:[(e||Y)&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:v.spacing.sm},""),children:[(0,c.Y)(l.T.Title,{css:Ge,level:4,color:"secondary",withoutMargins:!0,children:(0,c.Y)(Pe,{title:e,searchFilter:r,isActiveMatch:b})}),(0,c.Y)("div",{css:Je,children:Y&&(0,c.FD)(o.DropdownMenu.Root,{children:[(0,c.Y)(o.DropdownMenu.Trigger,{asChild:!0,children:(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.snippet-render-mode-tag",css:qe,children:(0,c.FD)("div",{css:(0,p.AH)({paddingLeft:v.spacing.xs,marginRight:v.spacing.xs,cursor:"pointer"},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:We(x)}),(0,c.Y)(o.ChevronDownIcon,{})]})})}),(0,c.FD)(o.DropdownMenu.Content,{children:[(0,c.Y)(o.DropdownMenu.RadioGroup,{componentId:"shared.model-trace-explorer.snippet-render-mode-radio",value:x,onValueChange:e=>y(e),children:Object.values(m.cC).map((e=>e===m.cC.PYTHON?null:(0,c.FD)(o.DropdownMenu.RadioItem,{value:e,children:[(0,c.Y)(o.DropdownMenu.ItemIndicator,{}),We(e)]},e)))}),(0,c.Y)(o.DropdownMenu.Arrow,{})]})]})})]}),(0,c.Y)(z,{data:n,searchFilter:r,activeMatch:a,containsActiveMatch:i,renderMode:x})]})})}var Qe=n(51847);const Ze=e=>{switch(e){case"system":return(0,c.Y)(Qe.P,{type:m.Dy.SYSTEM});case"user":return(0,c.Y)(Qe.P,{type:m.Dy.USER});case"tool":case"function":return(0,c.Y)(Qe.P,{type:m.Dy.WRENCH});default:return(0,c.Y)(Qe.P,{type:m.Dy.MODELS})}},et=e=>{switch(e.role){case"system":return(0,c.Y)(d.sA,{id:"+gqcru",defaultMessage:"System"});case"user":return(0,c.Y)(d.sA,{id:"t+aG6y",defaultMessage:"User"});case"assistant":return(0,c.Y)(d.sA,{id:"Hvznjh",defaultMessage:"Assistant"});case"tool":return e.name?e.name:(0,c.Y)(d.sA,{id:"dPn3az",defaultMessage:"Tool"});case"function":return(0,c.Y)(d.sA,{id:"5ZUAC2",defaultMessage:"Function"});default:return e.role}};var tt={name:"7dymr5",styles:"white-space:nowrap;display:inline-flex;align-items:center;flex:1;min-width:0"},nt={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};const st=({isExpandable:e,expanded:t,setExpanded:n,message:s})=>{const{theme:r}=(0,l.u)(),a=e?{":hover":{backgroundColor:r.colors.actionIconBackgroundHover,cursor:"pointer"}}:{};return(0,c.FD)("div",{role:"button",css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:r.spacing.sm,gap:r.spacing.sm,...a},""),onClick:()=>n(!t),children:[e&&(t?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{})),Ze(s.role),s.tool_call_id?(0,c.Y)(l.T.Text,{color:"secondary",css:tt,children:(0,c.Y)(d.sA,{id:"mWl3Qv",defaultMessage:"{toolName} was called in {toolCallId}",values:{toolName:(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginRight:r.spacing.xs},""),bold:!0,children:et(s)}),toolCallId:(0,c.Y)(Q.T,{componentId:"test",content:s.tool_call_id,children:(0,c.Y)("div",{css:(0,p.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:r.spacing.xs},""),children:(0,c.Y)(l.T.Text,{css:nt,code:!0,children:s.tool_call_id})})})}})}):(0,c.Y)(l.T.Text,{bold:!0,children:et(s)})]})};var rt=n(65854);var at={name:"12wal98",styles:"text-overflow:ellipsis;overflow:hidden;white-space:nowrap"};function it({toolCall:e}){const{theme:t}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,c.Y)(l.T.Text,{color:"secondary",css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${t.spacing.sm+t.spacing.xs}px`},""),children:(0,c.Y)(d.sA,{id:"hV4vVj",defaultMessage:"called {functionName} in {toolCallId}",values:{functionName:(0,c.FD)(o.Tag,{color:"purple",componentId:"shared.model-trace-explorer.function-name-tag",css:(0,p.AH)({margin:`0px ${t.spacing.xs}px`},""),children:[(0,c.Y)(o.FunctionIcon,{}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({whiteSpace:"nowrap",marginLeft:t.spacing.xs},""),children:e.function.name})]}),toolCallId:(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.tool-call-id-tooltip",content:e.id,children:(0,c.Y)("div",{css:(0,p.AH)({display:"inline-flex",flexShrink:1,overflow:"hidden",marginLeft:t.spacing.xs},""),children:(0,c.Y)(l.T.Text,{css:at,code:!0,color:"secondary",children:e.id})})})}})}),(0,c.Y)(z,{data:e.function.arguments})]},e.id)}const ot=e=>{try{return{content:JSON.stringify(JSON.parse(e),null,2),isJson:!0}}catch(t){return{content:e,isJson:!1}}};function lt({content:e,shouldDisplayCodeSnippet:t}){const{theme:n}=(0,l.u)();return e?t?(0,c.Y)(z,{data:e,searchFilter:"",activeMatch:null,containsActiveMatch:!1,renderMode:m.cC.JSON}):(0,c.Y)("div",{css:(0,p.AH)({padding:n.spacing.sm,paddingTop:0,marginBottom:-n.typography.fontSizeBase},""),children:(0,c.Y)(C,{children:e})}):null}function dt({message:e,className:t}){var n;const{theme:r}=(0,l.u)(),[a,i]=(0,s.useState)(!1),{content:u,isJson:m}=ot(null!==(n=e.content)&&void 0!==n?n:""),g=m&&("tool"===e.role||"function"===e.role),f=!g&&u.length>rt.w,v=f&&!a?`${u.slice(0,rt.w)}...`:u;return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",width:"100%",borderRadius:r.borders.borderRadiusSm,border:`1px solid ${r.colors.border}`,backgroundColor:r.colors.backgroundPrimary,overflow:"hidden"},""),className:t,children:[(0,c.Y)(st,{isExpandable:f,expanded:a,setExpanded:i,message:e}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:r.spacing.sm},""),children:[!(0,h.isNil)(e.tool_calls)&&e.tool_calls.map((e=>(0,c.Y)(it,{toolCall:e},e.id))),(0,c.Y)(lt,{content:v,shouldDisplayCodeSnippet:g})]}),f&&(0,c.Y)(l.B,{componentId:a?"shared.model-trace-explorer.chat-message-see-less":"shared.model-trace-explorer.chat-message-see-more",icon:a?(0,c.Y)(o.ChevronUpIcon,{}):(0,c.Y)(o.ChevronDownIcon,{}),type:"tertiary",onClick:()=>i(!a),css:(0,p.AH)({display:"flex",width:"100%",padding:r.spacing.md,borderRadius:"0px !important"},""),children:a?(0,c.Y)(d.sA,{id:"gTEFCD",defaultMessage:"See less"}):(0,c.Y)(d.sA,{id:"6fP+8o",defaultMessage:"See more"})})]})}function ct({messages:e}){const{theme:t}=(0,l.u)();return(0,h.isNil)(e)?null:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:e.map(((e,t)=>(0,c.Y)(dt,{message:e},t)))})}const ut=({title:e,data:t,renderMode:n,chatMessageFormat:r,maxVisibleMessages:a=3})=>{const{theme:o}=(0,l.u)(),[u,g]=(0,s.useState)(!1),f=(0,s.useMemo)((()=>{try{return JSON.parse(t)}catch(e){return t}}),[t]);(0,s.useEffect)((()=>{g(!1)}),[t]);const v=(0,h.isString)(f)||(0,h.isNumber)(f)||(0,h.isBoolean)(f),x=(0,i.Hq)(e?{[e]:f}:f,r),y=Array.isArray(f)&&f.length>0&&(0,h.every)(f,i.PC),b=Array.isArray(f)&&f.length>0&&(0,h.every)(f,i.W0);if(x&&x.length>0){const t=x.length>a,n=u||!t?x:x.slice(-a),s=t?x.length-n.length:0;return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:o.spacing.sm,padding:o.spacing.sm,border:`1px solid ${o.colors.border}`,borderRadius:o.borders.borderRadiusSm},""),children:[e&&(0,c.Y)(l.T.Title,{level:4,color:"secondary",withoutMargins:!0,css:(0,p.AH)({marginLeft:o.spacing.xs},""),children:e}),t&&(0,c.Y)(l.T.Link,{css:(0,p.AH)({alignSelf:"flex-start",marginLeft:o.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>g(!u),children:u?(0,c.Y)(d.sA,{id:"nugZSE",defaultMessage:"Show less"}):(0,c.Y)(d.sA,{id:"/akgwX",defaultMessage:"Show {hiddenMessageCount} more",values:{hiddenMessageCount:s}})}),(0,c.Y)(ct,{messages:n})]})}return"json"===n?(0,c.Y)(Xe,{title:e,data:t,initialRenderMode:m.cC.JSON}):"text"===n?(0,c.Y)(Xe,{title:e,data:t,initialRenderMode:m.cC.TEXT}):v?(0,c.Y)(ze,{title:e,value:String(f)}):y?(0,c.Y)(Ee,{title:e,tools:f}):b?(0,c.Y)(Ve,{title:e,documents:f}):(0,c.Y)(Xe,{title:e,data:t})},pt=({node:e})=>{var t;const{theme:n}=(0,l.u)(),s=(0,i.bn)(e),r=!e.parentId,a=s[0];return a?(0,c.Y)(Ce,{css:(0,p.AH)({marginBottom:r?n.spacing.sm:0},""),withBorder:r,sectionKey:a.name,title:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:n.spacing.sm},""),children:[(0,c.Y)(o.XCircleIcon,{color:"danger"}),(0,c.Y)(l.T.Text,{color:"error",bold:!0,children:"Exception"})]}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.sm,paddingLeft:r?0:n.spacing.lg},""),children:Object.entries(null!==(t=a.attributes)&&void 0!==t?t:{}).map((([e,t])=>(0,c.Y)(ut,{title:e,data:JSON.stringify(t,null,2),renderMode:"text"},e)))})},a.name):null},mt=({node:e})=>{var t;const{theme:n}=(0,l.u)(),{setSelectedNode:s,setActiveView:r,setShowTimelineTreeGantt:a}=J(),o=(0,i.N7)(e)>0;return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",marginRight:n.spacing.xs,gap:n.spacing.xs,"&:hover":{textDecoration:"underline",textDecorationColor:o?n.colors.actionDangerDefaultTextDefault:n.colors.actionDefaultTextDefault,cursor:"pointer"}},""),onClick:()=>{s(e),r("detail"),a(!1)},children:[(0,c.Y)(Qe.P,{hasException:o,type:(0,i.tC)(null!==(t=e.type)&&void 0!==t?t:m.UG.UNKNOWN)}),(0,c.Y)(l.T.Text,{color:o?"error":"primary",css:(0,p.AH)({marginLeft:n.spacing.xs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},""),children:e.title})]})};var ht={name:"s6cpzs",styles:"display:flex;flex-direction:column;flex:1;min-width:0"},gt={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},ft={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"};const vt=({node:e,renderMode:t})=>{const{theme:n}=(0,l.u)(),[r,a]=(0,s.useState)(!1),u=(0,s.useMemo)((()=>(0,i.g_)(e.inputs)),[e]),m=(0,s.useMemo)((()=>(0,i.g_)(e.outputs)),[e]),h=(0,i.bn)(e),g=e.chatMessageFormat,f=h.length>0,v=u.length>0,x=m.length>0,{setSelectedNode:y,setActiveView:b,setShowTimelineTreeGantt:Y}=J();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",minHeight:48,flexShrink:0},""),children:[(0,c.Y)("div",{css:(0,p.AH)({height:48,display:"flex",alignItems:"center"},""),children:(0,c.Y)(l.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,p.AH)({flexShrink:0,marginRight:n.spacing.xs},""),icon:r?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>a(!r),componentId:"shared.model-trace-explorer.toggle-span"})}),(0,c.Y)("div",{css:(0,p.AH)({position:"relative",boxSizing:"border-box",height:48,borderLeft:`2px solid ${n.colors.border}`,width:12},""),children:(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",left:-2,top:14,height:12,width:12,boxSizing:"border-box",borderBottomLeftRadius:n.borders.borderRadiusMd,borderBottom:`2px solid ${n.colors.border}`,borderLeft:`2px solid ${n.colors.border}`},"")})}),(0,c.FD)("div",{css:ht,children:[(0,c.FD)("div",{css:gt,children:[(0,c.Y)(l.T.Text,{color:"secondary",css:(0,p.AH)({display:"inline-flex",alignItems:"center",height:48},""),children:(0,c.Y)(d.sA,{id:"SbMdmm",defaultMessage:"{spanName} was called",values:{spanName:(0,c.Y)(mt,{node:e})}})}),(0,c.Y)("span",{onClick:()=>{y(e),b("detail"),Y(!0)},children:(0,c.Y)(l.T.Text,{css:ft,color:"secondary",children:(0,U.X6)(e.end-e.start)})})]}),r&&(0,c.FD)("div",{children:[f&&(0,c.Y)(pt,{node:e}),v&&(0,c.Y)(Ce,{sectionKey:"input",title:(0,c.Y)(d.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:u.map((({key:e,value:n},s)=>(0,c.Y)(ut,{title:e,data:n,renderMode:t,chatMessageFormat:g},e||s)))})}),x&&(0,c.Y)(Ce,{sectionKey:"output",title:(0,c.Y)(d.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingLeft:n.spacing.lg,marginBottom:n.spacing.sm},""),children:m.map((({key:e,value:n})=>(0,c.Y)(ut,{title:e,data:n,renderMode:t,chatMessageFormat:g},e)))})})]})]})]})},xt=({title:e,data:t,renderMode:n,sectionKey:r,maxVisibleItems:a=3,maxVisibleChatMessages:i=3,className:o,chatMessageFormat:d})=>{const{theme:u}=(0,l.u)(),[m,h]=(0,s.useState)(!1),g=t.length>a,f=g&&!m?t.slice(-a):t,v=g?t.length-f.length:0;return(0,c.Y)(Ce,{withBorder:!0,title:e,className:o,sectionKey:r,children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm},""),children:[g&&(0,c.Y)(l.T.Link,{css:(0,p.AH)({alignSelf:"flex-start",marginLeft:u.spacing.xs},""),componentId:"shared.model-trace-explorer.conversation-toggle",onClick:()=>h(!m),children:m?"Show less":`Show ${v} more`}),f.map((({key:e,value:t},s)=>(0,c.Y)(ut,{title:e,data:t,renderMode:n,chatMessageFormat:d,maxVisibleMessages:i},e||s)))]})})};var yt={name:"4zleql",styles:"display:block"},bt={name:"oit39a",styles:"& > span{display:flex;align-items:center;}"};const Yt=()=>{const{assessmentsPaneExpanded:e,setAssessmentsPaneExpanded:t,assessmentsPaneEnabled:n,isInComparisonView:s}=J();return s?null:(0,c.Y)(o.SegmentedControlGroup,{css:yt,name:"shared.model-trace-explorer.assessments-pane-toggle",componentId:"shared.model-trace-explorer.assessments-pane-toggle",value:e,size:"small",children:(0,c.Y)(o.SegmentedControlButton,{value:!0,disabled:!n,icon:(0,c.Y)(o.GavelIcon,{}),onClick:()=>null===t||void 0===t?void 0:t(!e),css:bt,children:!e&&(0,c.Y)(d.sA,{id:"r/fxMt",defaultMessage:"Assessments"})})})},At=({rootNode:e,intermediateNodes:t,hideRenderModeSelector:n=!1})=>{const{theme:r}=(0,l.u)(),[a,u]=(0,s.useState)("default"),m=e.inputs,h=e.outputs,g=e.chatMessageFormat,f=(0,i.bn)(e),v=t.length>0,x=f.length>0,y=(0,i.g_)(m).filter((({value:e})=>"null"!==e)),b=(0,i.g_)(h).filter((({value:e})=>"null"!==e));return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",flex:1,minHeight:0,padding:r.spacing.md,paddingTop:r.spacing.sm,overflow:"auto",minWidth:400},""),children:[!n&&(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"flex-end",marginBottom:r.spacing.sm},""),children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",gap:r.spacing.sm},""),children:[(0,c.FD)(o.SegmentedControlGroup,{name:"render-mode",componentId:"shared.model-trace-explorer.summary-view.render-mode",value:a,size:"small",onChange:e=>u(e.target.value),children:[(0,c.Y)(o.SegmentedControlButton,{value:"default",children:(0,c.Y)(d.sA,{id:"uYkbr+",defaultMessage:"Default"})}),(0,c.Y)(o.SegmentedControlButton,{value:"json",children:(0,c.Y)(d.sA,{id:"XC1Pro",defaultMessage:"JSON"})})]}),(0,c.Y)(Yt,{})]})}),x&&(0,c.Y)(pt,{node:e}),(0,c.Y)(xt,{title:(0,c.Y)(d.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),css:(0,p.AH)({marginBottom:v?0:r.spacing.md},""),sectionKey:"summary-inputs",data:y,renderMode:a,chatMessageFormat:g}),v&&t.map((e=>(0,c.Y)(vt,{node:e,renderMode:a},e.key))),(0,c.Y)(xt,{title:(0,c.Y)(d.sA,{id:"ZstVNI",defaultMessage:"Outputs"}),sectionKey:"summary-outputs",data:b,renderMode:a,chatMessageFormat:null!==g&&void 0!==g?g:"openai"})]})};var Tt=n(25637),wt=n(49633);var St={name:"1h0bf8r",styles:"body, :host{user-select:none;}"},Mt={name:"1gtrael",styles:"display:flex;flex:1;overflow:hidden;flex-direction:row"},It={name:"kjqqaz",styles:"width:0;position:relative"};var kt=(0,s.forwardRef)((({initialRatio:e,paneWidth:t,setPaneWidth:n,leftChild:r,leftMinWidth:a,rightChild:i,rightMinWidth:o},d)=>{var u;const[m,g]=(0,s.useState)(!1),f=(0,s.useRef)(null),v=null===(u=(0,wt.wY)({ref:f}))||void 0===u?void 0:u.width,x=(null!==v&&void 0!==v?v:1/0)-o,y=(0,s.useRef)(e),{theme:b}=(0,l.u)(),Y=(0,s.useCallback)((e=>{v&&(y.current=e/v)}),[v]),A=(0,s.useCallback)((()=>v),[v]);return(0,s.useImperativeHandle)(d,(()=>({updateRatio:Y,getContainerWidth:A}))),(0,s.useLayoutEffect)((()=>{v&&n((0,h.clamp)(v*y.current,a,x))}),[v,x,a,o,n]),(0,c.FD)("div",{ref:f,css:Mt,children:[m&&(0,c.Y)(p.mL,{styles:St}),(0,c.Y)(Tt.ResizableBox,{axis:"x",width:t,css:(0,p.AH)({display:"flex",flex:`0 0 ${t}px`},""),handle:(0,c.Y)("div",{css:It,children:(0,c.Y)("div",{css:(0,p.AH)({position:"relative",width:b.spacing.sm,marginLeft:-b.spacing.xs,minHeight:"100%",cursor:"ew-resize",backgroundColor:"rgba(0,0,0,0)",zIndex:1,":hover":{backgroundColor:"rgba(0,0,0,0.1)"}},"")})}),onResize:(e,{size:t})=>{const s=(0,h.clamp)(t.width,a,x);n(s),v&&(y.current=s/v)},onResizeStart:()=>g(!0),onResizeStop:()=>g(!1),minConstraints:[a,1/0],maxConstraints:[x,1/0],children:r}),i]})})),Dt=n(44666),Ct=n(33145);const Nt=(0,s.createContext)({schemas:[]}),Ft=({children:e,assessments:t})=>{const n=(0,s.useMemo)((()=>(e=>{const t={},n={};for(const s of e){if(t[s.assessment_name])continue;const e=(0,Ct.e)(s);if((0,h.isNil)(e)){n[s.assessment_name]={name:s.assessment_name,assessmentType:"feedback"in s?"feedback":"expectation",dataType:"boolean"};continue}const r="expectation"in s&&"serialized_value"in s.expectation;let a;switch(typeof e){case"string":a=r?"json":"string";break;case"boolean":default:a="boolean";break;case"number":a="number"}t[s.assessment_name]={name:s.assessment_name,assessmentType:"feedback"in s?"feedback":"expectation",dataType:a}}for(const[s,r]of Object.entries(n))s in t||(t[s]=r);return Object.values(t)})(t)),[t]),r=(0,s.useMemo)((()=>({schemas:n})),[n]);return(0,c.Y)(Nt.Provider,{value:r,children:e})},Et=()=>(0,s.useContext)(Nt),Ht=({name:e,setName:t,nameError:n,setNameError:r,handleChangeSchema:a})=>{const{schemas:i}=Et(),l=(0,d.tz)(),u=i.map((e=>{var t;return null!==(t=e.name)&&void 0!==t?t:""})),[p,m]=(0,s.useState)(null),[h,g]=(0,s.useState)(i),f=(0,s.useMemo)((()=>{const t=[...h];if(e&&!u.includes(e)){const n=(e=>({name:e,assessmentType:"feedback",dataType:"boolean"}))(e);t.unshift(n)}return t}),[e,h,u]),v=(0,s.useCallback)((e=>{m(e),a(e),r(null)}),[a,r]),x=(0,o.useComboboxState)({componentId:"shared.model-trace-explorer.assessment-name-typeahead",allItems:i,items:f,setItems:g,multiSelect:!1,setInputValue:e=>{t(e),r(null)},itemToString:e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:""},matcher:(e,t)=>{var n,s;return null!==(n=null===e||void 0===e||null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes(t.toLowerCase()))&&void 0!==n&&n},formValue:p,formOnChange:v,preventUnsetOnBlur:!0});return(0,c.FD)(o.TypeaheadComboboxRoot,{onKeyDown:e=>{"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||e.stopPropagation()},id:"shared.model-trace-explorer.assessment-name-typeahead",comboboxState:x,children:[(0,c.Y)(o.TypeaheadComboboxInput,{"data-testid":"assessment-name-typeahead-input",placeholder:l.formatMessage({id:"gN67TK",defaultMessage:"Enter an assessment name"}),validationState:n?"error":void 0,comboboxState:x,formOnChange:v,onPressEnter:()=>{f.length>0&&v(f[0])},allowClear:!0,showComboboxToggleButton:!0}),n&&(0,c.Y)(o.FormUI.Message,{type:"error",message:n}),(0,c.Y)(o.TypeaheadComboboxMenu,{comboboxState:x,children:f.map(((e,t)=>{var n,s,r;return(0,c.Y)(o.TypeaheadComboboxMenuItem,{"data-testid":`assessment-name-typeahead-item-${null!==(n=null===e||void 0===e?void 0:e.name)&&void 0!==n?n:""}`,item:e,index:t,comboboxState:x,children:null!==(r=null===e||void 0===e?void 0:e.name)&&void 0!==r?r:""},`assessment-name-typeahead-${null!==(s=null===e||void 0===e?void 0:e.name)&&void 0!==s?s:""}`)}))})]})},Rt=250,_t=(e,t=new Date)=>{const n=Math.max(0,Math.floor((t.getTime()-e)/1e3));let s=Math.floor(n/31536e3);return s>=1?(0,c.Y)(d.sA,{id:"16BvfJ",defaultMessage:"{timeSince, plural, =1 {1 year} other {# years}} ago",values:{timeSince:s}}):(s=Math.floor(n/2592e3),s>=1?(0,c.Y)(d.sA,{id:"5ZAXeS",defaultMessage:"{timeSince, plural, =1 {1 month} other {# months}} ago",values:{timeSince:s}}):(s=Math.floor(n/86400),s>=1?(0,c.Y)(d.sA,{id:"tLb7+M",defaultMessage:"{timeSince, plural, =1 {1 day} other {# days}} ago",values:{timeSince:s}}):(s=Math.floor(n/3600),s>=1?(0,c.Y)(d.sA,{id:"aOW396",defaultMessage:"{timeSince, plural, =1 {1 hour} other {# hours}} ago",values:{timeSince:s}}):(s=Math.floor(n/60),s>=1?(0,c.Y)(d.sA,{id:"7jsqqe",defaultMessage:"{timeSince, plural, =1 {1 minute} other {# minutes}} ago",values:{timeSince:s}}):(0,c.Y)(d.sA,{id:"93iLUV",defaultMessage:"{timeSince, plural, =1 {1 second} other {# seconds}} ago",values:{timeSince:n}})))))},Lt=({formValue:e,dataType:t,isFeedback:n})=>n?{feedback:{value:e}}:"json"===t?{expectation:{serialized_value:{value:String(e),serialization_format:"JSON_FORMAT"}}}:{expectation:{value:e}};var Ot=n(52033),Bt=n(72143),$t=n(89634),jt=n(27094),Vt=n(39595),zt=n(61060),Pt=n(59542);const Kt={json:Bt.f,string:jt.k,boolean:Ot.B,number:$t.O},Wt=(0,s.forwardRef)((({assessmentName:e,spanId:t,traceId:n,setExpanded:r},u)=>{var m;const{theme:g}=(0,l.u)(),{schemas:f}=Et(),[v,x]=(0,s.useState)(""),[y,b]=(0,s.useState)("feedback"),[Y,A]=(0,s.useState)("boolean"),[T,w]=(0,s.useState)(!0),[S,M]=(0,s.useState)(""),[I,k]=(0,s.useState)(null),[D,C]=(0,s.useState)(null),N=!(0,h.isNil)(e),F=null!==(m=Kt[Y])&&void 0!==m?m:Kt.string,{createAssessmentMutation:E,isLoading:H}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,d.tz)(),o=(0,Vt.jE)(),l=ke((e=>e.logAddedAssessment)),c=(0,Me.M)(),{mutate:u,isLoading:p}=(0,zt.n)({mutationFn:e=>(0,a.F9)()&&null!==c&&void 0!==c&&c.modelTraceInfo&&(0,i.gD)(c.modelTraceInfo)&&(0,i.ko)(null===c||void 0===c?void 0:c.modelTraceInfo)?Te.createAssessmentV4({payload:e,traceLocation:c.modelTraceInfo.trace_location}):Ae({payload:e}),onSuccess:n=>{var s;if((0,a.F9)()&&(0,h.isObject)(n)){const t="assessment"in n?n.assessment:n;l(e,t)}null===(s=c.invalidateTraceQuery)||void 0===s||s.call(c,e),o.invalidateQueries({queryKey:[i.BS,e]}),(0,Pt.B)({queryClient:o}),null===t||void 0===t||t()},onError:e=>{(0,i.ij)(r.formatMessage({id:"L3szkg",defaultMessage:"Failed to create assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSettled:()=>{null===s||void 0===s||s()}});return{createAssessmentMutation:u,isLoading:p}})({traceId:n,onSettled:()=>{r(!1)}}),R=(0,s.useCallback)((async()=>{var s;if("json"===Y)try{JSON.parse(T)}catch(i){return void C((0,c.Y)(d.sA,{id:"VXduJD",defaultMessage:"The provided value is not valid JSON"}))}if(!N&&""===v)return void k((0,c.Y)(d.sA,{id:"WHf+VX",defaultMessage:"Please enter a name"}));const r=Lt({formValue:T,dataType:Y,isFeedback:"feedback"===y}),a={assessment:{assessment_name:N?e:v,trace_id:n,source:{source_type:"HUMAN",source_id:null!==(s=(0,Dt.w)())&&void 0!==s?s:""},span_id:t,rationale:S,...r}};E(a)}),[Y,T,y,N,e,v,n,t,S,E]),_=(0,s.useCallback)((e=>{if(!e)return x(""),b("feedback"),A("boolean"),w(!0),M(""),void C(null);if(f.some((t=>t.name===e.name)))switch(x(e.name),b(e.assessmentType),A(e.dataType),e.dataType){case"string":case"json":w("");break;case"number":w(0);break;case"boolean":w(!0)}else x(e.name)}),[f]);return(0,c.FD)("div",{ref:u,css:(0,p.AH)({display:"flex",flexDirection:"column",gap:g.spacing.xs,marginTop:g.spacing.sm,border:`1px solid ${g.colors.border}`,padding:g.spacing.sm,borderRadius:g.borders.borderRadiusSm},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"+SBxBK",defaultMessage:"Assessment Type"})}),(0,c.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-type-select",componentId:"shared.model-trace-explorer.assessment-type-select",label:"Assessment Type",value:y,disabled:H,onChange:e=>{b(e.target.value),"feedback"===e.target.value&&"json"===Y&&A("string")},children:[(0,c.Y)(o.SimpleSelectOption,{value:"feedback",children:(0,c.Y)(d.sA,{id:"0AOcOr",defaultMessage:"Feedback"})}),(0,c.Y)(o.SimpleSelectOption,{value:"expectation",children:(0,c.Y)(d.sA,{id:"tEaqGu",defaultMessage:"Expectation"})})]}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:g.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"AdlJNW",defaultMessage:"Assessment Name"})}),N?(0,c.Y)(l.T.Text,{children:e}):(0,c.Y)(Ht,{name:v,setName:x,handleChangeSchema:_,nameError:I,setNameError:k}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:g.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"q8rYCQ",defaultMessage:"Data Type"})}),(0,c.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-data-type-select",componentId:"shared.model-trace-explorer.assessment-data-type-select",label:"Data Type",value:Y,disabled:H,onChange:e=>{A(e.target.value),C(null)},children:["expectation"===y&&(0,c.Y)(o.SimpleSelectOption,{value:"json",children:(0,c.Y)(d.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,c.Y)(o.SimpleSelectOption,{value:"string",children:(0,c.Y)(d.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,c.Y)(o.SimpleSelectOption,{value:"boolean",children:(0,c.Y)(d.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,c.Y)(o.SimpleSelectOption,{value:"number",children:(0,c.Y)(d.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:g.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"ms+6Z2",defaultMessage:"Value"})}),(0,c.Y)(F,{value:T,valueError:D,setValue:w,setValueError:C,isSubmitting:H}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:g.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"wDMTm8",defaultMessage:"Rationale"})}),(0,c.Y)(X.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-rationale-input",value:S,autoSize:{minRows:1,maxRows:5},disabled:H,onKeyDown:e=>e.stopPropagation(),onChange:e=>M(e.target.value)}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",justifyContent:"flex-end",marginTop:g.spacing.xs},""),children:[(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.assessment-create-button",disabled:H,onClick:()=>r(!1),children:(0,c.Y)(d.sA,{id:"+33ShX",defaultMessage:"Cancel"})}),(0,c.Y)(l.B,{css:(0,p.AH)({marginLeft:g.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-create-button",onClick:R,loading:H,children:(0,c.Y)(d.sA,{id:"Me7xpG",defaultMessage:"Create"})})]})]})})),Ut=({title:e,assessmentName:t,spanId:n,traceId:r})=>{const[a,i]=(0,s.useState)(!1),d=(0,s.useRef)(null);return(0,s.useEffect)((()=>{a&&d.current&&d.current.scrollIntoView({behavior:"smooth",block:"start"})}),[a]),(0,c.FD)("div",{children:[(0,c.Y)(l.B,{size:"small",componentId:"shared.model-trace-explorer.add-new-assessment",icon:(0,c.Y)(o.PlusIcon,{}),onClick:()=>i(!0),children:e}),a&&(0,c.Y)(Wt,{ref:d,assessmentName:t,spanId:n,traceId:r,setExpanded:i})]})},Gt=({assessment:e,setIsEditing:t,setShowDeleteModal:n})=>{var s;const r="feedback"in e,a=((null!==(s=(0,Dt.w)())&&void 0!==s?s:"")===e.source.source_id||r&&"HUMAN"!==e.source.source_type)&&t;return(0,c.FD)(o.DropdownMenu.Root,{children:[(0,c.Y)(o.DropdownMenu.Trigger,{asChild:!0,children:(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.assessment-more-button",icon:(0,c.Y)(o.OverflowIcon,{}),size:"small"})}),(0,c.FD)(o.DropdownMenu.Content,{minWidth:100,children:[a&&(0,c.FD)(o.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-edit-button",onClick:()=>null===t||void 0===t?void 0:t(!0),children:[(0,c.Y)(o.DropdownMenu.IconWrapper,{children:(0,c.Y)(o.PencilIcon,{})}),(0,c.Y)(d.sA,{id:"UQhorr",defaultMessage:"Edit"})]}),(0,c.FD)(o.DropdownMenu.Item,{componentId:"shared.model-trace-explorer.assessment-delete-button",onClick:()=>n(!0),children:[(0,c.Y)(o.DropdownMenu.IconWrapper,{children:(0,c.Y)(o.TrashIcon,{})}),(0,c.Y)(d.sA,{id:"aZV8M7",defaultMessage:"Delete"})]})]})]})},Jt=({assessment:e,onSuccess:t,onError:n,onSettled:s,skip:r})=>{const o=(0,d.tz)(),l=(0,Vt.jE)(),c=null===e||void 0===e?void 0:e.trace_id,u=null===e||void 0===e?void 0:e.assessment_id,p=ke((e=>e.logRemovedAssessment)),m=ke((e=>e.logAddedAssessment)),h=(0,Me.M)(),g=r||!c||!u,{mutate:f,isLoading:v}=(0,zt.n)({mutationFn:()=>g?Promise.reject(new Error("Mutation is skipped")):(0,a.F9)()&&h.modelTraceInfo&&(0,i.gD)(h.modelTraceInfo)&&(0,i.ko)(h.modelTraceInfo)?Te.deleteAssessmentV4({traceId:c,assessmentId:u,traceLocation:h.modelTraceInfo.trace_location}):(({traceId:e,assessmentId:t})=>(0,Ye.ff)((0,Ye.we)(`ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`),"DELETE"))({traceId:c,assessmentId:u}),onSuccess:()=>{var n;if((0,a.F9)()&&!g){if(e.overriddenAssessment){const t={...e.overriddenAssessment,valid:!0};m(c,t)}p(c,e)}l.invalidateQueries({queryKey:[i.BS,c]}),null===(n=h.invalidateTraceQuery)||void 0===n||n.call(h,c),(0,Pt.B)({queryClient:l}),null===t||void 0===t||t()},onError:e=>{e instanceof Error&&g||((0,i.ij)(o.formatMessage({id:"iRNZkJ",defaultMessage:"Failed to delete assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e))},onSettled:()=>{null===s||void 0===s||s()}});return{deleteAssessmentMutation:f,isLoading:v}},qt=({assessment:e,isModalVisible:t,setIsModalVisible:n})=>{const{deleteAssessmentMutation:r,isLoading:a}=Jt({assessment:e,onSettled:()=>{n(!1)}}),i=(0,s.useCallback)((()=>{r()}),[r]);return(0,c.Y)(Q.d,{componentId:"shared.model-trace-explorer.assessment-delete-modal",visible:t,onOk:i,okButtonProps:{danger:!0,loading:a},okText:(0,c.Y)(d.sA,{id:"vlUEAo",defaultMessage:"Delete"}),onCancel:()=>{n(!1)},cancelText:(0,c.Y)(d.sA,{id:"gFYM0j",defaultMessage:"Cancel"}),confirmLoading:a,title:(0,c.Y)(d.sA,{id:"mqqEUj",defaultMessage:"Delete assessment"}),children:(0,c.Y)(d.sA,{id:"puATD8",defaultMessage:"Are you sure you want to delete this assessment?"})})},Xt=({assessment:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,d.tz)(),o=(0,Vt.jE)(),l=ke((e=>e.logAddedAssessment)),c=(0,Me.M)(),{mutate:u,isLoading:p}=(0,zt.n)({mutationFn:t=>(0,a.F9)()&&null!==c&&void 0!==c&&c.modelTraceInfo&&(0,i.gD)(c.modelTraceInfo)&&(0,i.ko)(null===c||void 0===c?void 0:c.modelTraceInfo)?(t.assessment.assessment_name=e.assessment_name,Te.updateAssessmentV4({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t,traceLocation:c.modelTraceInfo.trace_location})):(({traceId:e,assessmentId:t,payload:n})=>(0,Ye.ff)((0,Ye.we)(`ajax-api/3.0/mlflow/traces/${e}/assessments/${t}`),"PATCH",n))({traceId:e.trace_id,assessmentId:e.assessment_id,payload:t}),onError:e=>{(0,i.ij)(r.formatMessage({id:"+hZB4c",defaultMessage:"Failed to update assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:n=>{var s;if((0,a.F9)()&&(0,h.isObject)(n)){const e="assessment"in n?n.assessment:n;l(e.trace_id,e)}o.invalidateQueries({queryKey:[i.BS,e.trace_id]}),null===(s=c.invalidateTraceQuery)||void 0===s||s.call(c,e.trace_id),(0,Pt.B)({queryClient:o}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{updateAssessmentMutation:u,isLoading:p}},Qt=({assessment:e,onSuccess:t,onSettled:n,onCancel:r})=>{var u;const m="feedback"in e,g=(0,Ct.e)(e),f=((e,t)=>{if("string"===typeof e){if(""===e)return"boolean";if(t)return"string";try{return JSON.parse(e),"json"}catch(n){return"string"}}return"boolean"===typeof e||"number"===typeof e?typeof e:"boolean"})(g,m),v=(e=>"string"===typeof e?e||null:"boolean"===typeof e||"number"===typeof e?e:null)(g),x=null!==(u=(0,Dt.w)())&&void 0!==u?u:"",{theme:y}=(0,l.u)(),[b,Y]=(0,s.useState)(f),[A,T]=(0,s.useState)(v),[w,S]=(0,s.useState)(e.rationale),[M,I]=(0,s.useState)(null),{updateAssessmentMutation:k,isLoading:D}=Xt({assessment:e,onSuccess:t,onSettled:n}),{overrideAssessmentMutation:C,isLoading:N}=(({traceId:e,onSuccess:t,onError:n,onSettled:s})=>{const r=(0,d.tz)(),o=(0,Vt.jE)(),l=ke((e=>e.logAddedAssessment)),c=ke((e=>e.logRemovedAssessment)),u=(0,Me.M)(),{mutate:p,isLoading:m}=(0,zt.n)({mutationFn:({oldAssessment:e,value:t,rationale:n})=>{var s;const r={...e,...t,rationale:n,source:{source_id:null!==(s=(0,Dt.w)())&&void 0!==s?s:"",source_type:"HUMAN"},overrides:e.assessment_id},o={assessment:(0,h.omit)(r,"assessment_id","create_time","last_update_time","overriddenAssessments")};return(0,a.F9)()&&u.modelTraceInfo&&(0,i.gD)(u.modelTraceInfo)&&(0,i.ko)(u.modelTraceInfo)?Te.createAssessmentV4({payload:o,traceLocation:u.modelTraceInfo.trace_location}):Ae({payload:o})},onError:e=>{(0,i.ij)(r.formatMessage({id:"X11caV",defaultMessage:"Failed to override assessment. Error: {error}"},{error:e instanceof Error?e.message:String(e)})),null===n||void 0===n||n(e)},onSuccess:(n,s)=>{var r;if((0,a.F9)()&&(0,h.isObject)(n)){const t="assessment"in n?n.assessment:n;t.overriddenAssessment=s.oldAssessment,l(e,t),c(e,s.oldAssessment)}o.invalidateQueries({queryKey:[i.BS,e]}),null===(r=u.invalidateTraceQuery)||void 0===r||r.call(u,e),(0,Pt.B)({queryClient:o}),null===t||void 0===t||t()},onSettled:()=>{null===s||void 0===s||s()}});return{overrideAssessmentMutation:p,isLoading:m}})({traceId:e.trace_id,onSuccess:t,onSettled:n}),F=D||N,E=(0,s.useCallback)((async()=>{if("json"===b)try{JSON.parse(A)}catch(n){return void I((0,c.Y)(d.sA,{id:"8I9ipd",defaultMessage:"The provided value is not valid JSON"}))}const t=Lt({formValue:A,dataType:b,isFeedback:m});if(x!==e.source.source_id&&m)C({oldAssessment:e,value:t,...w?{rationale:w}:{}});else{const e={assessment:{...t,rationale:w},update_mask:(m?"feedback":"expectation")+",rationale"};k(e)}}),[b,A,m,x,e,w,k,C]);return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:y.spacing.xs,marginTop:y.spacing.sm,border:`1px solid ${y.colors.border}`,padding:y.spacing.sm,borderRadius:y.borders.borderRadiusSm},""),children:[(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"b7OpMB",defaultMessage:"Data Type"})}),(0,c.FD)(o.SimpleSelect,{id:"shared.model-trace-explorer.assessment-edit-data-type-select",componentId:"shared.model-trace-explorer.assessment-edit-data-type-select",value:b,disabled:F,onChange:e=>{Y(e.target.value),I(null)},children:[!m&&(0,c.Y)(o.SimpleSelectOption,{value:"json",children:(0,c.Y)(d.sA,{id:"GKVTw4",defaultMessage:"JSON"})}),(0,c.Y)(o.SimpleSelectOption,{value:"string",children:(0,c.Y)(d.sA,{id:"cBSSLp",defaultMessage:"String"})}),(0,c.Y)(o.SimpleSelectOption,{value:"boolean",children:(0,c.Y)(d.sA,{id:"k0l8lF",defaultMessage:"Boolean"})}),(0,c.Y)(o.SimpleSelectOption,{value:"number",children:(0,c.Y)(d.sA,{id:"C9ccNu",defaultMessage:"Number"})})]}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"e2AObB",defaultMessage:"Value"})}),"json"===b&&(0,c.FD)(c.FK,{children:[(0,c.Y)(X.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(A),rows:3,onKeyDown:e=>e.stopPropagation(),onChange:e=>{T(e.target.value),I(null)},validationState:M?"error":void 0,disabled:F}),M&&(0,c.Y)(o.FormUI.Message,{id:"shared.model-trace-explorer.assessment-edit-value-json-error",message:M,type:"error"})]}),"string"===b&&(0,c.Y)(X.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-string-input",value:String(A),onKeyDown:e=>e.stopPropagation(),onChange:e=>{T(e.target.value),I(null)},disabled:F,allowClear:!0}),"boolean"===b&&(0,c.FD)(o.SegmentedControlGroup,{componentId:"shared.model-trace-explorer.assessment-edit-value-boolean-input",name:"shared.model-trace-explorer.assessment-edit-value-boolean-input",value:A,disabled:F,onChange:e=>{T(e.target.value),I(null)},children:[(0,c.Y)(o.SegmentedControlButton,{value:!0,children:"True"}),(0,c.Y)(o.SegmentedControlButton,{value:!1,children:"False"})]}),"number"===b&&(0,c.Y)(X.I,{componentId:"shared.model-trace-explorer.assessment-edit-value-number-input",value:String(A),onKeyDown:e=>e.stopPropagation(),onChange:e=>{T(e.target.value?Number(e.target.value):""),I(null)},type:"number",disabled:F,allowClear:!0}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginTop:y.spacing.xs},""),size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"6BRlPU",defaultMessage:"Rationale"})}),(0,c.Y)(X.I.TextArea,{componentId:"shared.model-trace-explorer.assessment-edit-rationale-input",value:w,autoSize:{minRows:1,maxRows:5},disabled:F,onKeyDown:e=>e.stopPropagation(),onChange:e=>S(e.target.value)}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",justifyContent:"flex-end",marginTop:y.spacing.xs},""),children:[(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.assessment-edit-cancel-button",disabled:F,onClick:r,children:(0,c.Y)(d.sA,{id:"mIFcgu",defaultMessage:"Cancel"})}),(0,c.Y)(l.B,{css:(0,p.AH)({marginLeft:y.spacing.sm},""),type:"primary",componentId:"shared.model-trace-explorer.assessment-edit-save-button",onClick:E,loading:F,children:(0,c.Y)(d.sA,{id:"M+iC03",defaultMessage:"Save"})})]})]})};var Zt=n(4564),en=n(777);var tn={name:"bcffy2",styles:"display:flex;align-items:center;justify-content:space-between"},nn={name:"1h52dri",styles:"overflow:hidden;text-overflow:ellipsis;white-space:nowrap"},sn={name:"s5xdrg",styles:"display:flex;align-items:center"},rn={name:"fxp7t8",styles:"flex:1;min-width:0"};const an=({expectation:e})=>{const{theme:t}=(0,l.u)(),[n,r]=(0,s.useState)(!1),[a,i]=(0,s.useState)(!1),[u,m]=(0,s.useState)(!1),{nodeMap:h,activeView:g}=J(),f=e.span_id?h[e.span_id]:null,v="summary"===g&&f,x=(e=>{if("value"in e)return e.value;try{return JSON.parse(e.serialized_value.value)}catch(t){return e.serialized_value.value}})(e.expectation),y=(0,Ct.R)(e.source);return(0,c.FD)("div",{css:(0,p.AH)({padding:t.spacing.sm+t.spacing.xs,paddingTop:t.spacing.sm,border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,c.FD)("div",{css:tn,children:[(0,c.Y)(l.T.Text,{bold:!0,css:nn,children:e.assessment_name}),(0,c.Y)(Gt,{assessment:e,setIsEditing:r,setShowDeleteModal:i}),(0,c.Y)(qt,{assessment:e,isModalVisible:a,setIsModalVisible:i})]}),n?(0,c.Y)(Qt,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.sm},""),children:[(0,c.FD)("div",{css:sn,children:[(0,c.Y)(y,{size:t.typography.fontSizeSm,css:(0,p.AH)({padding:2,backgroundColor:t.colors.actionIconBackgroundHover,borderRadius:t.borders.borderRadiusFull},"")}),(0,c.Y)(Zt.V,{source:e.source})]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:u?"flex-start":"center",gap:t.spacing.xs},""),children:[(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.toggle-expectation-expanded",size:"small",icon:u?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>m(!u)}),(0,c.Y)("div",{css:rn,children:u?(0,c.Y)("div",{css:(0,p.AH)({backgroundColor:t.colors.backgroundSecondary,padding:`${t.spacing.xs}px ${t.spacing.sm}px`,borderRadius:t.borders.borderRadiusMd,whiteSpace:"pre-wrap",wordBreak:"break-word"},""),children:(0,c.Y)(l.T.Text,{children:"string"===typeof x?x:JSON.stringify(x,null,2)})}):(0,c.Y)(en.S,{parsedValue:x,singleLine:!0})})]})]}),v&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,c.Y)(mt,{node:f})]})]})};var on={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const ln=({jsonValue:e,className:t,prefix:n,skipIcons:s=!1,overrideColor:r})=>{const{theme:a}=(0,l.u)();if(!e||'""'===e)return null;let i;try{i=JSON.parse(e)}catch(h){i=e}let u="default",m=JSON.stringify(i,null,2);return"yes"===i?(u="lime",m=(0,c.FD)(c.FK,{children:[!s&&(0,c.Y)(o.CheckCircleIcon,{css:(0,p.AH)({marginRight:a.spacing.xs},"")}),(0,c.Y)(d.sA,{id:"MhOmZG",defaultMessage:"Yes"})]})):"no"===i?(u="coral",m=(0,c.FD)(c.FK,{children:[!s&&(0,c.Y)(o.XCircleIcon,{css:(0,p.AH)({marginRight:a.spacing.xs},"")}),(0,c.Y)(d.sA,{id:"M8cEQy",defaultMessage:"No"})]})):"string"===typeof i?m=i:null===i?(u="coral",m=(0,c.FD)(c.FK,{children:[!s&&(0,c.Y)(l.k,{css:(0,p.AH)({marginRight:a.spacing.xs},"")}),(0,c.Y)(d.sA,{id:"zEXwQL",defaultMessage:"Error"})]})):!0===i?(u="lime",m=(0,c.FD)(c.FK,{children:[!s&&(0,c.Y)(o.CheckCircleIcon,{css:(0,p.AH)({marginRight:a.spacing.xs},"")}),(0,c.Y)(d.sA,{id:"hWHLjo",defaultMessage:"True"})]})):!1===i&&(u="coral",m=(0,c.FD)(c.FK,{children:[!s&&(0,c.Y)(o.XCircleIcon,{css:(0,p.AH)({marginRight:a.spacing.xs},"")}),(0,c.Y)(d.sA,{id:"4U/RVz",defaultMessage:"False"})]})),(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.assesment-value-tooltip",content:m,children:(0,c.Y)(o.Tag,{css:(0,p.AH)({display:"inline-flex",maxWidth:"100%",minWidth:a.spacing.md,marginRight:0},""),componentId:"shared.model-trace-explorer.assesment-value-tag",color:null!==r&&void 0!==r?r:u,className:t,children:(0,c.FD)("span",{css:on,children:[n,m]})})})};var dn={name:"fhxb3m",styles:"display:flex;flex-direction:row;align-items:center"};const cn=({renderConnector:e=!0,assessment:t,setIsEditing:n,hideOverflowMenu:r=!1})=>{const{theme:a}=(0,l.u)(),[i,o]=(0,s.useState)(!1),d=(0,Ct.R)(t.source);return(0,c.FD)("div",{css:dn,children:[e&&(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",left:-1,top:0,width:10,height:a.typography.lineHeightBase,boxSizing:"border-box",borderBottomLeftRadius:a.borders.borderRadiusMd,borderBottom:`1px solid ${a.colors.border}`,borderLeft:`1px solid ${a.colors.border}`},"")}),(0,c.Y)(d,{size:a.typography.fontSizeSm,css:(0,p.AH)({padding:2,backgroundColor:a.colors.actionIconBackgroundHover,borderRadius:a.borders.borderRadiusFull},"")}),(0,c.Y)(Zt.V,{source:t.source}),(0,c.FD)("div",{css:(0,p.AH)({marginLeft:"auto",display:"flex",flexDirection:"row",alignItems:"center",gap:a.spacing.xs},""),children:[t.last_update_time&&(0,c.Y)(l.T.Text,{color:"secondary",size:"sm",css:(0,p.AH)({marginLeft:a.spacing.sm,overflow:"hidden",textOverflow:"ellipsis",textWrap:"nowrap"},""),children:_t(new Date(t.last_update_time))}),!r&&(0,c.Y)(Gt,{assessment:t,setIsEditing:n,setShowDeleteModal:o}),(0,c.Y)(qt,{assessment:t,isModalVisible:i,setIsModalVisible:o})]})]})},un=({error:e})=>{const{theme:t}=(0,l.u)(),[n,r]=(0,s.useState)(!1);return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,c.Y)(o.Alert,{type:"error",closable:!1,message:e.error_code,componentId:"shared.model-trace-explorer.feedback-error-item",description:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs},""),children:[(0,c.Y)("span",{children:e.error_message}),e.stack_trace&&(0,c.Y)(l.T.Link,{componentId:"shared.model-trace-explorer.feedback-error-item-stack-trace-link",onClick:()=>r(!0),children:(0,c.Y)(d.sA,{id:"z/CjX4",defaultMessage:"View stack trace"})})]})}),e.stack_trace&&(0,c.Y)(Q.d,{title:(0,c.Y)(d.sA,{id:"KqReh3",defaultMessage:"Error stack trace"}),visible:n,componentId:"shared.model-trace-explorer.feedback-error-stack-trace-modal",footer:null,onCancel:()=>r(!1),children:(0,c.Y)(Xe,{data:JSON.stringify(e.stack_trace),title:"",initialRenderMode:m.cC.TEXT})})]})};var pn={name:"yqjhl6",styles:"display:flex;flex-direction:column;position:relative"};const mn=({feedback:e})=>{const{theme:t}=(0,l.u)(),n=e.feedback.value;return(0,c.FD)("div",{css:pn,children:[(0,c.Y)(cn,{renderConnector:!1,assessment:e}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,marginLeft:10,paddingLeft:t.spacing.md,paddingTop:t.spacing.sm,paddingBottom:t.spacing.md,paddingRight:t.spacing.lg,borderLeft:`1px solid ${t.colors.border}`},""),children:[(0,h.isNil)(e.feedback.error)?(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,c.Y)("div",{children:(0,c.Y)(ln,{jsonValue:JSON.stringify(n)})})]}):(0,c.Y)(un,{error:e.feedback.error}),e.rationale&&(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",css:(0,p.AH)({marginTop:t.spacing.xs},""),children:(0,c.Y)(d.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,c.Y)(C,{children:e.rationale})]})]})]})},hn=({isModalVisible:e,setIsModalVisible:t,feedback:n})=>{const r=(0,s.useMemo)((()=>(e=>{const t=new Set,n=[];let s=e;for(;s&&!t.has(s.assessment_id);)t.add(s.assessment_id),n.push(s),s=s.overriddenAssessment;return n})(n)),[n]);return(0,c.Y)(Q.d,{componentId:"shared.model-trace-explorer.feedback-history-modal",visible:e,footer:null,onCancel:()=>{t(!1)},title:(0,c.Y)(d.sA,{id:"n6SrIn",defaultMessage:"Edit history"}),children:r.map((e=>"feedback"in e?(0,c.Y)(mn,{feedback:e},e.assessment_id):null))})};var gn=n(69291);var fn={name:"1cgftv8",styles:"&:hover{text-decoration:underline;cursor:pointer;}"},vn={name:"16mcpms",styles:"& > div:last-of-type{margin-bottom:0;}"},xn={name:"rnnx2x",styles:"font-size:12px"};const yn=({feedback:e})=>{var t,n;const[r,a]=(0,s.useState)(!1),{theme:i}=(0,l.u)(),{nodeMap:o,activeView:u}=J(),{experimentId:m}=(0,ce.g)(),f=e.feedback.value,v=e.span_id?o[e.span_id]:null,x="summary"===u&&v,y=null===(t=e.metadata)||void 0===t?void 0:t[g.gK],b=y&&m?bn(m,y):void 0,Y=null===(n=e.metadata)||void 0===n?void 0:n[g.zZ],A=(()=>{if(null===Y)return;const e=Number(Y);return Number.isFinite(e)?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:6}).format(e):void 0})(),T=Boolean(A);return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.sm,marginLeft:i.spacing.lg},""),children:[!(0,h.isNil)(e.feedback.error)&&(0,c.Y)(un,{error:e.feedback.error}),x&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"+hQbnS",defaultMessage:"Span"})}),(0,c.Y)(mt,{node:v})]}),(0,h.isNil)(e.feedback.error)&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"RGKRP9",defaultMessage:"Feedback"})}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",gap:i.spacing.xs},""),children:[(0,c.Y)(ln,{jsonValue:JSON.stringify(f)}),e.overriddenAssessment&&(0,c.FD)(c.FK,{children:[(0,c.Y)("span",{onClick:()=>a(!0),children:(0,c.Y)(l.T.Text,{css:fn,color:"secondary",children:(0,c.Y)(d.sA,{id:"f4CfIz",defaultMessage:"(edited)"})})}),(0,c.Y)(hn,{isModalVisible:r,setIsModalVisible:a,feedback:e})]})]})]}),e.rationale&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"gYOuKs",defaultMessage:"Rationale"})}),(0,c.Y)("div",{css:vn,children:(0,c.Y)(C,{children:e.rationale})})]}),T&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:i.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{size:"sm",color:"secondary",children:(0,c.Y)(d.sA,{id:"oBJ8xc",defaultMessage:"Cost"})}),(0,c.Y)(l.T.Text,{style:{color:i.colors.textSecondary},children:A})]}),b&&(0,c.Y)(ce.N_,{to:b,target:"_blank",rel:"noreferrer",children:(0,c.FD)("span",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:i.spacing.xs},""),children:[(0,c.Y)(d.sA,{id:"4a2Kqx",defaultMessage:"View trace"}),(0,c.Y)(l.au,{css:xn})]})})]})},bn=(e,t)=>`${(0,gn.p)(e)}?selectedEvaluationId=${t}`,Yn=({feedback:e})=>{const{theme:t}=(0,l.u)(),[n,r]=(0,s.useState)(!1);return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:t.spacing.xs,paddingLeft:t.spacing.lg/2,marginLeft:t.spacing.lg/2,paddingTop:t.spacing.sm,paddingBottom:t.spacing.sm,borderLeft:`1px solid ${t.colors.border}`,position:"relative"},""),children:[(0,c.Y)(cn,{assessment:e,setIsEditing:r}),n?(0,c.Y)(Qt,{assessment:e,onSuccess:()=>r(!1),onCancel:()=>r(!1)}):(0,c.Y)(yn,{feedback:e})]})};const An=e=>{const t={"& > svg":{width:12,height:12}};switch(e){case"HUMAN":return(0,c.Y)(o.UserIcon,{css:t});case"LLM_JUDGE":return(0,c.Y)(o.SparkleIcon,{css:t});case"CODE":return(0,c.Y)(o.CodeIcon,{css:t});default:return null}};var Tn={name:"ti75j2",styles:"margin:0"};const wn=({feedbacks:e})=>{const{theme:t}=(0,l.u)();if(e.length<2)return null;const n=(0,h.countBy)(e,(e=>e.source.source_type));return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",gap:t.spacing.xs,alignItems:"center",marginLeft:t.spacing.xs},""),children:Object.entries(n).map((([e,n])=>(0,c.Y)(o.Tag,{componentId:`shared.model-trace-explorer.feedback-source-count-${e}`,css:Tn,children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:t.spacing.xs},""),children:[An(e),(0,c.Y)(l.T.Text,{children:n})]})},e)))})};var Sn={name:"1fttcpj",styles:"display:flex;flex-direction:column"},Mn={name:"ozd7xs",styles:"flex-shrink:0"},In={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const kn=({jsonValue:e,feedbacks:t})=>{const{theme:n}=(0,l.u)(),[r,a]=(0,s.useState)(!1);return(0,c.FD)("div",{css:Sn,children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",gap:n.spacing.xs,alignItems:"center"},""),children:[(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.toggle-assessment-expanded",css:Mn,size:"small",icon:r?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>a(!r)}),(0,c.Y)(ln,{jsonValue:e}),(0,c.Y)(wn,{feedbacks:t})]}),r&&(0,c.Y)("div",{css:In,children:t.map((e=>!1===(null===e||void 0===e?void 0:e.valid)?null:(0,c.Y)(Yn,{feedback:e},e.assessment_id)))})]})};var Dn={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},Cn={name:"ozd7xs",styles:"flex-shrink:0"};const Nn=({name:e,valuesMap:t,traceId:n,activeSpanId:r})=>{const{theme:a}=(0,l.u)(),i=(e=>{const t=e.split("/");return 1===t.length?e:2===t.length?t[1]:t.slice(2).join("/")})(e),[d,u]=(0,s.useState)(!1),m=Object.values(t).flat().some((e=>!(0,h.isNil)(e.feedback.error)));return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",marginBottom:a.spacing.sm,border:`1px solid ${a.colors.border}`,borderRadius:a.borders.borderRadiusMd,padding:a.spacing.sm+a.spacing.xs,paddingTop:a.spacing.sm,gap:a.spacing.sm},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:a.spacing.sm},""),children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:a.spacing.sm,flex:1,minWidth:0},""),children:[(0,c.Y)(l.T.Text,{bold:!0,css:Dn,children:i}),m&&(0,c.Y)(l.k,{css:Cn,color:"danger"})]}),(0,c.Y)(Q.T,{content:"Add new feedback",componentId:"shared.model-trace-explorer.add-feedback-in-group-tooltip",children:(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.add-feedback",css:(0,p.AH)({flexShrink:0,marginRight:-a.spacing.xs},""),size:"small",icon:(0,c.Y)(o.PlusIcon,{}),onClick:()=>u(!0)})})]}),Object.entries(t).map((([e,t])=>(0,c.Y)(kn,{jsonValue:e,feedbacks:t},e))),d&&(0,c.Y)(Wt,{assessmentName:e,spanId:r,traceId:n,setExpanded:u})]})};var Fn={name:"g030ms",styles:"display:flex;flex-direction:row;justify-content:space-between;align-items:center"};const En=({assessments:e,traceId:t,activeSpanId:n})=>{const r=ke((e=>e.reconstructAssessments)),i=ke((e=>e.assessmentActions[t])),o=(0,s.useMemo)((()=>{if(!(0,a.F9)())return e;const t=r(e,i);return(0,h.uniqBy)(t,(({assessment_id:e})=>e))}),[e,r,i]),{theme:u}=(0,l.u)(),{setAssessmentsPaneExpanded:m,assessmentsPaneExpanded:g,isInComparisonView:f}=J(),[v,x]=(0,s.useMemo)((()=>(0,h.partition)(o,(e=>"feedback"in e))),[o]),y=(0,s.useMemo)((()=>(e=>{const t={};return e.forEach((e=>{if(!1===e.valid)return;let n=null;""!==e.feedback.value&&(n=JSON.stringify(e.feedback.value));const{assessment_name:s}=e;t[s]||(t[s]={});const r=t[s];(0,h.isNil)(n)||(r[n]||(r[n]=[]),r[n].push(e))})),Object.entries(t).toSorted((([e],[t])=>e.localeCompare(t)))})(v)),[v]),b=x.toSorted(((e,t)=>e.assessment_name.localeCompare(t.assessment_name)));return(0,c.FD)("div",{"data-testid":"assessments-pane",css:(0,p.AH)({display:"flex",flexDirection:"column",...f?{padding:`${u.spacing.sm} 0`,maxHeight:10*u.spacing.lg}:{padding:u.spacing.sm,paddingTop:u.spacing.xs,height:"100%"},...f?{}:{borderLeft:`1px solid ${u.colors.border}`},overflowY:"auto",minWidth:Rt,width:"100%",boxSizing:"border-box"},""),children:[(0,c.FD)("div",{css:Fn,children:[!f&&(0,c.Y)(l.T.Text,{bold:!0,children:(0,c.Y)(d.sA,{id:"++Ydlz",defaultMessage:"Assessments"})}),!f&&m&&(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.close-assessments-pane-tooltip",content:(0,c.Y)(d.sA,{id:"cQQnzX",defaultMessage:"Hide assessments"}),children:(0,c.Y)(l.B,{"data-testid":"close-assessments-pane-button",componentId:"shared.model-trace-explorer.close-assessments-pane",size:"small",icon:(0,c.Y)(l.C,{}),onClick:()=>m(!1)})})]}),y.map((([e,s])=>(0,c.Y)(Nn,{name:e,valuesMap:s,traceId:t,activeSpanId:n},e))),b.length>0&&(0,c.FD)(c.FK,{children:[(0,c.Y)(l.T.Text,{color:"secondary",css:(0,p.AH)({marginBottom:u.spacing.sm},""),children:(0,c.Y)(d.sA,{id:"UbXw8O",defaultMessage:"Expectations"})}),(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:u.spacing.sm,marginBottom:u.spacing.sm},""),children:b.map((e=>(0,c.Y)(an,{expectation:e},e.assessment_id)))})]}),(0,c.Y)(Ut,{title:(0,c.Y)(d.sA,{id:"2+O4wk",defaultMessage:"Add new assessment"}),spanId:n,traceId:t})]})},Hn=()=>{const{theme:e}=(0,l.u)(),[t,n]=(0,s.useState)(500),{rootNode:r,nodeMap:a,assessmentsPaneEnabled:u,assessmentsPaneExpanded:m,isInComparisonView:h}=J(),g=(0,s.useMemo)((()=>Object.values(a).flatMap((e=>e.assessments))),[a]),f=(0,i.yt)(r);if(!r)return(0,c.Y)("div",{css:(0,p.AH)({marginTop:e.spacing.lg},""),children:(0,c.Y)(o.Empty,{description:(0,c.Y)(d.sA,{id:"hm98EL",defaultMessage:"No span data to display"})})});const v=(0,c.Y)(En,{assessments:g,traceId:r.traceId,activeSpanId:void 0});return!h&&u&&m?(0,c.Y)(kt,{initialRatio:.75,paneWidth:t,setPaneWidth:n,leftChild:(0,c.Y)(At,{rootNode:r,intermediateNodes:f}),rightChild:v,leftMinWidth:400,rightMinWidth:Rt}):(0,c.Y)(At,{rootNode:r,intermediateNodes:f})};var Rn=n(27556);var _n={name:"2wv1be",styles:"width:100%;box-sizing:border-box"};var Ln=({searchFilter:e,setSearchFilter:t,matchData:n,handleNextSearchMatch:r,handlePreviousSearchMatch:a})=>{const[i,d]=(0,s.useState)(e),u=(0,Rn.YQ)(t,350),{theme:m}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:m.spacing.sm},""),children:[(0,c.Y)(X.I,{componentId:"shared.model-trace-explorer.search-input",allowClear:!0,placeholder:"Search",value:i,onClear:()=>{t(""),d("")},onChange:e=>{d(e.target.value),u(e.target.value.toLowerCase())},prefix:(0,c.Y)(X.S,{}),css:_n}),n.match&&(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",marginLeft:m.spacing.xs,marginRight:m.spacing.sm,alignItems:"center"},""),children:[(0,c.FD)(l.T.Text,{css:(0,p.AH)({whiteSpace:"nowrap",marginRight:m.spacing.sm},""),children:[n.currentMatchIndex+1," / ",n.totalMatches]}),(0,c.Y)(l.B,{"data-testid":"prev-search-match",icon:(0,c.Y)(o.ChevronUpIcon,{}),onClick:a,componentId:"shared.model-trace-explorer.prev-search-match"}),(0,c.Y)(l.B,{"data-testid":"next-search-match",icon:(0,c.Y)(o.ChevronDownIcon,{}),onClick:r,componentId:"shared.model-trace-explorer.next-search-match"})]})]})};const On=e=>{switch(e.section){case"inputs":case"outputs":default:return"content";case"attributes":return"attributes";case"events":return"events"}},Bn=({treeNode:e,selectedNode:t,setSelectedNode:n,setActiveTab:r,setExpandedKeys:a,modelTraceInfo:o})=>{var l;const[d,c]=(0,s.useState)(""),[u,p]=(0,s.useState)((()=>(e=>{const t={};e&&(0,h.compact)((0,U.VC)([e]).map((e=>e.type))).forEach((e=>{t[e]=!0}));return{showParents:!0,showExceptions:!0,spanTypeDisplayState:t}})(e))),[m,g]=(0,s.useState)(0),{filteredTreeNodes:f,matches:v}=(0,s.useMemo)((()=>(0,h.isNil)(e)?{filteredTreeNodes:[],matches:[]}:(0,i.vL)(e,d,u)),[null===e||void 0===e?void 0:e.key,d,u,o]),x=(0,s.useMemo)((()=>(0,U.dM)(f)),[f]),y=(0,s.useCallback)((e=>{if(e>=v.length||e<0)return;g(e);const t=v[e];n(t.span),r(On(t));const s=(0,U.NP)(t.span,x);a((e=>new Set([...e,...s])))}),[v,n,r,x,a]),b=(0,s.useCallback)((()=>{y(m+1)}),[m,y]),Y=(0,s.useCallback)((()=>{y(m-1)}),[m,y]);return(0,s.useLayoutEffect)((()=>{if(0!==f.length)if(0!==v.length)g(0),n(v[0].span),r(On(v[0]));else{var e;const s=null!==(e=null===t||void 0===t?void 0:t.key)&&void 0!==e?e:"";if(s in x)n(x[s]);else{const e=f[0];n(e),r(null!==e&&void 0!==e&&e.chatMessages?"chat":"content")}}}),[f,v,n]),{matchData:{match:null!==(l=v[m])&&void 0!==l?l:null,totalMatches:v.length,currentMatchIndex:m},searchFilter:d.toLowerCase().trim(),setSearchFilter:c,spanFilterState:u,setSpanFilterState:p,filteredTreeNodes:f,handleNextSearchMatch:b,handlePreviousSearchMatch:Y}};function $n({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:s}=(0,l.u)(),{attributes:r}=e,a=(0,h.keys)(r).length>0,i=!(0,h.isNil)(n)&&n.span.key===e.key;return!a||(0,h.isNil)(r)?(0,c.Y)("div",{css:(0,p.AH)({marginTop:s.spacing.md},""),children:(0,c.Y)(o.Empty,{description:(0,c.Y)(d.sA,{id:"B5K1Ix",defaultMessage:"No attributes found"})})}):(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm,padding:s.spacing.md},""),children:Object.entries(r).map((([e,s])=>(0,c.Y)(Xe,{title:e,data:JSON.stringify(s,null,2),searchFilter:t,activeMatch:n,containsActiveMatch:i&&"attributes"===n.section&&n.key===e},e)))})}function jn({chatMessages:e,chatTools:t}){const{theme:n}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({overflowY:"auto",padding:n.spacing.md},""),"data-testid":"model-trace-explorer-chat-tab",children:[t&&(0,c.Y)(Ce,{css:(0,p.AH)({marginBottom:n.spacing.sm},""),title:(0,c.Y)(d.sA,{id:"Cjq57+",defaultMessage:"Tools"}),sectionKey:"messages",children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:t.map((e=>(0,c.Y)(Fe,{tool:e},e.function.name)))})}),(0,c.Y)(Ce,{title:(0,c.Y)(d.sA,{id:"AAdQxU",defaultMessage:"Messages"}),sectionKey:"messages",children:(0,c.Y)(ct,{messages:e})})]})}var Vn={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"},zn={name:"uqztsn",styles:"display:flex;flex-direction:row;justify-content:space-between;width:100%"};function Pn({activeSpan:e,className:t,searchFilter:n,activeMatch:r}){const{theme:a}=(0,l.u)(),o=(0,s.useMemo)((()=>(0,i.g_)(null===e||void 0===e?void 0:e.inputs)),[e]),u=(0,s.useMemo)((()=>(0,i.g_)(null===e||void 0===e?void 0:e.outputs)),[e]);if((0,h.isNil)(e))return null;const m=o.length>0,g=u.length>0,f=!(0,h.isNil)(r)&&r.span.key===e.key;return(0,c.FD)("div",{"data-testid":"model-trace-explorer-default-span-view",children:[m&&(0,c.Y)(Ce,{withBorder:!0,css:(0,p.AH)({marginBottom:a.spacing.sm},""),sectionKey:"input",title:(0,c.Y)("div",{css:Vn,children:(0,c.Y)(d.sA,{id:"/TX1Az",defaultMessage:"Inputs"})}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:o.map((({key:e,value:t},s)=>(0,c.Y)(Xe,{title:e,data:t,searchFilter:n,activeMatch:r,containsActiveMatch:f&&"inputs"===r.section&&r.key===e},e||s)))})}),g&&(0,c.Y)(Ce,{withBorder:!0,sectionKey:"output",title:(0,c.Y)("div",{css:zn,children:(0,c.Y)(d.sA,{id:"ZstVNI",defaultMessage:"Outputs"})}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:u.map((({key:e,value:t})=>(0,c.Y)(Xe,{title:e,data:t,searchFilter:n,activeMatch:r,containsActiveMatch:f&&"outputs"===r.section&&r.key===e},e)))})})]})}var Kn={name:"s5xdrg",styles:"display:flex;align-items:center"},Wn={name:"s5xdrg",styles:"display:flex;align-items:center"};function Un({shouldRenderMarkdown:e,setShouldRenderMarkdown:t}){const{theme:n}=(0,l.u)();return(0,c.FD)(o.SegmentedControlGroup,{"data-testid":"model-trace-explorer-render-mode-toggle",name:"render-mode",size:"small",componentId:`shared.model-trace-explorer.toggle-markdown-rendering-${!e}`,value:e,onChange:e=>{t(e.target.value)},children:[(0,c.Y)(o.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-raw-input-button",value:!1,children:(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.raw-input-rendering-tooltip",content:(0,c.Y)(d.sA,{id:"NMxAot",defaultMessage:"Raw input"}),children:(0,c.Y)("div",{css:Kn,children:(0,c.Y)(o.TextBoxIcon,{css:(0,p.AH)({fontSize:n.typography.fontSizeLg},"")})})})}),(0,c.Y)(o.SegmentedControlButton,{"data-testid":"model-trace-explorer-render-default-button",value:!0,children:(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.default-rendering-tooltip",content:(0,c.Y)(d.sA,{id:"xwe7WH",defaultMessage:"Default rendering"}),children:(0,c.Y)("div",{css:Wn,children:(0,c.Y)(o.MarkdownIcon,{css:(0,p.AH)({fontSize:n.typography.fontSizeLg},"")})})})})]})}var Gn={name:"1s4awny",styles:"display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:100%"};function Jn({activeSpan:e,className:t,searchFilter:n,activeMatch:r}){const{theme:a}=(0,l.u)(),[u,m]=(0,s.useState)(!0),g=(0,s.useMemo)((()=>(0,i.g_)(e.inputs)),[e]),f=e.outputs,v=g.length>0,x=!(0,h.isNil)(r)&&r.span.key===e.key,y=x&&"outputs"===r.section;return(0,c.FD)("div",{className:t,"data-testid":"model-trace-explorer-retriever-span-view",children:[v&&(0,c.Y)(Ce,{sectionKey:"input",css:(0,p.AH)({marginBottom:a.spacing.sm},""),title:(0,c.Y)(d.sA,{id:"/TX1Az",defaultMessage:"Inputs"}),children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:a.spacing.sm},""),children:g.map((({key:e,value:t},s)=>(0,c.Y)(Xe,{title:e,data:t,searchFilter:n,activeMatch:r,containsActiveMatch:x&&"inputs"===r.section&&r.key===e},e||s)))})}),(0,c.Y)(Ce,{sectionKey:"output",title:(0,c.FD)("div",{css:Gn,children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:a.spacing.sm},""),children:[(0,c.Y)(d.sA,{id:"ThYYz6",defaultMessage:"Documents"}),(0,c.Y)(o.Tag,{componentId:"shared.model-trace-explorer.document-count",children:f.length})]}),!y&&(0,c.Y)(Un,{shouldRenderMarkdown:u,setShouldRenderMarkdown:m})]}),children:u&&!y?(0,c.Y)("div",{css:(0,p.AH)({border:`1px solid ${a.colors.border}`,borderRadius:a.legacyBorders.borderRadiusMd},""),children:f.map(((e,t)=>(0,c.Y)("div",{css:(0,p.AH)({borderBottom:t!==f.length-1?`1px solid ${a.colors.border}`:""},""),children:(0,c.Y)(je,{text:e.page_content,metadata:e.metadata},t)},t)))}):(0,c.Y)("div",{css:(0,p.AH)({border:`1px solid ${a.colors.border}`,borderRadius:a.legacyBorders.borderRadiusMd,padding:a.spacing.md},""),children:(0,c.Y)(Xe,{title:"",data:JSON.stringify(f,null,2),searchFilter:n,activeMatch:r,containsActiveMatch:x&&"outputs"===r.section})})})]})}function qn({activeSpan:e,className:t,searchFilter:n,activeMatch:s}){const{theme:r}=(0,l.u)();return!(0,h.isNil)(e)&&(0,i.vl)(e)?(0,c.Y)("div",{css:(0,p.AH)({overflowY:"auto",padding:r.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,c.Y)(Jn,{activeSpan:e,className:t,searchFilter:n,activeMatch:s})}):(0,c.Y)("div",{css:(0,p.AH)({overflowY:"auto",padding:r.spacing.md},""),className:t,"data-testid":"model-trace-explorer-content-tab",children:(0,c.Y)(Pn,{activeSpan:e,className:t,searchFilter:n,activeMatch:s})})}function Xn({activeSpan:e,searchFilter:t,activeMatch:n}){const{theme:s}=(0,l.u)(),{events:r}=e,a=!(0,h.isNil)(n)&&n.span.key===e.key;return Array.isArray(r)&&0!==r.length?(0,c.Y)("div",{css:(0,p.AH)({padding:s.spacing.md},""),children:r.map(((e,r)=>{const d=e.attributes,u="exception"===e.name?(0,c.FD)(c.FK,{children:[(0,c.Y)(o.XCircleIcon,{css:(0,p.AH)({marginRight:s.spacing.sm},""),color:"danger"}),(0,c.Y)(l.T.Text,{color:"error",bold:!0,children:"Exception"})]}):e.name;return d?(0,c.Y)(Ce,{sectionKey:e.name,title:u,withBorder:!0,children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:s.spacing.sm},""),children:Object.keys(d).map((s=>{const o=(0,i.Q0)(e.name,r,s);return(0,c.Y)(Xe,{title:s,data:JSON.stringify(d[s],null,2),searchFilter:t,activeMatch:n,containsActiveMatch:a&&"events"===n.section&&n.key===o,initialRenderMode:m.cC.TEXT},o)}))})},`${e.name}-${r}`):null}))}):(0,c.Y)("div",{css:(0,p.AH)({marginTop:s.spacing.md},""),children:(0,c.Y)(o.Empty,{description:(0,c.Y)(d.sA,{id:"xnr5KT",defaultMessage:"No events found"})})})}var Qn=n(76127);function Zn({activeSpan:e,searchFilter:t,activeMatch:n,activeTab:r,setActiveTab:a}){const{theme:u}=(0,l.u)(),[m,g]=(0,s.useState)(500),f={flex:1,marginTop:-u.spacing.md,overflowY:"auto"},{assessmentsPaneExpanded:v,assessmentsPaneEnabled:x,isInComparisonView:y}=J();if((0,h.isNil)(e))return(0,c.Y)(o.Empty,{description:"Please select a span to view more information"});const b=(0,i.N7)(e),Y=b>0,A=!(0,h.isNil)(null===e||void 0===e?void 0:e.inputs)||!(0,h.isNil)(null===e||void 0===e?void 0:e.outputs),T=(0,c.FD)(o.Tabs.Root,{componentId:"shared.model-trace-explorer.right-pane-tabs",css:(0,p.AH)({display:"flex",flexDirection:"column",flex:1,borderLeft:`1px solid ${u.colors.border}`,minWidth:200,position:"relative"},""),value:r,onValueChange:e=>a(e),children:[(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",right:v?u.spacing.xs:u.spacing.md,top:u.spacing.xs},""),children:(0,c.Y)(Yt,{})}),(0,c.FD)(o.Tabs.List,{css:(0,p.AH)({padding:0,paddingLeft:u.spacing.md,paddingRight:u.spacing.sm,boxSizing:"border-box",width:"100%"},""),children:[e.chatMessages&&(0,c.Y)(o.Tabs.Trigger,{value:"chat",children:(0,c.Y)(d.sA,{id:"BkDhmT",defaultMessage:"Chat"})}),A&&(0,c.Y)(o.Tabs.Trigger,{value:"content",children:(0,c.Y)(d.sA,{id:"KW2dOC",defaultMessage:"Inputs / Outputs"})}),(0,c.Y)(o.Tabs.Trigger,{value:"attributes",children:"Attributes"}),(0,c.FD)(o.Tabs.Trigger,{value:"events",children:["Events ",Y&&(0,c.Y)(Qn.X,{count:b})]})]}),e.chatMessages&&(0,c.Y)(o.Tabs.Content,{css:f,value:"chat",children:(0,c.Y)(jn,{chatMessages:e.chatMessages,chatTools:e.chatTools})}),(0,c.Y)(o.Tabs.Content,{css:f,value:"content",children:(0,c.Y)(qn,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,c.Y)(o.Tabs.Content,{css:f,value:"attributes",children:(0,c.Y)($n,{activeSpan:e,searchFilter:t,activeMatch:n})}),(0,c.Y)(o.Tabs.Content,{css:f,value:"events",children:(0,c.Y)(Xn,{activeSpan:e,searchFilter:t,activeMatch:n})})]}),w=(0,c.Y)(En,{assessments:e.assessments,traceId:e.traceId,activeSpanId:e.parentId?String(e.key):void 0});return!y&&x&&v?(0,c.Y)(kt,{initialRatio:.7,paneWidth:m,setPaneWidth:g,leftChild:T,leftMinWidth:250,rightChild:w,rightMinWidth:Rt}):T}const es=s.memo(Zn),ts=({spanFilterState:e,setSpanFilterState:t})=>{const{theme:n}=(0,l.u)();return(0,c.FD)(l.aw.Root,{componentId:"shared.model-trace-explorer.timeline-tree-filter-popover",children:[(0,c.Y)(l.aw.Trigger,{asChild:!0,children:(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.timeline-tree-filter-button",icon:(0,c.Y)(o.FilterIcon,{}),size:"small",children:(0,c.Y)(d.sA,{id:"Dm4Ez0",defaultMessage:"Filter"})})}),(0,c.Y)(l.aw.Content,{align:"start",children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,paddingBottom:n.spacing.xs},""),children:[(0,c.Y)(l.T.Text,{bold:!0,children:(0,c.Y)(d.sA,{id:"oy2LTl",defaultMessage:"Filter"})}),(0,c.Y)(l.T.Text,{color:"secondary",children:(0,c.Y)(d.sA,{id:"rgSaFx",defaultMessage:"Span type"})}),Object.entries(e.spanTypeDisplayState).map((([s,r])=>{const a=(0,c.Y)(Qe.P,{type:(0,i.tC)(s)});return(0,c.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-span-filter_${s}-${!r}`,style:{width:"100%"},isChecked:r,onChange:()=>t({...e,spanTypeDisplayState:{...e.spanTypeDisplayState,[s]:!r}}),children:[a,(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginLeft:n.spacing.xs},""),children:(0,i.LS)(s)})]},s)})),(0,c.Y)(l.T.Text,{color:"secondary",children:(0,c.Y)(d.sA,{id:"SrV58C",defaultMessage:"Settings"})}),(0,c.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showParents}`,style:{width:"100%"},isChecked:e.showParents,onChange:()=>t({...e,showParents:!e.showParents}),children:[(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginRight:n.spacing.xs},""),children:(0,c.Y)(d.sA,{id:"nYSJgH",defaultMessage:"Show all parent spans"})}),(0,c.Y)(o.InfoTooltip,{componentId:"shared.model-trace-explorer.show-parents-tooltip",content:(0,c.Y)(d.sA,{id:"H9MulE",defaultMessage:"Always show parents of matched spans, regardless of filter conditions"})})]}),(0,c.FD)(o.Checkbox,{componentId:`shared.model-trace-explorer.toggle-show-parents_${!e.showExceptions}`,style:{width:"100%"},isChecked:e.showExceptions,onChange:()=>t({...e,showExceptions:!e.showExceptions}),children:[(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginRight:n.spacing.xs},""),children:(0,c.Y)(d.sA,{id:"/vhBCt",defaultMessage:"Show exceptions"})}),(0,c.Y)(o.InfoTooltip,{componentId:"shared.model-trace-explorer.show-exceptions-tooltip",content:(0,c.Y)(d.sA,{id:"60b0vW",defaultMessage:"Always show spans with exceptions, regardless of filter conditions"})})]})]})})]})},ns=({showTimelineInfo:e,setShowTimelineInfo:t,spanFilterState:n,setSpanFilterState:s})=>{const{theme:r}=(0,l.u)();return(0,c.FD)("div",{css:(0,p.AH)({padding:`${r.spacing.xs}px ${r.spacing.sm}px`,paddingBottom:3,borderBottom:`1px solid ${r.colors.border}`,boxSizing:"border-box",paddingLeft:r.spacing.sm,alignItems:"center",display:"flex",justifyContent:"space-between"},""),children:[(0,c.Y)(l.T.Text,{bold:!0,children:(0,c.Y)(d.sA,{id:"w48V74",defaultMessage:"Trace breakdown"})}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:r.spacing.sm},""),children:[(0,c.Y)(ts,{spanFilterState:n,setSpanFilterState:s}),(0,c.FD)(o.SegmentedControlGroup,{name:"size-story",value:e,onChange:e=>{t(e.target.value)},size:"small",componentId:"shared.model-trace-explorer.toggle-show-timeline",children:[(0,c.Y)(o.SegmentedControlButton,{"data-testid":"hide-timeline-info-button",icon:(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.hide-timeline-info-tooltip",content:(0,c.Y)(d.sA,{id:"E9fsRD",defaultMessage:"Show span tree"}),children:(0,c.Y)(o.ListBorderIcon,{})}),value:!1}),(0,c.Y)(o.SegmentedControlButton,{"data-testid":"show-timeline-info-button",icon:(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.show-timeline-info-tooltip",content:(0,c.Y)(d.sA,{id:"r5t1Je",defaultMessage:"Show execution timeline"}),children:(0,c.Y)(o.BarsAscendingVerticalIcon,{})}),value:!0})]})]})]})},ss=({active:e})=>{const{theme:t}=(0,l.u)(),n=e?t.colors.blue500:t.colors.border;return(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",left:"100%",bottom:0,width:U.De/2+1,height:t.spacing.md,boxSizing:"border-box",borderTopRightRadius:t.borders.borderRadiusMd,borderTop:`1px solid ${n}`,borderRight:`1px solid ${n}`,zIndex:U.u4.LOW},"")})},rs=({active:e})=>{const{theme:t}=(0,l.u)(),n=e?t.colors.blue500:t.colors.border;return(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",left:"50%",top:0,width:U.De/2,height:t.spacing.md,boxSizing:"border-box",borderBottomLeftRadius:t.borders.borderRadiusMd,borderBottom:`1px solid ${n}`,borderLeft:`1px solid ${n}`,zIndex:e?U.u4.NORMAL:U.u4.LOW},"")})},as=({active:e})=>{const{theme:t}=(0,l.u)(),n=e?t.colors.blue500:t.colors.border;return(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",width:U.De/2,left:"50%",height:U.QJ,borderLeft:`1px solid ${n}`,boxSizing:"border-box",zIndex:e?U.u4.NORMAL:U.u4.LOW},"")})},is=({isActiveSpan:e,isInActiveChain:t,linesToRender:n,hasChildren:s,isExpanded:r})=>0===n.length?(0,c.Y)("div",{css:(0,p.AH)({width:0,height:U.QJ,boxSizing:"border-box",position:"relative"},""),children:s&&(0,c.Y)(ss,{active:t&&!e})}):(0,c.Y)(c.FK,{children:n.map((({shouldRender:a,isActive:i},o)=>(0,c.FD)("div",{css:(0,p.AH)({width:U.De,height:U.QJ,boxSizing:"border-box",position:"relative"},""),children:[a&&(0,c.Y)(as,{active:i}),o===n.length-1&&(0,c.FD)(c.FK,{children:[(0,c.Y)(rs,{active:t}),s&&r&&(0,c.Y)(ss,{active:t&&!e})]})]},o)))});var os={name:"1fttcpj",styles:"display:flex;flex-direction:column"};const ls=({span:e,children:t})=>{var n;const{theme:s}=(0,l.u)(),r=(0,i.tC)(null!==(n=e.type)&&void 0!==n?n:m.UG.UNKNOWN),a=s.isDarkMode?s.colors.grey800:s.colors.grey100,o=s.isDarkMode?s.colors.grey500:s.colors.grey350;return(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.timeline-tree-node-tooltip",hideWhenDetached:!1,content:(0,c.FD)("div",{css:os,children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",gap:s.spacing.xs,alignItems:"center",overflow:"hidden",wordBreak:"break-all"},""),children:[(0,c.Y)(Qe.P,{type:r,isInTooltip:!0}),(0,c.Y)("span",{css:(0,p.AH)({color:a},""),children:e.title}),(0,c.Y)("span",{css:(0,p.AH)({marginLeft:s.spacing.xs,color:o,fontSize:s.typography.fontSizeSm},""),children:(0,U.X6)(e.end-e.start)})]}),(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",color:a},""),children:[(0,c.Y)(d.sA,{id:"YV6xFB",defaultMessage:"Start:"})," ",(0,U.X6)(e.start)," | ",(0,c.Y)(d.sA,{id:"q90jVU",defaultMessage:"End:"})," ",(0,U.X6)(e.end)]})]}),side:"right",maxWidth:700,children:t})};var ds={name:"18mz9c1",styles:"display:flex;flex-direction:row;align-items:center;overflow:hidden;flex:1"},cs={name:"adzntw",styles:"overflow:hidden;white-space:nowrap;text-overflow:ellipsis;flex:1"};const us=({node:e,selectedKey:t,expandedKeys:n,setExpandedKeys:s,traceStartTime:r,traceEndTime:a,onSelect:d,linesToRender:u})=>{var m,h;const g=n.has(e.key),{theme:f}=(0,l.u)(),v=(null!==(m=e.children)&&void 0!==m?m:[]).length>0,{setAssessmentsPaneExpanded:x}=J(),y=t===e.key,b=(0,U.VD)(e,String(t)),Y=b>-1,A=(0,i.N7)(e)>0,T=y?f.colors.actionDefaultBackgroundHover:"transparent";return(0,c.FD)(c.FK,{children:[(0,c.Y)(ls,{span:e,children:(0,c.Y)("div",{"data-testid":`timeline-tree-node-${e.key}`,css:(0,p.AH)({display:"flex",flexDirection:"column",width:"100%",cursor:"pointer",boxSizing:"border-box",backgroundColor:T,":hover":{backgroundColor:f.colors.actionDefaultBackgroundHover},":active":{backgroundColor:f.colors.actionDefaultBackgroundPress}},""),onClick:()=>{null===d||void 0===d||d(e)},children:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",padding:`0px ${f.spacing.sm}px`,justifyContent:"space-between",overflow:"hidden",flex:1},""),children:(0,c.FD)("div",{css:ds,children:[v?(0,c.Y)(l.B,{size:"small","data-testid":`toggle-span-expanded-${e.key}`,css:(0,p.AH)({flexShrink:0,marginRight:f.spacing.xs},""),icon:g?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:t=>{t.stopPropagation();const r=new Set(n);g?r.delete(e.key):r.add(e.key),s(r)},componentId:"shared.model-trace-explorer.toggle-span"}):(0,c.Y)("div",{css:(0,p.AH)({width:24,marginRight:f.spacing.xs},"")}),(0,c.Y)(is,{isActiveSpan:y,isInActiveChain:Y,linesToRender:u,hasChildren:v,isExpanded:g}),(0,c.Y)("span",{css:(0,p.AH)({flexShrink:0,marginRight:f.spacing.xs,borderRadius:f.borders.borderRadiusSm,border:`1px solid ${b>-1?f.colors.blue500:f.colors.backgroundSecondary}`,zIndex:U.u4.NORMAL},""),children:e.icon}),(0,c.Y)(l.T.Text,{color:A?"error":"primary",css:cs,children:e.title}),e.assessments.length>0&&(0,c.FD)(o.Tag,{color:"indigo","data-testid":`assessment-tag-${e.key}`,componentId:"shared.model-trace-explorer.assessment-count",css:(0,p.AH)({margin:0,borderRadius:f.borders.borderRadiusSm},""),onClick:()=>null===x||void 0===x?void 0:x(!0),children:[(0,c.Y)(o.GavelIcon,{}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginLeft:f.spacing.xs},""),children:e.assessments.length})]})]})})})}),g&&(null===(h=e.children)||void 0===h?void 0:h.map(((i,o)=>{var l,p;return(0,c.Y)(us,{node:i,expandedKeys:n,setExpandedKeys:s,selectedKey:t,traceStartTime:r,traceEndTime:a,onSelect:d,linesToRender:u.concat({shouldRender:o<(null!==(l=null===(p=e.children)||void 0===p?void 0:p.length)&&void 0!==l?l:0)-1,isActive:o<b})},i.key)})))]})};var ps={name:"1j2qjqs",styles:"flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis"};const ms=({node:e,selectedKey:t,leftOffset:n,width:r,onSelect:a,expandedKeys:i,setExpandedKeys:d})=>{var u;const{theme:m}=(0,l.u)(),h=(0,s.useRef)(null),g=(0,s.useRef)(null),f=t===e.key?m.colors.actionDefaultBackgroundHover:"transparent",v=(null!==(u=e.children)&&void 0!==u?u:[]).length>0,x=i.has(e.key);return(0,s.useLayoutEffect)((()=>{if(!h.current||!g.current)return;Math.max(h.current.offsetWidth,g.current.offsetWidth)<r-m.spacing.sm?(h.current.style.display="inline",g.current.style.display="none"):(h.current.style.display="none",g.current.style.display="inline")}),[m.spacing.sm,r]),(0,c.Y)(ls,{span:e,children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",cursor:"pointer",boxSizing:"border-box",paddingLeft:m.spacing.xs,paddingRight:m.spacing.sm,paddingTop:m.spacing.xs,paddingBottom:m.spacing.xs,backgroundColor:f,alignItems:"center",":hover":{backgroundColor:m.colors.actionDefaultBackgroundHover},":active":{backgroundColor:m.colors.actionDefaultBackgroundPress},zIndex:U.u4.NORMAL},""),onClick:()=>null===a||void 0===a?void 0:a(e),children:[v?(0,c.Y)(l.B,{size:"small","data-testid":`toggle-timeline-span-expanded-${e.key}`,css:(0,p.AH)({flexShrink:0,marginRight:m.spacing.xs},""),icon:x?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:t=>{t.stopPropagation();const n=new Set(i);x?n.delete(e.key):n.add(e.key),d(n)},componentId:"shared.model-trace-explorer.toggle-timeline-span"}):(0,c.Y)("div",{css:(0,p.AH)({width:24,marginRight:m.spacing.xs},"")}),(0,c.Y)("div",{css:(0,p.AH)({width:n,flexShrink:0},"")}),(0,c.Y)("div",{css:(0,p.AH)({position:"relative",width:r,height:m.typography.lineHeightBase,backgroundColor:m.colors.blue600,borderRadius:m.borders.borderRadiusSm,flexShrink:0},""),children:(0,c.Y)(l.T.Text,{children:(0,c.Y)("span",{ref:h,css:(0,p.AH)({marginLeft:m.spacing.xs,color:m.colors.white,display:"none"},""),children:e.title})})}),(0,c.FD)("div",{css:ps,children:[(0,c.Y)(l.T.Text,{children:(0,c.Y)("span",{ref:g,css:(0,p.AH)({marginLeft:m.spacing.xs,color:m.colors.textPrimary},""),children:e.title})}),(0,c.Y)(l.T.Text,{css:(0,p.AH)({marginLeft:m.spacing.xs},""),color:"secondary",children:(0,U.X6)(e.end-e.start)})]})]},e.key)})};var hs={name:"1c2ejnx",styles:"display:flex;flex-direction:column;position:relative;box-sizing:border-box"},gs={name:"bjn8wh",styles:"position:relative"},fs={name:"xyyuvf",styles:"position:absolute;height:100%;width:100%"};const vs=({nodes:e,selectedKey:t,onSelect:n,traceStartTime:r,traceEndTime:a,expandedKeys:i,setExpandedKeys:o})=>{var d,u;const{theme:m}=(0,l.u)(),h=(0,s.useRef)(null),g=null!==(d=null===(u=(0,wt.wY)({ref:h}))||void 0===u?void 0:u.width)&&void 0!==d?d:0,f=(0,s.useMemo)((()=>function(e,t,n,s=60){const r=t-e;if(r<=0||n<=0)return[];const a=Math.floor(n/s);if(a<1)return[];const i=r/a,o=Math.pow(10,Math.floor(Math.log10(i))),l=i/o;let d;d=l<=1?1:l<=2?2:l<=5?5:10;const c=d*o,u=t+2*c,p=[];for(let m=Math.ceil(e/c)*c;m<=u;m+=c)p.push(Number(m.toFixed(10)));return p}(r,a,g)),[a,r,g]),v=Math.min(...f),x=(f[f.length-1]+f[f.length-2])/2,y=f.slice(0,-1),b=e=>function(e,t,n,s){return(e-t)/(n-t)*s}(e,v,x,g);return(0,c.FD)("div",{css:hs,children:[(0,c.Y)("div",{ref:h,css:(0,p.AH)({display:"flex",width:"100%",flexDirection:"row",height:m.typography.lineHeightBase,paddingLeft:32,paddingRight:m.spacing.lg,boxSizing:"border-box",position:"sticky",top:0,backgroundColor:m.colors.backgroundPrimary,zIndex:U.u4.HIGH},""),children:(0,c.Y)("div",{"data-testid":"time-marker-area",css:gs,children:y.map((e=>(0,c.Y)(l.T.Text,{css:(0,p.AH)({position:"absolute",transform:"translateX(-50%)",left:b(e),whiteSpace:"nowrap"},""),children:(0,U.X6)(e)},e)))})}),(0,c.Y)("div",{css:(0,p.AH)({flex:1,pointerEvents:"none",zIndex:U.u4.LOW},""),children:(0,c.Y)("div",{css:fs,children:y.map((e=>(0,c.Y)("div",{css:(0,p.AH)({position:"absolute",left:b(e)+32,borderRight:`1px solid ${m.colors.border}`,height:"100%"},"")},e)))})}),e.map((e=>{const s=b(e.start),r=b(e.end)-s;return(0,c.Y)(ms,{selectedKey:t,onSelect:n,node:e,leftOffset:s,width:r,expandedKeys:i,setExpandedKeys:o},e.key)}))]})};var xs={name:"1v8q7xf",styles:"flex:1;overflow:auto;min-height:100%;box-sizing:border-box;display:flex;flex-direction:column"},ys={name:"1jyk3dc",styles:"overflow:hidden;display:flex;flex-direction:column;flex:1"},bs={name:"13ku56z",styles:"display:flex;flex-direction:column;height:100%"},Ys={name:"9nf0yq",styles:"flex:1;overflow-y:auto;display:flex"};const As=({rootNodes:e,selectedNode:t,setSelectedNode:n,traceStartTime:r,traceEndTime:a,expandedKeys:i,setExpandedKeys:o,spanFilterState:u,setSpanFilterState:m,className:h})=>{const{theme:g}=(0,l.u)(),f=(0,s.useCallback)((e=>{null===n||void 0===n||n(e)}),[n]),{showTimelineTreeGantt:v,setShowTimelineTreeGantt:x}=J(),y=(0,s.useMemo)((()=>(0,U.os)(e,i)),[e,i]),b=(0,s.useMemo)((()=>{var n;return(0,c.Y)("div",{css:xs,children:v?(0,c.Y)(vs,{nodes:y,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",onSelect:f,traceStartTime:r,traceEndTime:a,expandedKeys:i,setExpandedKeys:o}):e.map((e=>{var n;return(0,c.Y)(us,{node:e,expandedKeys:i,setExpandedKeys:o,selectedKey:null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:"",traceStartTime:r,traceEndTime:a,onSelect:f,linesToRender:[]},e.key)}))})}),[v,y,null===t||void 0===t?void 0:t.key,f,r,a,e,i,o]);return(0,c.Y)("div",{css:(0,p.AH)({height:"100%",borderRadius:g.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),className:h,children:(0,c.Y)("div",{css:ys,children:(0,c.FD)("div",{css:bs,children:[(0,c.Y)(ns,{showTimelineInfo:v,setShowTimelineInfo:x,spanFilterState:u,setSpanFilterState:m}),e.length>0?(0,c.Y)("div",{css:Ys,children:b}):(0,c.Y)("div",{css:(0,p.AH)({flex:1,display:"flex",justifyContent:"center",padding:g.spacing.md,paddingTop:g.spacing.lg},""),children:(0,c.Y)(d.sA,{id:"4pXg9j",defaultMessage:"No results found. Try using a different search term."})})]})})})};var Ts={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},ws={name:"82a6rk",styles:"flex:1"};const Ss=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:r})=>{var a,i;const{theme:o}=(0,l.u)(),d=window.innerWidth<=768?.33:.25,u=(0,s.useRef)(null),[m,g]=(0,s.useState)(500),{rootNode:f,selectedNode:v,setSelectedNode:x,activeTab:y,setActiveTab:b,isInComparisonView:Y}=J(),{expandedKeys:A,setExpandedKeys:T}=(0,U.B$)({rootNodes:f?[f]:[],initialExpandDepth:U.vf}),{matchData:w,searchFilter:S,setSearchFilter:M,spanFilterState:I,setSpanFilterState:k,filteredTreeNodes:D,handleNextSearchMatch:C,handlePreviousSearchMatch:N}=Bn({treeNode:f,selectedNode:v,setSelectedNode:x,setActiveTab:b,setExpandedKeys:T,modelTraceInfo:e});(0,s.useLayoutEffect)((()=>{const e=(0,h.values)((0,U.dM)(D,U.vf)).map((e=>e.key));T(new Set(e))}),[D,T]);const F=(0,s.useMemo)((()=>{const e=Math.max(...D.map(U.EA))*U.De+7*o.spacing.lg;return Math.max(275,e)}),[D,o.spacing.lg]);return(0,c.FD)("div",{css:Ts,className:t,children:[(0,c.Y)("div",{css:(0,p.AH)({padding:o.spacing.xs,borderBottom:`1px solid ${o.colors.border}`},""),children:(0,c.Y)(Ln,{searchFilter:S,setSearchFilter:M,matchData:w,handleNextSearchMatch:C,handlePreviousSearchMatch:N})}),(0,c.Y)(kt,{ref:u,initialRatio:d,paneWidth:m,setPaneWidth:g,leftChild:(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",flex:1,minWidth:F},""),children:(0,c.Y)(As,{rootNodes:D,selectedNode:v,traceStartTime:null!==(a=null===f||void 0===f?void 0:f.start)&&void 0!==a?a:0,traceEndTime:null!==(i=null===f||void 0===f?void 0:f.end)&&void 0!==i?i:0,setSelectedNode:e=>{x(e),(0,h.isString)(null===e||void 0===e?void 0:e.key)&&(null===r||void 0===r||r(null===e||void 0===e?void 0:e.key))},css:ws,expandedKeys:A,setExpandedKeys:T,spanFilterState:I,setSpanFilterState:k})}),leftMinWidth:F,rightChild:(0,c.Y)(es,{activeSpan:v,searchFilter:S,activeMatch:w.match,activeTab:y,setActiveTab:b}),rightMinWidth:500})]})};var Ms={name:"3epor4",styles:"& > div:nth-of-type(1){margin-bottom:0;flex-shrink:0;}display:flex;flex-direction:column;height:100%;overflow:hidden"},Is={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"},ks={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const Ds=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:r})=>{const{theme:a}=(0,l.u)(),{activeView:i,setActiveView:u}=J(),m=(0,s.useCallback)((e=>{u(e)}),[u]);return(0,c.FD)(o.Tabs.Root,{componentId:"shared.model-trace-explorer.view-mode-toggle",value:i,onValueChange:m,css:Ms,children:[(0,c.FD)(o.Tabs.List,{css:(0,p.AH)({paddingLeft:a.spacing.md,flexShrink:0},""),children:[(0,c.Y)(o.Tabs.Trigger,{value:"summary",children:(0,c.Y)(d.sA,{id:"paolVF",defaultMessage:"Summary"})}),(0,c.Y)(o.Tabs.Trigger,{value:"detail",children:(0,c.Y)(d.sA,{id:"Wh+aKq",defaultMessage:"Details & Timeline"})})]}),(0,c.Y)(o.Tabs.Content,{value:"summary",css:Is,children:(0,c.Y)(Hn,{})}),(0,c.Y)(o.Tabs.Content,{value:"detail",css:ks,children:(0,c.Y)(Ss,{modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:r})})]})};var Cs={name:"l2hjmg",styles:"display:flex;flex-direction:column;flex:1;min-height:0"};const Ns=({modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:s})=>{var r,a,i;const{theme:u}=(0,l.u)(),{assessmentsPaneEnabled:m,assessmentsPaneExpanded:h,setAssessmentsPaneExpanded:g,rootNode:f,selectedNode:v}=J();return(0,c.FD)("div",{css:Cs,children:[(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:u.spacing.xs,padding:`0px ${u.spacing.sm}px`,marginBottom:u.spacing.xs},""),children:[(0,c.Y)(l.B,{size:"small",componentId:"shared.model-trace-explorer.toggle-assessments-pane",icon:h?(0,c.Y)(o.ChevronDownIcon,{}):(0,c.Y)(l.o,{}),onClick:()=>g(!h)}),(0,c.Y)(l.T.Text,{bold:!0,children:(0,c.Y)(d.sA,{id:"++Ydlz",defaultMessage:"Assessments"})})]}),m&&h&&(0,c.Y)("div",{css:(0,p.AH)({marginBottom:u.spacing.sm,padding:u.spacing.sm,paddingTop:0},""),children:(0,c.Y)(En,{assessments:null!==(r=null===f||void 0===f?void 0:f.assessments)&&void 0!==r?r:[],traceId:null!==(a=null===f||void 0===f?void 0:f.traceId)&&void 0!==a?a:"",activeSpanId:null!==(i=null===v||void 0===v?void 0:v.key)&&void 0!==i?i:""})}),(0,c.Y)(Ds,{modelTraceInfo:e,className:t,selectedSpanId:n,onSelectSpan:s})]})},Fs=({children:e})=>(0,c.Y)(r.tH,{fallbackRender:u,children:e}),Es=({modelTrace:e,className:t,initialActiveView:n,selectedSpanId:r,onSelectSpan:o,collapseAssessmentPane:l,isInComparisonView:d})=>{var u;const[p,m]=(0,s.useState)(e),[h,g]=(0,s.useState)(!1),f=(0,i.MF)(e),v=null!==(u=(0,i.ob)(e))&&void 0!==u?u:0,x=!(0,a.ny)()||v<(0,a.T9)(),[y,b]=(0,s.useState)(f.startsWith("tr-")),[Y,A]=(0,s.useState)(!0),{isFetching:T}=Ie({traceId:f,setModelTrace:m,setAssessmentsPaneEnabled:b,enabled:x}),w=Y&&T;(0,s.useEffect)((()=>{m(e),A(!0)}),[f]),(0,s.useEffect)((()=>{Y&&!T&&A(!1)}),[Y,T]);const S=ke((e=>e.resetCache));return(0,s.useEffect)((()=>{S()}),[S]),x||h?(0,c.Y)(Fs,{traceId:f,children:(0,c.FD)(q,{modelTrace:p,initialActiveView:n,selectedSpanIdOnRender:r,assessmentsPaneEnabled:y,isInComparisonView:d,initialAssessmentsPaneCollapsed:l,isTraceInitialLoading:w,children:[(0,c.Y)(ve,{modelTraceInfo:p.info}),d?(0,c.Y)(Ns,{modelTraceInfo:p.info}):(0,c.Y)(Ds,{modelTraceInfo:p.info,className:t,selectedSpanId:r,onSelectSpan:o})]})}):(0,c.Y)(W,{traceId:f,setForceDisplay:g})};var Hs={name:"11qaxcx",styles:"display:inline-flex;max-width:100%"},Rs={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"};const _s=({metadata:e})=>{const{theme:t}=(0,l.u)(),n=(0,d.tz)(),s=null===e||void 0===e?void 0:e.span_name;if(!e||!s)return null;const r=n.formatMessage({id:"S3YY1P",defaultMessage:"Span: {spanName}"},{spanName:s});return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexWrap:"wrap",gap:t.spacing.xs},""),children:(0,c.Y)(Q.T,{componentId:"shared.model-trace-explorer.span-name-tooltip",content:r,children:(0,c.Y)(o.Tag,{css:Hs,componentId:"shared.model-trace-explorer.span-name-tag",color:"default",children:(0,c.Y)("span",{css:Rs,children:r})})})})};var Ls={name:"ozd7xs",styles:"flex-shrink:0"},Os={name:"1bnhmdk",styles:"overflow:hidden;text-overflow:ellipsis;text-wrap:nowrap"},Bs={name:"s5xdrg",styles:"display:flex;align-items:center"};const $s=({assessment:e})=>{const{theme:t}=(0,l.u)(),n=(0,Ct.e)(e),s=e.rationale,r=!(0,h.isNil)(e.feedback.error);return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",border:`1px solid ${t.colors.border}`,borderRadius:t.borders.borderRadiusMd,padding:t.spacing.md,gap:t.spacing.sm},""),children:[(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:t.spacing.sm},""),children:(0,c.FD)("div",{css:(0,p.AH)({display:"flex",alignItems:"center",gap:t.spacing.sm,flex:1,minWidth:0},""),children:[(0,c.Y)(o.GavelIcon,{css:Ls}),(0,c.Y)(l.T.Text,{bold:!0,css:Os,children:e.assessment_name})]})}),r&&(0,c.Y)(un,{error:e.feedback.error}),!r&&void 0!==n&&(0,c.Y)("div",{css:Bs,children:(0,c.Y)(ln,{jsonValue:JSON.stringify(n)})}),(0,c.Y)(_s,{metadata:e.metadata}),s&&(0,c.Y)(l.T.Text,{css:(0,p.AH)({color:t.colors.textSecondary,lineHeight:t.typography.lineHeightBase},""),children:s})]})},js=({assessments:e})=>{const{theme:t}=(0,l.u)(),n=(0,s.useMemo)((()=>e.filter((e=>"feedback"in e&&!1!==e.valid))),[e]);return 0===n.length?(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",padding:t.spacing.md,minWidth:300,height:"100%",borderLeft:`1px solid ${t.colors.border}`},""),children:(0,c.Y)(l.T.Text,{color:"secondary",children:(0,c.Y)(d.sA,{id:"PKwacx",defaultMessage:"No assessments available"})})}):(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",padding:t.spacing.md,paddingTop:t.spacing.sm,gap:t.spacing.md,minWidth:300,height:"100%",borderLeft:`1px solid ${t.colors.border}`,overflowY:"auto"},""),children:n.map((e=>(0,c.Y)($s,{assessment:e},e.assessment_id)))})};var Vs={name:"13y2nry",styles:"display:flex;flex-direction:column;height:100%;overflow:hidden"};const zs=({assessments:e})=>{const[t,n]=(0,s.useState)(500),{rootNode:r}=J(),a=(0,i.yt)(r);return r?(0,c.Y)("div",{css:Vs,children:(0,c.Y)(kt,{initialRatio:.5,paneWidth:t,setPaneWidth:n,leftChild:(0,c.Y)(At,{rootNode:r,intermediateNodes:a,hideRenderModeSelector:!0}),rightChild:(0,c.Y)(js,{assessments:e}),leftMinWidth:400,rightMinWidth:300})}):null},Ps=({children:e})=>(0,c.Y)(r.tH,{fallbackRender:u,children:e}),Ks=({modelTrace:e,assessments:t})=>{const n=(0,i.MF)(e);return(0,c.Y)(Ps,{traceId:n,children:(0,c.Y)(q,{modelTrace:e,assessmentsPaneEnabled:!0,children:(0,c.Y)(zs,{assessments:t})})})};var Ws={name:"15currb",styles:"display:flex;height:100%"},Us={name:"82a6rk",styles:"flex:1"};const Gs=({label:e})=>{const{theme:t}=(0,l.u)();return(0,c.FD)("div",{css:Ws,children:[(0,c.FD)("div",{css:Us,children:[(0,c.Y)("div",{css:(0,p.AH)({padding:t.spacing.sm,borderBottom:`1px solid ${t.colors.border}`},""),children:(0,c.Y)(o.TitleSkeleton,{label:e})}),(0,c.FD)("div",{css:(0,p.AH)({borderRadius:t.legacyBorders.borderRadiusMd,overflow:"hidden",display:"flex"},""),children:[(0,c.Y)("div",{css:(0,p.AH)({flex:1,padding:t.spacing.sm,borderRight:`1px solid ${t.colors.border}`},""),children:(0,c.Y)(o.TableSkeleton,{lines:5})}),(0,c.Y)("div",{css:(0,p.AH)({flex:2,padding:t.spacing.sm},""),children:(0,c.Y)(o.TableSkeleton,{lines:5})})]})]}),(0,c.Y)("div",{css:(0,p.AH)({padding:t.spacing.md,overflowY:"auto",flex:1},""),children:(0,c.Y)(o.TableSkeleton,{lines:12})})]})};var Js=n(884),qs=n(97407);const Xs={key:"",value:""},Qs=({componentIdPrefix:e,onSuccess:t,onClose:n})=>{const r=`${e}.tag-assignment-modal`,u=(0,d.tz)(),[m,g]=(0,s.useState)(void 0),f=(0,s.useMemo)((()=>m?(0,h.isArray)(m.tags)?m.tags.filter((({key:e})=>!e.startsWith(te))):(0,h.isObject)(m.tags)?Object.entries(m.tags).map((([e,t])=>({key:e,value:String(t)}))).filter((({key:e})=>!e.startsWith(te))):[]:[]),[m]),[v,x]=(0,s.useState)(!1),{theme:y}=(0,l.u)(),b=(0,Js.mN)({mode:"onChange"}),Y=(0,qs.$W)({name:"tags",emptyValue:{key:"",value:""},keyProperty:"key",valueProperty:"value",form:b,defaultValues:f}),A=()=>{x(!1),g(void 0),b.reset({tags:[Xs]}),null===n||void 0===n||n()},{mutate:T,isLoading:w,error:S}=(({onSuccess:e})=>(0,zt.n)({mutationFn:async({deletedTags:e,modelTraceInfo:t,newTags:n})=>{var s;if((0,a.F9)()&&(0,i.gD)(t)&&t.trace_location&&(0,i.ko)(t)){const s=n.map((e=>Te.setTraceTagV4({tag:e,traceLocation:t.trace_location,traceId:t.trace_id}))),r=e.map((e=>Te.deleteTraceTagV4({tagKey:e.key,traceLocation:t.trace_location,traceId:t.trace_id})));return Promise.all([...s,...r])}const r=(0,i.gD)(t)?t.trace_id:null!==(s=t.request_id)&&void 0!==s?s:"",o=n.map((e=>we({tag:e,traceId:r}))),l=e.map((e=>Se({tagKey:e.key,traceId:r})));return Promise.all([...o,...l])},onSuccess:e}))({onSuccess:()=>{A(),null===t||void 0===t||t()}});return{TagAssignmentModal:(0,c.FD)(Q.d,{componentId:r,title:(0,c.Y)(d.sA,{id:"xyEaut",defaultMessage:"Add tags"}),visible:v,destroyOnClose:!0,onCancel:A,footer:(0,c.FD)(c.FK,{children:[(0,c.Y)(l.B,{componentId:`${r}.submit-button`,onClick:A,disabled:w,children:(0,c.Y)(d.sA,{id:"Uf0z53",defaultMessage:"Cancel"})}),(0,c.Y)(l.B,{componentId:`${r}.submit-button`,type:"primary",onClick:b.handleSubmit((async({tags:e})=>{var t,n;if(!m)return;const s=e.filter((({key:e})=>Boolean(e))),r=null!==(t=s.filter((e=>!(null!==f&&void 0!==f&&f.some((t=>t.key===e.key&&t.value===e.value))))))&&void 0!==t?t:[],a=null!==(n=null===f||void 0===f?void 0:f.filter((e=>!s.some((t=>t.key===e.key)))))&&void 0!==n?n:[];T({newTags:r,deletedTags:a,modelTraceInfo:m})})),loading:w,disabled:w,children:(0,c.Y)(d.sA,{id:"r7aGM3",defaultMessage:"Save"})})]}),children:[S&&(0,c.Y)(o.Alert,{type:"error",message:S instanceof Error?S.message:String(S),componentId:`${r}.error`,closable:!1,css:(0,p.AH)({marginBottom:y.spacing.sm},"")}),(0,c.FD)(qs.Es,{...Y,children:[(0,c.FD)(qs.qd,{children:[(0,c.Y)(qs.C2,{children:(0,c.Y)(d.sA,{id:"eLgTRT",defaultMessage:"Key"})}),(0,c.Y)(qs.C2,{children:(0,c.Y)(d.sA,{id:"sBsRzu",defaultMessage:"Value"})})]}),Y.fields.map(((e,t)=>(0,c.FD)(qs.qd,{children:[(0,c.Y)(qs.R0,{index:t,rules:{validate:{unique:e=>{const n=Y.getTagsValues();return(null===n||void 0===n?void 0:n.findIndex((t=>t.key===e)))===t||u.formatMessage({id:"JPd7WA",defaultMessage:"Key must be unique"})},required:e=>{var n;const s=Y.getTagsValues();return!(null!==s&&void 0!==s&&null!==(n=s.at(t))&&void 0!==n&&n.value&&!e)||u.formatMessage({id:"XG8dcL",defaultMessage:"Key is required if value is present"})}}}}),(0,c.Y)(qs.tP,{index:t}),(0,c.Y)(qs.ki,{index:t,componentId:`${r}.remove-button`})]},e.id)))]})]}),showTagAssignmentModal:e=>{g(e),x(!0)},hideTagAssignmentModal:A}},Zs=({trace:e})=>{var t;const{theme:n}=(0,l.u)(),r=(0,s.useMemo)((()=>{var t;return null!==(t=e.data)&&void 0!==t&&t.spans?(0,i.jW)(e):null}),[e]);if(!r)return null;const a=r.chatMessages,o=null!==(t=null===a||void 0===a?void 0:a.slice(null===a||void 0===a?void 0:a.findLastIndex((e=>"user"===e.role))))&&void 0!==t?t:[];if(0!==o.length)return(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:null===o||void 0===o?void 0:o.map(((e,t)=>(0,c.Y)(dt,{message:e,css:(0,p.AH)({maxWidth:"80%",alignSelf:"user"===e.role?"flex-start":"flex-end",borderWidth:2,borderRadius:n.borders.borderRadiusMd},"")},t)))});const u=(0,i.g_)(r.inputs).filter((e=>"null"!==e.value)).reverse(),m=(0,i.g_)(r.outputs).filter((e=>"null"!==e.value)).reverse();return(0,c.FD)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm},""),children:[(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,width:"80%",alignSelf:"flex-start",borderRadius:n.borders.borderRadiusMd,backgroundColor:n.colors.backgroundPrimary},""),children:(0,c.Y)(xt,{title:(0,c.Y)(d.sA,{id:"nJxDSh",defaultMessage:"Inputs"}),data:u,renderMode:"default",sectionKey:"summary-inputs",maxVisibleItems:1,maxVisibleChatMessages:1})}),(0,c.Y)("div",{css:(0,p.AH)({display:"flex",flexDirection:"column",gap:n.spacing.sm,width:"80%",alignSelf:"flex-end",backgroundColor:n.colors.backgroundPrimary},""),children:(0,c.Y)(xt,{title:(0,c.Y)(d.sA,{id:"adVHxN",defaultMessage:"Outputs"}),data:m,renderMode:"default",sectionKey:"summary-outputs",maxVisibleItems:1,maxVisibleChatMessages:1})})]})};const er=e=>"expectation"in e;var tr={name:"idfvfs",styles:"display:flex;justify-content:flex-start"},nr={name:"92hyw0",styles:"max-width:150px"},sr={name:"92hyw0",styles:"max-width:150px"};const rr=({trace:e,getAssessmentTitle:t,onAddAssessmentsClick:n})=>{const{theme:s}=(0,l.u)(),r=(0,i.gD)(e.info)?e.info:null;return null===r||void 0===r||!r.assessments||(0,h.isEmpty)(null===r||void 0===r?void 0:r.assessments)?(0,c.Y)("div",{css:tr,children:(0,c.Y)(l.B,{componentId:"shared.model-trace-explorer.session-view.single-chart-turn-assessments.add-assessment",icon:(0,c.Y)(o.PlusIcon,{}),size:"small",onClick:n,css:[{marginTop:s.spacing.sm},(0,l.i)({backgroundColor:s.colors.backgroundPrimary}),""],children:(0,c.Y)(d.sA,{id:"HTQZeI",defaultMessage:"Evaluate trace"})})}):(0,c.Y)("div",{css:(0,p.AH)({display:"flex",gap:s.spacing.sm,flexWrap:"wrap"},""),children:null===r||void 0===r?void 0:r.assessments.map(((e,n)=>{var s,r;const a=t(e.assessment_name),i=null!==(s=null===(r=(0,Ct.e)(e))||void 0===r?void 0:r.toString())&&void 0!==s?s:"";return(0,c.Y)("div",{children:er(e)?(0,c.Y)(ln,{prefix:(0,c.FD)(c.FK,{children:[a,": "]}),jsonValue:i,css:nr,skipIcons:!0,overrideColor:"default"}):(0,c.FD)(c.FK,{children:[a,": ",(0,c.Y)(ln,{jsonValue:i,css:sr})]})},e.assessment_id)}))})}},81390:function(e,t,n){n.d(t,{B$:function(){return h},De:function(){return l},EA:function(){return v},NP:function(){return x},QJ:function(){return d},VC:function(){return p},VD:function(){return f},X6:function(){return g},dM:function(){return m},fJ:function(){return y},os:function(){return u},u4:function(){return c},vf:function(){return o}});var s=n(76118),r=n(46709),a=n(94664),i=n(86125);const o=1/0,l=16,d=32,c={HIGH:5,NORMAL:3,LOW:1},u=(e,t)=>{const n=[],s=e=>{var r;e&&(n.push(e),t.has(e.key)&&(null===(r=e.children)||void 0===r||r.forEach(s)))};return e.forEach(s),n},p=e=>{const t=[],n=e=>{var s;e&&(t.push(e),null===(s=e.children)||void 0===s||s.forEach(n))};return e.forEach(n),t},m=(e,t=1/0)=>{const n={},s=(e,r)=>{var a;!e||r>t||(n[e.key]=e,null===(a=e.children)||void 0===a||a.forEach((e=>s(e,r+1))))};return e.forEach(s,0),n},h=(e={})=>{const[t,n]=(0,r.useState)((()=>{if(e.rootNodes){const t=(0,s.values)(m(e.rootNodes,e.initialExpandDepth)).map((e=>e.key));return new Set(t)}return new Set}));return{expandedKeys:t,setExpandedKeys:n}},g=e=>{if(0===e)return"0s";if(e>=6e7){return`${(e/1e6/60).toFixed(2)}m`}if(e>=1e5){return`${(e/1e6).toFixed(2)}s`}return`${(e/1e3).toFixed(2)}ms`},f=(e,t)=>{var n;return e.key===t?0:(null!==(n=e.children)&&void 0!==n?n:[]).findIndex((e=>f(e,t)>-1))},v=e=>{var t;if(!e.children||0===(null===(t=e.children)||void 0===t?void 0:t.length))return 0;const n=e.children.map(v);return Math.max(...n)+1},x=(e,t)=>{const n=new Set;let s=e;for(;s&&s.parentId;)n.add(s.parentId),s=t[s.parentId];return n},y=e=>{var t;return!!e.parentId&&([a.UG.AGENT,a.UG.RETRIEVER,a.UG.CHAT_MODEL,a.UG.TOOL,a.UG.LLM].includes(null!==(t=e.type)&&void 0!==t?t:a.UG.UNKNOWN)||(0,i.N7)(e)>0)}},86125:function(e,t,n){n.d(t,{BS:function(){return m},CL:function(){return q},Hq:function(){return J},I$:function(){return W},LS:function(){return v},MF:function(){return C},N7:function(){return j},NH:function(){return g},OS:function(){return _},PC:function(){return z},Q0:function(){return B},UZ:function(){return S},W0:function(){return L},ZI:function(){return Q},bn:function(){return $},cp:function(){return I},f7:function(){return Y},gD:function(){return w},g_:function(){return R},h8:function(){return P},ij:function(){return h},in:function(){return G},jW:function(){return F},ko:function(){return ne},nr:function(){return se},ob:function(){return N},pQ:function(){return Z},tC:function(){return f},tI:function(){return ae},vL:function(){return b},vX:function(){return re},vl:function(){return O},x0:function(){return U},xD:function(){return x},yt:function(){return te}});var s=n(68248),r=n(76118),a=n(46709),i=n(94664),o=n(51847),l=n(9773),d=n(69660),c=n(21636),u=n(81390),p=n(73408);const m="model-trace-info-v3",h=e=>{},g=e=>{};function f(e){switch(e){case i.UG.LLM:return i.Dy.MODELS;case i.UG.CHAIN:return i.Dy.CHAIN;case i.UG.AGENT:return i.Dy.AGENT;case i.UG.TOOL:return i.Dy.WRENCH;case i.UG.CHAT_MODEL:return i.Dy.MODELS;case i.UG.RETRIEVER:return i.Dy.SEARCH;case i.UG.PARSER:return i.Dy.CODE;case i.UG.EMBEDDING:return i.Dy.NUMBERS;case i.UG.RERANKER:return i.Dy.SORT;case i.UG.MEMORY:return i.Dy.SAVE;case i.UG.FUNCTION:return i.Dy.FUNCTION;case i.UG.UNKNOWN:return i.Dy.UNKNOWN;default:return i.Dy.FUNCTION}}function v(e){switch(e){case i.UG.LLM:return"LLM";case i.UG.CHAIN:return"Chain";case i.UG.AGENT:return"Agent";case i.UG.TOOL:return"Tool";case i.UG.CHAT_MODEL:return"Chat model";case i.UG.RETRIEVER:return"Retriever";case i.UG.PARSER:return"Parser";case i.UG.EMBEDDING:return"Embedding";case i.UG.RERANKER:return"Reranker";case i.UG.MEMORY:return"Memory";case i.UG.FUNCTION:return"Function";case i.UG.UNKNOWN:return"Unknown";default:return e}}function x(e){try{return JSON.parse(e)}catch(t){return e}}const y=(e,t)=>{if(!t)return[];const n=[],s={inputs:null===e||void 0===e?void 0:e.inputs,outputs:null===e||void 0===e?void 0:e.outputs,attributes:null===e||void 0===e?void 0:e.attributes,events:null===e||void 0===e?void 0:e.events};return(0,r.map)(s,((s,r)=>{if("events"===r)return void n.push(...((e,t)=>{const n=e.events;if(!n)return[];const s=[];return n.forEach(((n,r)=>{const a=n.attributes;a&&Object.keys(a).forEach((i=>{const o=i.toLowerCase().includes(t),l=B(n.name,r,i);o&&s.push({span:e,section:"events",key:l,isKeyMatch:!0,matchIndex:0});const d=JSON.stringify(a[i]).toLowerCase().split(t).length-1;for(let t=0;t<d;t++)s.push({span:e,section:"events",key:l,isKeyMatch:!1,matchIndex:t})}))})),s})(e,t));R(s).forEach((s=>{s.key.toLowerCase().includes(t)&&n.push({span:e,section:r,key:s.key,isKeyMatch:!0,matchIndex:0});const a=s.value.toLowerCase().split(t).length-1;for(let t=0;t<a;t++)n.push({span:e,section:r,key:s.key,isKeyMatch:!1,matchIndex:t})}))})),n};function b(e,t,n){var s,r;const a=t.toLowerCase().trim(),i=Object.values(n.spanTypeDisplayState).every((e=>e));if(""===a&&i)return{filteredTreeNodes:[e],matches:[]};const o=null!==(s=e.children)&&void 0!==s?s:[],l=[],d=[];o.forEach((e=>{const{filteredTreeNodes:t,matches:s}=b(e,a,n);l.push(...t),d.push(...s)}));const c=(null!==(r=e.title)&&void 0!==r?r:"").toLowerCase(),u=y(e,a),p=u.length>0||c.includes(a),m=!e.type||n.spanTypeDisplayState[e.type],h=p&&m,g=l.length>0,f=j(e)>0;return h||n.showParents&&g||n.showExceptions&&f?{filteredTreeNodes:[{...e,children:l}],matches:u.concat(d)}:{filteredTreeNodes:l,matches:d}}function Y(e,t){var n;if((0,r.isNil)(t)||(0,r.isNil)(e))return;if(e.key===t)return e;const s=null!==(n=e.children)&&void 0!==n?n:[];for(const r of s){const e=Y(r,t);if(e)return e}}const A=(e,t,n,s,a,i)=>{var d,c,u,m,h,g,v,y;const b=x(null===(d=e.attributes)||void 0===d?void 0:d["mlflow.spanType"]),Y=x(null===(c=e.attributes)||void 0===c?void 0:c["mlflow.spanInputs"]),A=x(null===(u=e.attributes)||void 0===u?void 0:u["mlflow.spanOutputs"]),T=I(e),w=M(e),S=null!==(m=a[w])&&void 0!==m?m:[];var C;T||S.push(...null!==(C=a[""])&&void 0!==C?C:[]);const N=x(null===(h=e.attributes)||void 0===h?void 0:h["mlflow.chat.messages"]),F=x(null===(g=e.attributes)||void 0===g?void 0:g["mlflow.message.format"]),E=((e,t,n,s,a)=>{var i,o;if(Array.isArray(e)&&e.every(W))return(0,r.compact)(e.map(Q));const d=null!==(i=J(t,s))&&void 0!==i?i:[],c=null!==(o=J(n,s))&&void 0!==o?o:[];if("pydantic_ai"===s&&c.length>0)return d.length>0?d.concat(c):c;if("voltagent"===s&&a&&a.length>0){const e=(0,l.Nw)(t,n,a);if(e&&e.length>0)return e}return 0!==d.length&&0!==c.length?d.concat(c):void 0})(N,Y,A,F,s),H=((e,t)=>{var n;return Array.isArray(e)&&e.every(z)?e:Array.isArray(null===t||void 0===t?void 0:t.tools)&&null!==t&&void 0!==t&&null!==(n=t.tools)&&void 0!==n&&n.every(z)?t.tools:void 0})(x(null===(v=e.attributes)||void 0===v?void 0:v["mlflow.chat.tools"]),Y),R=(0,r.mapValues)((0,r.omitBy)(e.attributes,((e,t)=>t.startsWith("mlflow."))),(e=>x(e))),_=e.events,L=(Number(k(e))-t)/1e3,O=(Number(null!==(y=D(e))&&void 0!==y?y:n)-t)/1e3;return{title:e.name,icon:(0,p.Y)(o.P,{type:f(b),hasException:j(e)>0,isRootSpan:!T}),type:b,key:w,start:L,end:O,children:s,inputs:Y,outputs:A,attributes:R,events:_,chatMessageFormat:F,chatMessages:E,chatTools:H,parentId:T,assessments:S,traceId:i}},T=(e,t)=>{if(!e)return"";if(t&&e.length<16)try{return(e=>{const t=atob(e),n=t.length;let s="";for(let r=0;r<n;r++)s+=t.charCodeAt(r).toString(16).padStart(2,"0");return s})(e)}catch(n){return e}return e.startsWith("0x")?e.slice(2):e};function w(e){return!!e&&"trace_location"in e}function S(e){return"start_time_unix_nano"in e}function M(e){var t,n,s;return S(e)?T(null!==(t=e.span_id)&&void 0!==t?t:"",!0):T(null!==(n=null===(s=e.context)||void 0===s?void 0:s.span_id)&&void 0!==n?n:"",!1)}function I(e){var t,n;return S(e)?T(null!==(t=e.parent_span_id)&&void 0!==t?t:"",!0):T(null!==(n=e.parent_id)&&void 0!==n?n:"",!1)}function k(e){return S(e)?Number(e.start_time_unix_nano):Number(e.start_time)}function D(e){return S(e)?Number(e.end_time_unix_nano):Number(e.end_time)}function C(e){var t;return w(e.info)?e.info.trace_id:null!==(t=e.info.request_id)&&void 0!==t?t:""}function N(e){var t,n;if(!w(e.info))return null;const s=Number(null===(t=e.info)||void 0===t||null===(n=t.trace_metadata)||void 0===n?void 0:n["mlflow.trace.sizeBytes"]);return(0,r.isNil)(s)||isNaN(s)?null:s}function F(e){var t,n;const s=C(e),a=(null!==(t=null===(n=e.trace_data)||void 0===n?void 0:n.spans)&&void 0!==t?t:e.data.spans).map(ee),l={},d={};a.forEach((e=>{const t=M(e);l[t]=e,d[t]=[]})),a.forEach((e=>{const t=M(e),n=I(e);if(n){if(!d[n])throw new Error("Tree structure is malformed!");d[n].push(t)}}));const c=a.find((e=>!I(e)));if((0,r.isNil)(c))return null;return function t(n){var r,a,u;const m=l[n],h=Number(k(c)),g=Number(D(c)),v=d[n].map(t),x=E(e.info);if(S(m)||"parent_id"in m)return A(m,h,g,v,x,s);const y=null!==(r=m.span_type)&&void 0!==r?r:i.UG.UNKNOWN;return{title:m.name,icon:(0,p.Y)(o.P,{type:f(y)}),type:y,key:m.context.span_id,start:Number(m.start_time)-h,end:Number(null!==(a=m.end_time)&&void 0!==a?a:g)-h,children:v,inputs:m.inputs,outputs:m.outputs,attributes:m.attributes,events:m.events,parentId:null!==(u=m.parent_id)&&void 0!==u?u:m.parent_span_id,assessments:[],traceId:s}}(M(c))}const E=e=>{let t=[];var n;w(e)?t=null!==(n=e.assessments)&&void 0!==n?n:[]:t=H(e.tags);const s=(0,r.keyBy)(t,"assessment_id");Object.values(s).forEach((e=>{if(e.overrides){const t=s[e.overrides];e.overriddenAssessment=t}})),t=Object.values(s);const a=t.reduce(((e,t)=>{var n;const s=null!==(n=t.span_id)&&void 0!==n?n:"";return e[s]||(e[s]=[]),e[s].push(t),e}),{});return Object.keys(a).forEach((e=>{a[e].sort(((e,t)=>new Date(t.last_update_time).getTime()-new Date(e.last_update_time).getTime()))})),a},H=e=>{if(!e)return[];return(Array.isArray(e)?e:Object.entries(e).map((([e,t])=>({key:e,value:t})))).filter((({key:e})=>e.startsWith("mlflow.assessment."))).map((({value:e})=>JSON.parse(e)))};const R=e=>(0,r.isNil)(e)?[]:Array.isArray(e)||(0,r.isString)(e)||(0,r.isNumber)(e)||(0,r.isBoolean)(e)?[{key:"",value:JSON.stringify(e,null,2)}]:Object.entries(e).map((([e,t])=>({key:e,value:JSON.stringify(t,null,2)}))),_=({searchFilter:e,data:t,activeMatchBackgroundColor:n,inactiveMatchBackgroundColor:a,containsActiveMatch:i,activeMatch:o,scrollToActiveMatch:l})=>{const d=new RegExp(`(${(0,r.escapeRegExp)(e.trim())})`,"gi"),c=t.split(d),u=[];let m=0;for(let r=0;r<c.length;r++)if(c[r].toLowerCase().includes(e.toLowerCase().trim())){const e=i&&o.matchIndex===m,t=e?n:a,d=(0,p.Y)("span",{ref:e?l:null,css:(0,s.AH)({backgroundColor:t,scrollMarginTop:50},""),children:c[r]},r);m++,u.push(d)}else u.push(c[r]);return u},L=e=>(0,r.has)(e,"page_content"),O=e=>e.type===i.UG.RETRIEVER&&Array.isArray(e.outputs)&&e.outputs.length>0&&(0,r.every)(e.outputs,L),B=(e,t,n)=>`${e}-${t}-${n}`,$=e=>{var t;return(null!==(t=e.events)&&void 0!==t?t:[]).filter((e=>"exception"===e.name))},j=e=>$(e).length,V=e=>!(0,r.isNil)(e)&&(!(!(0,r.isNil)(e.type)&&!(0,r.isString)(e.type))&&(!(!(0,r.isNil)(e.description)&&!(0,r.isString)(e.description))&&!(!(0,r.isNil)(e.enum)&&!Array.isArray(e.enum)))),z=e=>{var t;if((0,r.isNil)(e)||"function"!==e.type||!(0,r.has)(e,"function.name"))return!1;const n=null===(t=e.function)||void 0===t?void 0:t.parameters;if(!(0,r.isNil)(n)){const e=n.required;if(!(0,r.isNil)(e)&&(!Array.isArray(e)||!e.every(r.isString)))return!1;const t=n.properties;if(!(0,r.isNil)(t)&&!Object.values(t).every(V))return!1}return!0},P=e=>{var t,n;return e&&(0,r.isString)(e.id)&&(0,r.isString)(null===(t=e.function)||void 0===t?void 0:t.arguments)&&(0,r.isString)(null===(n=e.function)||void 0===n?void 0:n.name)},K=e=>!(!(0,r.isNil)(e)&&!(0,r.isString)(e))||!!(0,r.isArray)(e)&&e.every((e=>(e=>{switch(e.type){case"text":case"input_text":case"output_text":return(0,r.isString)(e.text);case"image_url":const{image_url:t}=e;return!(0,r.isNil)(t)&&(0,r.isString)(t.url)&&((0,r.isNil)(t.detail)||["auto","low","high"].includes(t.detail));case"input_audio":const{input_audio:n}=e;return!(0,r.isNil)(n)&&(0,r.isString)(n.data)&&((0,r.isNil)(n.format)||["wav","mp3"].includes(n.format));default:return!1}})(e))),W=e=>{if(!e)return!1;if(e.tool_calls){if(!Array.isArray(e.tool_calls))return!1;if(!e.tool_calls.every(P))return!1}return(!e.parts||!(0,r.isNil)(e.content))&&("reasoning"===e.type||!!K(e.content)&&("user"===e.role||"assistant"===e.role||"system"===e.role||"tool"===e.role))},U=e=>Array.isArray(e)&&e.length>0&&e.every((e=>{return(0,r.has)(e,"message")&&(t=e.message,!!W(t)&&((0,r.isNil)(t.content)||(0,r.isString)(t.content)));var t})),G=e=>e&&U(e.choices),J=(e,t)=>{var n,s,a,i,o,c,u,p,m,h,g,f,v,x,y,b;try{if(Array.isArray(e)&&e.length>0&&e.every(W))return(0,r.compact)(e.map(Q));switch(t){case"langchain":const t=null!==(n=(0,l.HD)(e))&&void 0!==n?n:(0,l.oI)(e);if(t)return t;break;case"llamaindex":const r=null!==(s=(0,l.Hy)(e))&&void 0!==s?s:(0,l.W3)(e);if(r)return r;break;case"openai":const Y=null!==(a=null!==(i=null!==(o=null!==(c=(0,l.a8)(e))&&void 0!==c?c:(0,l.bS)(e))&&void 0!==o?o:(0,l.n_)(e))&&void 0!==i?i:(0,l.AG)(e))&&void 0!==a?a:(0,d.x1)(e);if(Y)return Y;break;case"dspy":const A=null!==(u=(0,l.iU)(e))&&void 0!==u?u:(0,l.Pn)(e);if(A)return A;break;case"gemini":const T=null!==(p=(0,l.DE)(e))&&void 0!==p?p:(0,l.Sy)(e);if(T)return T;break;case"anthropic":const w=null!==(m=(0,l.KF)(e))&&void 0!==m?m:(0,l.pL)(e);if(w)return w;break;case"openai-agent":const S=null!==(h=(0,l.xW)(e))&&void 0!==h?h:(0,l.m$)(e);if(S)return S;break;case"autogen":const M=null!==(g=(0,l.nW)(e))&&void 0!==g?g:(0,l.u6)(e);if(M)return M;break;case"bedrock":const I=null!==(f=(0,l.Yv)(e))&&void 0!==f?f:(0,l.f1)(e);if(I)return I;break;case"vercel_ai":const k=null!==(v=(0,l.fJ)(e))&&void 0!==v?v:(0,l.QA)(e);if(k)return k;break;case"pydantic_ai":const D=null!==(x=(0,l.Ii)(e))&&void 0!==x?x:(0,l.TY)(e);if(D)return D;break;case"voltagent":const C=null!==(y=(0,l.o0)(e))&&void 0!==y?y:(0,l.LO)(e);if(C)return C;break;default:const N=null!==(b=(0,l.a8)(e))&&void 0!==b?b:(0,l.bS)(e);if(N)return N}return Array.isArray(e)&&e.length>0&&e.every(l.oi)?(0,r.compact)(e.map(l.pN)):null}catch(Y){return null}},q=e=>{var t;let n=null===(t=e.function)||void 0===t?void 0:t.arguments;try{n=JSON.stringify(JSON.parse(n),null,2)}catch(s){}return{id:e.id,function:{arguments:n,name:e.function.name}}},X=e=>{if((0,r.isNil)(e)||(0,r.isString)(e))return e;return e.map((e=>{var t;switch(e.type){case"text":case"input_text":case"output_text":return e.text;case"image_url":const n=null===e||void 0===e||null===(t=e.image_url)||void 0===t?void 0:t.url;return n?`![](${n})`:"[image]";case"input_audio":return"[audio]"}})).filter((e=>void 0!==e)).join("\n\n")},Q=e=>{var t;return"reasoning"===e.type?null:{...e,content:X(e.content),tool_calls:null===(t=e.tool_calls)||void 0===t?void 0:t.map(q)}},Z=e=>{if((0,r.isNil)(e))return"content";if(e.chatMessages)return"chat";return!(0,r.isNil)(e.inputs)||!(0,r.isNil)(e.outputs)?"content":"attributes"},ee=e=>{var t;const n=e=>Array.isArray(e)?e.reduce(((e,t)=>{return t.key&&t.value?{...e,[t.key]:(n=t.value,(0,r.isObject)(n)?"string_value"in n?n.string_value:"bool_value"in n?n.bool_value:"int_value"in n?n.int_value:"double_value"in n?n.double_value:n:n)}:e;var n}),{}):e;return{...e,...e.attributes&&{attributes:n(e.attributes)},...e.events&&{events:null===(t=e.events)||void 0===t?void 0:t.map((e=>({...e,attributes:n(e.attributes)})))}}},te=e=>(0,a.useMemo)((()=>{if(!e)return[];return(0,u.VC)([e]).filter(u.fJ)}),[e]),ne=e=>{var t;return Boolean(e&&w(e)&&"UC_SCHEMA"===(null===(t=e.trace_location)||void 0===t?void 0:t.type))},se=e=>{var t,n,s,r;return"MLFLOW_EXPERIMENT"===e.type?null===(t=e.mlflow_experiment)||void 0===t?void 0:t.experiment_id:"INFERENCE_TABLE"===e.type?null===(n=e.inference_table)||void 0===n?void 0:n.full_table_name:"UC_SCHEMA"===e.type?`${null===(s=e.uc_schema)||void 0===s?void 0:s.catalog_name}.${null===(r=e.uc_schema)||void 0===r?void 0:r.schema_name}`:void 0},re=e=>{const t=se(e.trace_location);return t?`trace:/${t}/${e.trace_id}`:e.trace_id},ae=e=>{var t;const n=null===(t=e.trace_metadata)||void 0===t?void 0:t[c.Uu];if(!n)return null;try{var s;const e=JSON.parse(n);return null!==(s=null===e||void 0===e?void 0:e.total_tokens)&&void 0!==s?s:null}catch{return null}}},89602:function(e,t,n){n.d(t,{C:function(){return a}});var s=n(27757),r=n(73408);function a({children:e}){return(0,r.Y)(s.T.Text,{bold:!0,children:e})}},94664:function(e,t,n){n.d(t,{Dy:function(){return r},UG:function(){return s},VZ:function(){return a},cC:function(){return i}});let s=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.FUNCTION="FUNCTION",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e}({}),r=function(e){return e.MODELS="models",e.DOCUMENT="document",e.CONNECT="connect",e.SEARCH="search",e.SORT="sort",e.UNKNOWN="unknown",e.FUNCTION="function",e.CODE="code",e.NUMBERS="numbers",e.WRENCH="wrench",e.AGENT="agent",e.CHAIN="chain",e.USER="user",e.SYSTEM="system",e.SAVE="save",e}({}),a=function(e){return e.LLM="LLM",e.CHAIN="CHAIN",e.AGENT="AGENT",e.TOOL="TOOL",e.CHAT_MODEL="CHAT_MODEL",e.RETRIEVER="RETRIEVER",e.PARSER="PARSER",e.EMBEDDING="EMBEDDING",e.RERANKER="RERANKER",e.MEMORY="MEMORY",e.UNKNOWN="UNKNOWN",e}({}),i=function(e){return e.JSON="json",e.TEXT="text",e.MARKDOWN="markdown",e.PYTHON="python",e}({})},97407:function(e,t,n){n.d(t,{R0:function(){return Y},C2:function(){return f.C},ki:function(){return w},Es:function(){return p},qd:function(){return g},tP:function(){return A},$W:function(){return I}});var s=n(59930),r=n.n(s),a=n(884),i=n(45175),o=n(46709),l=n(73408);const d=(0,o.createContext)(null);function c({children:e,...t}){return(0,l.Y)(d.Provider,{value:t,children:e})}function u(){const e=(0,o.useContext)(d);return r()(e,"useTagAssignmentContext must be used within a TagAssignmentRoot"),e}function p({children:e,...t}){const n=(0,a.xW)(),s=(0,l.Y)(c,{...t,children:(0,l.Y)(i.V,{children:e})});return n?s:(r()(t.form,"Nest your component on a FormProvider or pass a form prop"),(0,l.Y)(a.Op,{...t.form,children:s}))}var m=n(68248),h=n(27757);function g({children:e}){const{theme:t}=(0,h.u)(),n=o.Children.toArray(e);r()(n.length<=3,"TagAssignmentRow must have 3 children or less");const s=Array(3).fill(null).map(((e,s)=>{var r;return null!==(r=n[s])&&void 0!==r?r:(0,l.Y)("span",{style:{width:t.general.heightSm}},s)}));return(0,l.Y)("div",{css:(0,m.AH)({display:"grid",gridTemplateColumns:"1fr 1fr min-content",gap:t.spacing.sm},""),children:s})}var f=n(89602),v=n(66916),x=n(27299);var y={name:"82a6rk",styles:"flex:1"};const b=(0,o.forwardRef)((({errorMessage:e,...t},n)=>(0,l.FD)("div",{css:y,children:[(0,l.Y)(v.I,{validationState:e?"error":"info",...t,ref:n}),e&&(0,l.Y)(x.FormUI.Message,{message:e,type:"error"})]})));function Y({index:e,rules:t,render:n}){const{name:s,keyProperty:r,getTagsValues:i,emptyValue:o,appendIfPossible:d}=u();return(0,l.Y)(a.xI,{name:`${s}.${e}.${r}`,rules:t,render:({field:e,fieldState:t,formState:s})=>{var a;const c=e.onChange;return e.onChange=function(e){var t;c(e);const n=i();null!==n&&void 0!==n&&null!==(t=n.at(-1))&&void 0!==t&&t[r]&&d(o,{shouldFocus:!1})},n?n({field:e,fieldState:t,formState:s}):(0,l.Y)(b,{componentId:"TagAssignmentKey.Default.Input",errorMessage:null===(a=t.error)||void 0===a?void 0:a.message,...e})}})}function A({rules:e,index:t,render:n}){const{name:s,valueProperty:r}=u();return(0,l.Y)(a.xI,{rules:e,name:`${s}.${t}.${r}`,render:({field:e,fieldState:t,formState:s})=>{var r;return n?n({field:e,fieldState:t,formState:s}):(0,l.Y)(b,{componentId:"TagAssignmentValue.Default.Input",errorMessage:null===(r=t.error)||void 0===r?void 0:r.message,...e})}})}var T=n(31988);function w({index:e,...t}){const{removeOrUpdate:n}=u();return(0,l.Y)(T.u,{onClick:()=>n(e),...t})}var S=n(7655);function M(e,t){if(void 0!==e)return 0===e&&r()(!1,"maxLength must be greater than 0"),{maxLength:{value:e,message:t.formatMessage({id:"JW0GbU",defaultMessage:"You can set a maximum of {maxLength} values"},{maxLength:e})}}}function I({name:e,maxLength:t,emptyValue:n,defaultValues:s,loading:i,form:l,keyProperty:d,valueProperty:c}){const[u]=(0,o.useState)(n),p=(0,a.xW)(),m=Boolean(p)&&!l,h=m?p:l;r()(h,"Nest your component on a FormProvider or pass a form prop"),r()(!(s&&m),"Define defaultValues at form context level");const{setValue:g}=h,f=function({name:e,maxLength:t,emptyValue:n,form:s,keyProperty:i}){const l=(0,S.A)(),d=(0,a.xW)(),c=Boolean(d)&&!s?d:s;r()(c,"Nest your component on a FormProvider or pass a form prop");const[u]=(0,o.useState)(n),{append:p,update:m,remove:h,...g}=(0,a.jz)({name:e,control:c.control,rules:M(t,l)}),{getValues:f}=c,v=(0,o.useCallback)((()=>f(e)),[f,e]),x=(0,o.useCallback)(((e,n)=>{const s=v();t&&s&&s.length>=t||p(e,n)}),[v,t,p]),y=(0,o.useCallback)((e=>{const t=v();if(t&&e===t.length-1)return m(e,u);const n=null===t||void 0===t?void 0:t.at(-1);if(null!==n&&void 0!==n&&n[i])return h(e),void p(u,{shouldFocus:!1});h(e)}),[u,v,i,p,h,m]);return{form:c,...g,originalAppend:p,update:m,originalRemove:h,appendIfPossible:x,removeOrUpdate:y,getTagsValues:v}}({name:e,maxLength:t,emptyValue:n,form:h,keyProperty:d}),v=f.getTagsValues;return(0,o.useEffect)((()=>{if(!i){if(s){const n=[...s];return(!t||t&&n.length<t)&&n.push(u),void g(e,n)}if(m){var n;const s=null!==(n=v())&&void 0!==n?n:[];return(!t||t&&s.length<t)&&s.push(u),void g(e,s)}g(e,[u])}}),[s,g,i,t,e,u,m,v]),{...f,form:h,maxLength:t,emptyValue:n,name:e,keyProperty:d,valueProperty:c}}}}]);